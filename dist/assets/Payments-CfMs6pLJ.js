import{u as q,j as e}from"./index-Cb5Y6uas.js";import{u as V,r as m}from"./react-CzDbI3ao.js";const w="http://localhost:4000",t={primary:"#D97706",primaryHover:"#B45309",accent:"#15803D",accentHover:"#166534",background:"#F9FAFB",cardBg:"#FFFFFF",border:"#E2E8F0",text:"#1E1E1E",textLight:"#64748B",textLighter:"#94A3B8",error:"#DC2626",errorLight:"#FEF2F2",success:"#15803D",successLight:"#F0FDF4",warning:"#D97706",warningLight:"#FFFBEB"},d={Money:s=>e.jsx("svg",{...s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})}),Phone:s=>e.jsx("svg",{...s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),Check:s=>e.jsx("svg",{...s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),Clock:s=>e.jsx("svg",{...s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),Refresh:s=>e.jsx("svg",{...s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),Edit:s=>e.jsx("svg",{...s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})},j=({children:s,className:u="",padding:a="p-6",style:c})=>e.jsx("div",{className:`rounded-2xl shadow-sm border transition-all duration-300 hover:shadow-md ${a} ${u}`,style:{backgroundColor:t.cardBg,borderColor:t.border,...c||{}},children:s}),A=({children:s,onClick:u,disabled:a=!1,loading:c=!1,size:y="md",className:h="",type:p="button"})=>{const f={sm:"px-4 py-2 text-sm",md:"px-6 py-3 text-base",lg:"px-8 py-4 text-lg"};return e.jsxs("button",{type:p,onClick:u,disabled:a||c,className:`rounded-xl font-semibold text-white transition-all duration-300 flex items-center justify-center gap-3 shadow-lg hover:shadow-xl active:scale-95 ${f[y]} ${h}`,style:{backgroundColor:a?t.textLighter:t.primary,cursor:a?"not-allowed":"pointer",opacity:a?.6:1},onMouseOver:x=>{!a&&!c&&(x.currentTarget.style.backgroundColor=t.primaryHover)},onMouseOut:x=>{!a&&!c&&(x.currentTarget.style.backgroundColor=t.primary)},children:[c&&e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),s]})},J=({children:s,onClick:u,disabled:a=!1,size:c="md",className:y=""})=>{const h={sm:"px-4 py-2 text-sm",md:"px-6 py-3 text-base",lg:"px-8 py-4 text-lg"};return e.jsx("button",{onClick:u,disabled:a,className:`rounded-xl font-semibold text-white transition-all duration-300 flex items-center justify-center gap-3 shadow-lg hover:shadow-xl active:scale-95 ${h[c]} ${y}`,style:{backgroundColor:a?t.textLighter:t.accent,cursor:a?"not-allowed":"pointer",opacity:a?.6:1},onMouseOver:p=>{a||(p.currentTarget.style.backgroundColor=t.accentHover)},onMouseOut:p=>{a||(p.currentTarget.style.backgroundColor=t.accent)},children:s})},Q=()=>{const{t:s}=q(),u=V(),a=new Date().toLocaleString(void 0,{month:"long",year:"numeric"}),[c,y]=m.useState([]),[h,p]=m.useState([]),[f,x]=m.useState(null),[I,F]=m.useState(!1),[k,R]=m.useState(""),[C,O]=m.useState(""),[M,S]=m.useState(""),[L,W]=m.useState(!1),[B,P]=m.useState(!1),$=m.useMemo(()=>new URLSearchParams(u.search),[u.search]),E=$.get("clientId"),D=$.get("clientName");function b(){const o=localStorage.getItem("token");if(!o)return;F(!0),x(null);const i=new URLSearchParams(u.search),r=i.get("scope"),l=i.get("filter"),n=[];r&&n.push(`scope=${encodeURIComponent(r)}`),l&&n.push(`filter=${encodeURIComponent(l)}`),r||n.push("mine=true");const T=n.length?`?${n.join("&")}`:"";Promise.all([fetch(`${w}/api/payments/transactions${T}`,{headers:{Authorization:`Bearer ${o}`}}),fetch(`${w}/api/payments/completed${T}`,{headers:{Authorization:`Bearer ${o}`}})]).then(async([g,z])=>{const v=await g.json(),N=await z.json();if(!g.ok)throw new Error((v==null?void 0:v.error)||"Failed to load pending");if(!z.ok)throw new Error((N==null?void 0:N.error)||"Failed to load completed");y(v.transactions||[]),p(N.payments||[])}).catch(g=>x((g==null?void 0:g.message)||"Failed to load payments")).finally(()=>{F(!1)})}m.useEffect(()=>{const i=new Date().toLocaleString(void 0,{month:"long"}),r=s("payments.payForMonth",{month:i}),l=D?`${r} — ${D}`:r;S(l),b()},[u.search,s]);const _=m.useMemo(()=>{const o=new Date,i=o.getMonth(),r=o.getFullYear();return c.filter(l=>{const n=new Date(l.created_at);return n.getMonth()===i&&n.getFullYear()===r}).reduce((l,n)=>l+(Number(n.amount)||0),0)},[c]),H=m.useMemo(()=>{const o=new Date,i=o.getMonth(),r=o.getFullYear();return h.filter(l=>{const n=new Date(l.completed_at);return n.getMonth()===i&&n.getFullYear()===r}).reduce((l,n)=>l+(Number(n.amount)||0),0)},[h]);async function Y(o){if(o.preventDefault(),B)return;const i=localStorage.getItem("token");if(!i){x("Not authenticated");return}try{P(!0),x(null);const r={amount:Number(k),phoneNumber:C,purpose:M};E&&(r.clientId=Number(E));const l=await fetch(`${w}/api/payments/transactions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify(r)}),n=await l.json();if(!l.ok)throw new Error((n==null?void 0:n.error)||"Failed to initiate payment");await b()}catch(r){x((r==null?void 0:r.message)||"Failed to initiate payment")}finally{P(!1)}}async function U(o){const i=localStorage.getItem("token");if(!i){x("Not authenticated");return}try{x(null);const r=await fetch(`${w}/api/payments/transactions/${o}/complete`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({})}),l=await r.json();if(!r.ok)throw new Error((l==null?void 0:l.error)||"Failed to complete transaction");await b()}catch(r){x((r==null?void 0:r.message)||"Failed to complete transaction")}}return e.jsx("div",{className:"min-h-screen p-4 lg:p-6",style:{backgroundColor:t.background},children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl lg:text-4xl font-bold mb-2",style:{color:t.text},children:s("payments.title")}),e.jsx("p",{className:"text-lg",style:{color:t.textLight},children:s("payments.subtitle")})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full animate-pulse",style:{backgroundColor:t.accent}}),e.jsx("div",{className:"text-2xl font-bold",style:{color:t.primary},children:c.length+h.length})]}),e.jsx("div",{className:"text-sm",style:{color:t.textLight},children:s("payments.totalTransactions")})]}),e.jsxs(A,{onClick:b,loading:I,size:"md",className:"flex items-center gap-2",children:[e.jsx(d.Refresh,{className:"w-4 h-4"}),e.jsx("span",{children:s("common.refresh")})]})]})]}),f&&e.jsx("div",{className:"rounded-2xl p-4 border animate-fadeIn",style:{backgroundColor:t.errorLight,borderColor:t.error},children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-3 h-3 rounded-full animate-pulse",style:{backgroundColor:t.error}}),e.jsx("span",{className:"font-semibold",style:{color:t.error},children:f})]})}),e.jsxs(j,{padding:"p-6 lg:p-8",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(d.Money,{className:"w-6 h-6",style:{color:t.primary}}),e.jsx("h3",{className:"text-xl font-semibold",style:{color:t.text},children:s("payments.initiatePayment")})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"px-4 py-2 rounded-xl font-semibold text-white",style:{backgroundColor:t.primary},children:"MTN MoMo"}),e.jsx("span",{className:"text-sm",style:{color:t.textLight},children:s("payments.serviceName")})]})]}),e.jsxs("form",{onSubmit:Y,className:"grid grid-cols-1 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-semibold mb-3 flex items-center gap-2",style:{color:t.text},children:[e.jsx(d.Money,{className:"w-4 h-4",style:{color:t.primary}}),s("payments.amountRWF")]}),e.jsx("input",{type:"number",min:"0",step:"0.01",className:"w-full px-4 py-3 rounded-xl border focus:outline-none focus:ring-2 transition-all duration-300",style:{backgroundColor:t.cardBg,borderColor:t.border,color:t.text},value:k,onChange:o=>R(o.target.value),required:!0,placeholder:s("payments.amountPlaceholder")})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-semibold mb-3 flex items-center gap-2",style:{color:t.text},children:[e.jsx(d.Phone,{className:"w-4 h-4",style:{color:t.primary}}),s("payments.phoneNumber")]}),e.jsx("input",{className:"w-full px-4 py-3 rounded-xl border focus:outline-none focus:ring-2 transition-all duration-300",style:{backgroundColor:t.cardBg,borderColor:t.border,color:t.text},value:C,onChange:o=>O(o.target.value),required:!0,placeholder:s("payments.phonePlaceholder")})]}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("label",{className:"text-sm font-semibold flex items-center gap-2",style:{color:t.text},children:[e.jsx(d.Edit,{className:"w-4 h-4",style:{color:t.primary}}),s("payments.paymentPurpose")]}),e.jsxs("button",{type:"button",onClick:()=>W(o=>!o),className:"flex items-center gap-1 text-sm font-medium transition-all duration-300 hover:scale-105",style:{color:t.primary},children:[e.jsx(d.Edit,{className:"w-3 h-3"}),s(L?"payments.doneEditing":"payments.editPurpose")]})]}),e.jsx("input",{className:"w-full px-4 py-3 rounded-xl border focus:outline-none focus:ring-2 transition-all duration-300",style:{backgroundColor:L?t.cardBg:t.background,borderColor:t.border,color:t.text},value:M,onChange:o=>S(o.target.value),readOnly:!L,placeholder:s("payments.purposePlaceholder")})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(A,{type:"submit",loading:B,disabled:!k||!C,className:"w-full py-3",children:[e.jsx(d.Money,{className:"w-4 h-4"}),e.jsx("span",{children:s("payments.initiatePayment")})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(j,{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-3",children:[e.jsx(d.Clock,{className:"w-6 h-6",style:{color:t.warning}}),e.jsx("div",{className:"text-2xl font-bold",style:{color:t.text},children:c.length})]}),e.jsxs("div",{className:"text-sm font-semibold",style:{color:t.textLight},children:[s("payments.pendingTransactions")," — ",a]}),e.jsxs("div",{className:"text-lg font-bold mt-1",style:{color:t.warning},children:[_.toLocaleString()," RWF"]})]}),e.jsxs(j,{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-3",children:[e.jsx(d.Check,{className:"w-6 h-6",style:{color:t.success}}),e.jsx("div",{className:"text-2xl font-bold",style:{color:t.text},children:h.length})]}),e.jsxs("div",{className:"text-sm font-semibold",style:{color:t.textLight},children:[s("payments.completedPayments")," — ",a]}),e.jsxs("div",{className:"text-lg font-bold mt-1",style:{color:t.success},children:[H.toLocaleString()," RWF"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-8",children:[e.jsxs(j,{padding:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(d.Clock,{className:"w-5 h-5",style:{color:t.warning}}),e.jsx("h3",{className:"text-lg font-semibold",style:{color:t.text},children:s("payments.pendingTransactions")})]}),e.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-semibold",style:{backgroundColor:t.warningLight,color:t.warning},children:s("payments.waitingCount",{count:c.length})})]}),e.jsxs("div",{className:"space-y-4",children:[c.map(o=>e.jsx("div",{className:"p-4 rounded-xl border transition-all duration-300 hover:shadow-md group",style:{backgroundColor:t.cardBg,borderColor:t.border},children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full animate-pulse",style:{backgroundColor:t.warning}}),e.jsx("div",{className:"font-semibold",style:{color:t.text},children:s("payments.transaction",{id:o.id})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{style:{color:t.textLight},children:s("payments.client")}),e.jsx("div",{className:"font-medium",style:{color:t.text},children:o.client_username||`Client #${o.client_id}`})]}),e.jsxs("div",{children:[e.jsx("div",{style:{color:t.textLight},children:s("payments.amount")}),e.jsxs("div",{className:"font-medium",style:{color:t.text},children:[o.amount.toLocaleString()," ",o.currency]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{style:{color:t.textLight},children:s("payments.phone")}),e.jsx("div",{className:"font-medium",style:{color:t.text},children:o.phone_number})]})]})]}),e.jsxs(J,{onClick:()=>U(o.id),size:"sm",className:"flex items-center gap-2",children:[e.jsx(d.Check,{className:"w-3 h-3"}),e.jsx("span",{children:s("payments.complete")})]})]})},o.id)),!c.length&&e.jsxs("div",{className:"text-center py-8 rounded-xl border-2 border-dashed",style:{backgroundColor:t.background,borderColor:t.border},children:[e.jsx(d.Clock,{className:"w-12 h-12 mx-auto mb-3",style:{color:t.textLighter}}),e.jsx("h4",{className:"text-lg font-semibold mb-2",style:{color:t.textLight},children:s("payments.noPendingTitle")}),e.jsx("p",{className:"text-sm",style:{color:t.textLighter},children:s("payments.noPendingDesc")})]})]})]}),e.jsxs(j,{padding:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(d.Check,{className:"w-5 h-5",style:{color:t.success}}),e.jsx("h3",{className:"text-lg font-semibold",style:{color:t.text},children:s("payments.completedPayments")})]}),e.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-semibold",style:{backgroundColor:t.successLight,color:t.success},children:s("payments.processedCount",{count:h.length})})]}),e.jsxs("div",{className:"space-y-4",children:[h.map(o=>e.jsx("div",{className:"p-4 rounded-xl border transition-all duration-300 hover:shadow-md",style:{backgroundColor:t.cardBg,borderColor:t.border},children:e.jsx("div",{className:"flex items-start justify-between gap-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:t.success}}),e.jsx("div",{className:"font-semibold",style:{color:t.text},children:s("payments.payment",{id:o.id})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{style:{color:t.textLight},children:s("payments.client")}),e.jsx("div",{className:"font-medium",style:{color:t.text},children:o.client_username||(o.client_id?`Client #${o.client_id}`:"N/A")})]}),e.jsxs("div",{children:[e.jsx("div",{style:{color:t.textLight},children:s("payments.amount")}),e.jsxs("div",{className:"font-medium",style:{color:t.text},children:[o.amount.toLocaleString()," ",o.currency]})]}),e.jsxs("div",{children:[e.jsx("div",{style:{color:t.textLight},children:s("payments.status")}),e.jsx("div",{className:"font-medium capitalize",style:{color:t.success},children:o.status})]}),e.jsxs("div",{children:[e.jsx("div",{style:{color:t.textLight},children:s("payments.date")}),e.jsx("div",{className:"font-medium",style:{color:t.text},children:new Date(o.completed_at).toLocaleDateString()})]})]})]})})},o.id)),!h.length&&e.jsxs("div",{className:"text-center py-8 rounded-xl border-2 border-dashed",style:{backgroundColor:t.background,borderColor:t.border},children:[e.jsx(d.Check,{className:"w-12 h-12 mx-auto mb-3",style:{color:t.textLighter}}),e.jsx("h4",{className:"text-lg font-semibold mb-2",style:{color:t.textLight},children:s("payments.noCompletedTitle")}),e.jsx("p",{className:"text-sm",style:{color:t.textLighter},children:s("payments.noCompletedDesc")})]})]})]})]})]})})};export{Q as default};
