import{u as N,j as e}from"./index-BdDvBGrt.js";import{r as x}from"./react-BeLGUnOF.js";import{d as w,g as y,W as z,h as k}from"./ui-DnAl6TrK.js";const b="http://localhost:4000",E=()=>{const{t}=N(),[m,h]=x.useState({name:"",plateNumber:null,salary:null,zones:[]}),[u,v]=x.useState(!1),[j,p]=x.useState([]);x.useEffect(()=>{const r=localStorage.getItem("token");r&&(v(!0),fetch(`${b}/api/driver/dashboard`,{headers:{Authorization:`Bearer ${r}`}}).then(async l=>{var c,o,a,i;const s=await l.json();if(!l.ok)throw new Error((s==null?void 0:s.error)||"Failed to load driver dashboard");const d=[(c=s==null?void 0:s.user)==null?void 0:c.first_name,(o=s==null?void 0:s.user)==null?void 0:o.last_name].filter(Boolean).join(" ")||((a=s==null?void 0:s.user)==null?void 0:a.username)||"";h({name:d,plateNumber:((i=s==null?void 0:s.vehicle)==null?void 0:i.plate)??null,salary:(s==null?void 0:s.salary)??null,zones:Array.isArray(s==null?void 0:s.zones)?s.zones.map(n=>String((n==null?void 0:n.name)??n)).filter(Boolean):[]})}).catch(async()=>{try{const l=await fetch(`${b}/api/me`,{headers:{Authorization:`Bearer ${r}`}}),s=await l.json();l.ok&&h(d=>{var c;return{...d,name:((c=s==null?void 0:s.user)==null?void 0:c.username)||d.name}})}catch{}}).finally(()=>v(!1)),fetch(`${b}/api/driver/schedule`,{headers:{Authorization:`Bearer ${r}`}}).then(async l=>{var c;const s=await l.json();if(!l.ok)throw new Error((s==null?void 0:s.error)||"Failed to load schedule");const d=Array.isArray(s==null?void 0:s.schedule)?s.schedule:[];if(p(d),!m.plateNumber){const o=new Map;for(const a of d){const i=(c=a.vehicle_plate)==null?void 0:c.trim();i&&o.set(i,(o.get(i)||0)+1)}if(o.size){let a=null,i=-1;o.forEach((n,g)=>{n>i&&(i=n,a=g)}),a&&h(n=>({...n,plateNumber:n.plateNumber??a}))}}}).catch(()=>p([])))},[]);const f=x.useMemo(()=>[t("weekday.mon"),t("weekday.tue"),t("weekday.wed"),t("weekday.thu"),t("weekday.fri"),t("weekday.sat"),t("weekday.sun")],[t]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-zinc-800 to-indigo-600 bg-clip-text text-transparent",children:t("driver.title")}),e.jsx("p",{className:"text-zinc-600 mt-2",children:t("driver.subtitle")})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-4 sm:mt-0 text-sm text-zinc-500",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{children:t("driver.profileActive")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-600",children:t("driver.name")}),e.jsx("div",{className:"text-2xl font-bold text-zinc-900 mt-1",children:u?"…":m.name||"-"})]}),e.jsx("div",{className:"shrink-0 p-2 rounded-lg bg-indigo-50 text-indigo-600",children:e.jsx(w,{className:"h-8 w-8"})})]})}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-600",children:t("driver.assignedCar")}),e.jsx("div",{className:"text-2xl font-bold text-zinc-900 mt-1",children:u?"…":m.plateNumber??t("driver.notAssigned")})]}),e.jsx("div",{className:"shrink-0 p-2 rounded-lg bg-amber-50 text-amber-600",children:e.jsx(y,{className:"h-8 w-8"})})]})}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-600",children:t("driver.salary")}),e.jsx("div",{className:"text-2xl font-bold text-zinc-900 mt-1",children:u?"…":m.salary!=null?m.salary.toLocaleString():t("common.notSet")})]}),e.jsx("div",{className:"shrink-0 p-2 rounded-lg bg-emerald-50 text-emerald-600",children:e.jsx(z,{className:"h-8 w-8"})})]})})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(k,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h2",{className:"text-sm font-semibold text-zinc-700",children:t("driver.schedule.title")})]}),j.length===0?e.jsx("div",{className:"text-zinc-600",children:t("driver.schedule.none")}):e.jsx("div",{className:"space-y-4",children:j.map(r=>{var o,a;const l=r.supervisor_status,s=l==null?{text:t("status.pending"),cls:"bg-amber-50 text-amber-700 border-amber-200"}:l==="complete"?{text:t("status.completed"),cls:"bg-emerald-50 text-emerald-700 border-emerald-200"}:{text:t("status.notCompleted"),cls:"bg-red-50 text-red-700 border-red-200"},d=(()=>{const i=r.assigned_manpower_names,n=r.assigned_manpower_usernames??[];return(i&&i.length?i:n)||[]})(),c=f[(Number(r.service_day)||1)-1]||"";return e.jsxs("div",{className:"rounded-xl border border-zinc-100 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-zinc-900 font-semibold",children:c}),e.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded-lg border ${s.cls}`,children:s.text})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"rounded-lg bg-zinc-50 p-3",children:[e.jsx("div",{className:"text-xs text-zinc-500",children:t("driver.vehicle")}),e.jsx("div",{className:"text-sm font-semibold text-zinc-800",children:r.vehicle_plate||"-"})]}),e.jsxs("div",{className:"rounded-lg bg-zinc-50 p-3",children:[e.jsx("div",{className:"text-xs text-zinc-500",children:t("common.serviceStart")}),e.jsx("div",{className:"text-sm font-semibold text-zinc-800",children:((o=r.service_start)==null?void 0:o.slice(0,5))||"-"})]}),e.jsxs("div",{className:"rounded-lg bg-zinc-50 p-3",children:[e.jsx("div",{className:"text-xs text-zinc-500",children:t("common.serviceEnd")}),e.jsx("div",{className:"text-sm font-semibold text-zinc-800",children:((a=r.service_end)==null?void 0:a.slice(0,5))||"-"})]}),e.jsxs("div",{className:"rounded-lg bg-zinc-50 p-3",children:[e.jsx("div",{className:"text-xs text-zinc-500",children:t("driver.zone")}),e.jsx("div",{className:"text-sm font-semibold text-zinc-800",children:r.zone_name||"-"})]})]}),e.jsxs("div",{className:"mt-3 text-xs text-zinc-600 space-y-1",children:[d.length>0&&e.jsxs("div",{children:[t("driver.team"),": ",d.join(", ")]}),l==="not_complete"&&r.supervisor_reason&&e.jsx("div",{className:"text-red-600",children:r.supervisor_reason})]})]},r.id)})})]})]})};export{E as default};
