import{u as P,j as e}from"./index-DMsqYpTw.js";import{r as s,u as z}from"./react-BeLGUnOF.js";const v="http://localhost:4000",U=()=>{const{t}=P(),[u,j]=s.useState(""),[h,N]=s.useState(""),[p,S]=s.useState(""),[g,w]=s.useState(""),[$,V]=s.useState([]),[x,y]=s.useState(""),[q,F]=s.useState([]),[b,k]=s.useState(""),I=z(),[f,i]=s.useState(!1),[E,C]=s.useState(null),[B,c]=s.useState(null);s.useEffect(()=>{const r=localStorage.getItem("token");r&&Promise.all([fetch(`${v}/api/manager/vehicles`,{headers:{Authorization:`Bearer ${r}`}}),fetch(`${v}/api/manager/users?role=supervisor`,{headers:{Authorization:`Bearer ${r}`}})]).then(async([o,m])=>{const n=await o.json(),a=await m.json();if(!o.ok)throw new Error((n==null?void 0:n.error)||"Failed to load vehicles");if(!m.ok)throw new Error((a==null?void 0:a.error)||"Failed to load supervisors");const l=(n.vehicles||[]).map(d=>({id:String(d.id),plate:String(d.plate)})),L=(a.users||[]).map(d=>({id:String(d.id),username:String(d.username)}));V(l),F(L)}).catch(o=>console.error("Load vehicles/supervisors error:",o))},[I.search]);function A(r){if(r.preventDefault(),c(null),C(null),i(!0),!u.trim()||!h.trim()||!p.trim()||!g.trim()){c("All fields are required."),i(!1);return}const o=Number(g);if(Number.isNaN(o)||o<0){c("Salary must be a non-negative number."),i(!1);return}const m={firstName:u,lastName:h,username:p,salary:o};if(!x){c("Please select a vehicle to assign."),i(!1);return}m.vehicleId=Number(x),b&&(m.supervisorUserId=Number(b));const n=localStorage.getItem("token");if(!n){c("You must be logged in as manager to register manpower."),i(!1);return}fetch(`${v}/api/manager/manpower`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(m)}).then(async a=>{const l=await a.json();if(!a.ok)throw new Error((l==null?void 0:l.error)||"Failed to register manpower");C(`Manpower created. Temporary password: ${(l==null?void 0:l.tempPassword)||""}`.trim()),j(""),N(""),S(""),w(""),y(""),k("")}).catch(a=>c((a==null?void 0:a.message)||"Failed to register manpower")).finally(()=>i(!1))}return e.jsxs("div",{className:"p-6 max-w-2xl",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:t("register.manpower.title")}),e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[B&&e.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3 text-red-700",children:B}),E&&e.jsx("div",{className:"rounded-lg border border-emerald-200 bg-emerald-50 p-3 text-emerald-700",children:E}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-800",children:t("register.common.firstName")}),e.jsx("input",{className:"mt-1 block w-full rounded-md border",style:{borderColor:"#E5E7EB"},value:u,onChange:r=>j(r.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-800",children:t("register.common.lastName")}),e.jsx("input",{className:"mt-1 block w-full rounded-md border",style:{borderColor:"#E5E7EB"},value:h,onChange:r=>N(r.target.value),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-800",children:t("register.common.username")}),e.jsx("input",{className:"mt-1 block w-full rounded-md border",style:{borderColor:"#E5E7EB"},value:p,onChange:r=>S(r.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-800",children:t("register.common.salary")}),e.jsx("input",{type:"number",min:"0",step:"0.01",className:"mt-1 block w-full rounded-md border",style:{borderColor:"#E5E7EB"},value:g,onChange:r=>w(r.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-800",children:t("register.common.assignVehicle")}),e.jsxs("select",{value:x,onChange:r=>y(r.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",children:[e.jsx("option",{value:"",children:t("register.common.selectVehicle")}),$.map(r=>e.jsx("option",{value:r.id,children:r.plate},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-800",children:t("register.manpower.assignSupervisorOptional")}),e.jsxs("select",{value:b,onChange:r=>k(r.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",children:[e.jsx("option",{value:"",children:t("register.common.selectSupervisor")}),q.map(r=>e.jsx("option",{value:r.id,children:r.username},r.id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:t("register.manpower.hintUseVehicleSupervisor")})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:f,className:`px-4 py-2 text-white rounded-md ${f?"bg-amber-400":"bg-amber-600 hover:bg-amber-700"}`,children:f?"â€¦":t("register.manpower.button")})})]})]})};export{U as default};
