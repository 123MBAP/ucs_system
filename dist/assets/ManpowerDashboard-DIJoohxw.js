import{u as N,j as e}from"./index-Cb5Y6uas.js";import{r as m}from"./react-CzDbI3ao.js";import{d as y,i as b,T as _,W as z}from"./ui-C_j-RX_5.js";const j="http://localhost:4000",A=()=>{var u,p,v;const{t}=N(),[,w]=m.useState(null),[l,f]=m.useState({name:"",salary:null,vehicle:null,driver:null,supervisor:null}),[n,x]=m.useState(!1),[h,g]=m.useState([]);return m.useEffect(()=>{const r=localStorage.getItem("token");r&&(x(!0),fetch(`${j}/api/manpower/dashboard`,{headers:{Authorization:`Bearer ${r}`}}).then(async a=>{var d,c,o;const s=await a.json();if(!a.ok)throw new Error((s==null?void 0:s.error)||"Failed to load dashboard");w(s.user);const i=[(d=s==null?void 0:s.user)==null?void 0:d.first_name,(c=s==null?void 0:s.user)==null?void 0:c.last_name].filter(Boolean).join(" ")||((o=s==null?void 0:s.user)==null?void 0:o.username)||"";f({name:i,salary:(s==null?void 0:s.salary)??null,vehicle:(s==null?void 0:s.vehicle)??null,driver:(s==null?void 0:s.driver)??null,supervisor:(s==null?void 0:s.supervisor)??null})}).catch(a=>console.error("Load manpower profile error:",a)).finally(()=>x(!1)),fetch(`${j}/api/manpower/schedule`,{headers:{Authorization:`Bearer ${r}`}}).then(async a=>{const s=await a.json();if(!a.ok)throw new Error((s==null?void 0:s.error)||"Failed to load schedule");g(Array.isArray(s.schedule)?s.schedule:[])}).catch(a=>console.error("Load manpower schedule error:",a)))},[]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-zinc-800 to-indigo-600 bg-clip-text text-transparent",children:t("manpower.title")}),e.jsx("p",{className:"text-zinc-600 mt-2",children:t("manpower.subtitle")})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-4 sm:mt-0 text-sm text-zinc-500",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{children:t("manpower.profileActive")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-600",children:t("manpower.name")}),e.jsx("div",{className:"text-2xl font-bold text-zinc-900 mt-1",children:n?"…":l.name||"-"})]}),e.jsx("div",{className:"shrink-0 p-2 rounded-lg bg-indigo-50 text-indigo-600",children:e.jsx(y,{className:"h-8 w-8"})})]})}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-600",children:t("manpower.assignedVehicle")}),e.jsx("div",{className:"text-2xl font-bold text-zinc-900 mt-1",children:n?"…":((u=l.vehicle)==null?void 0:u.plate)||t("manpower.notAssigned")}),e.jsxs("div",{className:"text-sm text-zinc-600 mt-2 flex items-center gap-1",children:[e.jsx(b,{className:"w-4 h-4"})," ",t("manpower.driver"),": ",n?"…":((p=l.driver)==null?void 0:p.username)||"-"]}),e.jsxs("div",{className:"text-sm text-zinc-600 mt-1 flex items-center gap-1",children:[e.jsx(b,{className:"w-4 h-4"})," ",t("manpower.supervisor"),": ",n?"…":((v=l.supervisor)==null?void 0:v.username)||"-"]})]}),e.jsx("div",{className:"shrink-0 p-2 rounded-lg bg-amber-50 text-amber-600",children:e.jsx(_,{className:"h-8 w-8"})})]})}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-600",children:t("manpower.salary")}),e.jsx("div",{className:"text-2xl font-bold text-zinc-900 mt-1",children:n?"…":l.salary!=null?l.salary.toLocaleString():"Not set"})]}),e.jsx("div",{className:"shrink-0 p-2 rounded-lg bg-emerald-50 text-emerald-600",children:e.jsx(z,{className:"h-8 w-8"})})]})})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-4",children:e.jsx("h2",{className:"text-xl font-bold text-zinc-800",children:t("manpower.schedule.title")})}),h.length===0?e.jsx("div",{className:"text-zinc-600",children:t("manpower.schedule.none")}):e.jsx("div",{className:"divide-y divide-zinc-200",children:h.map(r=>{var c,o;const s=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"][(Number(r.service_day)||1)-1]||"",i=r.supervisor_status,d=i==null?{text:t("status.pending"),cls:"bg-amber-50 text-amber-700 border-amber-200"}:i==="complete"?{text:t("status.completed"),cls:"bg-emerald-50 text-emerald-700 border-emerald-200"}:{text:t("status.notCompleted"),cls:"bg-red-50 text-red-700 border-red-200"};return e.jsxs("div",{className:"py-4 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-zinc-900 font-semibold",children:s}),e.jsxs("div",{className:"text-zinc-600 text-sm",children:[(c=r.service_start)==null?void 0:c.slice(0,5)," - ",(o=r.service_end)==null?void 0:o.slice(0,5)]}),e.jsxs("div",{className:"text-zinc-500 text-xs mt-1 space-y-0.5",children:[e.jsxs("div",{children:[r.zone_name?`${t("manpower.zone")}: ${r.zone_name}`:"",r.zone_name&&(r.vehicle_plate||r.driver_username)?" • ":"",r.vehicle_plate?`${t("manpower.vehicle")}: ${r.vehicle_plate}`:"",r.vehicle_plate&&r.driver_username?" • ":"",r.driver_username?`${t("manpower.driver")}: ${r.driver_username}`:""]}),!!(r.assigned_manpower_usernames&&r.assigned_manpower_usernames.length)&&e.jsxs("div",{children:[t("manpower.team"),": ",r.assigned_manpower_usernames.join(", ")]})]}),i==="not_complete"&&r.supervisor_reason&&e.jsxs("div",{className:"text-red-600 text-xs mt-1",children:[t("manpower.reason"),": ",r.supervisor_reason]})]}),e.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded-lg border ${d.cls}`,children:d.text})]},r.id)})})]})]})};export{A as default};
