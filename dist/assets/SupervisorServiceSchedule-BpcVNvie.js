import{j as e}from"./index-DZTFkylD.js";import{g as le,f as ae,r as a}from"./react-CzDbI3ao.js";const N="http://localhost:4000",r={primary:"#D97706",primaryHover:"#B45309",background:"#F9FAFB",cardBg:"#FFFFFF",border:"#E5E7EB",text:"#1E1E1E",textLight:"#6B7280",error:"#DC2626"},i={Back:o=>e.jsx("svg",{...o,className:o.className??"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),Calendar:o=>e.jsx("svg",{...o,className:o.className??"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),Vehicle:o=>e.jsx("svg",{...o,className:o.className??"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})}),Driver:o=>e.jsx("svg",{...o,className:o.className??"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),Time:o=>e.jsx("svg",{...o,className:o.className??"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),Manpower:o=>e.jsx("svg",{...o,className:o.className??"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),Delete:o=>e.jsx("svg",{...o,className:o.className??"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),Add:o=>e.jsx("svg",{...o,className:o.className??"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})},P=({title:o,number:c})=>e.jsxs("div",{className:"flex items-center gap-3 mb-6 pb-3 border-b",style:{borderColor:r.border},children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm",style:{backgroundColor:r.primary},children:c}),e.jsx("h2",{className:"text-2xl font-bold",style:{color:r.text},children:o})]}),O=({children:o,className:c=""})=>e.jsx("div",{className:`rounded-lg shadow-sm border p-6 ${c}`,style:{backgroundColor:r.cardBg,borderColor:r.border},children:o}),ne=({children:o,onClick:c,disabled:u=!1,loading:p=!1,className:g=""})=>e.jsx("button",{onClick:c,disabled:u||p,className:`px-4 py-2 rounded-lg font-medium text-white transition-colors flex items-center gap-2 ${g}`,style:{backgroundColor:u?r.textLight:r.primary,cursor:u?"not-allowed":"pointer"},onMouseOver:x=>{!u&&!p&&(x.currentTarget.style.backgroundColor=r.primaryHover)},onMouseOut:x=>{!u&&!p&&(x.currentTarget.style.backgroundColor=r.primary)},children:o});function de(){const{id:o}=le(),c=Number(o),u=ae(),[p,g]=a.useState(!0),[x,h]=a.useState(null),[k,Z]=a.useState([]),[w,J]=a.useState([]),[q,G]=a.useState([]),[K,Q]=a.useState(""),[j,C]=a.useState([]),[S,U]=a.useState([]),[y,b]=a.useState("saved"),[D,E]=a.useState(""),[_,F]=a.useState(""),[M,$]=a.useState(""),[B,A]=a.useState(""),[T,X]=a.useState("08:00"),[V,Y]=a.useState("12:00"),[L,z]=a.useState([]),m=typeof window<"u"?localStorage.getItem("token"):null;a.useEffect(()=>{Number.isFinite(c)&&m&&(g(!0),h(null),Promise.all([fetch(`${N}/api/supervisor/zones/${c}/supervision`,{headers:{Authorization:`Bearer ${m}`}}),fetch(`${N}/api/supervisor/zones/${c}/schedule`,{headers:{Authorization:`Bearer ${m}`}})]).then(async([s,l])=>{var I;const t=await s.json(),n=await l.json();if(!s.ok)throw new Error((t==null?void 0:t.error)||"Failed to load zone data");if(!l.ok)throw new Error((n==null?void 0:n.error)||"Failed to load schedule");Q(((I=t==null?void 0:t.zone)==null?void 0:I.name)||""),Z(((t==null?void 0:t.vehicles)||[]).map(d=>({id:Number(d.id),plate:String(d.plate)}))),J(((t==null?void 0:t.drivers)||[]).map(d=>({id:Number(d.id),username:String(d.username)}))),G(((t==null?void 0:t.manpower)||[]).map(d=>({id:Number(d.id),username:String(d.username)}))),C((n==null?void 0:n.schedule)||[]);const v=Array.isArray(t==null?void 0:t.serviceDays)?t.serviceDays.map(d=>Number(d)).filter(d=>Number.isFinite(d)):[];U(v),v.length?(b("saved"),E(String(v[0]))):(b("special"),F("1"))}).catch(s=>h((s==null?void 0:s.message)||"Failed to load")).finally(()=>g(!1)))},[c,m]);async function ee(){if(!m)return;h(null);const s=y==="saved"?D:_;if(!s||!M){h("Please select service day and vehicle");return}const l={service_day:Number(s),vehicle_id:Number(M),driver_id:B?Number(B):null,service_start:R(T),service_end:R(V),assigned_manpower_ids:L},t=await fetch(`${N}/api/supervisor/zones/${c}/schedule`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`},body:JSON.stringify(l)}),n=await t.json();if(!t.ok){h((n==null?void 0:n.error)||"Failed to create entry");return}C(v=>[...v,n.entry]),$(""),A(""),z([])}async function se(s){if(!m)return;const l=await fetch(`${N}/api/supervisor/zones/${c}/schedule/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${m}`}});if(!l.ok){const t=await l.json().catch(()=>({}));h((t==null?void 0:t.error)||"Failed to delete entry");return}C(t=>t.filter(n=>n.id!==s))}function re(s){z(l=>l.includes(s)?l.filter(t=>t!==s):[...l,s])}const f=s=>new Date(2e3,0,s).toLocaleString(void 0,{weekday:"long"}),W=[1,2,3,4,5,6,7],H=W.filter(s=>!S.includes(s)),oe=a.useMemo(()=>{const s=new Map;return k.forEach(l=>s.set(l.id,l.plate)),s},[k]),te=a.useMemo(()=>{const s=new Map;return w.forEach(l=>s.set(l.id,l.username)),s},[w]);return p?e.jsx("div",{className:"min-h-screen p-6",style:{backgroundColor:r.background},children:e.jsx("div",{className:"max-w-6xl mx-auto space-y-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 rounded w-48 mb-6",style:{backgroundColor:r.border}}),e.jsxs("div",{className:"grid gap-6",children:[e.jsx("div",{className:"h-64 rounded-lg",style:{backgroundColor:r.border}}),e.jsx("div",{className:"h-96 rounded-lg",style:{backgroundColor:r.border}})]})]})})}):e.jsx("div",{className:"min-h-screen p-6",style:{backgroundColor:r.background},children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-8",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("button",{onClick:()=>u(-1),className:"flex items-center space-x-2 transition-colors duration-200",style:{color:r.textLight},children:[e.jsx(i.Back,{}),e.jsx("span",{className:"font-medium",children:"Back to Zone"})]}),e.jsx("div",{className:"w-px h-6",style:{backgroundColor:r.border}}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",style:{color:r.text},children:"Service Schedule"}),e.jsxs("p",{className:"mt-1",style:{color:r.textLight},children:["Plan and manage services for ",K]})]})]})}),x&&e.jsx("div",{className:"rounded-lg p-4 border",style:{backgroundColor:"#FEF2F2",borderColor:r.error},children:e.jsxs("div",{className:"flex items-center space-x-2",style:{color:r.error},children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"font-medium",children:x})]})}),e.jsxs("section",{children:[e.jsx(P,{title:"Add New Service Entry",number:1}),e.jsxs(O,{children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-3",style:{color:r.text},children:"Service Day"}),e.jsxs("div",{className:"flex space-x-4 mb-4",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"dayMode",value:"saved",checked:y==="saved",onChange:()=>b("saved"),style:{accentColor:r.primary}}),e.jsx("span",{className:"text-sm font-medium",style:{color:r.text},children:"Regular Days"})]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"dayMode",value:"special",checked:y==="special",onChange:()=>b("special"),style:{accentColor:r.primary}}),e.jsx("span",{className:"text-sm font-medium",style:{color:r.text},children:"Special Days"})]})]}),y==="saved"?e.jsxs("select",{value:D,onChange:s=>E(s.target.value),className:"w-full rounded-lg px-4 py-3 focus:outline-none focus:ring-2 border",style:{backgroundColor:r.cardBg,borderColor:r.border,color:r.text},children:[!S.length&&e.jsx("option",{value:"",children:"No regular days set"}),S.map(s=>e.jsx("option",{value:s,children:f(s)},s))]}):e.jsx("select",{value:_,onChange:s=>F(s.target.value),className:"w-full rounded-lg px-4 py-3 focus:outline-none focus:ring-2 border",style:{backgroundColor:r.cardBg,borderColor:r.border,color:r.text},children:H.length?H.map(s=>e.jsx("option",{value:s,children:f(s)},s)):W.map(s=>e.jsx("option",{value:s,children:f(s)},s))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold mb-2",style:{color:r.text},children:[e.jsx(i.Time,{className:"inline w-4 h-4 mr-2",style:{color:r.primary}}),"Start Time"]}),e.jsx("input",{type:"time",value:T,onChange:s=>X(s.target.value),className:"w-full rounded-lg px-4 py-3 focus:outline-none focus:ring-2 border",style:{backgroundColor:r.cardBg,borderColor:r.border,color:r.text}})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold mb-2",style:{color:r.text},children:[e.jsx(i.Time,{className:"inline w-4 h-4 mr-2",style:{color:r.primary}}),"End Time"]}),e.jsx("input",{type:"time",value:V,onChange:s=>Y(s.target.value),className:"w-full rounded-lg px-4 py-3 focus:outline-none focus:ring-2 border",style:{backgroundColor:r.cardBg,borderColor:r.border,color:r.text}})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold mb-2",style:{color:r.text},children:[e.jsx(i.Vehicle,{className:"inline w-4 h-4 mr-2",style:{color:r.primary}}),"Vehicle"]}),e.jsxs("select",{value:M,onChange:s=>$(s.target.value),className:"w-full rounded-lg px-4 py-3 focus:outline-none focus:ring-2 border",style:{backgroundColor:r.cardBg,borderColor:r.border,color:r.text},children:[e.jsx("option",{value:"",children:"Select vehicle…"}),k.map(s=>e.jsx("option",{value:s.id,children:s.plate},s.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold mb-2",style:{color:r.text},children:[e.jsx(i.Driver,{className:"inline w-4 h-4 mr-2",style:{color:r.primary}}),"Driver"]}),e.jsxs("select",{value:B,onChange:s=>A(s.target.value),className:"w-full rounded-lg px-4 py-3 focus:outline-none focus:ring-2 border",style:{backgroundColor:r.cardBg,borderColor:r.border,color:r.text},children:[e.jsx("option",{value:"",children:"Select driver…"}),w.map(s=>e.jsx("option",{value:s.id,children:s.username},s.id))]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold mb-3",style:{color:r.text},children:[e.jsx(i.Manpower,{className:"inline w-4 h-4 mr-2",style:{color:r.primary}}),"Assign Manpower"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:q.map(s=>e.jsx("button",{type:"button",onClick:()=>re(s.id),className:`px-3 py-2 rounded-lg border text-sm font-medium transition-all duration-200 ${L.includes(s.id)?"text-white shadow-lg":"border hover:shadow-md"}`,style:L.includes(s.id)?{backgroundColor:r.primary,borderColor:r.primary}:{backgroundColor:r.cardBg,color:r.text,borderColor:r.border},children:s.username},s.id))})]})]})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsxs(ne,{onClick:ee,className:"px-6 py-3",children:[e.jsx(i.Add,{}),e.jsx("span",{children:"Add Service Entry"})]})})]})]}),e.jsxs("section",{children:[e.jsx(P,{title:"Scheduled Services",number:2}),e.jsxs(O,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:r.text},children:"Current Schedule"}),e.jsxs("span",{className:"text-sm px-3 py-1 rounded-full",style:{backgroundColor:r.background,color:r.textLight},children:[j.length," entr",j.length===1?"y":"ies"]})]}),j.length?e.jsx("div",{className:"space-y-4",children:j.slice().sort((s,l)=>s.service_day-l.service_day||s.service_start.localeCompare(l.service_start)).map(s=>{var l;return e.jsx("div",{className:"rounded-lg border p-4 transition-shadow duration-200 hover:shadow-md",style:{backgroundColor:r.cardBg,borderColor:r.border},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:r.primary}}),e.jsx("span",{className:"font-semibold",style:{color:r.text},children:f(s.service_day)})]}),e.jsxs("div",{className:"flex items-center space-x-1 text-sm",style:{color:r.textLight},children:[e.jsx(i.Time,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.service_start.substring(0,5)," - ",s.service_end.substring(0,5)]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(i.Vehicle,{className:"w-4 h-4",style:{color:r.textLight}}),e.jsx("span",{style:{color:r.text},children:oe.get(s.vehicle_id)||`Vehicle #${s.vehicle_id}`})]}),s.driver_id&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(i.Driver,{className:"w-4 h-4",style:{color:r.textLight}}),e.jsx("span",{style:{color:r.text},children:te.get(s.driver_id)||`Driver #${s.driver_id}`})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(i.Manpower,{className:"w-4 h-4",style:{color:r.textLight}}),e.jsx("span",{style:{color:r.text},children:(l=s.assigned_manpower_ids)!=null&&l.length?`${s.assigned_manpower_ids.length} manpower assigned`:"No manpower assigned"})]})]})]}),e.jsxs("button",{onClick:()=>se(s.id),className:"flex items-center space-x-1 px-3 py-2 rounded-lg font-medium transition-colors duration-200 ml-4",style:{backgroundColor:"#FEF2F2",color:r.error},children:[e.jsx(i.Delete,{}),e.jsx("span",{className:"text-sm",children:"Delete"})]})]})},s.id)})}):e.jsxs("div",{className:"text-center py-12 rounded-lg border",style:{backgroundColor:r.background,borderColor:r.border},children:[e.jsx(i.Calendar,{className:"w-16 h-16 mx-auto mb-4",style:{color:r.textLight}}),e.jsx("h3",{className:"text-lg font-semibold mb-2",style:{color:r.textLight},children:"No services scheduled"}),e.jsx("p",{style:{color:r.textLight},children:"Add your first service entry to get started"})]})]})]})]})})}function R(o){return/^\d{2}:\d{2}$/.test(o)?`${o}:00`:o}export{de as default};
