import{u as q,j as e}from"./index-DMsqYpTw.js";import{r as a,u as P,L as R}from"./react-BeLGUnOF.js";const p="http://localhost:4000",J=()=>{const{t:o}=q(),[k,y]=a.useState(""),[E,C]=a.useState(""),[g,x]=a.useState(""),[b,v]=a.useState([]),[L,F]=a.useState([]),[I,O]=a.useState([]),[f,A]=a.useState(""),[j,l]=a.useState(!1),[$,S]=a.useState(null),[z,c]=a.useState(null),N=P(),w=new URLSearchParams(N.search),m=w.get("reassign")==="1",[u,B]=a.useState("existing");function T(s){v(t=>t.includes(s)?t.filter(r=>r!==s):[...t,s])}a.useEffect(()=>{const s=localStorage.getItem("token");s&&(fetch(`${p}/api/zones`,{headers:{Authorization:`Bearer ${s}`}}).then(async t=>{const r=await t.json();if(!t.ok)throw new Error((r==null?void 0:r.error)||"Failed to load zones");const n=(r.zones||[]).map(h=>({id:String(h.id),name:h.zone_name}));F(n);const d=new URLSearchParams(N.search).get("zoneId");d&&n.some(h=>h.id===String(d))&&v([String(d)])}).catch(t=>console.error("Load zones error:",t)),fetch(`${p}/api/manager/users?role=supervisor`,{headers:{Authorization:`Bearer ${s}`}}).then(async t=>{const r=await t.json();if(!t.ok)throw new Error((r==null?void 0:r.error)||"Failed to load supervisors");const n=(r.users||[]).map(i=>({id:String(i.id),username:i.username}));O(n)}).catch(t=>console.error("Load supervisors error:",t)))},[N.search]);function Z(s){if(s.preventDefault(),c(null),S(null),l(!0),m&&u==="existing"){if(!b.length){c("Select a zone to assign."),l(!1);return}if(!f){c("Select a supervisor to assign."),l(!1);return}const r=localStorage.getItem("token");if(!r){c("You must be logged in as manager to reassign a supervisor."),l(!1);return}const n=b[0];fetch(`${p}/api/manager/zones/${n}/reassign-supervisor`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({supervisorUserId:Number(f)})}).then(async i=>{const d=await i.json();if(!i.ok)throw new Error((d==null?void 0:d.error)||"Failed to reassign supervisor");S("Supervisor reassigned successfully.")}).catch(i=>c((i==null?void 0:i.message)||"Failed to reassign supervisor")).finally(()=>l(!1));return}if(!k.trim()||!E.trim()||!g.trim()){c("First name, last name and username/email are required."),l(!1);return}const t=localStorage.getItem("token");if(!t){c("You must be logged in as manager to create a supervisor."),l(!1);return}fetch(`${p}/api/manager/supervisors`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({username:g})}).then(async r=>{const n=await r.json();if(!r.ok)throw new Error((n==null?void 0:n.error)||"Failed to create supervisor");S(`Supervisor created. Temporary password: ${n.tempPassword}`),y(""),C(""),x(""),v([])}).catch(r=>c(r.message||"Failed to create supervisor")).finally(()=>l(!1))}return e.jsxs("div",{className:"p-6 max-w-2xl",children:[m&&w.get("zoneId")&&e.jsx("div",{className:"mb-2",children:e.jsxs(R,{to:`/zones/${w.get("zoneId")}`,className:"text-amber-600 underline text-sm",children:["← ",o("register.common.back")]})}),e.jsx("h2",{className:"text-2xl font-bold mb-4",children:o(m?"register.supervisor.reassignTitle":"register.supervisor.title")}),e.jsxs("form",{onSubmit:Z,className:"space-y-4",children:[z&&e.jsx("div",{className:"rounded-lg border border-amber-200 bg-amber-50 p-3 text-amber-700",children:z}),$&&e.jsx("div",{className:"rounded-lg border border-amber-200 bg-amber-50 p-3 text-amber-700",children:$}),!(m&&u==="existing")&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-800",children:o("register.common.firstName")}),e.jsx("input",{className:"mt-1 block w-full rounded-md border",style:{borderColor:"#E5E7EB"},value:k,onChange:s=>y(s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-800",children:o("register.common.lastName")}),e.jsx("input",{className:"mt-1 block w-full rounded-md border",style:{borderColor:"#E5E7EB"},value:E,onChange:s=>C(s.target.value),required:!0})]})]}),!m&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-800",children:o("register.common.usernameOrEmail")}),e.jsx("input",{className:"mt-1 block w-full rounded-md border",style:{borderColor:"#E5E7EB"},value:g,onChange:s=>x(s.target.value),required:!0})]}),m&&e.jsxs("div",{className:"p-4 border rounded-md",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",name:"mode",value:"existing",checked:u==="existing",onChange:()=>B("existing"),className:"mr-2"}),e.jsx("span",{children:"Assign to an existing supervisor"})]}),e.jsxs("label",{className:"inline-flex items-center ml-6",children:[e.jsx("input",{type:"radio",name:"mode",value:"new",checked:u==="new",onChange:()=>B("new"),className:"mr-2"}),e.jsx("span",{children:"Create a new supervisor"})]})]}),u==="existing"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-800",children:o("register.vehicle.selectDriver").replace("Driver","Supervisor")}),e.jsxs("select",{value:f,onChange:s=>A(s.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",children:[e.jsx("option",{value:"",children:"-- Select supervisor --"}),I.map(s=>e.jsx("option",{value:s.id,children:s.username},s.id))]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-800",children:o("register.common.usernameOrEmail")}),e.jsx("input",{className:"mt-1 block w-full rounded-md border",style:{borderColor:"#E5E7EB"},value:g,onChange:s=>x(s.target.value)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-800",children:o("register.supervisor.assignZonesOptional")}),e.jsx("div",{className:"mt-2 space-y-2",children:L.map(s=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:b.includes(s.id),onChange:()=>T(s.id)}),e.jsx("span",{children:s.name})]},s.id))})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:j,className:`px-4 py-2 text-white rounded-md ${j?"bg-amber-400":"bg-amber-600 hover:bg-amber-700"}`,children:j?"…":o("register.supervisor.button")})})]})]})};export{J as default};
