import{u as L,j as e}from"./index-DnGg16Vn.js";import{r as t}from"./react-BeLGUnOF.js";const d="http://localhost:4000",U=()=>{const{t:s}=L(),[g,S]=t.useState(""),[x,k]=t.useState(""),[p,C]=t.useState(""),[v,$]=t.useState(""),[b,V]=t.useState(!1),[m,f]=t.useState("existing"),[D,J]=t.useState([]),[j,B]=t.useState(null),[w,P]=t.useState(""),[N,h]=t.useState(!1),[A,O]=t.useState(null),[T,u]=t.useState(null);t.useEffect(()=>{const r=localStorage.getItem("token");r&&fetch(`${d}/api/manager/vehicles`,{headers:{Authorization:`Bearer ${r}`}}).then(async n=>{const a=await n.json();if(!n.ok)throw new Error((a==null?void 0:a.error)||"Failed to load vehicles");const o=(a.vehicles||[]).map(i=>({id:String(i.id),plate:i.plate}));J(o)}).catch(n=>console.error("Load vehicles error:",n))},[]);function M(r){if(r.preventDefault(),u(null),O(null),h(!0),!g.trim()||!x.trim()||!p.trim()){u("First name, last name and username/email are required."),h(!1);return}const n={firstName:g,lastName:x,username:p,salary:v?Number(v):void 0},a=localStorage.getItem("token");if(!a){u("You must be logged in as manager to create a driver."),h(!1);return}fetch(`${d}/api/manager/drivers`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(n)}).then(async o=>{var F,I;const i=await o.json();if(!o.ok)throw new Error((i==null?void 0:i.error)||"Failed to create driver");const y=(F=i==null?void 0:i.driver)==null?void 0:F.id;if(!y)throw new Error("Driver created but id missing");if(b)if(m==="existing"){if(!j)throw new Error("Please select a vehicle to assign.");const c=await fetch(`${d}/api/manager/drivers/${y}/vehicle`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({vehicleId:Number(j)})}),l=await c.json();if(!c.ok)throw new Error((l==null?void 0:l.error)||"Failed to assign vehicle")}else{if(!w.trim())throw new Error("Please provide the new vehicle plate");const c=await fetch(`${d}/api/manager/vehicles`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({plate:w.trim()})}),l=await c.json();if(!c.ok)throw new Error((l==null?void 0:l.error)||"Failed to create vehicle");const z=(I=l==null?void 0:l.vehicle)==null?void 0:I.id;if(!z)throw new Error("Vehicle created but id missing");const q=await fetch(`${d}/api/manager/drivers/${y}/vehicle`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({vehicleId:z})}),E=await q.json();if(!q.ok)throw new Error((E==null?void 0:E.error)||"Failed to assign new vehicle")}O(`Driver created. Temporary password: ${i.tempPassword}`),S(""),k(""),C(""),$(""),V(!1),f("existing"),B(null),P("")}).catch(o=>u(o.message||"Failed to create driver")).finally(()=>h(!1))}return e.jsxs("div",{className:"p-6 max-w-2xl",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:s("register.driver.title")}),e.jsxs("form",{onSubmit:M,className:"space-y-4",children:[T&&e.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3 text-red-700",children:T}),A&&e.jsx("div",{className:"rounded-lg border border-emerald-200 bg-emerald-50 p-3 text-emerald-700",children:A}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-800",children:s("register.common.firstName")}),e.jsx("input",{className:"mt-1 block w-full rounded-md border",style:{borderColor:"#E5E7EB"},value:g,onChange:r=>S(r.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-800",children:s("register.common.lastName")}),e.jsx("input",{className:"mt-1 block w-full rounded-md border",style:{borderColor:"#E5E7EB"},value:x,onChange:r=>k(r.target.value),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-800",children:s("register.common.usernameOrEmail")}),e.jsx("input",{className:"mt-1 block w-full rounded-md border",style:{borderColor:"#E5E7EB"},value:p,onChange:r=>C(r.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-800",children:s("register.driver.salaryOptional")}),e.jsx("input",{type:"number",min:"0",className:"mt-1 block w-full rounded-md border",style:{borderColor:"#E5E7EB"},value:v,onChange:r=>$(r.target.value),placeholder:s("register.common.salary")})]}),e.jsx("div",{className:"pt-2",children:e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",checked:b,onChange:r=>V(r.target.checked),className:"mr-2"}),e.jsx("span",{children:s("register.driver.assignVehicleOptional")})]})}),b&&e.jsxs("div",{className:"p-4 border rounded-md",children:[e.jsxs("div",{className:"space-x-4 mb-3",children:[e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",name:"vehicleMode",value:"existing",checked:m==="existing",onChange:()=>f("existing"),className:"mr-2"}),e.jsx("span",{children:s("register.driver.assignExisting")})]}),e.jsxs("label",{className:"inline-flex items-center ml-4",children:[e.jsx("input",{type:"radio",name:"vehicleMode",value:"new",checked:m==="new",onChange:()=>f("new"),className:"mr-2"}),e.jsx("span",{children:s("register.driver.assignNew")})]})]}),m==="existing"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-800",children:s("register.driver.selectVehicle")}),e.jsxs("select",{value:j??"",onChange:r=>B(r.target.value||null),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",children:[e.jsx("option",{value:"",children:"-- Select vehicle --"}),D.map(r=>e.jsx("option",{value:r.id,children:r.plate},r.id))]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-800",children:s("register.driver.newVehiclePlate")}),e.jsx("input",{className:"mt-1 block w-full rounded-md border",style:{borderColor:"#E5E7EB"},value:w,onChange:r=>P(r.target.value)})]})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:N,className:`px-4 py-2 text-white rounded-md ${N?"bg-amber-400":"bg-amber-600 hover:bg-amber-700"}`,children:N?"â€¦":s("register.driver.button")})})]})]})};export{U as default};
