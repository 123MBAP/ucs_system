import{j as e}from"./index-8yk-1D8L.js";import{r as t,u as B}from"./react-CzDbI3ao.js";const v="http://localhost:4000",V=()=>{const[m,f]=t.useState(""),[u,j]=t.useState(""),[h,w]=t.useState(""),[p,N]=t.useState(""),[E,A]=t.useState([]),[g,S]=t.useState(""),[F,q]=t.useState([]),[x,y]=t.useState(""),I=B(),[b,i]=t.useState(!1),[k,$]=t.useState(null),[C,n]=t.useState(null);t.useEffect(()=>{const s=localStorage.getItem("token");s&&Promise.all([fetch(`${v}/api/manager/vehicles`,{headers:{Authorization:`Bearer ${s}`}}),fetch(`${v}/api/manager/users?role=supervisor`,{headers:{Authorization:`Bearer ${s}`}})]).then(async([a,c])=>{const o=await a.json(),r=await c.json();if(!a.ok)throw new Error((o==null?void 0:o.error)||"Failed to load vehicles");if(!c.ok)throw new Error((r==null?void 0:r.error)||"Failed to load supervisors");const l=(o.vehicles||[]).map(d=>({id:String(d.id),plate:String(d.plate)})),R=(r.users||[]).map(d=>({id:String(d.id),username:String(d.username)}));A(l),q(R)}).catch(a=>console.error("Load vehicles/supervisors error:",a))},[I.search]);function L(s){if(s.preventDefault(),n(null),$(null),i(!0),!m.trim()||!u.trim()||!h.trim()||!p.trim()){n("All fields are required."),i(!1);return}const a=Number(p);if(Number.isNaN(a)||a<0){n("Salary must be a non-negative number."),i(!1);return}const c={firstName:m,lastName:u,username:h,salary:a};if(!g){n("Please select a vehicle to assign."),i(!1);return}c.vehicleId=Number(g),x&&(c.supervisorUserId=Number(x));const o=localStorage.getItem("token");if(!o){n("You must be logged in as manager to register manpower."),i(!1);return}fetch(`${v}/api/manager/manpower`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(c)}).then(async r=>{const l=await r.json();if(!r.ok)throw new Error((l==null?void 0:l.error)||"Failed to register manpower");$(`Manpower created. Temporary password: ${(l==null?void 0:l.tempPassword)||""}`.trim()),f(""),j(""),w(""),N(""),S(""),y("")}).catch(r=>n((r==null?void 0:r.message)||"Failed to register manpower")).finally(()=>i(!1))}return e.jsxs("div",{className:"p-6 max-w-2xl",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Register Manpower"}),e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[C&&e.jsx("div",{className:"text-red-600",children:C}),k&&e.jsx("div",{className:"text-green-600",children:k}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"First Name"}),e.jsx("input",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",value:m,onChange:s=>f(s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Last Name"}),e.jsx("input",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",value:u,onChange:s=>j(s.target.value),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Username"}),e.jsx("input",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",value:h,onChange:s=>w(s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Salary"}),e.jsx("input",{type:"number",min:"0",step:"0.01",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",value:p,onChange:s=>N(s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Assign Vehicle"}),e.jsxs("select",{value:g,onChange:s=>S(s.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",children:[e.jsx("option",{value:"",children:"-- Select vehicle --"}),E.map(s=>e.jsx("option",{value:s.id,children:s.plate},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Assign Supervisor (optional)"}),e.jsxs("select",{value:x,onChange:s=>y(s.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",children:[e.jsx("option",{value:"",children:"-- Select supervisor (optional) --"}),F.map(s=>e.jsx("option",{value:s.id,children:s.username},s.id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"If not selected, we will use the vehicle's supervisor automatically (if set)."})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:b,className:`px-4 py-2 text-white rounded-md ${b?"bg-blue-400":"bg-blue-600 hover:bg-blue-700"}`,children:b?"Registeringâ€¦":"Register Manpower"})})]})]})};export{V as default};
