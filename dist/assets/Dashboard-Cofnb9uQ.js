import{j as e}from"./index-CdjKjvMW.js";import{r as d,L as E}from"./react-CzDbI3ao.js";import{e as P,U as _,f as B,c as M}from"./ui-C_j-RX_5.js";const K="http://localhost:4000",R={TrendUp:()=>e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})}),TrendDown:()=>e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"})})},re=()=>{const[y,w]=d.useState("monthly"),[j,S]=d.useState([]),[U,A]=d.useState(!1),[O,L]=d.useState(!1),[T,V]=d.useState([]),[f,F]=d.useState(new Date().getFullYear()),[v,Z]=d.useState(new Date().getMonth()+1),N=t=>Number(t??0).toLocaleString(),[x,H]=d.useState({zones:{total:15,supervisors:45,chiefs:15},clients:{total:3247},manpower:{total:15680},vehicles:{total:892,drivers:945},payments:{currentMonth:245670,today:12345}}),[g,J]=d.useState({yearly:[],monthly:[],weekly:[],daily:[]});function Y(t,o,n){const l=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],m=Array.from({length:12},(s,r)=>({key:`${o}-${String(r+1).padStart(2,"0")}`,label:l[r],year:o,monthIdx:r})),i=new Map(m.map(s=>[s.key,0])),a=[0,0,0,0],c=`${o}-${String(n).padStart(2,"0")}`,h=Array.from({length:5},(s,r)=>String(new Date().getFullYear()-(4-r))),b=new Map(h.map(s=>[s,0])),I=new Date,W=[],$=[];for(let s=6;s>=0;s--){const r=new Date(I);r.setDate(I.getDate()-s);const u=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}`;$.push(u),W.push(`Day ${7-s}`)}const z=new Map($.map(s=>[s,0])),Q=Array.isArray(t)?t.filter(s=>{const r=String((s==null?void 0:s.status)||"").toLowerCase();return!(s!=null&&s.status)||r==="success"||r==="successful"}):[];for(const s of Q){const r=Number(s.amount||0),u=new Date(s.completed_at||s.created_at||s.updated_at||s.inserted_at||Date.now()),k=`${u.getFullYear()}-${String(u.getMonth()+1).padStart(2,"0")}`;if(i.has(k)&&i.set(k,(i.get(k)||0)+r),k===c){const te=Math.min(4,Math.max(1,Math.ceil(u.getDate()/7)));a[te-1]+=r}const D=String(u.getFullYear());b.has(D)&&b.set(D,(b.get(D)||0)+r);const C=`${u.getFullYear()}-${String(u.getMonth()+1).padStart(2,"0")}-${String(u.getDate()).padStart(2,"0")}`;z.has(C)&&z.set(C,(z.get(C)||0)+r)}const q=m.map(s=>({month:s.label,amount:i.get(s.key)||0})),G=[{week:"Week 1",amount:a[0]},{week:"Week 2",amount:a[1]},{week:"Week 3",amount:a[2]},{week:"Week 4",amount:a[3]}],X=h.map(s=>({year:s,amount:b.get(s)||0})),ee=$.map((s,r)=>({day:W[r],amount:z.get(s)||0}));return{yearly:X,monthly:q,weekly:G,daily:ee}}d.useEffect(()=>{const t={yearly:g.yearly,monthly:g.monthly,weekly:g.weekly,daily:g.daily};S(t[y]||[])},[y,g]),d.useEffect(()=>{let t=!1;async function o(){try{A(!0);const n=localStorage.getItem("token");if(!n){S([{month:"Jan",amount:4e4},{month:"Feb",amount:32e3},{month:"Mar",amount:28e3},{month:"Apr",amount:35e3},{month:"May",amount:42e3},{month:"Jun",amount:38e3}]);return}const m=await(await fetch(`${K}/api/payments/completed`,{headers:{Authorization:`Bearer ${n}`}})).json(),i=Array.isArray(m==null?void 0:m.payments)?m.payments:[];if(!t){V(i);const a=Y(i,f,v);J({yearly:a.yearly,monthly:a.monthly,weekly:a.weekly,daily:a.daily})}}catch{t||S([{month:"Jan",amount:4e4},{month:"Feb",amount:32e3},{month:"Mar",amount:28e3},{month:"Apr",amount:35e3},{month:"May",amount:42e3},{month:"Jun",amount:38e3}])}finally{t||A(!1)}}return o(),()=>{t=!0}},[]),d.useEffect(()=>{const t=Y(T,f,v);J({yearly:t.yearly,monthly:t.monthly,weekly:t.weekly,daily:t.daily})},[T,f,v]),d.useEffect(()=>{const t=localStorage.getItem("token");t&&(L(!0),fetch(`${K}/api/manager/dashboard`,{headers:{Authorization:`Bearer ${t}`}}).then(async o=>{const n=await o.json();if(!o.ok)throw new Error((n==null?void 0:n.error)||"Failed to load dashboard");H(l=>({...l,zones:n.zones??l.zones,clients:n.clients??l.clients,manpower:n.manpower??l.manpower,vehicles:n.vehicles??l.vehicles,payments:n.payments??l.payments}))}).catch(o=>console.error("Dashboard load error:",o)).finally(()=>L(!1)))},[]);const p=({title:t,value:o,subtitle:n,icon:l,trend:m,trendValue:i,actionLabel:a,actionTo:c,gradient:h="from-amber-500 to-yellow-600"})=>e.jsx("div",{className:"group bg-white rounded-xl shadow-sm border border-zinc-100 p-3 sm:p-4 hover:shadow-md transition-all duration-200",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs font-medium text-zinc-500 mb-1",children:t}),e.jsx("p",{className:"text-2xl font-semibold text-zinc-900",children:O?"...":o}),n&&e.jsx("p",{className:"text-xs text-zinc-500 mt-1",children:n}),m&&typeof i=="number"&&e.jsxs("div",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium mt-2 ${i>0?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:[i>0?e.jsx(R.TrendUp,{}):e.jsx(R.TrendDown,{}),e.jsxs("span",{className:"ml-1",children:[Math.abs(i),"%"]})]}),a&&c&&e.jsx(E,{to:c,className:"block text-xs text-amber-600 mt-2 hover:underline transition-colors",children:a})]}),e.jsx("div",{className:`p-3 rounded-lg bg-gradient-to-br ${h} shadow-sm`,children:e.jsx("div",{className:"text-white w-5 h-5",children:l})})]})});return e.jsxs("div",{className:"space-y-6 overflow-x-hidden",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-zinc-800",children:"Business Dashboard"}),e.jsx("p",{className:"text-sm text-zinc-500 mt-1",children:"Here's an overview of your operations today."})]}),e.jsxs("div",{className:"flex items-center mt-3 sm:mt-0 space-x-2 text-sm text-green-600",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{children:"System Online"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[e.jsx(p,{title:"Zones Managed",value:x.zones.total,subtitle:`${x.zones.supervisors} Supervisors â€¢ ${x.zones.chiefs} Chiefs`,icon:e.jsx(P,{className:"w-5 h-5"}),actionLabel:"Manage zones",actionTo:"/zones",gradient:"from-amber-500 to-orange-500"}),e.jsx(p,{title:"Total Clients",value:N(x.clients.total),subtitle:"Active clients",icon:e.jsx(_,{className:"w-5 h-5"}),trend:!0,trendValue:12.5,actionLabel:"Manage clients",actionTo:"/clients",gradient:"from-green-500 to-emerald-500"}),e.jsx(p,{title:"Manpower",value:N(x.manpower.total),subtitle:"Total workforce",icon:e.jsx(B,{className:"w-5 h-5"}),trend:!0,trendValue:8.2,actionLabel:"Manage manpower",actionTo:"/manpower-dashboard",gradient:"from-zinc-700 to-neutral-800"}),e.jsx(p,{title:"Vehicles & Drivers",value:x.vehicles.total,subtitle:`${x.vehicles.drivers} Drivers`,icon:e.jsx(M,{className:"w-5 h-5"}),actionLabel:"Manage vehicles",actionTo:"/vehicles",gradient:"from-amber-600 to-orange-600"}),e.jsx(p,{title:"Current Month Payments",value:`$${N(x.payments.currentMonth)}`,subtitle:"Total payments this month",icon:e.jsx(M,{className:"w-5 h-5"}),trend:!0,trendValue:15.3,gradient:"from-emerald-500 to-teal-600"}),e.jsx(p,{title:"Today's Payments",value:`$${N(x.payments.today)}`,subtitle:"Payments received today",icon:e.jsx(M,{className:"w-5 h-5"}),gradient:"from-amber-600 to-yellow-500"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-zinc-100 p-4 sm:p-5",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-5",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-zinc-800",children:"Payment Trends"}),e.jsx("p",{className:"text-xs text-zinc-500 mt-1",children:"Visual overview of payment performance"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-3 md:mt-0",children:[e.jsx("button",{onClick:()=>w("yearly"),className:`px-3 py-1.5 rounded-md text-xs font-semibold ${y==="yearly"?"bg-amber-600 text-white":"bg-zinc-100 text-zinc-600 hover:bg-zinc-200"}`,children:"Year"}),e.jsx("button",{onClick:()=>w("monthly"),className:`px-3 py-1.5 rounded-md text-xs font-semibold ${y==="monthly"?"bg-amber-600 text-white":"bg-zinc-100 text-zinc-600 hover:bg-zinc-200"}`,children:"Monthly"}),e.jsx("button",{onClick:()=>w("weekly"),className:`px-3 py-1.5 rounded-md text-xs font-semibold ${y==="weekly"?"bg-amber-600 text-white":"bg-zinc-100 text-zinc-600 hover:bg-zinc-200"}`,children:"Weekly"}),e.jsx("button",{onClick:()=>w("daily"),className:`px-3 py-1.5 rounded-md text-xs font-semibold ${y==="daily"?"bg-amber-600 text-white":"bg-zinc-100 text-zinc-600 hover:bg-zinc-200"}`,children:"Daily"}),y==="yearly"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mx-1 text-zinc-400",children:"|"}),e.jsx("select",{value:f,onChange:t=>F(Number(t.target.value)),className:"text-xs bg-white border border-zinc-200 rounded-md px-2 py-1 text-zinc-700",children:g.yearly.map(t=>e.jsx("option",{value:Number(t.year),children:t.year},t.year))})]}),y==="monthly"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mx-1 text-zinc-400",children:"|"}),e.jsx("select",{value:f,onChange:t=>F(Number(t.target.value)),className:"text-xs bg-white border border-zinc-200 rounded-md px-2 py-1 text-zinc-700",children:g.yearly.map(t=>e.jsx("option",{value:Number(t.year),children:t.year},t.year))}),e.jsx("select",{value:v,onChange:t=>Z(Number(t.target.value)),className:"text-xs bg-white border border-zinc-200 rounded-md px-2 py-1 text-zinc-700",children:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].map((t,o)=>e.jsx("option",{value:o+1,children:t},t))})]})]})]}),e.jsx("div",{className:"h-64 relative w-full",children:U?e.jsx("div",{className:"h-full flex items-center justify-center text-zinc-500 text-sm",children:"Loading payments..."}):j.length===0?e.jsx("div",{className:"h-full flex items-center justify-center text-zinc-500 text-sm",children:"No payments to display"}):(()=>{const t=j.map(a=>Number(a.amount)||0),o=Math.max(...t,1),n=Math.pow(10,Math.floor(Math.log10(o))),l=Math.ceil(o/n)*n,m=6,i=Array.from({length:m},(a,c)=>Math.round(l/(m-1)*c));return e.jsxs("div",{className:"h-full flex w-full",children:[e.jsx("div",{className:"w-14 relative",children:i.map((a,c)=>{const h=100-a/l*100;return e.jsx("div",{className:"absolute left-0 w-full",style:{top:`${h}%`},children:e.jsx("div",{className:"-translate-y-1/2 flex items-center",children:e.jsx("span",{className:"text-[10px] text-zinc-500 w-10 text-right pr-2",children:a.toLocaleString()})})},c)})}),e.jsxs("div",{className:"flex-1 relative",children:[i.map((a,c)=>{const h=100-a/l*100;return e.jsx("div",{className:"absolute left-0 right-0",style:{top:`${h}%`},children:e.jsx("div",{className:`h-px ${c===0?"bg-zinc-300":"bg-zinc-100"}`})},c)}),e.jsx("div",{className:"absolute inset-x-0 bottom-6 top-2",children:e.jsx("div",{className:"h-full flex items-end justify-between px-4 gap-2",children:j.map((a,c)=>{const h=Number(a.amount)||0,b=Math.max(10,Math.min(100,h/l*100));return e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col items-center group",children:[e.jsx("div",{className:"text-center mb-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:e.jsxs("div",{className:"bg-zinc-800 text-white text-xs px-2 py-1 rounded-md shadow-lg",children:["$",h.toLocaleString()]})}),e.jsx("div",{className:"w-3/4 bg-gradient-to-t from-amber-500 to-yellow-500 rounded-t-md transition-all duration-300 hover:opacity-90 cursor-pointer shadow-sm",style:{height:`${b}%`}})]},c)})})}),e.jsx("div",{className:"absolute left-0 right-0 bottom-0",children:e.jsx("div",{className:"flex justify-between items-center px-4",children:j.map((a,c)=>e.jsx("div",{className:"flex-1 text-center truncate",children:e.jsx("p",{className:"text-[11px] font-medium text-zinc-600",children:a.month||a.week||a.year||a.day})},c))})})]})]})})()})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-zinc-100 p-4 sm:p-5",children:[e.jsx("h3",{className:"text-base font-semibold text-zinc-800 mb-3",children:"Quick Actions"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:[{label:"Add New Zone",to:"/add-zone",Icon:P,color:"text-amber-600 bg-amber-50"},{label:"Register Client",to:"/register-client",Icon:_,color:"text-emerald-600 bg-emerald-50"},{label:"View Reports",to:"/reports",Icon:M,color:"text-neutral-700 bg-neutral-50"},{label:"Manage Workers",to:"/manage-workers",Icon:B,color:"text-orange-600 bg-orange-50"}].map(({label:t,to:o,Icon:n,color:l},m)=>e.jsxs(E,{to:o,className:"flex flex-col items-center justify-center p-3 bg-zinc-50 rounded-lg hover:bg-white border border-zinc-200 transition-all duration-200 group",children:[e.jsx("span",{className:`mb-1.5 p-1.5 rounded-md ${l}`,children:e.jsx(n,{className:"h-5 w-5"})}),e.jsx("span",{className:"text-xs font-medium text-zinc-700 text-center group-hover:text-amber-600",children:t})]},m))})]})]})};export{re as default};
