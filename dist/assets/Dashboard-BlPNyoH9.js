import{u as ue,j as e}from"./index-B34CxXhK.js";import{r as l,L as Z}from"./react-BeLGUnOF.js";import{C as xe}from"./ChartComponent-B221MXQ3.js";import{e as R,U,f as O,c as z}from"./ui-DnAl6TrK.js";const M="http://localhost:4000",V={TrendUp:()=>e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})}),TrendDown:()=>e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"})})},be=()=>{const{lang:Q,setLang:q,t:d}=ue(),[F,D]=l.useState([]),[G,E]=l.useState(!1),[H,Y]=l.useState(!1),[b,X]=l.useState([]),ee=new Date,[g,te]=l.useState(ee.getFullYear()),[h,se]=l.useState(0),[$,ae]=l.useState([]),[y,T]=l.useState(""),[ne,re]=l.useState([]),[p,B]=l.useState(""),v=s=>Number(s??0).toLocaleString(),[u,oe]=l.useState({zones:{total:15,supervisors:45,chiefs:15},clients:{total:3247},manpower:{total:15680},vehicles:{total:892,drivers:945},payments:{currentMonth:245670,today:12345}}),[J,A]=l.useState({yearly:[],monthly:[],weekly:[],daily:[]});function C(s,n,t){const r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],i=Array.from({length:12},(a,o)=>({key:`${n}-${String(o+1).padStart(2,"0")}`,label:r[o],year:n,monthIdx:o})),m=new Map(i.map(a=>[a.key,0])),c=[0,0,0,0],w=`${n}-${String(t).padStart(2,"0")}`,j=Array.from({length:5},(a,o)=>String(new Date().getFullYear()-(4-o))),N=new Map(j.map(a=>[a,0])),W=new Date,K=[],_=[];for(let a=6;a>=0;a--){const o=new Date(W);o.setDate(W.getDate()-a);const x=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`;_.push(x),K.push(`Day ${7-a}`)}const k=new Map(_.map(a=>[a,0])),le=Array.isArray(s)?s.filter(a=>{const o=String((a==null?void 0:a.status)||"").toLowerCase();return!(a!=null&&a.status)||o==="success"||o==="successful"}):[];for(const a of le){const o=Number(a.amount||0),x=new Date(a.completed_at||a.created_at||a.updated_at||a.inserted_at||Date.now()),S=`${x.getFullYear()}-${String(x.getMonth()+1).padStart(2,"0")}`;if(m.has(S)&&m.set(S,(m.get(S)||0)+o),S===w){const he=Math.min(4,Math.max(1,Math.ceil(x.getDate()/7)));c[he-1]+=o}const L=String(x.getFullYear());N.has(L)&&N.set(L,(N.get(L)||0)+o);const I=`${x.getFullYear()}-${String(x.getMonth()+1).padStart(2,"0")}-${String(x.getDate()).padStart(2,"0")}`;k.has(I)&&k.set(I,(k.get(I)||0)+o)}const ie=i.map(a=>({month:a.label,amount:m.get(a.key)||0})),ce=[{week:"Week 1",amount:c[0]},{week:"Week 2",amount:c[1]},{week:"Week 3",amount:c[2]},{week:"Week 4",amount:c[3]}],de=j.map(a=>({year:a,amount:N.get(a)||0})),me=_.map((a,o)=>({day:K[o],amount:k.get(a)||0}));return{yearly:de,monthly:ie,weekly:ce,daily:me}}l.useEffect(()=>{D(J.monthly||[])},[J]),l.useEffect(()=>{let s=!1;async function n(){try{E(!0);const t=localStorage.getItem("token");if(!t){D([{month:"Jan",amount:4e4},{month:"Feb",amount:32e3},{month:"Mar",amount:28e3},{month:"Apr",amount:35e3},{month:"May",amount:42e3},{month:"Jun",amount:38e3}]);return}const i=await(await fetch(`${M}/api/payments/completed`,{headers:{Authorization:`Bearer ${t}`}})).json(),m=Array.isArray(i==null?void 0:i.payments)?i.payments:[];if(!s){X(m);const c=C(m,g,h);A({yearly:c.yearly,monthly:c.monthly,weekly:c.weekly,daily:c.daily})}}catch{s||D([{month:"Jan",amount:4e4},{month:"Feb",amount:32e3},{month:"Mar",amount:28e3},{month:"Apr",amount:35e3},{month:"May",amount:42e3},{month:"Jun",amount:38e3}])}finally{s||E(!1)}}return n(),()=>{s=!0}},[]),l.useEffect(()=>{const s=localStorage.getItem("token");s&&fetch(`${M}/api/zones`,{headers:{Authorization:`Bearer ${s}`}}).then(async n=>{const t=await n.json();if(!n.ok)throw new Error((t==null?void 0:t.error)||"Failed to load zones");const r=(t.zones||[]).map(i=>({id:i.id,zone_name:i.zone_name,supervisor_id:i.supervisor_id}));ae(r)}).catch(()=>{})},[]),l.useEffect(()=>{const s=localStorage.getItem("token");s&&fetch(`${M}/api/report/supervisors`,{headers:{Authorization:`Bearer ${s}`}}).then(async n=>{const t=await n.json();if(!n.ok)throw new Error((t==null?void 0:t.error)||"Failed to load supervisors");re(Array.isArray(t.supervisors)?t.supervisors:[])}).catch(()=>{})},[]);const P=l.useMemo(()=>{const s=t=>{if(!t)return!1;const r=new Date(t);return!(r.getFullYear()!==g||h&&r.getMonth()+1!==h)},n=p?$.filter(t=>String(t.supervisor_id??"")===String(p)).map(t=>t.id):[];return b.filter(t=>!(!s((t==null?void 0:t.completed_at)||(t==null?void 0:t.created_at)||(t==null?void 0:t.updated_at)||(t==null?void 0:t.inserted_at))||y&&String((t==null?void 0:t.zone_id)??"")!==String(y)||!y&&p&&!n.includes(Number(t==null?void 0:t.zone_id))))},[b,g,h,y,p,$]);l.useEffect(()=>{const s=C(P,g,h);A({yearly:s.yearly,monthly:s.monthly,weekly:s.weekly,daily:s.daily})},[P,g,h]),l.useEffect(()=>{const s=C(b,g,h);A({yearly:s.yearly,monthly:s.monthly,weekly:s.weekly,daily:s.daily})},[b,g,h]),l.useEffect(()=>{const s=localStorage.getItem("token");s&&(Y(!0),fetch(`${M}/api/manager/dashboard`,{headers:{Authorization:`Bearer ${s}`}}).then(async n=>{const t=await n.json();if(!n.ok)throw new Error((t==null?void 0:t.error)||"Failed to load dashboard");oe(r=>({...r,zones:t.zones??r.zones,clients:t.clients??r.clients,manpower:t.manpower??r.manpower,vehicles:t.vehicles??r.vehicles,payments:t.payments??r.payments}))}).catch(n=>console.error("Dashboard load error:",n)).finally(()=>Y(!1)))},[]);const f=({title:s,value:n,subtitle:t,icon:r,trend:i,trendValue:m,actionLabel:c,actionTo:w,gradient:j="from-amber-500 to-yellow-600"})=>e.jsx("div",{className:"group bg-white rounded-xl shadow-sm border border-zinc-100 p-3 sm:p-4 hover:shadow-md transition-all duration-200",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs font-medium text-zinc-500 mb-1",children:s}),e.jsx("p",{className:"text-2xl font-semibold text-zinc-900",children:H?"...":n}),t&&e.jsx("p",{className:"text-xs text-zinc-500 mt-1",children:t}),i&&typeof m=="number"&&e.jsxs("div",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium mt-2 ${m>0?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:[m>0?e.jsx(V.TrendUp,{}):e.jsx(V.TrendDown,{}),e.jsxs("span",{className:"ml-1",children:[Math.abs(m),"%"]})]}),c&&w&&e.jsx(Z,{to:w,className:"block text-xs text-amber-600 mt-2 hover:underline transition-colors",children:c})]}),e.jsx("div",{className:`p-3 rounded-lg bg-gradient-to-br ${j} shadow-sm`,children:e.jsx("div",{className:"text-white w-5 h-5",children:r})})]})});return e.jsxs("div",{className:"space-y-6 overflow-x-hidden",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-amber-400 to-amber-500 bg-clip-text text-transparent",children:d("sidebar.dashboard")}),e.jsx("p",{className:"text-sm text-zinc-500 mt-1",children:d("app.subtitle")})]}),e.jsxs("div",{className:"flex items-center mt-3 sm:mt-0 space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-green-600",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{children:d("app.systemOnline")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"sr-only",children:"Language"}),e.jsxs("select",{value:Q,onChange:s=>q(s.target.value),className:"text-sm bg-white border border-zinc-200 rounded-md px-2 py-1",children:[e.jsx("option",{value:"en",children:d("lang.english")}),e.jsx("option",{value:"rw",children:d("lang.kinyarwanda")})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[e.jsx(f,{title:"Zones Managed",value:u.zones.total,subtitle:`${u.zones.supervisors} Supervisors â€¢ ${u.zones.chiefs} Chiefs`,icon:e.jsx(R,{className:"w-5 h-5"}),actionLabel:"Manage zones",actionTo:"/zones",gradient:"from-amber-500 to-orange-500"}),e.jsx(f,{title:"Total Clients",value:v(u.clients.total),subtitle:"Active clients",icon:e.jsx(U,{className:"w-5 h-5"}),trend:!0,trendValue:12.5,actionLabel:"Manage clients",actionTo:"/clients",gradient:"from-green-500 to-emerald-500"}),e.jsx(f,{title:"Manpower",value:v(u.manpower.total),subtitle:"Total workforce",icon:e.jsx(O,{className:"w-5 h-5"}),trend:!0,trendValue:8.2,gradient:"from-zinc-700 to-neutral-800"}),e.jsx(f,{title:"Vehicles & Drivers",value:u.vehicles.total,subtitle:`${u.vehicles.drivers} Drivers`,icon:e.jsx(z,{className:"w-5 h-5"}),actionLabel:"Manage vehicles",actionTo:"/vehicles",gradient:"from-amber-600 to-orange-600"}),e.jsx(f,{title:"Current Month Payments",value:`$${v(u.payments.currentMonth)}`,subtitle:"Total payments this month",icon:e.jsx(z,{className:"w-5 h-5"}),trend:!0,trendValue:15.3,gradient:"from-emerald-500 to-teal-600"}),e.jsx(f,{title:"Today's Payments",value:`$${v(u.payments.today)}`,subtitle:"Payments received today",icon:e.jsx(z,{className:"w-5 h-5"}),gradient:"from-amber-600 to-yellow-500"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-zinc-100 p-4 sm:p-5",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-5",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-zinc-800",children:d("supervisor.trends.title")}),e.jsx("p",{className:"text-xs text-zinc-500 mt-1",children:d("supervisor.trends.subtitle")})]}),e.jsxs("div",{className:"flex flex-wrap items-end gap-2 mt-3 md:mt-0",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[11px] text-zinc-600",children:d("reports.filters.year")}),e.jsx("select",{className:"text-xs bg-white border border-zinc-200 rounded-md px-2 py-1 text-zinc-700",value:g,onChange:s=>te(Number(s.target.value)),children:Array.from({length:6}).map((s,n)=>{const t=new Date().getFullYear()-n;return e.jsx("option",{value:t,children:t},t)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[11px] text-zinc-600",children:d("reports.filters.month")}),e.jsxs("select",{className:"text-xs bg-white border border-zinc-200 rounded-md px-2 py-1 text-zinc-700",value:h,onChange:s=>se(Number(s.target.value)),children:[e.jsx("option",{value:0,children:"All months"}),Array.from({length:12}).map((s,n)=>{const t=n+1,i=new Date(2e3,n,1).toLocaleString(void 0,{month:"long"});return e.jsx("option",{value:t,children:i},t)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[11px] text-zinc-600",children:d("reports.filters.zone")}),e.jsxs("select",{className:"text-xs bg-white border border-zinc-200 rounded-md px-2 py-1 text-zinc-700",value:y,onChange:s=>{T(s.target.value),s.target.value&&B("")},children:[e.jsx("option",{value:"",children:"All Zones"}),$.map(s=>e.jsx("option",{value:s.id,children:s.zone_name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[11px] text-zinc-600",children:d("reports.filters.supervisor")}),e.jsxs("select",{className:"text-xs bg-white border border-zinc-200 rounded-md px-2 py-1 text-zinc-700",value:p,onChange:s=>{B(s.target.value),s.target.value&&T("")},children:[e.jsx("option",{value:"",children:"All Supervisors"}),ne.map(s=>e.jsx("option",{value:s.id,children:s.username},s.id))]})]})]})]}),e.jsx("div",{className:"h-64 relative w-full",children:G?e.jsx("div",{className:"h-full flex items-center justify-center text-zinc-500 text-sm",children:d("supervisor.trends.loading")}):F.length===0?e.jsx("div",{className:"h-full flex items-center justify-center text-zinc-500 text-sm",children:d("supervisor.trends.empty")}):e.jsx(xe,{data:F.map(s=>({name:s.month||s.week||s.year||s.day,amount:Number(s.amount)||0})),xKey:"name",series:[{key:"amount",name:"Amount"}],height:260})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-zinc-100 p-4 sm:p-5",children:[e.jsx("h3",{className:"text-base font-semibold text-zinc-800 mb-3",children:"Quick Actions"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:[{label:"Add New Zone",to:"/add-zone",Icon:R,color:"text-amber-600 bg-amber-50"},{label:"Register Client",to:"/register-client",Icon:U,color:"text-emerald-600 bg-emerald-50"},{label:"View Reports",to:"/reports",Icon:z,color:"text-neutral-700 bg-neutral-50"},{label:"Manage Workers",to:"/manage-workers",Icon:O,color:"text-orange-600 bg-orange-50"}].map(({label:s,to:n,Icon:t,color:r},i)=>e.jsxs(Z,{to:n,className:"flex flex-col items-center justify-center p-3 bg-zinc-50 rounded-lg hover:bg-white border border-zinc-200 transition-all duration-200 group",children:[e.jsx("span",{className:`mb-1.5 p-1.5 rounded-md ${r}`,children:e.jsx(t,{className:"h-5 w-5"})}),e.jsx("span",{className:"text-xs font-medium text-zinc-700 text-center group-hover:text-amber-600",children:s})]},i))})]})]})};export{be as default};
