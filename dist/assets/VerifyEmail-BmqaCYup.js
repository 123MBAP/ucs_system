import{j as n}from"./index-BdDvBGrt.js";import{u as x,f as y,r as c}from"./react-BeLGUnOF.js";function v(){const l=x(),f=y(),i="http://localhost:4000",[o,e]=c.useState("idle"),[d,a]=c.useState("");return c.useEffect(()=>{async function h(){e("working");try{const t=new URLSearchParams(l.search),m=t.get("code"),p=t.get("email"),u=localStorage.getItem("token");if(!m){e("error"),a("Missing verification code.");return}if(!u){e("error"),a("Please login first, then click the verification link again.");return}const g=await fetch(`${i}/api/profile/email/verify-code`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`},body:JSON.stringify({code:m})});if(!g.ok){const r=await g.json().catch(()=>({}));e("error"),a((r==null?void 0:r.error)||"Verification failed.");return}e("ok"),a("Email verified successfully.");try{const r=localStorage.getItem("user");if(r){const s=JSON.parse(r);s.email=p||s.email,s.email_verified=!0,localStorage.setItem("user",JSON.stringify(s))}}catch{}setTimeout(()=>f("/profile"),1200)}catch(t){e("error"),a((t==null?void 0:t.message)||"Unexpected error.")}}h()},[l.search,i,f]),n.jsxs("div",{className:"p-6 max-w-xl mx-auto",children:[o==="working"&&n.jsx("div",{className:"text-sm text-gray-700",children:"Verifying your email, please wait..."}),o!=="working"&&n.jsx("div",{className:o==="ok"?"text-green-600":"text-red-600",children:d})]})}export{v as default};
