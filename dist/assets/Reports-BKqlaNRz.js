import{j as e}from"./index-DZTFkylD.js";import{r}from"./react-CzDbI3ao.js";const p="http://localhost:4000",ue=()=>{const[o,M]=r.useState(null),[B,d]=r.useState(!1),[R,m]=r.useState(null),A=new Date,[l,H]=r.useState(A.getFullYear()),[c,V]=r.useState(A.getMonth()+1),[S,Y]=r.useState([]),[C,q]=r.useState([]),[_,O]=r.useState(null),[k,G]=r.useState([]),[y,D]=r.useState(""),[v,J]=r.useState("all"),[N,K]=r.useState([]),[g,Q]=r.useState(null),[$,W]=r.useState([]),[P,X]=r.useState(null),[F,ee]=r.useState([]),[f,L]=r.useState(""),[u,te]=r.useState("all"),E=r.useRef(null),T=r.useRef(null),I=r.useRef(null),U=r.useRef(null);function b(t,s){const n=window.open("","_blank");n&&(n.document.open(),n.document.write(`<!doctype html><html><head><meta charset="utf-8"><title>${t}</title>
      <style>
        body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, 'Apple Color Emoji','Segoe UI Emoji'; padding: 24px; }
        table { width: 100%; border-collapse: collapse; font-size: 12px; }
        th, td { border: 1px solid #ddd; padding: 8px; }
        th { background: #f3f4f6; text-align: left; }
        h1 { font-size: 18px; margin: 0 0 12px; }
      </style>
    </head><body>
      <h1>${t}</h1>
      ${s}
      <script>window.onload = function(){ window.print(); setTimeout(()=>window.close(), 300); }<\/script>
    </body></html>`),n.document.close())}const se=()=>{var j;const t=((j=E.current)==null?void 0:j.innerHTML)||"",s=new Date(2e3,c-1,1).toLocaleString(void 0,{month:"long"}),n=F.find(h=>String(h.id)===f),a=k.find(h=>String(h.id)===y),i=N.map(h=>h.zone_name).filter(Boolean),x=a?[a.zone_name]:i.length?i:[],z=`
      <div style="margin-bottom:16px">
        <div style="font-size:20px;font-weight:700;">UCS Company Ltd.</div>
        <div style="font-size:14px;color:#374151;">Zones Summary Report</div>
        <div style="margin-top:8px;font-size:12px;color:#111827;">
          <div><strong>Period:</strong> ${s} ${l}</div>
          <div><strong>Filter:</strong> ${v}</div>
          <div><strong>Supervisor:</strong> ${n?n.username:"All"}</div>
          <div><strong>Zones:</strong> ${x.length?x.join(", "):"All"}</div>
        </div>
      </div>`;b(`Zones Summary ${l}-${c}`,z+t)},ne=()=>{var a;const t=((a=T.current)==null?void 0:a.innerHTML)||"",n=`
      <div style="margin-bottom:16px">
        <div style="font-size:20px;font-weight:700;">UCS Company Ltd.</div>
        <div style="font-size:14px;color:#374151;">Chief Clients Report</div>
        <div style="margin-top:8px;font-size:12px;color:#111827;">
          <div><strong>Period:</strong> ${new Date(2e3,c-1,1).toLocaleString(void 0,{month:"long"})} ${l}</div>
          <div><strong>Filter:</strong> ${u}</div>
        </div>
      </div>`;b(`Chief Clients ${l}-${c} (${u})`,n+t)},ae=()=>{var a;const t=((a=I.current)==null?void 0:a.innerHTML)||"",n=`
      <div style="margin-bottom:16px">
        <div style="font-size:20px;font-weight:700;">UCS Company Ltd.</div>
        <div style="font-size:14px;color:#374151;">Chief Payments Report</div>
        <div style="margin-top:8px;font-size:12px;color:#111827;">
          <div><strong>Period:</strong> ${new Date(2e3,c-1,1).toLocaleString(void 0,{month:"long"})} ${l}</div>
        </div>
      </div>`;b(`Chief Payments ${l}-${c}`,n+t)},oe=()=>{var a;const t=((a=U.current)==null?void 0:a.innerHTML)||"",n=`
      <div style="margin-bottom:16px">
        <div style="font-size:20px;font-weight:700;">UCS Company Ltd.</div>
        <div style="font-size:14px;color:#374151;">My Payments Report</div>
        <div style="margin-top:8px;font-size:12px;color:#111827;">
          <div><strong>Period:</strong> ${new Date(2e3,c-1,1).toLocaleString(void 0,{month:"long"})} ${l}</div>
        </div>
      </div>`;b(`My Payments ${l}-${c}`,n+t)};function Z(t){if(t==null)return"";const s=String(t);return/[",\n]/.test(s)?'"'+s.replace(/"/g,'""')+'"':s}function w(t,s,n){const a=s.map(Z).join(","),i=n.map(he=>he.map(Z).join(",")),x=[a,...i].join(`
`),z=new Blob([x],{type:"text/csv;charset=utf-8;"}),j=URL.createObjectURL(z),h=document.createElement("a");h.href=j,h.download=t,h.click(),URL.revokeObjectURL(j)}const re=()=>{const t=N.map(s=>[s.zone_id,s.zone_name,s.clients_count,s.amount_to_pay,s.amount_paid,s.amount_remaining]);w(`zones_summary_${l}-${c}.csv`,["Zone ID","Zone","# Clients","Amount To Pay","Amount Paid","Remaining"],t)},ie=()=>{const t=S.map(s=>[s.client_id,s.client_username??"",s.amount_to_pay,s.amount_paid,s.amount_remaining]);w(`chief_clients_${l}-${c}_${u}.csv`,["Client ID","Client","To Pay","Paid","Remaining"],t)},le=()=>{const t=C.map(s=>[s.id,s.completed_at??"",s.client_username??s.client_id??"",s.amount,s.currency??"",s.status??""]);w(`chief_payments_${l}-${c}.csv`,["Payment ID","Date","Client","Amount","Currency","Status"],t)},ce=()=>{const t=$.map(s=>[s.id,s.completed_at??"",s.amount,s.currency??"",s.status??""]);w(`my_payments_${l}-${c}.csv`,["Payment ID","Date","Amount","Currency","Status"],t)},de=t=>{D(t),o==="manager"&&t&&L("")},me=t=>{L(t),o==="manager"&&t&&D("")};return r.useEffect(()=>{const t=localStorage.getItem("token");t&&(d(!0),m(null),fetch(`${p}/api/me`,{headers:{Authorization:`Bearer ${t}`}}).then(async s=>{var a;const n=await s.json();if(!s.ok)throw new Error((n==null?void 0:n.error)||"Failed to load user");M(((a=n==null?void 0:n.user)==null?void 0:a.role)??null)}).catch(s=>m((s==null?void 0:s.message)||"Failed to load user")).finally(()=>d(!1)))},[]),r.useEffect(()=>{const t=localStorage.getItem("token");if(!t||!o||o!=="manager"&&o!=="supervisor")return;d(!0),m(null),fetch(`${p}/api/zones${o==="supervisor"?"?scope=supervisor":""}`,{headers:{Authorization:`Bearer ${t}`}}).then(async n=>{const a=await n.json();if(!n.ok)throw new Error((a==null?void 0:a.error)||"Failed to load zones");const i=(a.zones||[]).map(x=>({id:x.id,zone_name:x.zone_name}));G(i)}).catch(n=>m((n==null?void 0:n.message)||"Failed to load zones")).finally(()=>d(!1))},[o]),r.useEffect(()=>{const t=localStorage.getItem("token");!t||o!=="manager"||(d(!0),m(null),fetch(`${p}/api/report/supervisors`,{headers:{Authorization:`Bearer ${t}`}}).then(async s=>{const n=await s.json();if(!s.ok)throw new Error((n==null?void 0:n.error)||"Failed to load supervisors");ee(Array.isArray(n.supervisors)?n.supervisors:[])}).catch(s=>m((s==null?void 0:s.message)||"Failed to load supervisors")).finally(()=>d(!1)))},[o]),r.useEffect(()=>{const t=localStorage.getItem("token");if(!(!t||!o))if(d(!0),m(null),o==="chief"){const s=new URLSearchParams;s.set("year",String(l)),s.set("month",String(c)),s.set("filter",u),fetch(`${p}/api/report/clients-summary?${s.toString()}`,{headers:{Authorization:`Bearer ${t}`}}).then(async a=>{const i=await a.json();if(!a.ok)throw new Error((i==null?void 0:i.error)||"Failed to load summary");Y(Array.isArray(i.clients)?i.clients:[])}).catch(a=>m((a==null?void 0:a.message)||"Failed to load summary")).finally(()=>d(!1));const n=new URLSearchParams;n.set("year",String(l)),n.set("month",String(c)),fetch(`${p}/api/report/payments?${n.toString()}`,{headers:{Authorization:`Bearer ${t}`}}).then(async a=>{const i=await a.json();if(!a.ok)throw new Error((i==null?void 0:i.error)||"Failed to load payments");q(Array.isArray(i.payments)?i.payments:[]),O(i.totals||null)}).catch(a=>m((a==null?void 0:a.message)||"Failed to load payments"))}else if(o==="manager"||o==="supervisor"){const s=new URLSearchParams;s.set("year",String(l)),s.set("month",String(c)),s.set("filter",v),y&&s.set("zoneId",y),o==="manager"&&f&&s.set("supervisorId",f),fetch(`${p}/api/report/zones-summary?${s.toString()}`,{headers:{Authorization:`Bearer ${t}`}}).then(async n=>{const a=await n.json();if(!n.ok)throw new Error((a==null?void 0:a.error)||"Failed to load zones summary");K(Array.isArray(a.rows)?a.rows:[]),Q(a.totals||null)}).catch(n=>m((n==null?void 0:n.message)||"Failed to load zones summary")).finally(()=>d(!1))}else if(o==="client"){const s=new URLSearchParams;s.set("year",String(l)),s.set("month",String(c)),fetch(`${p}/api/report/payments?${s.toString()}`,{headers:{Authorization:`Bearer ${t}`}}).then(async n=>{const a=await n.json();if(!n.ok)throw new Error((a==null?void 0:a.error)||"Failed to load payments");W(Array.isArray(a.payments)?a.payments:[]),X(a.totals||null)}).catch(n=>m((n==null?void 0:n.message)||"Failed to load payments")).finally(()=>d(!1))}else d(!1)},[o,l,c,v,y,f,u]),e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Reports"}),e.jsxs("div",{className:"mb-4 flex flex-wrap items-end gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700",children:"Year"}),e.jsx("select",{className:"mt-1 border rounded px-2 py-2",value:l,onChange:t=>H(Number(t.target.value)),children:Array.from({length:6}).map((t,s)=>{const n=new Date().getFullYear()-s;return e.jsx("option",{value:n,children:n},n)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700",children:"Month"}),e.jsx("select",{className:"mt-1 border rounded px-2 py-2",value:c,onChange:t=>V(Number(t.target.value)),children:Array.from({length:12}).map((t,s)=>{const n=s+1,i=new Date(2e3,s,1).toLocaleString(void 0,{month:"long"});return e.jsx("option",{value:n,children:i},n)})})]}),(o==="manager"||o==="supervisor")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700",children:"Zone"}),e.jsxs("select",{className:"mt-1 border rounded px-2 py-2",value:y,onChange:t=>de(t.target.value),children:[e.jsx("option",{value:"",children:"All Zones"}),k.map(t=>e.jsx("option",{value:t.id,children:t.zone_name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700",children:"Paid & Remaining"}),e.jsxs("select",{className:"mt-1 border rounded px-2 py-2",value:v,onChange:t=>J(t.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"remaining",children:"Remaining"})]})]}),o==="manager"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700",children:"Supervisor"}),e.jsxs("select",{className:"mt-1 border rounded px-2 py-2",value:f,onChange:t=>me(t.target.value),children:[e.jsx("option",{value:"",children:"All Supervisors"}),F.map(t=>e.jsx("option",{value:t.id,children:t.username},t.id))]})]}),e.jsxs("div",{className:"self-end pb-1 flex items-center gap-2",children:[e.jsx("button",{onClick:re,className:"px-3 py-2 rounded bg-amber-600 text-white",children:"Download CSV"}),e.jsx("button",{onClick:se,className:"px-3 py-2 rounded bg-amber-700 text-white",children:"Download PDF"})]})]}),o==="chief"&&e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Showing clients in your assigned zones"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700",children:"Paid&Remaining"}),e.jsxs("select",{className:"mt-1 border rounded px-2 py-2",value:u,onChange:t=>te(t.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"remaining",children:"Remaining"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:ie,className:"px-3 py-2 rounded bg-amber-600 text-white",children:"Download Clients CSV"}),e.jsx("button",{onClick:ne,className:"px-3 py-2 rounded bg-amber-700 text-white",children:"Download PDF"})]})]}),o==="client"&&e.jsx("div",{className:"text-sm text-gray-600",children:"Showing your monthly summary"})]}),R&&e.jsx("div",{className:"text-red-600 mb-3",children:R}),B?e.jsx("div",{children:"Loadingâ€¦"}):e.jsxs(e.Fragment,{children:[(o==="manager"||o==="supervisor")&&e.jsx("div",{ref:E,className:"bg-white rounded-lg shadow overflow-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Zone"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"# Clients"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Amount To Pay"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Amount Paid"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Remaining"})]})}),e.jsxs("tbody",{children:[N.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3",children:t.zone_name}),e.jsx("td",{className:"px-4 py-3 text-right",children:t.clients_count}),e.jsx("td",{className:"px-4 py-3 text-right",children:t.amount_to_pay}),e.jsx("td",{className:"px-4 py-3 text-right",children:t.amount_paid}),e.jsx("td",{className:"px-4 py-3 text-right",children:t.amount_remaining})]},t.zone_id)),!N.length&&e.jsx("tr",{children:e.jsx("td",{className:"px-4 py-6 text-gray-500",colSpan:5,children:"No data found."})})]}),g&&e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-gray-50 font-semibold border-t",children:[e.jsx("td",{className:"px-4 py-3 text-right",children:"Totals"}),e.jsx("td",{className:"px-4 py-3 text-right",children:g.clients_count}),e.jsx("td",{className:"px-4 py-3 text-right",children:g.amount_to_pay}),e.jsx("td",{className:"px-4 py-3 text-right",children:g.amount_paid}),e.jsx("td",{className:"px-4 py-3 text-right",children:g.amount_remaining})]})})]})}),o==="chief"&&e.jsx("div",{ref:T,className:"bg-white rounded-lg shadow overflow-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Client"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Amount To Pay"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Amount Paid"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Remaining"})]})}),e.jsxs("tbody",{children:[S.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3",children:t.client_username||t.client_id}),e.jsx("td",{className:"px-4 py-3 text-right",children:t.amount_to_pay}),e.jsx("td",{className:"px-4 py-3 text-right",children:t.amount_paid}),e.jsx("td",{className:"px-4 py-3 text-right",children:t.amount_remaining})]},t.client_id)),!S.length&&e.jsx("tr",{children:e.jsx("td",{className:"px-4 py-6 text-gray-500",colSpan:4,children:"No clients found."})})]})]})}),o==="chief"&&e.jsxs("div",{ref:I,className:"bg-white rounded-lg shadow overflow-auto mt-6",children:[e.jsxs("div",{className:"px-4 py-3 font-semibold flex items-center justify-between",children:[e.jsx("span",{children:"Payments (filtered)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:le,className:"px-3 py-1 rounded bg-amber-600 text-white",children:"Download CSV"}),e.jsx("button",{onClick:ae,className:"px-3 py-1 rounded bg-amber-700 text-white",children:"Download PDF"})]})]}),e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Client"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Currency"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Status"})]})}),e.jsxs("tbody",{children:[C.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3",children:t.completed_at?new Date(t.completed_at).toLocaleString():"-"}),e.jsx("td",{className:"px-4 py-3",children:t.client_username||t.client_id}),e.jsx("td",{className:"px-4 py-3 text-right",children:t.amount}),e.jsx("td",{className:"px-4 py-3",children:t.currency||""}),e.jsx("td",{className:"px-4 py-3",children:t.status||""})]},t.id)),!C.length&&e.jsx("tr",{children:e.jsx("td",{className:"px-4 py-6 text-gray-500",colSpan:5,children:"No payments found."})})]}),_&&e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-gray-50 font-semibold border-t",children:[e.jsx("td",{className:"px-4 py-3 text-right",colSpan:2,children:"Totals"}),e.jsx("td",{className:"px-4 py-3 text-right",children:_.amount_sum}),e.jsxs("td",{className:"px-4 py-3",colSpan:2,children:["Count: ",_.count]})]})})]})]}),o==="client"&&e.jsxs("div",{ref:U,className:"bg-white rounded-lg shadow overflow-auto",children:[e.jsxs("div",{className:"px-4 py-3 font-semibold flex items-center justify-between",children:[e.jsx("span",{children:"My Payments (filtered)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:ce,className:"px-3 py-1 rounded bg-amber-600 text-white",children:"Download CSV"}),e.jsx("button",{onClick:oe,className:"px-3 py-1 rounded bg-amber-700 text-white",children:"Download PDF"})]})]}),e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Currency"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Status"})]})}),e.jsxs("tbody",{children:[$.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3",children:t.completed_at?new Date(t.completed_at).toLocaleString():"-"}),e.jsx("td",{className:"px-4 py-3 text-right",children:t.amount}),e.jsx("td",{className:"px-4 py-3",children:t.currency||""}),e.jsx("td",{className:"px-4 py-3",children:t.status||""})]},t.id)),!$.length&&e.jsx("tr",{children:e.jsx("td",{className:"px-4 py-6 text-gray-500",colSpan:4,children:"No payments found."})})]}),P&&e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-gray-50 font-semibold border-t",children:[e.jsx("td",{className:"px-4 py-3 text-right",children:"Totals"}),e.jsx("td",{className:"px-4 py-3 text-right",children:P.amount_sum}),e.jsxs("td",{className:"px-4 py-3",colSpan:2,children:["Count: ",P.count]})]})})]})]})]})]})};export{ue as default};
