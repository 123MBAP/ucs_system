import{j as e,u as He}from"./index-DnGg16Vn.js";import{r as p}from"./react-BeLGUnOF.js";import{L as ee}from"./LoadingSpinner-uLM5j9Cp.js";function Pe(X){const{t:o,colors:a,supervisors:b,vehicles:D,zones:S,editingId:E,editVehicleId:F,moveSelection:N,assignVehicleNoSup:A,assignVehicleToSupervisorId:T,assignZoneNoSup:_,assignZoneToSupervisorId:z,actionLoading:w,startEdit:P,cancelEdit:R,setEditVehicleId:B,setMoveSelection:q,setAssignVehicleNoSup:W,setAssignVehicleToSupervisorId:Z,setAssignZoneNoSup:L,setAssignZoneToSupervisorId:M,saveVehicle:V,unassignVehicle:g,removeZone:j,moveZone:i,assignVehicleToSupervisor:x,assignZoneToSupervisor:J}=X,G=({title:l,number:c})=>e.jsxs("div",{className:"flex items-center gap-3 mb-6 pb-3 border-b",style:{borderColor:a.border},children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm",style:{backgroundColor:a.primary},children:c}),e.jsx("h2",{className:"text-2xl font-bold",style:{color:a.text},children:l})]}),O=({title:l})=>e.jsx("h3",{className:"text-lg font-semibold mb-4 pb-2 border-b",style:{color:a.text,borderColor:a.border},children:l}),K=({children:l,className:c=""})=>e.jsx("div",{className:`rounded-lg shadow-sm border p-6 ${c}`,style:{backgroundColor:a.cardBg,borderColor:a.border},children:l}),H=({children:l,onClick:c,disabled:s=!1,loading:r=!1,className:n=""})=>e.jsxs("button",{onClick:c,disabled:s||r,className:`px-4 py-2 rounded-lg font-medium text-white transition-colors flex items-center gap-2 ${n}`,style:{backgroundColor:s?a.textLight:a.primary,cursor:s?"not-allowed":"pointer"},onMouseOver:t=>{!s&&!r&&(t.currentTarget.style.backgroundColor=a.primaryHover)},onMouseOut:t=>{!s&&!r&&(t.currentTarget.style.backgroundColor=a.primary)},children:[r&&e.jsx(ee,{size:14,className:"border-white/40 border-t-white"}),l]}),Q=({children:l,onClick:c,disabled:s=!1,className:r=""})=>e.jsx("button",{onClick:c,disabled:s,className:`px-4 py-2 rounded-lg font-medium border transition-colors ${r}`,style:{color:a.text,borderColor:a.border,backgroundColor:"transparent",cursor:s?"not-allowed":"pointer"},onMouseOver:n=>{s||(n.currentTarget.style.backgroundColor=a.background)},onMouseOut:n=>{s||(n.currentTarget.style.backgroundColor="transparent")},children:l});return e.jsxs("section",{children:[e.jsx(G,{title:o("manageWorkers.section.supervisors"),number:1}),e.jsxs("div",{className:"space-y-6 mb-8",children:[e.jsxs(K,{children:[e.jsx(O,{title:"Supervisors and Their Zones"}),e.jsxs("div",{className:"space-y-4",children:[b.filter(l=>(l.zones||[]).length>0).map(l=>e.jsxs("div",{className:"border rounded-lg p-4",style:{borderColor:a.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-semibold",style:{color:a.text},children:l.username}),E===l.id?e.jsx(Q,{onClick:R,className:"text-sm px-3 py-1",children:o("manageWorkers.close")}):e.jsx("button",{onClick:()=>P(l),className:"text-sm font-medium px-3 py-1 rounded border",style:{color:a.primary,borderColor:a.primary},children:o("manageWorkers.manage")})]}),e.jsx("div",{className:"space-y-3",children:(l.zones||[]).map(c=>e.jsxs("div",{className:"flex items-center justify-between text-sm p-2 rounded border",style:{borderColor:a.border},children:[e.jsx("span",{style:{color:a.text},children:c.name}),E===l.id&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-2 py-1 text-xs rounded border",style:{borderColor:a.border},onClick:()=>j(l.id,c.id),children:"Unassign"}),e.jsxs("select",{className:"border rounded px-2 py-1 text-xs",style:{borderColor:a.border},value:N[c.id]||"",onChange:s=>q(r=>({...r,[c.id]:s.target.value})),children:[e.jsx("option",{value:"",children:"Move to…"}),b.filter(s=>s.id!==l.id).map(s=>e.jsx("option",{value:s.id,children:s.username},s.id))]}),e.jsx(H,{loading:!!w[`moveZone-${c.id}`],disabled:!N[c.id]||!!w[`moveZone-${c.id}`],onClick:()=>i(c.id,N[c.id]),className:"text-xs px-2 py-1",children:"Move"})]})]},c.id))})]},l.id)),b.filter(l=>(l.zones||[]).length>0).length===0&&e.jsx("div",{className:"text-center py-8",style:{color:a.textLight},children:"No supervisors with zones"})]})]}),e.jsxs(K,{children:[e.jsx(O,{title:"Supervisors and Their Vehicles"}),e.jsxs("div",{className:"space-y-4",children:[b.filter(l=>(l.vehicles||[]).length>0).map(l=>e.jsxs("div",{className:"border rounded-lg p-4",style:{borderColor:a.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-semibold",style:{color:a.text},children:l.username}),E===l.id?e.jsx(Q,{onClick:R,className:"text-sm px-3 py-1",children:o("manageWorkers.close")}):e.jsx("button",{onClick:()=>P(l),className:"text-sm font-medium px-3 py-1 rounded border",style:{color:a.primary,borderColor:a.primary},children:o("manageWorkers.manage")})]}),e.jsxs("div",{className:"space-y-3",children:[(l.vehicles||[]).map(c=>e.jsxs("div",{className:"flex items-center justify-between text-sm p-2 rounded border",style:{borderColor:a.border},children:[e.jsx("span",{style:{color:a.text},children:c.plate}),E===l.id&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-2 py-1 text-xs rounded border",style:{borderColor:a.border},onClick:()=>g(l.id,c.id),children:"Unassign"}),e.jsxs("select",{className:"border rounded px-2 py-1 text-xs",style:{borderColor:a.border},value:N[c.id]||"",onChange:s=>q(r=>({...r,[c.id]:s.target.value})),children:[e.jsx("option",{value:"",children:"Move to…"}),b.filter(s=>s.id!==l.id).map(s=>e.jsx("option",{value:s.id,children:s.username},s.id))]}),e.jsx(H,{loading:!!w[`saveVehicle-${l.id}`],disabled:!N[c.id]||!!w[`saveVehicle-${l.id}`],onClick:()=>{const s=Number(N[c.id]);Number.isFinite(s)&&x(s,c.id)},className:"text-xs px-2 py-1",children:"Move"})]})]},c.id)),E===l.id&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("select",{value:F,onChange:c=>B(c.target.value),className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:a.border},children:[e.jsx("option",{value:"",children:o("manageWorkers.selectVehicle")}),D.filter(c=>!(l.vehicles||[]).some(s=>s.id===c.id)).map(c=>e.jsx("option",{value:c.id,children:c.plate},c.id))]}),e.jsx(H,{loading:!!w[`saveVehicle-${l.id}`],onClick:()=>V(l.id),disabled:!F||!!w[`saveVehicle-${l.id}`],className:"text-sm px-3 py-1",children:o("manageWorkers.addVehicle")})]})]})]},l.id)),b.filter(l=>(l.vehicles||[]).length>0).length===0&&e.jsx("div",{className:"text-center py-8",style:{color:a.textLight},children:"No supervisors with vehicles"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(K,{children:[e.jsx(O,{title:"Supervisors Without Zones"}),(()=>{const l=b.filter(r=>!r.zones||r.zones.length===0),c=new Set;b.forEach(r=>(r.zones||[]).forEach(n=>c.add(n.id)));const s=S.filter(r=>!c.has(r.id));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:a.border},value:z,onChange:r=>M(r.target.value),children:[e.jsx("option",{value:"",children:"Select supervisor…"}),l.map(r=>e.jsx("option",{value:r.id,children:r.username},r.id))]}),e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:a.border},value:_,onChange:r=>L(r.target.value),children:[e.jsx("option",{value:"",children:"Select zone…"}),s.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]}),e.jsx(H,{loading:!!w.assignZoneNoSup,disabled:!_||!z||!!w.assignZoneNoSup,onClick:()=>{const r=Number(_),n=Number(z);Number.isFinite(r)&&Number.isFinite(n)&&J(n,r)},className:"text-sm whitespace-nowrap",children:"Assign"})]}),l.length===0&&e.jsx("div",{className:"text-sm text-center py-4",style:{color:a.textLight},children:"All supervisors have zones"})]})})()]}),e.jsxs(K,{children:[e.jsx(O,{title:o("manageWorkers.unassignedVehicles")}),(()=>{const l=new Set;b.forEach(s=>(s.vehicles||[]).forEach(r=>l.add(r.id)));const c=D.filter(s=>!l.has(s.id));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:a.border},value:A,onChange:s=>W(s.target.value),children:[e.jsx("option",{value:"",children:"Select vehicle…"}),c.map(s=>e.jsx("option",{value:s.id,children:s.plate},s.id))]}),e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:a.border},value:T,onChange:s=>Z(s.target.value),children:[e.jsx("option",{value:"",children:"Select supervisor…"}),b.map(s=>e.jsx("option",{value:s.id,children:s.username},s.id))]}),e.jsx(H,{loading:!!w.assignVehicleNoSup,disabled:!A||!T||!!w.assignVehicleNoSup,onClick:()=>{const s=Number(A),r=Number(T);Number.isFinite(s)&&Number.isFinite(r)&&x(r,s)},className:"text-sm whitespace-nowrap",children:"Assign"})]}),c.length===0&&e.jsx("div",{className:"text-sm text-center py-4",style:{color:a.textLight},children:"All vehicles are assigned to supervisors"})]})})()]}),e.jsxs(K,{children:[e.jsx(O,{title:"Supervisors Without Vehicles"}),(()=>{const l=b.filter(r=>!r.vehicles||r.vehicles.length===0),c=new Set;b.forEach(r=>(r.vehicles||[]).forEach(n=>c.add(n.id)));const s=D.filter(r=>!c.has(r.id));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:a.border},value:T,onChange:r=>Z(r.target.value),children:[e.jsx("option",{value:"",children:"Select supervisor…"}),l.map(r=>e.jsx("option",{value:r.id,children:r.username},r.id))]}),e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:a.border},value:A,onChange:r=>W(r.target.value),children:[e.jsx("option",{value:"",children:"Select vehicle…"}),s.map(r=>e.jsx("option",{value:r.id,children:r.plate},r.id))]}),e.jsx(H,{disabled:!A||!T||!!w.assignVehicleNoSup,onClick:()=>{const r=Number(A),n=Number(T);Number.isFinite(r)&&Number.isFinite(n)&&x(n,r)},className:"text-sm whitespace-nowrap",children:"Assign"})]}),l.length===0&&e.jsx("div",{className:"text-sm text-center py-4",style:{color:a.textLight},children:"All supervisors have vehicles"})]})})()]}),e.jsxs(K,{children:[e.jsx(O,{title:"Unassigned Zones"}),(()=>{const l=new Set;b.forEach(s=>(s.zones||[]).forEach(r=>l.add(r.id)));const c=S.filter(s=>!l.has(s.id));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:a.border},value:_,onChange:s=>L(s.target.value),children:[e.jsx("option",{value:"",children:"Select zone…"}),c.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:a.border},value:z,onChange:s=>M(s.target.value),children:[e.jsx("option",{value:"",children:"Select supervisor…"}),b.map(s=>e.jsx("option",{value:s.id,children:s.username},s.id))]}),e.jsx(H,{disabled:!_||!z||!!w.assignZoneNoSup,onClick:()=>{const s=Number(_),r=Number(z);Number.isFinite(s)&&Number.isFinite(r)&&J(r,s)},className:"text-sm whitespace-nowrap",children:"Assign"})]}),c.length===0&&e.jsx("div",{className:"text-sm text-center py-4",style:{color:a.textLight},children:"All zones are assigned to supervisors"})]})})()]})]})]})}function We(X){const{colors:o,chiefs:a,zones:b,actionLoading:D,manageChief:S,moveZoneChiefTarget:E,noChiefSelectedZone:F,noChiefAssignChiefId:N,noZoneSelectedChief:A,noZoneAssignZoneId:T,setManageChief:_,setMoveZoneChiefTarget:z,setNoChiefSelectedZone:w,setNoChiefAssignChiefId:P,setNoZoneSelectedChief:R,setNoZoneAssignZoneId:B,setZoneChief:q,removeZoneChief:W}=X,Z=({title:g,number:j})=>e.jsxs("div",{className:"flex items-center gap-3 mb-6 pb-3 border-b",style:{borderColor:o.border},children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm",style:{backgroundColor:o.primary},children:j}),e.jsx("h2",{className:"text-2xl font-bold",style:{color:o.text},children:g})]}),L=({title:g})=>e.jsx("h3",{className:"text-lg font-semibold mb-4 pb-2 border-b",style:{color:o.text,borderColor:o.border},children:g}),M=({children:g,className:j=""})=>e.jsx("div",{className:`rounded-lg shadow-sm border p-6 ${j}`,style:{backgroundColor:o.cardBg,borderColor:o.border},children:g}),V=({children:g,onClick:j,disabled:i=!1,loading:x=!1,className:J=""})=>e.jsxs("button",{onClick:j,disabled:i||x,className:`px-4 py-2 rounded-lg font-medium text-white transition-colors flex items-center gap-2 ${J}`,style:{backgroundColor:i?o.textLight:o.primary,cursor:i?"not-allowed":"pointer"},onMouseOver:G=>{!i&&!x&&(G.currentTarget.style.backgroundColor=o.primaryHover)},onMouseOut:G=>{!i&&!x&&(G.currentTarget.style.backgroundColor=o.primary)},children:[x&&e.jsx(ee,{size:14,className:"border-white/40 border-t-white"}),g]});return e.jsxs("section",{children:[e.jsx(Z,{title:"Manage Chiefs",number:2}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(M,{children:[e.jsx(L,{title:"Chiefs and Their Zones"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[a.map(g=>{const j=b.filter(i=>i.assigned_chief===g.id);return j.length===0?null:e.jsxs("div",{className:"border rounded-lg p-4",style:{borderColor:o.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-semibold",style:{color:o.text},children:g.username}),e.jsx("button",{onClick:()=>_(i=>({...i,[g.id]:!i[g.id]})),className:"text-sm font-medium px-3 py-1 rounded border",style:{color:o.primary,borderColor:o.primary},children:S[g.id]?"Done":"Manage"})]}),e.jsx("div",{className:"space-y-3",children:j.map(i=>e.jsxs("div",{className:"flex items-center justify-between text-sm p-2 rounded border",style:{borderColor:o.border},children:[e.jsx("span",{style:{color:o.text},children:i.name}),S[g.id]&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-2 py-1 text-xs rounded border",style:{borderColor:o.border},disabled:!!D[`removeChief-${i.id}`],onClick:()=>W(i.id),children:"Unassign"}),e.jsxs("select",{className:"border rounded px-2 py-1 text-xs",style:{borderColor:o.border},value:E[i.id]||"",onChange:x=>z(J=>({...J,[i.id]:x.target.value})),children:[e.jsx("option",{value:"",children:"Move to…"}),a.filter(x=>x.id!==g.id).map(x=>e.jsx("option",{value:x.id,children:x.username},x.id))]}),e.jsx(V,{loading:!!D[`setChief-${i.id}`],disabled:!E[i.id]||!!D[`setChief-${i.id}`],onClick:()=>{const x=Number(E[i.id]);Number.isFinite(x)&&q(i.id,x)},className:"text-xs px-2 py-1",children:"Move"})]})]},i.id))})]},g.id)}),a.filter(g=>b.some(j=>j.assigned_chief===g.id)).length===0&&e.jsx("div",{className:"col-span-full text-center py-8",style:{color:o.textLight},children:"No chiefs with assigned zones"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(M,{children:[e.jsx(L,{title:"Zones Needing Chiefs"}),(()=>{const g=b.filter(i=>!i.assigned_chief),j=a.filter(i=>b.every(x=>x.assigned_chief!==i.id));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:o.border},value:F,onChange:i=>w(i.target.value),children:[e.jsx("option",{value:"",children:"Select zone…"}),g.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]}),e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:o.border},value:N,onChange:i=>P(i.target.value),children:[e.jsx("option",{value:"",children:"Select chief…"}),j.map(i=>e.jsx("option",{value:i.id,children:i.username},i.id))]}),e.jsx(V,{loading:!!D[`setChief-${Number(F)}`],disabled:!F||!N||!!D[`setChief-${Number(F)}`],onClick:()=>{const i=Number(F),x=Number(N);Number.isFinite(i)&&Number.isFinite(x)&&q(i,x),w(""),P("")},className:"text-sm whitespace-nowrap",children:"Assign"})]}),g.length===0&&e.jsx("div",{className:"text-sm text-center py-4",style:{color:o.textLight},children:"All zones have chiefs assigned"})]})})()]}),e.jsxs(M,{children:[e.jsx(L,{title:"Chiefs Without Zones"}),(()=>{const g=a.filter(i=>b.every(x=>x.assigned_chief!==i.id)),j=b.filter(i=>!i.assigned_chief);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:o.border},value:A,onChange:i=>R(i.target.value),children:[e.jsx("option",{value:"",children:"Select chief…"}),g.map(i=>e.jsx("option",{value:i.id,children:i.username},i.id))]}),e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:o.border},value:T,onChange:i=>B(i.target.value),children:[e.jsx("option",{value:"",children:"Select zone…"}),j.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]}),e.jsx(V,{loading:!!D[`setChief-${Number(T)}`],disabled:!A||!T||!!D[`setChief-${Number(T)}`],onClick:()=>{const i=Number(A),x=Number(T);Number.isFinite(x)&&Number.isFinite(i)&&q(x,i),R(""),B("")},className:"text-sm whitespace-nowrap",children:"Assign"})]}),g.length===0&&e.jsx("div",{className:"text-sm text-center py-4",style:{color:o.textLight},children:"All chiefs have zones assigned"})]})})()]})]})]})]})}function Je(X){const{colors:o,vehicles:a,drivers:b,manpower:D,actionLoading:S,manageVehicle:E,moveManpowerTarget:F,unassignedSelected:N,assignVehicleForSelection:A,setManageVehicle:T,setMoveManpowerTarget:_,setUnassignedSelected:z,setAssignVehicleForSelection:w,assignManpowerVehicle:P,unassignManpowerVehicle:R,deleteManpower:B,manageDriver:q,moveDriverTargetVehicle:W,unassignedDriverId:Z,vehicleForUnassignedDriver:L,vehicleNoDriverId:M,driverNoVehicleId:V,setManageDriver:g,setMoveDriverTargetVehicle:j,setUnassignedDriverId:i,setVehicleForUnassignedDriver:x,setVehicleNoDriverId:J,setDriverNoVehicleId:G,assignDriverVehicle:O,unassignDriverVehicle:K}=X,H=({title:s,number:r})=>e.jsxs("div",{className:"flex items-center gap-3 mb-6 pb-3 border-b",style:{borderColor:o.border},children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm",style:{backgroundColor:o.primary},children:r}),e.jsx("h2",{className:"text-2xl font-bold",style:{color:o.text},children:s})]}),Q=({title:s})=>e.jsx("h3",{className:"text-lg font-semibold mb-4 pb-2 border-b",style:{color:o.text,borderColor:o.border},children:s}),l=({children:s,className:r=""})=>e.jsx("div",{className:`rounded-lg shadow-sm border p-6 ${r}`,style:{backgroundColor:o.cardBg,borderColor:o.border},children:s}),c=({children:s,onClick:r,disabled:n=!1,loading:t=!1,className:f=""})=>e.jsxs("button",{onClick:r,disabled:n||t,className:`px-4 py-2 rounded-lg font-medium text-white transition-colors flex items-center gap-2 ${f}`,style:{backgroundColor:n?o.textLight:o.primary,cursor:n?"not-allowed":"pointer"},onMouseOver:y=>{!n&&!t&&(y.currentTarget.style.backgroundColor=o.primaryHover)},onMouseOut:y=>{!n&&!t&&(y.currentTarget.style.backgroundColor=o.primary)},children:[t&&e.jsx(ee,{size:14,className:"border-white/40 border-t-white"}),s]});return e.jsxs(e.Fragment,{children:[e.jsxs("section",{children:[e.jsx(H,{title:"Manage Manpower",number:3}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(l,{children:[e.jsx(Q,{title:"Vehicles and Their Manpower"}),e.jsx("div",{className:"space-y-4",children:a.map(s=>e.jsxs("div",{className:"border rounded-lg p-4",style:{borderColor:o.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-semibold",style:{color:o.text},children:s.plate}),e.jsx("button",{onClick:()=>T(r=>({...r,[s.id]:!r[s.id]})),className:"text-sm font-medium px-3 py-1 rounded border",style:{color:o.primary,borderColor:o.primary},children:E[s.id]?"Done":"Manage"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(s.manpower||[]).length===0&&e.jsx("div",{className:"text-sm",style:{color:o.textLight},children:"No manpower assigned"}),(s.manpower||[]).map(r=>e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2 border rounded-lg px-3 py-2",style:{borderColor:o.border},children:[e.jsx("span",{className:"text-sm",style:{color:o.text},children:r.username}),E[s.id]&&e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2",children:[e.jsx("button",{className:"px-2 py-1 text-xs rounded border",style:{borderColor:o.border},onClick:()=>R(r.manpower_id),children:"Remove"}),e.jsxs("select",{className:"border rounded px-2 py-1 text-xs",style:{borderColor:o.border},value:F[r.manpower_id]||"",onChange:n=>_(t=>({...t,[r.manpower_id]:n.target.value})),children:[e.jsx("option",{value:"",children:"Move to…"}),a.filter(n=>n.id!==s.id).map(n=>e.jsx("option",{value:n.id,children:n.plate},n.id))]}),e.jsx(c,{loading:!!S[`assignManpower-${r.manpower_id}`],disabled:!F[r.manpower_id]||!!S[`assignManpower-${r.manpower_id}`],onClick:()=>{const n=Number(F[r.manpower_id]);Number.isFinite(n)&&P(r.manpower_id,n)},className:"text-xs px-2 py-1",children:"Move"})]})]},r.manpower_id))]})]},s.id))})]}),e.jsxs(l,{children:[e.jsx(Q,{title:"Unassigned Manpower"}),(()=>{const s=new Set;a.forEach(n=>(n.manpower||[]).forEach(t=>s.add(t.manpower_id)));const r=D.filter(n=>!s.has(n.id));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:o.border},value:A,onChange:n=>w(n.target.value),children:[e.jsx("option",{value:"",children:"Select vehicle…"}),a.map(n=>e.jsx("option",{value:n.id,children:n.plate},n.id))]}),e.jsx(c,{disabled:!A||Object.keys(N).filter(n=>N[Number(n)]).length===0,loading:!!S.assignManpower,onClick:async()=>{const n=Object.keys(N).map(Number).filter(f=>N[f]),t=Number(A);for(const f of n)await P(f,t);z(()=>({})),w("")},className:"text-sm whitespace-nowrap",children:"Assign Selected"}),e.jsx("button",{className:"px-4 py-2 rounded-lg font-medium border text-sm whitespace-nowrap",style:{borderColor:o.error,color:o.error},disabled:Object.keys(N).filter(n=>N[Number(n)]).length===0,onClick:async()=>{const n=Object.keys(N).map(Number).filter(f=>N[f]);if(!(!n.length||!window.confirm(`Delete ${n.length} manpower user(s)? This cannot be undone.`))){for(const f of n)await B(f);z(()=>({}))}},children:"Delete Selected"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:[r.map(n=>e.jsxs("label",{className:"flex items-center gap-3 border rounded-lg p-3 cursor-pointer transition-colors hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",checked:!!N[n.id],onChange:t=>z(f=>({...f,[n.id]:t.target.checked})),className:"rounded",style:{accentColor:o.primary}}),e.jsx("span",{className:"text-sm",style:{color:o.text},children:n.username})]},n.id)),r.length===0&&e.jsx("div",{className:"col-span-full text-center py-8",style:{color:o.textLight},children:"No unassigned manpower"})]})]})})()]})]})]}),e.jsxs("section",{children:[e.jsx(H,{title:"Manage Drivers",number:4}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(l,{children:[e.jsx(Q,{title:"Drivers and Their Vehicles"}),(()=>{const s=[],r=new Map(b.map(t=>[t.id,t]));a.forEach(t=>(t.drivers||[]).forEach(f=>{const y=f.user_id&&r.get(f.user_id);y&&s.push({driver:y,vehicle:t})}));const n=a.filter(t=>!t.drivers||t.drivers.length===0);return e.jsxs("div",{className:"space-y-3",children:[s.length===0&&e.jsx("div",{className:"text-center py-8",style:{color:o.textLight},children:"No drivers currently assigned to vehicles"}),s.map(({driver:t,vehicle:f})=>e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 p-3 border rounded-lg",style:{borderColor:o.border},children:[e.jsxs("div",{className:"text-sm min-w-0 flex-1 break-words",children:[e.jsx("span",{className:"font-medium",style:{color:o.text},children:t.username}),e.jsxs("span",{className:"ml-2",style:{color:o.textLight},children:["→ ",f.plate]})]}),e.jsx("div",{className:"flex items-center flex-wrap gap-2 sm:justify-end",children:q[t.id]?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 w-full sm:w-auto",children:[e.jsx("button",{className:"px-3 py-1 text-xs rounded border",style:{borderColor:o.border},disabled:!!S[`assignDriver-${t.id}`],onClick:()=>K(t.id),children:"Remove"}),e.jsxs("select",{className:"border rounded px-2 py-1 text-xs min-w-[8rem]",style:{borderColor:o.border},value:W[t.id]||"",onChange:y=>j(se=>({...se,[t.id]:y.target.value})),children:[e.jsx("option",{value:"",children:"Move to…"}),n.filter(y=>y.id!==f.id).map(y=>e.jsx("option",{value:y.id,children:y.plate},y.id))]}),e.jsx(c,{loading:!!S[`assignDriver-${t.id}`],disabled:!W[t.id]||!!S[`assignDriver-${t.id}`],onClick:()=>{const y=Number(W[t.id]);Number.isFinite(y)&&O(t.id,y)},className:"text-xs px-2 py-1",children:"Move"}),e.jsx("button",{className:"px-3 py-1 text-xs rounded border",style:{borderColor:o.border},onClick:()=>g(y=>({...y,[t.id]:!1})),children:"Done"})]})}):e.jsx("button",{onClick:()=>g(y=>({...y,[t.id]:!0})),className:"text-sm font-medium px-3 py-1 rounded border",style:{color:o.primary,borderColor:o.primary},children:"Manage"})})]},`${t.id}-${f.id}`))]})})()]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(l,{children:[e.jsx(Q,{title:"Drivers Without Vehicles"}),(()=>{const s=new Set;a.forEach(t=>(t.drivers||[]).forEach(f=>s.add(f.user_id)));const r=b.filter(t=>!s.has(t.id)),n=a.filter(t=>!t.drivers||t.drivers.length===0);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:o.border},value:Z,onChange:t=>i(t.target.value),children:[e.jsx("option",{value:"",children:"Select driver…"}),r.map(t=>e.jsx("option",{value:t.id,children:t.username},t.id))]}),e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:o.border},value:L,onChange:t=>x(t.target.value),children:[e.jsx("option",{value:"",children:"Select vehicle…"}),n.map(t=>e.jsx("option",{value:t.id,children:t.plate},t.id))]}),e.jsx(c,{loading:!!S[`assignDriver-${Number(Z)}`],disabled:!Z||!L||!!S[`assignDriver-${Number(Z)}`],onClick:()=>{const t=Number(Z),f=Number(L);Number.isFinite(t)&&Number.isFinite(f)&&O(t,f),i(""),x("")},className:"text-sm whitespace-nowrap",children:"Assign"})]}),r.length===0&&e.jsx("div",{className:"text-sm text-center py-4",style:{color:o.textLight},children:"All drivers have vehicles assigned"})]})})()]}),e.jsxs(l,{children:[e.jsx(Q,{title:"Vehicles Without Drivers"}),(()=>{const s=new Set;a.forEach(t=>(t.drivers||[]).forEach(f=>s.add(f.user_id)));const r=b.filter(t=>!s.has(t.id)),n=a.filter(t=>!t.drivers||t.drivers.length===0);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:o.border},value:M,onChange:t=>J(t.target.value),children:[e.jsx("option",{value:"",children:"Select vehicle…"}),n.map(t=>e.jsx("option",{value:t.id,children:t.plate},t.id))]}),e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:o.border},value:V,onChange:t=>G(t.target.value),children:[e.jsx("option",{value:"",children:"Select driver…"}),r.map(t=>e.jsx("option",{value:t.id,children:t.username},t.id))]}),e.jsx(c,{loading:!!S[`assignDriver-${Number(V)}`],disabled:!M||!V||!!S[`assignDriver-${Number(V)}`],onClick:()=>{const t=Number(M),f=Number(V);Number.isFinite(f)&&Number.isFinite(t)&&O(f,t),J(""),G("")},className:"text-sm whitespace-nowrap",children:"Assign"})]}),n.length===0&&e.jsx("div",{className:"text-sm text-center py-4",style:{color:o.textLight},children:"All vehicles have drivers assigned"})]})})()]})]})]})]})]})}const k="http://localhost:4000",Ge=()=>{const{t:X}=He(),[o,a]=p.useState([]),[b,D]=p.useState([]),[S,E]=p.useState([]),[F,N]=p.useState([]),[A,T]=p.useState([]),[_,z]=p.useState([]),[w,P]=p.useState(!1),[R,B]=p.useState(null),[q,W]=p.useState(null),[Z,L]=p.useState(""),[M,V]=p.useState(""),[g,j]=p.useState({}),[i,x]=p.useState({}),[J,G]=p.useState({}),[O,K]=p.useState({}),[H,Q]=p.useState(""),[l,c]=p.useState({}),[s,r]=p.useState({}),[n,t]=p.useState(""),[f,y]=p.useState(""),[se,le]=p.useState(""),[de,ce]=p.useState(""),[he,te]=p.useState(""),[me,oe]=p.useState(""),[ue,ie]=p.useState(""),[xe,ne]=p.useState(""),[re,$]=p.useState({}),[pe,ge]=p.useState({}),[fe,ve]=p.useState({}),[be,ye]=p.useState(""),[Ne,je]=p.useState(""),[Ce,we]=p.useState(""),[Se,ke]=p.useState(""),Y={primary:"#D97706",primaryHover:"#B45309",accent:"#15803D",accentHover:"#166534",background:"#F3F4F6",cardBg:"#FFFFFF",border:"#E5E7EB",text:"#1E1E1E",textLight:"#6B7280",error:"#DC2626"};function I(){const h=localStorage.getItem("token");h&&(P(!0),B(null),fetch(`${k}/api/manageworkers/init`,{headers:{Authorization:`Bearer ${h}`}}).then(async u=>{const d=await u.json();if(!u.ok)throw new Error((d==null?void 0:d.error)||"Failed to load");const m=(d.supervisors||[]).map(v=>({id:v.id,username:v.username,vehicles:Array.isArray(v.vehicles)?v.vehicles.map(U=>({id:Number(U.id),plate:String(U.plate)})):[],zones:Array.isArray(v.zones)?v.zones.map(U=>({id:Number(U.id),name:String(U.name)})):[]}));a(m);const C=new Map((d.drivers||[]).map(v=>[Number(v.id),String(v.username)]));D((d.vehicles||[]).map(v=>({id:Number(v.id),plate:String(v.plate),manpower:Array.isArray(v.manpower)?v.manpower.map(U=>({manpower_id:Number(U.manpower_id),username:String(U.username)})):[],drivers:Array.isArray(v.drivers)?v.drivers.map(U=>({user_id:Number(U.user_id),username:C.get(Number(U.user_id))})):[]}))),E((d.zones||[]).map(v=>({id:Number(v.id),name:String(v.zone_name),assigned_chief:v.assigned_chief??null,supervisor_id:v.supervisor_id??null}))),N((d.chiefs||[]).map(v=>({id:Number(v.id),username:String(v.username)}))),T((d.drivers||[]).map(v=>({id:Number(v.id),username:String(v.username)}))),z((d.manpower||[]).map(v=>({id:Number(v.id),username:String(v.username)})))}).catch(u=>B((u==null?void 0:u.message)||"Failed to load")).finally(()=>P(!1)))}async function $e(h){const u=localStorage.getItem("token");u&&(await fetch(`${k}/api/manageworkers/manpower/${h}`,{method:"DELETE",headers:{Authorization:`Bearer ${u}`}}),I())}p.useEffect(()=>{I()},[]);function Ae(h){W(h.id),L(""),V("")}function ae(){W(null),L(""),V(""),j({})}async function Te(h){const u=localStorage.getItem("token");if(u&&Z!=="")try{$(m=>({...m,[`saveVehicle-${h}`]:!0}));const d=await fetch(`${k}/api/manageworkers/supervisors/${h}/vehicle`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`},body:JSON.stringify({vehicleId:Number(Z)})});if(d.status===409)if(window.confirm("This vehicle is already assigned to another supervisor. Do you want to move it to this supervisor?"))await fetch(`${k}/api/manageworkers/supervisors/${h}/vehicle/move`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`},body:JSON.stringify({vehicleId:Number(Z)})});else return;else if(!d.ok){const m=await d.json().catch(()=>({}));throw new Error((m==null?void 0:m.error)||"Failed to assign vehicle")}}catch(d){B((d==null?void 0:d.message)||"Failed to assign/move vehicle")}finally{ae(),I(),$(d=>({...d,[`saveVehicle-${h}`]:!1}))}}async function Ve(h,u){const d=localStorage.getItem("token");d&&(await fetch(`${k}/api/manageworkers/supervisors/${h}/vehicle/${u}`,{method:"DELETE",headers:{Authorization:`Bearer ${d}`}}),I())}async function De(h,u){const d=localStorage.getItem("token");if(d)try{$(C=>({...C,assignVehicleNoSup:!0}));const m=await fetch(`${k}/api/manageworkers/supervisors/${h}/vehicle`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify({vehicleId:u})});if(m.status===409)if(window.confirm("This vehicle is already assigned to another supervisor. Do you want to move it to this supervisor?"))await fetch(`${k}/api/manageworkers/supervisors/${h}/vehicle/move`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify({vehicleId:u})});else return;else if(!m.ok){const C=await m.json().catch(()=>({}));throw new Error((C==null?void 0:C.error)||"Failed to assign vehicle")}}catch(m){B((m==null?void 0:m.message)||"Failed to assign/move vehicle")}finally{te(""),oe(""),I(),$(m=>({...m,assignVehicleNoSup:!1}))}}async function Ze(h){const u=localStorage.getItem("token");if(u&&M)try{$(m=>({...m,[`addZone-${h}`]:!0}));const d=await fetch(`${k}/api/manageworkers/supervisors/${h}/zones/add`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`},body:JSON.stringify({zoneId:Number(M)})});if(d.status===409)if(await d.json().catch(()=>({})),window.confirm("This zone is already assigned to a supervisor. Do you want to move it to this supervisor?"))await fetch(`${k}/api/manageworkers/supervisors/${h}/zones/move`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`},body:JSON.stringify({zoneId:Number(M)})});else return;else if(!d.ok){const m=await d.json().catch(()=>({}));throw new Error((m==null?void 0:m.error)||"Failed to add zone")}}catch(d){B((d==null?void 0:d.message)||"Failed to add/move zone")}finally{V(""),I(),$(d=>({...d,[`addZone-${h}`]:!1}))}}async function Me(h,u){const d=localStorage.getItem("token");if(d)try{$(C=>({...C,assignZoneNoSup:!0}));const m=await fetch(`${k}/api/manageworkers/supervisors/${h}/zones/add`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify({zoneId:u})});if(m.status===409)if(await m.json().catch(()=>({})),window.confirm("This zone is already assigned to a supervisor. Do you want to move it to this supervisor?"))await fetch(`${k}/api/manageworkers/supervisors/${h}/zones/move`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify({zoneId:u})});else return;else if(!m.ok){const C=await m.json().catch(()=>({}));throw new Error((C==null?void 0:C.error)||"Failed to add zone")}}catch(m){B((m==null?void 0:m.message)||"Failed to add/move zone")}finally{ie(""),ne(""),I(),$(m=>({...m,assignZoneNoSup:!1}))}}async function Ie(h,u){const d=localStorage.getItem("token");d&&(await fetch(`${k}/api/manageworkers/supervisors/${h}/zones/remove`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify({zoneId:u})}),I())}async function Ee(h,u){const d=localStorage.getItem("token");if(!d)return;const m=Number(u);Number.isFinite(m)&&($(C=>({...C,[`moveZone-${h}`]:!0})),await fetch(`${k}/api/manageworkers/supervisors/${m}/zones/move`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify({zoneId:h})}),j(C=>({...C,[h]:""})),I(),$(C=>({...C,[`moveZone-${h}`]:!1})))}async function Fe(h,u){const d=localStorage.getItem("token");d&&($(m=>({...m,[`setChief-${h}`]:!0})),await fetch(`${k}/api/manageworkers/zones/${h}/reassign-chief`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify({chiefUserId:u})}),I(),$(m=>({...m,[`setChief-${h}`]:!1})))}async function ze(h){const u=localStorage.getItem("token");u&&($(d=>({...d,[`removeChief-${h}`]:!0})),await fetch(`${k}/api/manageworkers/zones/${h}/chief`,{method:"DELETE",headers:{Authorization:`Bearer ${u}`}}),I(),$(d=>({...d,[`removeChief-${h}`]:!1})))}async function Le(h,u){const d=localStorage.getItem("token");d&&($(m=>({...m,[`assignDriver-${h}`]:!0})),await fetch(`${k}/api/manageworkers/drivers/${h}/vehicle`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify({vehicleId:u})}),I(),$(m=>({...m,[`assignDriver-${h}`]:!1})))}async function Be(h){const u=localStorage.getItem("token");u&&(await fetch(`${k}/api/manageworkers/drivers/${h}/vehicle`,{method:"DELETE",headers:{Authorization:`Bearer ${u}`}}),I())}async function _e(h,u){const d=localStorage.getItem("token");d&&($(m=>({...m,[`assignManpower-${h}`]:!0})),await fetch(`${k}/api/manageworkers/manpower/${h}/vehicle`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify({vehicleId:u})}),I(),$(m=>({...m,[`assignManpower-${h}`]:!1})))}async function Oe(h){const u=localStorage.getItem("token");u&&(await fetch(`${k}/api/manageworkers/manpower/${h}/vehicle`,{method:"DELETE",headers:{Authorization:`Bearer ${u}`}}),I())}return e.jsxs("div",{className:"p-6 space-y-8 min-h-screen",style:{backgroundColor:Y.background},children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 ucs-gradient-text",children:X("manageWorkers.title")}),e.jsx("p",{className:"text-lg",style:{color:Y.textLight},children:X("manageWorkers.subtitle")})]}),R&&e.jsx("div",{className:"p-4 rounded-lg text-white font-medium text-center",style:{backgroundColor:Y.error},children:R}),w?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx(ee,{size:32,className:"border-gray-400 border-t-gray-600"})}):e.jsxs("div",{className:"space-y-12 max-w-7xl mx-auto",children:[e.jsx(Pe,{t:X,colors:Y,supervisors:o,vehicles:b,zones:S,editingId:q,editVehicleId:Z,addZoneId:M,moveSelection:g,assignVehicleNoSup:he,assignVehicleToSupervisorId:me,assignZoneNoSup:ue,assignZoneToSupervisorId:xe,actionLoading:re,startEdit:Ae,cancelEdit:ae,setEditVehicleId:L,setAddZoneId:V,setMoveSelection:j,setAssignVehicleNoSup:te,setAssignVehicleToSupervisorId:oe,setAssignZoneNoSup:ie,setAssignZoneToSupervisorId:ne,saveVehicle:Te,unassignVehicle:Ve,addZone:Ze,removeZone:Ie,moveZone:Ee,assignVehicleToSupervisor:De,assignZoneToSupervisor:Me}),e.jsx(We,{colors:Y,chiefs:F,zones:S,actionLoading:re,manageChief:pe,moveZoneChiefTarget:fe,noChiefSelectedZone:be,noChiefAssignChiefId:Ne,noZoneSelectedChief:Ce,noZoneAssignZoneId:Se,setManageChief:ge,setMoveZoneChiefTarget:ve,setNoChiefSelectedZone:ye,setNoChiefAssignChiefId:je,setNoZoneSelectedChief:we,setNoZoneAssignZoneId:ke,setZoneChief:Fe,removeZoneChief:ze}),e.jsx(Je,{colors:Y,vehicles:b,drivers:A,manpower:_,actionLoading:re,manageVehicle:i,moveManpowerTarget:J,unassignedSelected:O,assignVehicleForSelection:H,setManageVehicle:x,setMoveManpowerTarget:G,setUnassignedSelected:K,setAssignVehicleForSelection:Q,assignManpowerVehicle:_e,unassignManpowerVehicle:Oe,deleteManpower:$e,manageDriver:l,moveDriverTargetVehicle:s,unassignedDriverId:n,vehicleForUnassignedDriver:f,vehicleNoDriverId:se,driverNoVehicleId:de,setManageDriver:c,setMoveDriverTargetVehicle:r,setUnassignedDriverId:t,setVehicleForUnassignedDriver:y,setVehicleNoDriverId:le,setDriverNoVehicleId:ce,assignDriverVehicle:Le,unassignDriverVehicle:Be})]})]})};export{Ge as default};
