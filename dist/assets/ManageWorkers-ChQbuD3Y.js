import{u as Re,j as e}from"./index-BdDvBGrt.js";import{r as l}from"./react-BeLGUnOF.js";import{L as be}from"./LoadingSpinner-BmhjDzC_.js";const m="http://localhost:4000",Qe=()=>{const{t:c}=Re(),[j,ye]=l.useState([]),[g,je]=l.useState([]),[y,Ne]=l.useState([]),[w,we]=l.useState([]),[E,Ce]=l.useState([]),[ke,Se]=l.useState([]),[$e,Q]=l.useState(!1),[X,N]=l.useState(null),[Y,ee]=l.useState(null),[C,M]=l.useState(""),[k,D]=l.useState(""),[V,F]=l.useState({}),[se,Ae]=l.useState({}),[I,Te]=l.useState({}),[b,L]=l.useState({}),[_,re]=l.useState(""),[De,te]=l.useState({}),[W,Ze]=l.useState({}),[S,oe]=l.useState(""),[B,ie]=l.useState(""),[O,ne]=l.useState(""),[$,ae]=l.useState(""),[z,le]=l.useState(""),[H,de]=l.useState(""),[P,ce]=l.useState(""),[J,me]=l.useState(""),[d,h]=l.useState({}),[he,Ee]=l.useState({}),[U,Me]=l.useState({}),[A,ue]=l.useState(""),[R,xe]=l.useState(""),[q,pe]=l.useState(""),[T,ge]=l.useState(""),i={primary:"#D97706",primaryHover:"#B45309",background:"#F3F4F6",cardBg:"#FFFFFF",border:"#E5E7EB",text:"#1E1E1E",textLight:"#6B7280",error:"#DC2626"};function u(){const t=localStorage.getItem("token");t&&(Q(!0),N(null),fetch(`${m}/api/manageworkers/init`,{headers:{Authorization:`Bearer ${t}`}}).then(async o=>{const s=await o.json();if(!o.ok)throw new Error((s==null?void 0:s.error)||"Failed to load");const r=(s.supervisors||[]).map(a=>({id:a.id,username:a.username,vehicles:Array.isArray(a.vehicles)?a.vehicles.map(p=>({id:Number(p.id),plate:String(p.plate)})):[],zones:Array.isArray(a.zones)?a.zones.map(p=>({id:Number(p.id),name:String(p.name)})):[]}));ye(r);const n=new Map((s.drivers||[]).map(a=>[Number(a.id),String(a.username)]));je((s.vehicles||[]).map(a=>({id:Number(a.id),plate:String(a.plate),manpower:Array.isArray(a.manpower)?a.manpower.map(p=>({manpower_id:Number(p.manpower_id),username:String(p.username)})):[],drivers:Array.isArray(a.drivers)?a.drivers.map(p=>({user_id:Number(p.user_id),username:n.get(Number(p.user_id))})):[]}))),Ne((s.zones||[]).map(a=>({id:Number(a.id),name:String(a.zone_name),assigned_chief:a.assigned_chief??null,supervisor_id:a.supervisor_id??null}))),we((s.chiefs||[]).map(a=>({id:Number(a.id),username:String(a.username)}))),Ce((s.drivers||[]).map(a=>({id:Number(a.id),username:String(a.username)}))),Se((s.manpower||[]).map(a=>({id:Number(a.id),username:String(a.username)})))}).catch(o=>N((o==null?void 0:o.message)||"Failed to load")).finally(()=>Q(!1)))}async function Ve(t){const o=localStorage.getItem("token");o&&(await fetch(`${m}/api/manageworkers/manpower/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`}}),u())}l.useEffect(()=>{u()},[]);function Fe(t){ee(t.id),M(""),D("")}function fe(){ee(null),M(""),D(""),F({})}async function Ie(t){const o=localStorage.getItem("token");if(o&&C!=="")try{h(r=>({...r,[`saveVehicle-${t}`]:!0}));const s=await fetch(`${m}/api/manageworkers/supervisors/${t}/vehicle`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({vehicleId:Number(C)})});if(s.status===409)if(window.confirm("This vehicle is already assigned to another supervisor. Do you want to move it to this supervisor?"))await fetch(`${m}/api/manageworkers/supervisors/${t}/vehicle/move`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({vehicleId:Number(C)})});else return;else if(!s.ok){const r=await s.json().catch(()=>({}));throw new Error((r==null?void 0:r.error)||"Failed to assign vehicle")}}catch(s){N((s==null?void 0:s.message)||"Failed to assign/move vehicle")}finally{fe(),u(),h(s=>({...s,[`saveVehicle-${t}`]:!1}))}}async function Le(t,o){const s=localStorage.getItem("token");s&&(await fetch(`${m}/api/manageworkers/supervisors/${t}/vehicle/${o}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}}),u())}async function _e(t,o){const s=localStorage.getItem("token");if(s)try{h(n=>({...n,assignVehicleNoSup:!0}));const r=await fetch(`${m}/api/manageworkers/supervisors/${t}/vehicle`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({vehicleId:o})});if(r.status===409)if(window.confirm("This vehicle is already assigned to another supervisor. Do you want to move it to this supervisor?"))await fetch(`${m}/api/manageworkers/supervisors/${t}/vehicle/move`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({vehicleId:o})});else return;else if(!r.ok){const n=await r.json().catch(()=>({}));throw new Error((n==null?void 0:n.error)||"Failed to assign vehicle")}}catch(r){N((r==null?void 0:r.message)||"Failed to assign/move vehicle")}finally{le(""),de(""),u(),h(r=>({...r,assignVehicleNoSup:!1}))}}async function We(t){const o=localStorage.getItem("token");if(o&&k)try{h(r=>({...r,[`addZone-${t}`]:!0}));const s=await fetch(`${m}/api/manageworkers/supervisors/${t}/zones/add`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({zoneId:Number(k)})});if(s.status===409)if(await s.json().catch(()=>({})),window.confirm("This zone is already assigned to a supervisor. Do you want to move it to this supervisor?"))await fetch(`${m}/api/manageworkers/supervisors/${t}/zones/move`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({zoneId:Number(k)})});else return;else if(!s.ok){const r=await s.json().catch(()=>({}));throw new Error((r==null?void 0:r.error)||"Failed to add zone")}}catch(s){N((s==null?void 0:s.message)||"Failed to add/move zone")}finally{D(""),u(),h(s=>({...s,[`addZone-${t}`]:!1}))}}async function Be(t,o){const s=localStorage.getItem("token");if(s)try{h(n=>({...n,assignZoneNoSup:!0}));const r=await fetch(`${m}/api/manageworkers/supervisors/${t}/zones/add`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({zoneId:o})});if(r.status===409)if(await r.json().catch(()=>({})),window.confirm("This zone is already assigned to a supervisor. Do you want to move it to this supervisor?"))await fetch(`${m}/api/manageworkers/supervisors/${t}/zones/move`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({zoneId:o})});else return;else if(!r.ok){const n=await r.json().catch(()=>({}));throw new Error((n==null?void 0:n.error)||"Failed to add zone")}}catch(r){N((r==null?void 0:r.message)||"Failed to add/move zone")}finally{ce(""),me(""),u(),h(r=>({...r,assignZoneNoSup:!1}))}}async function Oe(t,o){const s=localStorage.getItem("token");s&&(await fetch(`${m}/api/manageworkers/supervisors/${t}/zones/remove`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({zoneId:o})}),u())}async function ze(t,o){const s=localStorage.getItem("token");if(!s)return;const r=Number(o);Number.isFinite(r)&&(h(n=>({...n,[`moveZone-${t}`]:!0})),await fetch(`${m}/api/manageworkers/supervisors/${r}/zones/move`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({zoneId:t})}),F(n=>({...n,[t]:""})),u(),h(n=>({...n,[`moveZone-${t}`]:!1})))}async function G(t,o){const s=localStorage.getItem("token");s&&(h(r=>({...r,[`setChief-${t}`]:!0})),await fetch(`${m}/api/manageworkers/zones/${t}/reassign-chief`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({chiefUserId:o})}),u(),h(r=>({...r,[`setChief-${t}`]:!1})))}async function He(t){const o=localStorage.getItem("token");o&&(h(s=>({...s,[`removeChief-${t}`]:!0})),await fetch(`${m}/api/manageworkers/zones/${t}/chief`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`}}),u(),h(s=>({...s,[`removeChief-${t}`]:!1})))}async function K(t,o){const s=localStorage.getItem("token");s&&(h(r=>({...r,[`assignDriver-${t}`]:!0})),await fetch(`${m}/api/manageworkers/drivers/${t}/vehicle`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({vehicleId:o})}),u(),h(r=>({...r,[`assignDriver-${t}`]:!1})))}async function Pe(t){const o=localStorage.getItem("token");o&&(await fetch(`${m}/api/manageworkers/drivers/${t}/vehicle`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`}}),u())}async function ve(t,o){const s=localStorage.getItem("token");s&&(h(r=>({...r,[`assignManpower-${t}`]:!0})),await fetch(`${m}/api/manageworkers/manpower/${t}/vehicle`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({vehicleId:o})}),u(),h(r=>({...r,[`assignManpower-${t}`]:!1})))}async function Je(t){const o=localStorage.getItem("token");o&&(await fetch(`${m}/api/manageworkers/manpower/${t}/vehicle`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`}}),u())}const Z=({title:t,number:o})=>e.jsxs("div",{className:"flex items-center gap-3 mb-6 pb-3 border-b",style:{borderColor:i.border},children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm",style:{backgroundColor:i.primary},children:o}),e.jsx("h2",{className:"text-2xl font-bold",style:{color:i.text},children:t})]}),v=({title:t})=>e.jsx("h3",{className:"text-lg font-semibold mb-4 pb-2 border-b",style:{color:i.text,borderColor:i.border},children:t}),f=({children:t,className:o=""})=>e.jsx("div",{className:`rounded-lg shadow-sm border p-6 ${o}`,style:{backgroundColor:i.cardBg,borderColor:i.border},children:t}),x=({children:t,onClick:o,disabled:s=!1,loading:r=!1,className:n=""})=>e.jsxs("button",{onClick:o,disabled:s||r,className:`px-4 py-2 rounded-lg font-medium text-white transition-colors flex items-center gap-2 ${n}`,style:{backgroundColor:s?i.textLight:i.primary,cursor:s?"not-allowed":"pointer"},onMouseOver:a=>{!s&&!r&&(a.currentTarget.style.backgroundColor=i.primaryHover)},onMouseOut:a=>{!s&&!r&&(a.currentTarget.style.backgroundColor=i.primary)},children:[r&&e.jsx(be,{size:16,className:"border-white/60 border-t-white"}),t]}),Ue=({children:t,onClick:o,disabled:s=!1,className:r=""})=>e.jsx("button",{onClick:o,disabled:s,className:`px-4 py-2 rounded-lg font-medium border transition-colors ${r}`,style:{color:i.text,borderColor:i.border,backgroundColor:"transparent",cursor:s?"not-allowed":"pointer"},onMouseOver:n=>{s||(n.currentTarget.style.backgroundColor=i.background)},onMouseOut:n=>{s||(n.currentTarget.style.backgroundColor="transparent")},children:t});return e.jsxs("div",{className:"p-6 space-y-8 min-h-screen",style:{backgroundColor:i.background},children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 ucs-gradient-text",children:c("manageWorkers.title")}),e.jsx("p",{className:"text-lg",style:{color:i.textLight},children:c("manageWorkers.subtitle")})]}),X&&e.jsx("div",{className:"p-4 rounded-lg text-white font-medium text-center",style:{backgroundColor:i.error},children:X}),$e?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx(be,{size:32,className:"border-gray-400 border-t-gray-600"})}):e.jsxs("div",{className:"space-y-12 max-w-7xl mx-auto",children:[e.jsxs("section",{children:[e.jsx(Z,{title:c("manageWorkers.section.supervisors"),number:1}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[j.map(t=>e.jsxs(f,{className:"hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:i.text},children:t.username}),e.jsxs("span",{className:"text-sm",style:{color:i.textLight},children:["ID: #",t.id]})]}),Y===t.id?e.jsx(Ue,{onClick:fe,className:"text-sm px-3 py-1",children:c("manageWorkers.close")}):e.jsx("button",{onClick:()=>Fe(t),className:"text-sm font-medium underline px-3 py-1 rounded",style:{color:i.primary},children:c("manageWorkers.manage")})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",style:{color:i.textLight},children:c("manageWorkers.assignedVehicles")}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:t.vehicles&&t.vehicles.length?t.vehicles.map(o=>e.jsx("span",{className:"px-2 py-1 text-xs rounded border",style:{borderColor:i.border},children:o.plate},o.id)):e.jsx("span",{className:"text-sm",style:{color:i.textLight},children:c("manageWorkers.none")})})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",style:{color:i.textLight},children:c("manageWorkers.zones")}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:t.zones&&t.zones.length?t.zones.map(o=>e.jsx("span",{className:"px-2 py-1 text-xs rounded border",style:{borderColor:i.border},children:o.name},o.id)):e.jsx("span",{className:"text-sm",style:{color:i.textLight},children:c("manageWorkers.none")})})]})]}),Y===t.id&&e.jsxs("div",{className:"space-y-4 border-t pt-4",style:{borderColor:i.border},children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:i.text},children:c("manageWorkers.assignVehicle")}),e.jsxs("select",{value:C,onChange:o=>M(o.target.value),className:"w-full border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:border-amber-600 focus:ring-amber-600",style:{borderColor:i.border},children:[e.jsx("option",{value:"",children:c("manageWorkers.selectVehicle")}),g.map(o=>e.jsx("option",{value:o.id,children:o.plate},o.id))]}),e.jsx("div",{className:"mt-2",children:e.jsx(x,{onClick:()=>Ie(t.id),disabled:!C||!!d[`saveVehicle-${t.id}`],loading:!!d[`saveVehicle-${t.id}`],className:"text-sm px-3 py-1",children:c("manageWorkers.addVehicle")})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:i.text},children:c("manageWorkers.unassignVehicles")}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.vehicles.map(o=>e.jsxs("button",{onClick:()=>Le(t.id,o.id),className:"px-3 py-1 text-xs rounded-lg border flex items-center gap-1 transition-colors",style:{borderColor:i.border},onMouseOver:s=>s.currentTarget.style.backgroundColor=i.background,onMouseOut:s=>s.currentTarget.style.backgroundColor="transparent",children:[o.plate," ",e.jsx("span",{children:"✕"})]},o.id)),!t.vehicles.length&&e.jsx("div",{className:"text-sm",style:{color:i.textLight},children:c("manageWorkers.noVehiclesToUnassign")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:i.text},children:c("manageWorkers.addZone")}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("select",{value:k,onChange:o=>D(o.target.value),className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},children:[e.jsx("option",{value:"",children:c("manageWorkers.selectZone")}),y.filter(o=>!t.zones.some(s=>s.id===o.id)).map(o=>e.jsx("option",{value:o.id,children:o.name},o.id))]}),e.jsx(x,{onClick:()=>We(t.id),disabled:!k||!!d[`addZone-${t.id}`],loading:!!d[`addZone-${t.id}`],className:"text-sm px-3 py-1",children:c("manageWorkers.add")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:i.text},children:c("manageWorkers.removeZones")}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.zones.map(o=>e.jsxs("button",{onClick:()=>Oe(t.id,o.id),className:"px-3 py-1 text-xs rounded-lg border flex items-center gap-1 transition-colors",style:{borderColor:i.border},onMouseOver:s=>s.currentTarget.style.backgroundColor=i.background,onMouseOut:s=>s.currentTarget.style.backgroundColor="transparent",children:[o.name," ",e.jsx("span",{children:"✕"})]},o.id)),!t.zones.length&&e.jsx("div",{className:"text-sm",style:{color:i.textLight},children:c("manageWorkers.noZonesToRemove")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:i.text},children:c("manageWorkers.moveZones")}),e.jsxs("div",{className:"space-y-3",children:[t.zones.map(o=>e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2",children:[e.jsx("span",{className:"text-sm flex-1",style:{color:i.text},children:o.name}),e.jsxs("select",{value:V[o.id]||"",onChange:s=>F(r=>({...r,[o.id]:s.target.value})),className:"border rounded-lg px-2 py-1 text-sm",style:{borderColor:i.border},children:[e.jsx("option",{value:"",children:c("manageWorkers.selectSupervisor")}),j.filter(s=>s.id!==t.id).map(s=>e.jsx("option",{value:s.id,children:s.username},s.id))]}),e.jsx(x,{onClick:()=>ze(o.id,V[o.id]),disabled:!V[o.id]||!!d[`moveZone-${o.id}`],loading:!!d[`moveZone-${o.id}`],className:"text-sm px-2 py-1",children:c("manageWorkers.move")})]},o.id)),!t.zones.length&&e.jsx("div",{className:"text-sm",style:{color:i.textLight},children:"No zones to move"})]})]})]})]},t.id)),!j.length&&e.jsx(f,{children:e.jsx("div",{className:"text-center py-8",style:{color:i.textLight},children:c("manageWorkers.noSupervisorsFound")})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(f,{children:[e.jsx(v,{title:c("manageWorkers.unassignedVehicles")}),(()=>{const t=new Set;j.forEach(s=>(s.vehicles||[]).forEach(r=>t.add(r.id)));const o=g.filter(s=>!t.has(s.id));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:z,onChange:s=>le(s.target.value),children:[e.jsx("option",{value:"",children:"Select vehicle…"}),o.map(s=>e.jsx("option",{value:s.id,children:s.plate},s.id))]}),e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:H,onChange:s=>de(s.target.value),children:[e.jsx("option",{value:"",children:"Select supervisor…"}),j.map(s=>e.jsx("option",{value:s.id,children:s.username},s.id))]}),e.jsx(x,{disabled:!z||!H||!!d.assignVehicleNoSup,loading:!!d.assignVehicleNoSup,onClick:()=>{const s=Number(z),r=Number(H);Number.isFinite(s)&&Number.isFinite(r)&&_e(r,s)},className:"text-sm whitespace-nowrap",children:"Assign"})]}),o.length===0&&e.jsx("div",{className:"text-sm text-center py-4",style:{color:i.textLight},children:"All vehicles are assigned to supervisors"})]})})()]}),e.jsxs(f,{children:[e.jsx(v,{title:"Unassigned Zones"}),(()=>{const t=new Set;j.forEach(s=>(s.zones||[]).forEach(r=>t.add(r.id)));const o=y.filter(s=>!t.has(s.id));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:P,onChange:s=>ce(s.target.value),children:[e.jsx("option",{value:"",children:"Select zone…"}),o.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:J,onChange:s=>me(s.target.value),children:[e.jsx("option",{value:"",children:"Select supervisor…"}),j.map(s=>e.jsx("option",{value:s.id,children:s.username},s.id))]}),e.jsx(x,{disabled:!P||!J||!!d.assignZoneNoSup,loading:!!d.assignZoneNoSup,onClick:()=>{const s=Number(P),r=Number(J);Number.isFinite(s)&&Number.isFinite(r)&&Be(r,s)},className:"text-sm whitespace-nowrap",children:"Assign"})]}),o.length===0&&e.jsx("div",{className:"text-sm text-center py-4",style:{color:i.textLight},children:"All zones are assigned to supervisors"})]})})()]})]})]}),e.jsxs("section",{children:[e.jsx(Z,{title:"Manage Chiefs",number:2}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(f,{children:[e.jsx(v,{title:"Chiefs and Their Zones"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[w.map(t=>{const o=y.filter(s=>s.assigned_chief===t.id);return o.length===0?null:e.jsxs("div",{className:"border rounded-lg p-4",style:{borderColor:i.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-semibold",style:{color:i.text},children:t.username}),e.jsx("button",{onClick:()=>Ee(s=>({...s,[t.id]:!s[t.id]})),className:"text-sm font-medium px-3 py-1 rounded border",style:{color:i.primary,borderColor:i.primary},children:he[t.id]?"Done":"Manage"})]}),e.jsx("div",{className:"space-y-3",children:o.map(s=>e.jsxs("div",{className:"flex items-center justify-between text-sm p-2 rounded border",style:{borderColor:i.border},children:[e.jsx("span",{style:{color:i.text},children:s.name}),he[t.id]&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-2 py-1 text-xs rounded border",style:{borderColor:i.border},disabled:!!d[`removeChief-${s.id}`],onClick:()=>He(s.id),children:"Unassign"}),e.jsxs("select",{className:"border rounded px-2 py-1 text-xs",style:{borderColor:i.border},value:U[s.id]||"",onChange:r=>Me(n=>({...n,[s.id]:r.target.value})),children:[e.jsx("option",{value:"",children:"Move to…"}),w.filter(r=>r.id!==t.id).map(r=>e.jsx("option",{value:r.id,children:r.username},r.id))]}),e.jsx(x,{disabled:!U[s.id]||!!d[`setChief-${s.id}`],loading:!!d[`setChief-${s.id}`],onClick:()=>{const r=Number(U[s.id]);Number.isFinite(r)&&G(s.id,r)},className:"text-xs px-2 py-1",children:"Move"})]})]},s.id))})]},t.id)}),w.filter(t=>y.some(o=>o.assigned_chief===t.id)).length===0&&e.jsx("div",{className:"col-span-full text-center py-8",style:{color:i.textLight},children:"No chiefs with assigned zones"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(f,{children:[e.jsx(v,{title:"Zones Needing Chiefs"}),(()=>{const t=y.filter(s=>!s.assigned_chief),o=w.filter(s=>y.every(r=>r.assigned_chief!==s.id));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:A,onChange:s=>ue(s.target.value),children:[e.jsx("option",{value:"",children:"Select zone…"}),t.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:R,onChange:s=>xe(s.target.value),children:[e.jsx("option",{value:"",children:"Select chief…"}),o.map(s=>e.jsx("option",{value:s.id,children:s.username},s.id))]}),e.jsx(x,{disabled:!A||!R||!!d[`setChief-${Number(A)}`],loading:!!d[`setChief-${Number(A)}`],onClick:()=>{const s=Number(A),r=Number(R);Number.isFinite(s)&&Number.isFinite(r)&&G(s,r),ue(""),xe("")},className:"text-sm whitespace-nowrap",children:"Assign"})]}),t.length===0&&e.jsx("div",{className:"text-sm text-center py-4",style:{color:i.textLight},children:"All zones have chiefs assigned"})]})})()]}),e.jsxs(f,{children:[e.jsx(v,{title:"Chiefs Without Zones"}),(()=>{const t=w.filter(s=>y.every(r=>r.assigned_chief!==s.id)),o=y.filter(s=>!s.assigned_chief);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:q,onChange:s=>pe(s.target.value),children:[e.jsx("option",{value:"",children:"Select chief…"}),t.map(s=>e.jsx("option",{value:s.id,children:s.username},s.id))]}),e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:T,onChange:s=>ge(s.target.value),children:[e.jsx("option",{value:"",children:"Select zone…"}),o.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx(x,{disabled:!q||!T||!!d[`setChief-${Number(T)}`],loading:!!d[`setChief-${Number(T)}`],onClick:()=>{const s=Number(q),r=Number(T);Number.isFinite(r)&&Number.isFinite(s)&&G(r,s),pe(""),ge("")},className:"text-sm whitespace-nowrap",children:"Assign"})]}),t.length===0&&e.jsx("div",{className:"text-sm text-center py-4",style:{color:i.textLight},children:"All chiefs have zones assigned"})]})})()]})]})]})]}),e.jsxs("section",{children:[e.jsx(Z,{title:"Manage Manpower",number:3}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(f,{children:[e.jsx(v,{title:"Vehicles and Their Manpower"}),e.jsx("div",{className:"space-y-4",children:g.map(t=>e.jsxs("div",{className:"border rounded-lg p-4",style:{borderColor:i.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-semibold",style:{color:i.text},children:t.plate}),e.jsx("button",{onClick:()=>Ae(o=>({...o,[t.id]:!o[t.id]})),className:"text-sm font-medium px-3 py-1 rounded border",style:{color:i.primary,borderColor:i.primary},children:se[t.id]?"Done":"Manage"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(t.manpower||[]).length===0&&e.jsx("div",{className:"text-sm",style:{color:i.textLight},children:"No manpower assigned"}),(t.manpower||[]).map(o=>e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2 border rounded-lg px-3 py-2",style:{borderColor:i.border},children:[e.jsx("span",{className:"text-sm",style:{color:i.text},children:o.username}),se[t.id]&&e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2",children:[e.jsx("button",{className:"px-2 py-1 text-xs rounded border",style:{borderColor:i.border},onClick:()=>Je(o.manpower_id),children:"Remove"}),e.jsxs("select",{className:"border rounded px-2 py-1 text-xs",style:{borderColor:i.border},value:I[o.manpower_id]||"",onChange:s=>Te(r=>({...r,[o.manpower_id]:s.target.value})),children:[e.jsx("option",{value:"",children:"Move to…"}),g.filter(s=>s.id!==t.id).map(s=>e.jsx("option",{value:s.id,children:s.plate},s.id))]}),e.jsx(x,{disabled:!I[o.manpower_id]||!!d[`assignManpower-${o.manpower_id}`],loading:!!d[`assignManpower-${o.manpower_id}`],onClick:()=>{const s=Number(I[o.manpower_id]);Number.isFinite(s)&&ve(o.manpower_id,s)},className:"text-xs px-2 py-1",children:"Move"})]})]},o.manpower_id))]})]},t.id))})]}),e.jsxs(f,{children:[e.jsx(v,{title:"Unassigned Manpower"}),(()=>{const t=new Set;g.forEach(s=>(s.manpower||[]).forEach(r=>t.add(r.manpower_id)));const o=ke.filter(s=>!t.has(s.id));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:_,onChange:s=>re(s.target.value),children:[e.jsx("option",{value:"",children:"Select vehicle…"}),g.map(s=>e.jsx("option",{value:s.id,children:s.plate},s.id))]}),e.jsx(x,{disabled:!_||Object.keys(b).filter(s=>b[Number(s)]).length===0,onClick:async()=>{const s=Object.keys(b).map(Number).filter(n=>b[n]),r=Number(_);for(const n of s)await ve(n,r);L({}),re("")},className:"text-sm whitespace-nowrap",children:"Assign Selected"}),e.jsx("button",{className:"px-4 py-2 rounded-lg font-medium border text-sm whitespace-nowrap",style:{borderColor:i.error,color:i.error},disabled:Object.keys(b).filter(s=>b[Number(s)]).length===0,onClick:async()=>{const s=Object.keys(b).map(Number).filter(n=>b[n]);if(!(!s.length||!window.confirm(`Delete ${s.length} manpower user(s)? This cannot be undone.`))){for(const n of s)await Ve(n);L({})}},children:"Delete Selected"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:[o.map(s=>e.jsxs("label",{className:"flex items-center gap-3 border rounded-lg p-3 cursor-pointer transition-colors hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",checked:!!b[s.id],onChange:r=>L(n=>({...n,[s.id]:r.target.checked})),className:"rounded",style:{accentColor:i.primary}}),e.jsx("span",{className:"text-sm",style:{color:i.text},children:s.username})]},s.id)),o.length===0&&e.jsx("div",{className:"col-span-full text-center py-8",style:{color:i.textLight},children:"No unassigned manpower"})]})]})})()]})]})]}),e.jsxs("section",{children:[e.jsx(Z,{title:"Manage Drivers",number:4}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(f,{children:[e.jsx(v,{title:"Drivers and Their Vehicles"}),(()=>{const t=[],o=new Map(E.map(r=>[r.id,r]));g.forEach(r=>(r.drivers||[]).forEach(n=>{const a=n.user_id&&o.get(n.user_id);a&&t.push({driver:a,vehicle:r})}));const s=g.filter(r=>!r.drivers||r.drivers.length===0);return e.jsxs("div",{className:"space-y-3",children:[t.length===0&&e.jsx("div",{className:"text-center py-8",style:{color:i.textLight},children:"No drivers currently assigned to vehicles"}),t.map(({driver:r,vehicle:n})=>e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 p-3 border rounded-lg",style:{borderColor:i.border},children:[e.jsxs("div",{className:"text-sm min-w-0 flex-1 break-words",children:[e.jsx("span",{className:"font-medium",style:{color:i.text},children:r.username}),e.jsxs("span",{className:"ml-2",style:{color:i.textLight},children:["→ ",n.plate]})]}),e.jsx("div",{className:"flex items-center flex-wrap gap-2 sm:justify-end",children:De[r.id]?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 w-full sm:w-auto",children:[e.jsx("button",{className:"px-3 py-1 text-xs rounded border",style:{borderColor:i.border},disabled:!!d[`assignDriver-${r.id}`],onClick:()=>Pe(r.id),children:"Remove"}),e.jsxs("select",{className:"border rounded px-2 py-1 text-xs min-w-[8rem]",style:{borderColor:i.border},value:W[r.id]||"",onChange:a=>Ze(p=>({...p,[r.id]:a.target.value})),children:[e.jsx("option",{value:"",children:"Move to…"}),s.filter(a=>a.id!==n.id).map(a=>e.jsx("option",{value:a.id,children:a.plate},a.id))]}),e.jsx(x,{disabled:!W[r.id]||!!d[`assignDriver-${r.id}`],loading:!!d[`assignDriver-${r.id}`],onClick:()=>{const a=Number(W[r.id]);Number.isFinite(a)&&K(r.id,a)},className:"text-xs px-2 py-1",children:"Move"}),e.jsx("button",{className:"px-3 py-1 text-xs rounded border",style:{borderColor:i.border},onClick:()=>te(a=>({...a,[r.id]:!1})),children:"Done"})]})}):e.jsx("button",{onClick:()=>te(a=>({...a,[r.id]:!0})),className:"text-sm font-medium px-3 py-1 rounded border",style:{color:i.primary,borderColor:i.primary},children:"Manage"})})]},`${r.id}-${n.id}`))]})})()]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(f,{children:[e.jsx(v,{title:"Drivers Without Vehicles"}),(()=>{const t=new Set;g.forEach(r=>(r.drivers||[]).forEach(n=>t.add(n.user_id)));const o=E.filter(r=>!t.has(r.id)),s=g.filter(r=>!r.drivers||r.drivers.length===0);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:S,onChange:r=>oe(r.target.value),children:[e.jsx("option",{value:"",children:"Select driver…"}),o.map(r=>e.jsx("option",{value:r.id,children:r.username},r.id))]}),e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:B,onChange:r=>ie(r.target.value),children:[e.jsx("option",{value:"",children:"Select vehicle…"}),s.map(r=>e.jsx("option",{value:r.id,children:r.plate},r.id))]}),e.jsx(x,{disabled:!S||!B||!!d[`assignDriver-${Number(S)}`],loading:!!d[`assignDriver-${Number(S)}`],onClick:()=>{const r=Number(S),n=Number(B);Number.isFinite(r)&&Number.isFinite(n)&&K(r,n),oe(""),ie("")},className:"text-sm whitespace-nowrap",children:"Assign"})]}),o.length===0&&e.jsx("div",{className:"text-sm text-center py-4",style:{color:i.textLight},children:"All drivers have vehicles assigned"})]})})()]}),e.jsxs(f,{children:[e.jsx(v,{title:"Vehicles Without Drivers"}),(()=>{const t=new Set;g.forEach(r=>(r.drivers||[]).forEach(n=>t.add(n.user_id)));const o=E.filter(r=>!t.has(r.id)),s=g.filter(r=>!r.drivers||r.drivers.length===0);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:O,onChange:r=>ne(r.target.value),children:[e.jsx("option",{value:"",children:"Select vehicle…"}),s.map(r=>e.jsx("option",{value:r.id,children:r.plate},r.id))]}),e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:$,onChange:r=>ae(r.target.value),children:[e.jsx("option",{value:"",children:"Select driver…"}),o.map(r=>e.jsx("option",{value:r.id,children:r.username},r.id))]}),e.jsx(x,{disabled:!O||!$||!!d[`assignDriver-${Number($)}`],loading:!!d[`assignDriver-${Number($)}`],onClick:()=>{const r=Number(O),n=Number($);Number.isFinite(n)&&Number.isFinite(r)&&K(n,r),ne(""),ae("")},className:"text-sm whitespace-nowrap",children:"Assign"})]}),s.length===0&&e.jsx("div",{className:"text-sm text-center py-4",style:{color:i.textLight},children:"All vehicles have drivers assigned"})]})})()]})]})]})]})]})]})};export{Qe as default};
