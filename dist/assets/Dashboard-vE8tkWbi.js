import{j as e}from"./index-B9Qtw13a.js";import{r as l,L as Z}from"./react-BeLGUnOF.js";import{C as de}from"./ChartComponent-DlIAT8sb.js";import{e as K,U as R,f as U,c as k}from"./ui-DnAl6TrK.js";const z="http://localhost:4000",V={TrendUp:()=>e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})}),TrendDown:()=>e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"})})},ge=()=>{const[I,M]=l.useState([]),[O,F]=l.useState(!1),[H,E]=l.useState(!1),[p,Q]=l.useState([]),q=new Date,[x,G]=l.useState(q.getFullYear()),[m,X]=l.useState(0),[D,ee]=l.useState([]),[y,T]=l.useState(""),[te,se]=l.useState([]),[f,Y]=l.useState(""),w=s=>Number(s??0).toLocaleString(),[h,ae]=l.useState({zones:{total:15,supervisors:45,chiefs:15},clients:{total:3247},manpower:{total:15680},vehicles:{total:892,drivers:945},payments:{currentMonth:245670,today:12345}}),[B,$]=l.useState({yearly:[],monthly:[],weekly:[],daily:[]});function A(s,n,t){const r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],i=Array.from({length:12},(a,o)=>({key:`${n}-${String(o+1).padStart(2,"0")}`,label:r[o],year:n,monthIdx:o})),d=new Map(i.map(a=>[a.key,0])),c=[0,0,0,0],b=`${n}-${String(t).padStart(2,"0")}`,v=Array.from({length:5},(a,o)=>String(new Date().getFullYear()-(4-o))),j=new Map(v.map(a=>[a,0])),J=new Date,W=[],C=[];for(let a=6;a>=0;a--){const o=new Date(J);o.setDate(J.getDate()-a);const u=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`;C.push(u),W.push(`Day ${7-a}`)}const N=new Map(C.map(a=>[a,0])),ne=Array.isArray(s)?s.filter(a=>{const o=String((a==null?void 0:a.status)||"").toLowerCase();return!(a!=null&&a.status)||o==="success"||o==="successful"}):[];for(const a of ne){const o=Number(a.amount||0),u=new Date(a.completed_at||a.created_at||a.updated_at||a.inserted_at||Date.now()),S=`${u.getFullYear()}-${String(u.getMonth()+1).padStart(2,"0")}`;if(d.has(S)&&d.set(S,(d.get(S)||0)+o),S===b){const ce=Math.min(4,Math.max(1,Math.ceil(u.getDate()/7)));c[ce-1]+=o}const _=String(u.getFullYear());j.has(_)&&j.set(_,(j.get(_)||0)+o);const L=`${u.getFullYear()}-${String(u.getMonth()+1).padStart(2,"0")}-${String(u.getDate()).padStart(2,"0")}`;N.has(L)&&N.set(L,(N.get(L)||0)+o)}const re=i.map(a=>({month:a.label,amount:d.get(a.key)||0})),oe=[{week:"Week 1",amount:c[0]},{week:"Week 2",amount:c[1]},{week:"Week 3",amount:c[2]},{week:"Week 4",amount:c[3]}],le=v.map(a=>({year:a,amount:j.get(a)||0})),ie=C.map((a,o)=>({day:W[o],amount:N.get(a)||0}));return{yearly:le,monthly:re,weekly:oe,daily:ie}}l.useEffect(()=>{M(B.monthly||[])},[B]),l.useEffect(()=>{let s=!1;async function n(){try{F(!0);const t=localStorage.getItem("token");if(!t){M([{month:"Jan",amount:4e4},{month:"Feb",amount:32e3},{month:"Mar",amount:28e3},{month:"Apr",amount:35e3},{month:"May",amount:42e3},{month:"Jun",amount:38e3}]);return}const i=await(await fetch(`${z}/api/payments/completed`,{headers:{Authorization:`Bearer ${t}`}})).json(),d=Array.isArray(i==null?void 0:i.payments)?i.payments:[];if(!s){Q(d);const c=A(d,x,m);$({yearly:c.yearly,monthly:c.monthly,weekly:c.weekly,daily:c.daily})}}catch{s||M([{month:"Jan",amount:4e4},{month:"Feb",amount:32e3},{month:"Mar",amount:28e3},{month:"Apr",amount:35e3},{month:"May",amount:42e3},{month:"Jun",amount:38e3}])}finally{s||F(!1)}}return n(),()=>{s=!0}},[]),l.useEffect(()=>{const s=localStorage.getItem("token");s&&fetch(`${z}/api/zones`,{headers:{Authorization:`Bearer ${s}`}}).then(async n=>{const t=await n.json();if(!n.ok)throw new Error((t==null?void 0:t.error)||"Failed to load zones");const r=(t.zones||[]).map(i=>({id:i.id,zone_name:i.zone_name,supervisor_id:i.supervisor_id}));ee(r)}).catch(()=>{})},[]),l.useEffect(()=>{const s=localStorage.getItem("token");s&&fetch(`${z}/api/report/supervisors`,{headers:{Authorization:`Bearer ${s}`}}).then(async n=>{const t=await n.json();if(!n.ok)throw new Error((t==null?void 0:t.error)||"Failed to load supervisors");se(Array.isArray(t.supervisors)?t.supervisors:[])}).catch(()=>{})},[]);const P=l.useMemo(()=>{const s=t=>{if(!t)return!1;const r=new Date(t);return!(r.getFullYear()!==x||m&&r.getMonth()+1!==m)},n=f?D.filter(t=>String(t.supervisor_id??"")===String(f)).map(t=>t.id):[];return p.filter(t=>!(!s((t==null?void 0:t.completed_at)||(t==null?void 0:t.created_at)||(t==null?void 0:t.updated_at)||(t==null?void 0:t.inserted_at))||y&&String((t==null?void 0:t.zone_id)??"")!==String(y)||!y&&f&&!n.includes(Number(t==null?void 0:t.zone_id))))},[p,x,m,y,f,D]);l.useEffect(()=>{const s=A(P,x,m);$({yearly:s.yearly,monthly:s.monthly,weekly:s.weekly,daily:s.daily})},[P,x,m]),l.useEffect(()=>{const s=A(p,x,m);$({yearly:s.yearly,monthly:s.monthly,weekly:s.weekly,daily:s.daily})},[p,x,m]),l.useEffect(()=>{const s=localStorage.getItem("token");s&&(E(!0),fetch(`${z}/api/manager/dashboard`,{headers:{Authorization:`Bearer ${s}`}}).then(async n=>{const t=await n.json();if(!n.ok)throw new Error((t==null?void 0:t.error)||"Failed to load dashboard");ae(r=>({...r,zones:t.zones??r.zones,clients:t.clients??r.clients,manpower:t.manpower??r.manpower,vehicles:t.vehicles??r.vehicles,payments:t.payments??r.payments}))}).catch(n=>console.error("Dashboard load error:",n)).finally(()=>E(!1)))},[]);const g=({title:s,value:n,subtitle:t,icon:r,trend:i,trendValue:d,actionLabel:c,actionTo:b,gradient:v="from-amber-500 to-yellow-600"})=>e.jsx("div",{className:"group bg-white rounded-xl shadow-sm border border-zinc-100 p-3 sm:p-4 hover:shadow-md transition-all duration-200",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs font-medium text-zinc-500 mb-1",children:s}),e.jsx("p",{className:"text-2xl font-semibold text-zinc-900",children:H?"...":n}),t&&e.jsx("p",{className:"text-xs text-zinc-500 mt-1",children:t}),i&&typeof d=="number"&&e.jsxs("div",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium mt-2 ${d>0?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:[d>0?e.jsx(V.TrendUp,{}):e.jsx(V.TrendDown,{}),e.jsxs("span",{className:"ml-1",children:[Math.abs(d),"%"]})]}),c&&b&&e.jsx(Z,{to:b,className:"block text-xs text-amber-600 mt-2 hover:underline transition-colors",children:c})]}),e.jsx("div",{className:`p-3 rounded-lg bg-gradient-to-br ${v} shadow-sm`,children:e.jsx("div",{className:"text-white w-5 h-5",children:r})})]})});return e.jsxs("div",{className:"space-y-6 overflow-x-hidden",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-zinc-800",children:"Business Dashboard"}),e.jsx("p",{className:"text-sm text-zinc-500 mt-1",children:"Here's an overview of your operations today."})]}),e.jsxs("div",{className:"flex items-center mt-3 sm:mt-0 space-x-2 text-sm text-green-600",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{children:"System Online"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[e.jsx(g,{title:"Zones Managed",value:h.zones.total,subtitle:`${h.zones.supervisors} Supervisors â€¢ ${h.zones.chiefs} Chiefs`,icon:e.jsx(K,{className:"w-5 h-5"}),actionLabel:"Manage zones",actionTo:"/zones",gradient:"from-amber-500 to-orange-500"}),e.jsx(g,{title:"Total Clients",value:w(h.clients.total),subtitle:"Active clients",icon:e.jsx(R,{className:"w-5 h-5"}),trend:!0,trendValue:12.5,actionLabel:"Manage clients",actionTo:"/clients",gradient:"from-green-500 to-emerald-500"}),e.jsx(g,{title:"Manpower",value:w(h.manpower.total),subtitle:"Total workforce",icon:e.jsx(U,{className:"w-5 h-5"}),trend:!0,trendValue:8.2,actionLabel:"Manage manpower",actionTo:"/manpower-dashboard",gradient:"from-zinc-700 to-neutral-800"}),e.jsx(g,{title:"Vehicles & Drivers",value:h.vehicles.total,subtitle:`${h.vehicles.drivers} Drivers`,icon:e.jsx(k,{className:"w-5 h-5"}),actionLabel:"Manage vehicles",actionTo:"/vehicles",gradient:"from-amber-600 to-orange-600"}),e.jsx(g,{title:"Current Month Payments",value:`$${w(h.payments.currentMonth)}`,subtitle:"Total payments this month",icon:e.jsx(k,{className:"w-5 h-5"}),trend:!0,trendValue:15.3,gradient:"from-emerald-500 to-teal-600"}),e.jsx(g,{title:"Today's Payments",value:`$${w(h.payments.today)}`,subtitle:"Payments received today",icon:e.jsx(k,{className:"w-5 h-5"}),gradient:"from-amber-600 to-yellow-500"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-zinc-100 p-4 sm:p-5",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-5",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-zinc-800",children:"Payment Trends"}),e.jsx("p",{className:"text-xs text-zinc-500 mt-1",children:"Visual overview of payment performance"})]}),e.jsxs("div",{className:"flex flex-wrap items-end gap-2 mt-3 md:mt-0",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[11px] text-zinc-600",children:"Year"}),e.jsx("select",{className:"text-xs bg-white border border-zinc-200 rounded-md px-2 py-1 text-zinc-700",value:x,onChange:s=>G(Number(s.target.value)),children:Array.from({length:6}).map((s,n)=>{const t=new Date().getFullYear()-n;return e.jsx("option",{value:t,children:t},t)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[11px] text-zinc-600",children:"Month"}),e.jsxs("select",{className:"text-xs bg-white border border-zinc-200 rounded-md px-2 py-1 text-zinc-700",value:m,onChange:s=>X(Number(s.target.value)),children:[e.jsx("option",{value:0,children:"All months"}),Array.from({length:12}).map((s,n)=>{const t=n+1,i=new Date(2e3,n,1).toLocaleString(void 0,{month:"long"});return e.jsx("option",{value:t,children:i},t)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[11px] text-zinc-600",children:"Zone"}),e.jsxs("select",{className:"text-xs bg-white border border-zinc-200 rounded-md px-2 py-1 text-zinc-700",value:y,onChange:s=>{T(s.target.value),s.target.value&&Y("")},children:[e.jsx("option",{value:"",children:"All Zones"}),D.map(s=>e.jsx("option",{value:s.id,children:s.zone_name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[11px] text-zinc-600",children:"Supervisor"}),e.jsxs("select",{className:"text-xs bg-white border border-zinc-200 rounded-md px-2 py-1 text-zinc-700",value:f,onChange:s=>{Y(s.target.value),s.target.value&&T("")},children:[e.jsx("option",{value:"",children:"All Supervisors"}),te.map(s=>e.jsx("option",{value:s.id,children:s.username},s.id))]})]})]})]}),e.jsx("div",{className:"h-64 relative w-full",children:O?e.jsx("div",{className:"h-full flex items-center justify-center text-zinc-500 text-sm",children:"Loading payments..."}):I.length===0?e.jsx("div",{className:"h-full flex items-center justify-center text-zinc-500 text-sm",children:"No payments to display"}):e.jsx(de,{data:I.map(s=>({name:s.month||s.week||s.year||s.day,amount:Number(s.amount)||0})),xKey:"name",series:[{key:"amount",name:"Amount"}],height:260})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-zinc-100 p-4 sm:p-5",children:[e.jsx("h3",{className:"text-base font-semibold text-zinc-800 mb-3",children:"Quick Actions"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:[{label:"Add New Zone",to:"/add-zone",Icon:K,color:"text-amber-600 bg-amber-50"},{label:"Register Client",to:"/register-client",Icon:R,color:"text-emerald-600 bg-emerald-50"},{label:"View Reports",to:"/reports",Icon:k,color:"text-neutral-700 bg-neutral-50"},{label:"Manage Workers",to:"/manage-workers",Icon:U,color:"text-orange-600 bg-orange-50"}].map(({label:s,to:n,Icon:t,color:r},i)=>e.jsxs(Z,{to:n,className:"flex flex-col items-center justify-center p-3 bg-zinc-50 rounded-lg hover:bg-white border border-zinc-200 transition-all duration-200 group",children:[e.jsx("span",{className:`mb-1.5 p-1.5 rounded-md ${r}`,children:e.jsx(t,{className:"h-5 w-5"})}),e.jsx("span",{className:"text-xs font-medium text-zinc-700 text-center group-hover:text-amber-600",children:s})]},i))})]})]})};export{ge as default};
