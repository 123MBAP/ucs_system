import{j as e}from"./index-B9Qtw13a.js";import{j as R,f as U,r as c}from"./react-BeLGUnOF.js";const p="http://localhost:4000",r={primary:"#D97706",primaryHover:"#B45309",accent:"#15803D",accentHover:"#166534",background:"#F9FAFB",cardBg:"#FFFFFF",border:"#E5E7EB",text:"#1E1E1E",textLight:"#6B7280",error:"#DC2626"},u={Back:t=>{const{className:a,...n}=t;return e.jsx("svg",{...n,className:["w-4 h-4",a].filter(Boolean).join(" "),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})},Calendar:t=>{const{className:a,...n}=t;return e.jsx("svg",{...n,className:["w-5 h-5",a].filter(Boolean).join(" "),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})},Vehicle:t=>{const{className:a,...n}=t;return e.jsx("svg",{...n,className:["w-5 h-5",a].filter(Boolean).join(" "),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})})},Save:t=>{const{className:a,...n}=t;return e.jsx("svg",{...n,className:["w-4 h-4",a].filter(Boolean).join(" "),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})},Add:t=>{const{className:a,...n}=t;return e.jsx("svg",{...n,className:["w-4 h-4",a].filter(Boolean).join(" "),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})},Schedule:t=>{const{className:a,...n}=t;return e.jsx("svg",{...n,className:["w-4 h-4",a].filter(Boolean).join(" "),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}};function F(t){return new Date(2e3,0,t).toLocaleString(void 0,{weekday:"long"})}const A=({title:t,number:a})=>e.jsxs("div",{className:"flex items-center gap-3 mb-4 md:mb-6 pb-3 border-b",style:{borderColor:r.border},children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm",style:{backgroundColor:r.primary},children:a}),e.jsx("h2",{className:"text-2xl font-bold",style:{color:r.text},children:t})]}),g=({children:t,className:a=""})=>e.jsx("div",{className:`rounded-lg shadow-sm border p-4 sm:p-5 md:p-6 ${a}`,style:{backgroundColor:r.cardBg,borderColor:r.border},children:t}),z=({children:t,onClick:a,disabled:n=!1,loading:x=!1,className:j=""})=>e.jsx("button",{onClick:a,disabled:n||x,className:`px-4 py-2 rounded-lg font-medium text-white transition-colors flex items-center gap-2 ${j}`,style:{backgroundColor:n?r.textLight:r.primary,cursor:n?"not-allowed":"pointer"},onMouseOver:d=>{!n&&!x&&(d.currentTarget.style.backgroundColor=r.primaryHover)},onMouseOut:d=>{!n&&!x&&(d.currentTarget.style.backgroundColor=r.primary)},children:t}),f=({children:t,onClick:a,disabled:n=!1,loading:x=!1,className:j=""})=>e.jsx("button",{onClick:a,disabled:n||x,className:`px-4 py-2 rounded-lg font-medium text-white transition-colors flex items-center gap-2 ${j}`,style:{backgroundColor:n?r.textLight:r.accent,cursor:n?"not-allowed":"pointer"},onMouseOver:d=>{!n&&!x&&(d.currentTarget.style.backgroundColor=r.accentHover)},onMouseOut:d=>{!n&&!x&&(d.currentTarget.style.backgroundColor=r.accent)},children:t}),G=()=>{const{id:t}=R(),a=U(),[n,x]=c.useState(null),[j,d]=c.useState(!1),[D,V]=c.useState(null),[N,k]=c.useState([]),[I,y]=c.useState(!1),[v,C]=c.useState({}),[w,S]=c.useState({}),[b,B]=c.useState({}),[M,E]=c.useState({}),[$,L]=c.useState({});function h(){const s=localStorage.getItem("token");!s||!t||(d(!0),V(null),fetch(`${p}/api/supervisor/zones/${t}/supervision`,{headers:{Authorization:`Bearer ${s}`}}).then(async l=>{const o=await l.json();if(!l.ok)throw new Error((o==null?void 0:o.error)||"Failed to load");x(o),k(o.serviceDays||[]),y(!1),C({}),S({}),B({}),E({}),L({})}).catch(l=>V((l==null?void 0:l.message)||"Failed to load")).finally(()=>d(!1)))}c.useEffect(()=>{h()},[t]);function T(s){k(l=>l.includes(s)?l.filter(o=>o!==s):[...l,s])}async function _(){const s=localStorage.getItem("token");!s||!t||(await fetch(`${p}/api/supervisor/zones/${t}/service-days`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({days:N})}),h())}async function H(s){const l=localStorage.getItem("token");if(!l||!t)return;const o=Number(v[s]);o&&(await fetch(`${p}/api/supervisor/zones/${t}/driver/vehicle`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({driverUserId:o,vehicleId:s})}),h())}async function O(s){const l=localStorage.getItem("token");!l||!t||(await fetch(`${p}/api/supervisor/zones/${t}/driver/vehicle/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${l}`}}),h())}async function P(s){const l=localStorage.getItem("token");if(!l||!t)return;const o=M[s]||[];o.length&&(await fetch(`${p}/api/supervisor/zones/${t}/vehicle/${s}/manpower`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({manpowerIds:o})}),h())}async function W(s,l){const o=localStorage.getItem("token");!o||!t||(await fetch(`${p}/api/supervisor/zones/${t}/vehicle/${s}/manpower/${l}`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`}}),h())}async function J(s,l){const o=localStorage.getItem("token");!o||!t||(await fetch(`${p}/api/supervisor/zones/${t}/vehicle/${l}/manpower`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({manpowerIds:[s]})}),h())}const Z=c.useMemo(()=>n?n.drivers.filter(s=>s.vehicle_id==null):[],[n]);return j?e.jsx("div",{className:"min-h-screen p-0 sm:p-2 md:p-4",style:{backgroundColor:r.background},children:e.jsx("div",{className:"max-w-none md:max-w-6xl mx-auto space-y-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 rounded w-48 mb-6",style:{backgroundColor:r.border}}),e.jsx("div",{className:"grid gap-6",children:[...Array(5)].map((s,l)=>e.jsx("div",{className:"h-32 rounded-lg",style:{backgroundColor:r.border}},l))})]})})}):D?e.jsx("div",{className:"min-h-screen p-0 sm:p-2 md:p-4",style:{backgroundColor:r.background},children:e.jsx("div",{className:"max-w-none md:max-w-6xl mx-auto",children:e.jsx(g,{children:e.jsx("div",{className:"text-center p-6 rounded-lg",style:{backgroundColor:"#FEF2F2",borderColor:r.error},children:e.jsx("div",{style:{color:r.error},className:"font-medium",children:D})})})})}):n?e.jsx("div",{className:"min-h-screen p-0 sm:p-2 md:p-4",style:{backgroundColor:r.background},children:e.jsxs("div",{className:"max-w-none md:max-w-6xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("button",{onClick:()=>a(-1),className:"flex items-center space-x-2 transition-colors duration-200",style:{color:r.textLight},children:[e.jsx(u.Back,{}),e.jsx("span",{className:"font-medium",children:"Back to Zones"})]}),e.jsx("div",{className:"w-px h-6",style:{backgroundColor:r.border}}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",style:{color:r.text},children:"Zone Supervision"}),e.jsxs("p",{className:"mt-1",style:{color:r.textLight},children:["Manage ",n.zone.name," operations and assignments"]})]})]}),e.jsxs(f,{onClick:()=>a(`/supervisor/zones/${n.zone.id}/schedule`),className:"hidden md:flex px-6 py-3",children:[e.jsx(u.Schedule,{}),e.jsx("span",{children:"Plan Service Schedule"})]})]}),e.jsx("div",{className:"md:hidden",children:e.jsx(g,{children:e.jsxs(f,{onClick:()=>a(`/supervisor/zones/${n.zone.id}/schedule`),className:"w-full justify-center py-3",children:[e.jsx(u.Schedule,{}),e.jsx("span",{children:"Plan Service Schedule"})]})})}),e.jsxs("section",{children:[e.jsx(A,{title:"Supervisor Vehicles",number:1}),e.jsxs(g,{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(u.Vehicle,{style:{color:r.primary}}),e.jsx("h3",{className:"text-lg font-semibold",style:{color:r.text},children:"Your Assigned Vehicles"})]}),e.jsx("div",{children:n.supervisorVehicles&&n.supervisorVehicles.length?e.jsx("div",{className:"flex flex-wrap gap-3",children:n.supervisorVehicles.map(s=>e.jsx("span",{className:"px-4 py-2 rounded-lg font-medium border",style:{backgroundColor:"#FEF7ED",borderColor:r.primary,color:r.primary},children:s.plate},s.id))}):e.jsx("div",{style:{color:r.textLight},className:"italic",children:"No vehicles assigned to you yet"})})]})]}),e.jsxs("section",{children:[e.jsx(A,{title:"Service Days Configuration",number:2}),e.jsxs(g,{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-6",children:[e.jsx(u.Calendar,{style:{color:r.primary}}),e.jsx("h3",{className:"text-lg font-semibold",style:{color:r.text},children:"Active Service Days"})]}),I?e.jsxs("div",{children:[e.jsx("div",{className:"flex flex-wrap gap-3 mb-6",children:Array.from({length:7}).map((s,l)=>{const o=l+1,m=N.includes(o);return e.jsx("button",{onClick:()=>T(o),className:`px-4 py-3 rounded-lg border font-medium transition-all duration-200 ${m?"text-white shadow-lg":"border hover:shadow-md"}`,style:m?{backgroundColor:r.primary,borderColor:r.primary}:{backgroundColor:r.cardBg,color:r.text,borderColor:r.border},children:F(o)},o)})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(f,{onClick:async()=>{await _(),y(!1)},className:"px-6 py-3",children:[e.jsx(u.Save,{}),e.jsx("span",{children:"Save"})]}),e.jsx("button",{onClick:()=>{k(n.serviceDays||[]),y(!1)},className:"px-4 py-2 rounded-lg font-medium border",style:{backgroundColor:r.cardBg,color:r.text,borderColor:r.border},children:"Cancel"})]})]}):e.jsxs("div",{children:[e.jsx("div",{className:"flex flex-wrap gap-3 mb-6",children:Array.from({length:7}).map((s,l)=>{const o=l+1,m=N.includes(o);return e.jsx("span",{className:`px-4 py-3 rounded-lg border font-medium ${m?"text-white":""}`,style:m?{backgroundColor:r.primary,borderColor:r.primary}:{backgroundColor:r.cardBg,color:r.text,borderColor:r.border},children:F(o)},o)})}),e.jsx(z,{onClick:()=>y(!0),className:"px-6 py-3",children:e.jsx("span",{children:"Edit Service Days"})})]})]})]}),e.jsxs("section",{children:[e.jsx(A,{title:"Vehicle & Driver Management",number:3}),e.jsxs(g,{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-6",children:[e.jsx(u.Vehicle,{style:{color:r.primary}}),e.jsx("h3",{className:"text-lg font-semibold",style:{color:r.text},children:"Vehicles with Assignments"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n.vehicles.map(s=>{const l=n.drivers.find(o=>o.vehicle_id===s.id)||null;return e.jsxs("div",{className:"rounded-lg p-4 border",style:{backgroundColor:r.background,borderColor:r.border},children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(u.Vehicle,{className:"w-4 h-4",style:{color:r.primary}}),e.jsxs("h4",{className:"font-semibold",style:{color:r.text},children:["Vehicle ",s.plate]})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",style:{color:r.text},children:"Current driver:"})," ",l?e.jsx("span",{style:{color:r.text},children:l.full_name||l.username}):e.jsx("span",{style:{color:r.error},children:"None assigned"})]}),Array.isArray(s.assigned_manpower_users)&&e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium mb-1",style:{color:r.text},children:"Assigned Manpower:"}),s.assigned_manpower_users.length?e.jsx("div",{className:"space-y-1",children:s.assigned_manpower_users.map(o=>{var m;return e.jsxs("div",{className:"px-2 py-1 rounded flex items-center justify-between",style:{backgroundColor:r.cardBg,color:r.text},children:[e.jsx("span",{children:o.full_name||o.username}),b[s.id]&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>W(s.id,o.id),className:"px-2 py-1 rounded text-sm",style:{backgroundColor:"#FEF2F2",color:r.error},children:"Remove"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{className:"rounded px-2 py-1 border text-sm",style:{backgroundColor:r.cardBg,borderColor:r.border,color:r.text},value:((m=$[s.id])==null?void 0:m.toVehicleId)||"",onChange:i=>L({...$,[s.id]:{manpowerId:o.id,toVehicleId:Number(i.target.value)||null}}),children:[e.jsx("option",{value:"",children:"Move to vehicle…"}),n.vehicles.filter(i=>i.id!==s.id).map(i=>e.jsx("option",{value:i.id,children:i.plate},i.id))]}),e.jsx("button",{onClick:()=>{const i=$[s.id];i!=null&&i.manpowerId&&(i!=null&&i.toVehicleId)&&J(i.manpowerId,i.toVehicleId)},className:"px-2 py-1 rounded text-sm",style:{backgroundColor:r.accent,color:"white"},children:"Move"})]})]})]},o.id)})}):e.jsx("div",{style:{color:r.textLight},className:"italic",children:"None assigned"})]})]}),w[s.id]?e.jsxs("div",{children:[e.jsxs("select",{className:"w-full rounded-lg px-4 py-3 mb-3 focus:outline-none focus:ring-2 border",style:{backgroundColor:r.cardBg,borderColor:r.border,color:r.text},value:v[s.id]||"",onChange:o=>C({...v,[s.id]:o.target.value}),children:[e.jsx("option",{value:"",children:"Select driver…"}),Z.map(o=>e.jsx("option",{value:o.id,children:o.full_name||o.username},o.id))]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{onClick:()=>H(s.id),className:"w-full justify-center py-3",children:[e.jsx(u.Save,{}),e.jsx("span",{children:"Save"})]}),e.jsx("button",{onClick:()=>{S({...w,[s.id]:!1}),C({...v,[s.id]:""})},className:"px-4 py-2 rounded-lg font-medium border",style:{backgroundColor:r.cardBg,color:r.text,borderColor:r.border},children:"Cancel"})]})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{onClick:()=>S({...w,[s.id]:!0}),className:"w-full justify-center py-3",children:e.jsx("span",{children:"Change Driver"})}),l&&e.jsx("button",{onClick:()=>O(l.id),className:"px-4 py-2 rounded-lg font-medium border",style:{backgroundColor:"#FEF2F2",color:r.error,borderColor:r.error},children:"Unassign Driver"})]}),e.jsx("div",{className:"mt-4",children:b[s.id]?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("select",{multiple:!0,className:"w-full rounded-lg px-3 py-2 border",style:{backgroundColor:r.cardBg,borderColor:r.border,color:r.text},value:(M[s.id]||[]).map(String),onChange:o=>{const m=Array.from(o.target.selectedOptions).map(i=>Number(i.value));E({...M,[s.id]:m})},children:(n.unassignedManpower||[]).map(o=>e.jsx("option",{value:o.id,children:o.full_name||o.username},o.id))}),e.jsxs(f,{onClick:()=>P(s.id),children:[e.jsx(u.Add,{}),e.jsx("span",{children:"Add"})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:()=>B({...b,[s.id]:!1}),className:"px-4 py-2 rounded-lg font-medium border",style:{backgroundColor:r.cardBg,color:r.text,borderColor:r.border},children:"Done"})})]}):e.jsx("button",{onClick:()=>B({...b,[s.id]:!0}),className:"px-4 py-2 rounded-lg font-medium border",style:{backgroundColor:r.cardBg,color:r.text,borderColor:r.border},children:"Manage Manpowers"})})]},s.id)})})]})]})]})}):e.jsx("div",{className:"min-h-screen p-0 sm:p-2 md:p-4",style:{backgroundColor:r.background},children:e.jsx("div",{className:"max-w-none md:max-w-6xl mx-auto",children:e.jsx(g,{children:e.jsx("div",{className:"text-center",children:e.jsx("div",{style:{color:r.textLight},children:"Zone not found"})})})})})};export{G as default};
