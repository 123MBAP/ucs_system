import{u as q,j as e}from"./index-DnGg16Vn.js";import{r as l,L as o}from"./react-BeLGUnOF.js";import{U as C,B as $,W as A,C as z,a as T,H as F,b as I}from"./ui-DnAl6TrK.js";const c="http://localhost:4000",W=()=>{var v;const{t:a}=q(),[s,y]=l.useState(null),[E,h]=l.useState(!1),[j,u]=l.useState(null),[f,d]=l.useState([]),[m,g]=l.useState(null);function x(){const i=localStorage.getItem("token");i&&(h(!0),u(null),fetch(`${c}/api/chief/dashboard`,{headers:{Authorization:`Bearer ${i}`}}).then(async r=>{const t=await r.json();if(!r.ok)throw new Error((t==null?void 0:t.error)||"Failed to load");y(t)}).catch(r=>u((r==null?void 0:r.message)||"Failed to load")).finally(()=>h(!1)))}l.useEffect(()=>{x(),(async()=>{const r=localStorage.getItem("token");if(r)try{const t=await fetch(`${c}/api/password/chief/requests`,{headers:{Authorization:`Bearer ${r}`}}),n=await t.json();if(!t.ok)throw new Error((n==null?void 0:n.error)||"Failed");d(Array.isArray(n==null?void 0:n.requests)?n.requests:[])}catch{}})();function i(){x()}return window.addEventListener("payments-updated",i),()=>{window.removeEventListener("payments-updated",i)}},[]);const k=(s==null?void 0:s.chiefName)||"-",D=(s==null?void 0:s.zoneName)||((v=s==null?void 0:s.zones)!=null&&v.length?a("common.multipleZones"):"-"),w=(s==null?void 0:s.clientsTotal)||0,N=(s==null?void 0:s.amountTotal)||0,b=(s==null?void 0:s.amountPaid)||0,S=(s==null?void 0:s.amountRemaining)??Math.max(0,N-b),p=(s==null?void 0:s.clientsPaid)||0,R=(s==null?void 0:s.clientsRemaining)??Math.max(0,w-p),B=(s==null?void 0:s.todayPayments)||0;return e.jsxs("div",{className:"space-y-8",children:[f.length>0&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow p-6 border border-amber-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-[#1E1E1E]",children:"Client Password Reset Requests"}),e.jsx("button",{onClick:async()=>{const i=localStorage.getItem("token");if(i)try{const r=await fetch(`${c}/api/password/chief/requests`,{headers:{Authorization:`Bearer ${i}`}}),t=await r.json();if(!r.ok)throw new Error((t==null?void 0:t.error)||"Failed");d(Array.isArray(t==null?void 0:t.requests)?t.requests:[])}catch{}},className:"text-[#D97706] hover:text-[#B45309] underline text-sm",children:a("common.refresh")})]}),e.jsx("div",{className:"space-y-2",children:f.map(i=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-amber-100 bg-amber-50/40",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-[#1E1E1E]",children:i.username}),i.emailHint&&e.jsxs("div",{className:"text-xs text-gray-600",children:["Email: ",i.emailHint]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Requested at: ",new Date(i.createdAt).toLocaleString()]})]}),e.jsx("button",{disabled:m===i.id,onClick:async()=>{const r=localStorage.getItem("token");if(r){g(i.id);try{const t=await fetch(`${c}/api/password/chief/requests/${i.id}/reset`,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}}),n=await t.json();if(!t.ok)throw new Error((n==null?void 0:n.error)||"Failed");d(L=>L.filter(P=>P.id!==i.id))}catch(t){alert((t==null?void 0:t.message)||"Failed to reset")}finally{g(null)}}},className:`px-3 py-1.5 rounded-md text-white text-sm ${m===i.id?"bg-gray-400":"bg-neutral-900 hover:bg-neutral-800"}`,children:m===i.id?"Resetting...":"Reset to 123"})]},i.id))})]}),e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-[#1E1E1E]",children:a("chief.title")}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:a("chief.subtitle")})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-500",children:a("chief.label.chief")}),e.jsx("p",{className:"text-lg font-semibold text-[#1E1E1E]",children:k}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:a("chief.label.zone")}),e.jsx("p",{className:"text-lg font-semibold text-[#1E1E1E]",children:D}),e.jsx("div",{className:"mt-2",children:e.jsx("button",{onClick:x,className:"text-[#D97706] hover:text-[#B45309] underline text-sm transition-colors",children:a("common.refresh")})})]})]}),j&&e.jsx("div",{className:"text-red-600",children:j}),E?e.jsx("div",{children:a("common.loading")}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow p-6 border border-amber-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:a("chief.cards.clientsTotal")}),e.jsx("p",{className:"text-2xl font-bold text-[#1E1E1E] mt-2",children:w.toLocaleString()}),e.jsx("div",{className:"mt-2",children:e.jsx(o,{to:"/clients?scope=chief&filter=all",className:"text-[#D97706] hover:text-[#B45309] underline text-sm transition-colors",children:a("common.view")})})]}),e.jsx("div",{className:"shrink-0 p-2 rounded-lg bg-amber-50 text-[#D97706]",children:e.jsx(C,{className:"h-8 w-8"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow p-6 border border-amber-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:a("chief.cards.amountTotal")}),e.jsx("p",{className:"text-2xl font-bold text-[#1E1E1E] mt-2",children:N.toLocaleString()})]}),e.jsx("div",{className:"shrink-0 p-2 rounded-lg bg-amber-100 text-[#B45309]",children:e.jsx($,{className:"h-8 w-8"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow p-6 border border-green-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:a("chief.cards.amountPaid")}),e.jsx("p",{className:"text-2xl font-bold text-[#1E1E1E] mt-2",children:b.toLocaleString()}),e.jsx("div",{className:"mt-2",children:e.jsx(o,{to:"/clients?scope=chief&filter=paid",className:"text-[#15803D] hover:text-[#166534] underline text-sm transition-colors",children:a("common.view")})})]}),e.jsx("div",{className:"shrink-0 p-2 rounded-lg bg-green-50 text-[#15803D]",children:e.jsx(A,{className:"h-8 w-8"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow p-6 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:a("chief.cards.amountRemaining")}),e.jsx("p",{className:"text-2xl font-bold text-[#1E1E1E] mt-2",children:S.toLocaleString()})]}),e.jsx("div",{className:"shrink-0 p-2 rounded-lg bg-amber-50 text-[#D97706]",children:e.jsx(z,{className:"h-8 w-8"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow p-6 border border-green-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:a("chief.cards.clientsPaid")}),e.jsx("p",{className:"text-2xl font-bold text-[#1E1E1E] mt-2",children:p.toLocaleString()}),e.jsx("div",{className:"mt-2",children:e.jsx(o,{to:"/clients?scope=chief&filter=paid",className:"text-[#15803D] hover:text-[#166534] underline text-sm transition-colors",children:a("common.view")})})]}),e.jsx("div",{className:"shrink-0 p-2 rounded-lg bg-green-50 text-[#15803D]",children:e.jsx(T,{className:"h-8 w-8"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow p-6 border border-amber-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:a("chief.cards.clientsRemaining")}),e.jsx("p",{className:"text-2xl font-bold text-[#1E1E1E] mt-2",children:R.toLocaleString()}),e.jsx("div",{className:"mt-2",children:e.jsx(o,{to:"/clients?scope=chief&filter=remaining",className:"text-[#D97706] hover:text-[#B45309] underline text-sm transition-colors",children:a("common.view")})})]}),e.jsx("div",{className:"shrink-0 p-2 rounded-lg bg-amber-50 text-[#D97706]",children:e.jsx(F,{className:"h-8 w-8"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow p-6 border border-green-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:a("chief.cards.todayPayments")}),e.jsx("p",{className:"text-2xl font-bold text-[#1E1E1E] mt-2",children:B.toLocaleString()}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:a("chief.cards.todayPaymentsDesc")}),e.jsx("div",{className:"mt-2",children:e.jsx(o,{to:"/payments?scope=chief&filter=today",className:"text-[#15803D] hover:text-[#166534] underline text-sm transition-colors",children:a("common.view")})})]}),e.jsx("div",{className:"shrink-0 p-2 rounded-lg bg-green-50 text-[#15803D]",children:e.jsx(I,{className:"h-8 w-8"})})]})})]})]})};export{W as default};
