import{u as g,j as e}from"./index-Cb5Y6uas.js";import{r as d}from"./react-CzDbI3ao.js";import{d as N,g as w,W as y,e as z,h as _}from"./ui-C_j-RX_5.js";const m="http://localhost:4000",A=()=>{const{t}=g(),[n,x]=d.useState({name:"",plateNumber:null,salary:null,zones:[]}),[c,h]=d.useState(!1),[u,v]=d.useState([]);d.useEffect(()=>{const r=localStorage.getItem("token");r&&(h(!0),fetch(`${m}/api/driver/dashboard`,{headers:{Authorization:`Bearer ${r}`}}).then(async i=>{var l,b,j,p;const s=await i.json();if(!i.ok)throw new Error((s==null?void 0:s.error)||"Failed to load driver dashboard");const a=[(l=s==null?void 0:s.user)==null?void 0:l.first_name,(b=s==null?void 0:s.user)==null?void 0:b.last_name].filter(Boolean).join(" ")||((j=s==null?void 0:s.user)==null?void 0:j.username)||"";x({name:a,plateNumber:((p=s==null?void 0:s.vehicle)==null?void 0:p.plate)??null,salary:(s==null?void 0:s.salary)??null,zones:Array.isArray(s==null?void 0:s.zones)?s.zones.map(o=>String((o==null?void 0:o.name)??o)).filter(Boolean):[]})}).catch(async()=>{try{const i=await fetch(`${m}/api/me`,{headers:{Authorization:`Bearer ${r}`}}),s=await i.json();i.ok&&x(a=>{var l;return{...a,name:((l=s==null?void 0:s.user)==null?void 0:l.username)||a.name}})}catch{}}).finally(()=>h(!1)),fetch(`${m}/api/driver/schedule`,{headers:{Authorization:`Bearer ${r}`}}).then(async i=>{const s=await i.json();if(!i.ok)throw new Error((s==null?void 0:s.error)||"Failed to load schedule");const a=Array.isArray(s==null?void 0:s.schedule)?s.schedule:[];v(a)}).catch(()=>v([])))},[]);const f=d.useMemo(()=>["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],[]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-zinc-800 to-indigo-600 bg-clip-text text-transparent",children:t("driver.title")}),e.jsx("p",{className:"text-zinc-600 mt-2",children:t("driver.subtitle")})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-4 sm:mt-0 text-sm text-zinc-500",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{children:t("driver.profileActive")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-600",children:t("driver.name")}),e.jsx("div",{className:"text-2xl font-bold text-zinc-900 mt-1",children:c?"…":n.name||"-"})]}),e.jsx("div",{className:"shrink-0 p-2 rounded-lg bg-indigo-50 text-indigo-600",children:e.jsx(N,{className:"h-8 w-8"})})]})}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-600",children:t("driver.assignedCar")}),e.jsx("div",{className:"text-2xl font-bold text-zinc-900 mt-1",children:c?"…":n.plateNumber??"Not assigned"})]}),e.jsx("div",{className:"shrink-0 p-2 rounded-lg bg-amber-50 text-amber-600",children:e.jsx(w,{className:"h-8 w-8"})})]})}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-600",children:t("driver.salary")}),e.jsx("div",{className:"text-2xl font-bold text-zinc-900 mt-1",children:c?"…":n.salary!=null?n.salary.toLocaleString():"Not set"})]}),e.jsx("div",{className:"shrink-0 p-2 rounded-lg bg-emerald-50 text-emerald-600",children:e.jsx(y,{className:"h-8 w-8"})})]})})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"h-5 w-5 text-indigo-600"}),e.jsx("div",{className:"text-sm font-semibold text-zinc-700",children:t("driver.assignedZones")})]})}),c?"…":n.zones.length?e.jsx("ul",{className:"list-disc pl-6 text-zinc-800",children:n.zones.map((r,i)=>e.jsx("li",{children:r},i))}):e.jsx("div",{className:"text-zinc-600",children:t("driver.none")})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(_,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h2",{className:"text-sm font-semibold text-zinc-700",children:t("driver.schedule.title")})]}),u.length===0?e.jsx("div",{className:"text-zinc-600",children:t("driver.schedule.none")}):e.jsx("div",{className:"divide-y divide-zinc-200",children:u.map(r=>{var a,l;const i=r.supervisor_status,s=i==null?{text:t("status.pending"),cls:"bg-amber-50 text-amber-700 border-amber-200"}:i==="complete"?{text:t("status.completed"),cls:"bg-emerald-50 text-emerald-700 border-emerald-200"}:{text:t("status.notCompleted"),cls:"bg-red-50 text-red-700 border-red-200"};return e.jsxs("div",{className:"py-4 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-zinc-900 font-semibold",children:f[(Number(r.service_day)||1)-1]||""}),e.jsxs("div",{className:"text-zinc-600 text-sm",children:[(a=r.service_start)==null?void 0:a.slice(0,5)," - ",(l=r.service_end)==null?void 0:l.slice(0,5)]}),e.jsxs("div",{className:"text-zinc-500 text-xs mt-1 space-y-0.5",children:[e.jsxs("div",{children:[r.zone_name?`${t("driver.zone")}: ${r.zone_name}`:"",r.zone_name&&r.vehicle_plate?" • ":"",r.vehicle_plate?`${t("driver.vehicle")}: ${r.vehicle_plate}`:""]}),!!(r.assigned_manpower_usernames&&r.assigned_manpower_usernames.length)&&e.jsxs("div",{children:[t("driver.team"),": ",r.assigned_manpower_usernames.join(", ")]})]}),i==="not_complete"&&r.supervisor_reason&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:r.supervisor_reason})]}),e.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded-lg border ${s.cls}`,children:s.text})]},r.id)})})]})]})};export{A as default};
