import{u as J,j as e}from"./index-8yk-1D8L.js";import{r as i}from"./react-CzDbI3ao.js";import{c as O,R as U,d as Z,M as q}from"./ui-fx2JTPqr.js";const b="http://localhost:4000",h={Client:t=>e.jsx("svg",{...t,className:`w-6 h-6 ${t.className||""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),Payment:t=>e.jsx("svg",{...t,className:`w-6 h-6 ${t.className||""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})}),Phone:t=>e.jsx("svg",{...t,className:`w-5 h-5 ${t.className||""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),Check:t=>e.jsx("svg",{...t,className:`w-5 h-5 ${t.className||""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),Loading:t=>e.jsx("svg",{...t,className:`w-5 h-5 animate-spin ${t.className||""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 2v4m0 12v4m8-10h-4M6 12H2"})}),Alert:t=>e.jsx("svg",{...t,className:`w-5 h-5 ${t.className||""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},se=()=>{const{t}=J(),B="John Client",[g,L]=i.useState(null),[N,z]=i.useState([]),[w,k]=i.useState([]),[K,_]=i.useState({}),D=i.useMemo(()=>[t("weekday.mon"),t("weekday.tue"),t("weekday.wed"),t("weekday.thu"),t("weekday.fri"),t("weekday.sat"),t("weekday.sun")],[t]),S=i.useMemo(()=>N.map(s=>D[(Number(s)||1)-1]).filter(Boolean),[N]),[d,T]=i.useState(null),[p,F]=i.useState(0),[$,R]=i.useState(""),[y,C]=i.useState(!1),[m,j]=i.useState({type:"idle"});i.useEffect(()=>{const s=localStorage.getItem("token");!s||!b||(async()=>{var r,n;try{const l=await fetch(`${b}/api/clients/me`,{headers:{Authorization:`Bearer ${s}`}}),a=await l.json();if(l.ok&&((r=a==null?void 0:a.client)!=null&&r.zone_id)){L(a.client.id),((n=a==null?void 0:a.client)==null?void 0:n.monthly_amount)!=null&&T(Number(a.client.monthly_amount));const c=await fetch(`${b}/api/zones/${a.client.zone_id}/service-days`,{headers:{Authorization:`Bearer ${s}`}}),x=await c.json();c.ok&&Array.isArray(x==null?void 0:x.serviceDays)&&z(x.serviceDays.map(u=>Number(u)).filter(u=>u>=1&&u<=7));const P=await fetch(`${b}/api/zones/${a.client.zone_id}/schedule`,{headers:{Authorization:`Bearer ${s}`}}),f=await P.json();P.ok&&Array.isArray(f==null?void 0:f.schedule)&&k(f.schedule);const A=await fetch(`${b}/api/payments/statements`,{headers:{Authorization:`Bearer ${s}`}}),v=await A.json();if(A.ok&&Array.isArray(v==null?void 0:v.payments)){const u=new Date,W=u.getFullYear(),V=u.getMonth(),Y=v.payments.filter(o=>(o==null?void 0:o.client_id)===a.client.id&&(o==null?void 0:o.completed_at)).map(o=>({amt:Number(o.amount)||0,dt:new Date(o.completed_at)})).filter(({dt:o})=>o.getFullYear()===W&&o.getMonth()===V).reduce((o,{amt:H})=>o+H,0);F(Y)}}}catch{}})()},[]);const E=s=>{if(!s||s.supervisor_status!=="complete"||!s.supervisor_decided_at)return!1;const r=new Date(s.supervisor_decided_at),n=new Date(r.getTime()+1440*60*1e3),l=new Date<=n,a=(s.complained_client_ids||[]).includes(g||-1);return l&&!a},M=i.useMemo(()=>{const s=new Date;return w.filter(r=>{if(r.supervisor_status!=="complete"||!r.supervisor_decided_at)return!0;const n=new Date(r.supervisor_decided_at),l=new Date(n.getTime()+1440*60*1e3);return(r.complained_client_ids||[]).includes(g||-1)||s<=l})},[w,g]),X=async s=>{var n;const r=localStorage.getItem("token");if(r)try{_(c=>({...c,[s]:!0}));const l=await fetch(`${b}/api/clients/complaints`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({scheduleId:s})}),a=await l.json();l.ok&&((n=a==null?void 0:a.schedule)!=null&&n.complained_client_ids)&&k(c=>c.map(x=>x.id===s?{...x,complained_client_ids:a.schedule.complained_client_ids}:x))}finally{_(l=>({...l,[s]:!1}))}},I=async s=>{if(s.preventDefault(),!/^\+?\d{9,15}$/.test($)){j({type:"error",message:"Enter a valid phone number (9-15 digits, optionally starting with +)."});return}C(!0),j({type:"pending",message:"Payment initiated. Please confirm on your phone…"});try{await new Promise(r=>setTimeout(r,1500)),await new Promise(r=>setTimeout(r,3e3)),j({type:"success",message:"Payment confirmed on your phone. Thank you!"})}catch{j({type:"error",message:"Payment failed. Please try again."})}finally{C(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gray-50 p-4 sm:p-6 lg:p-8",children:[e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6 sm:space-y-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold text-charcoal",children:t("clientDashboard.title")}),e.jsx("p",{className:"text-gray-600 mt-2 text-sm sm:text-base",children:t("clientDashboard.subtitle")})]}),e.jsx("div",{className:"flex items-center space-x-4 mt-4 sm:mt-0",children:e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[e.jsx("div",{className:"w-2 h-2 bg-green-600 rounded-full animate-pulse"}),e.jsx("span",{children:"Account Active"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 sm:gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6 sm:space-y-8",children:[e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6 transition-all duration-300 hover:shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-600",children:t("client.profile")}),e.jsx("span",{className:"text-xs text-green-600 bg-green-50 px-2 py-1 rounded-full font-medium border border-green-200",children:t("common.verified")})]}),e.jsx("p",{className:"text-xl sm:text-2xl font-bold text-charcoal",children:B}),e.jsx("p",{className:"text-gray-600 mt-1 text-sm sm:text-base",children:"Active client since 2024"})]}),e.jsx("div",{className:"w-14 h-14 sm:w-16 sm:h-16 bg-gradient-to-br from-amber-500 to-amber-600 rounded-2xl flex items-center justify-center shadow-lg",children:e.jsx(h.Client,{})})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-5 transition-all duration-300 hover:shadow-md",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-3",children:e.jsx("span",{className:"text-sm font-semibold text-gray-600",children:t("clientDashboard.serviceDay")})}),e.jsx("p",{className:"text-gray-600 text-sm mb-2",children:"The day of service in your zone is:"}),e.jsx("p",{className:"text-lg sm:text-xl font-bold text-charcoal",children:S.length?S.join(", "):"Not set"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-5 transition-all duration-300 hover:shadow-md",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-3",children:e.jsx("span",{className:"text-sm font-semibold text-gray-600",children:t("clientDashboard.amountToPay")})}),e.jsx("p",{className:"text-lg sm:text-xl font-bold text-charcoal",children:d!=null?`$${d.toLocaleString()}`:"—"}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"Your monthly amount"}),d!=null&&e.jsxs("p",{className:"text-gray-500 text-xs mt-2",children:["Remaining this month: $",Math.max(0,d-p).toLocaleString()]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-5 transition-all duration-300 hover:shadow-md",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(h.Payment,{className:"w-4 h-4 text-amber-600"}),e.jsx("span",{className:"text-sm font-semibold text-gray-600",children:t("clientDashboard.paidThisMonth")})]}),e.jsxs("p",{className:"text-lg sm:text-xl font-bold text-charcoal",children:["$",p.toLocaleString()]}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"Total paid this month"}),d!=null&&e.jsxs("div",{className:"flex items-center space-x-2 mt-3",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${p>=d?"bg-green-600":"bg-amber-500"}`}),e.jsx("span",{className:`text-xs font-medium ${p>=d?"text-green-600":"text-amber-600"}`,children:p>=d?t("clientDashboard.paymentUpToDate"):t("clientDashboard.paymentPending")})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-5",children:[e.jsx("h3",{className:"text-sm font-semibold text-charcoal mb-4",children:"Quick Actions"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{label:"Payment History",Icon:O,color:"text-amber-600 bg-amber-50"},{label:"Receipts",Icon:U,color:"text-green-600 bg-green-50"},{label:"Profile",Icon:Z,color:"text-charcoal bg-gray-100"},{label:"Support",Icon:q,color:"text-gray-600 bg-gray-50"}].map(({label:s,Icon:r,color:n},l)=>e.jsxs("button",{className:"flex flex-col items-center justify-center p-3 bg-gray-50 rounded-lg hover:bg-amber-50 border border-gray-200 hover:border-amber-200 transition-all duration-200 group",children:[e.jsx("span",{className:`mb-2 p-2 rounded-lg ${n}`,children:e.jsx(r,{className:"h-4 w-4"})}),e.jsx("span",{className:"text-xs font-medium text-charcoal text-center group-hover:text-amber-700",children:s})]},l))})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-4",children:e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-charcoal",children:t("clientDashboard.serviceSchedule")})}),M.length===0?e.jsx("div",{className:"text-gray-600 text-center py-8",children:t("clientDashboard.noSchedule")}):e.jsx("div",{className:"space-y-3",children:M.map(s=>{var a,c;const r=D[(Number(s.service_day)||1)-1]||"",n=s.supervisor_status,l=n==null?{text:"Pending",cls:"bg-amber-50 text-amber-700 border-amber-200"}:n==="complete"?{text:"Completed",cls:"bg-green-50 text-green-700 border-green-200"}:{text:"Not Completed",cls:"bg-red-50 text-red-700 border-red-200"};return e.jsx("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-charcoal font-semibold text-sm sm:text-base",children:r}),e.jsxs("div",{className:"text-gray-600 text-xs sm:text-sm",children:[(a=s.service_start)==null?void 0:a.slice(0,5)," - ",(c=s.service_end)==null?void 0:c.slice(0,5)]})]}),e.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded-lg border ${l.cls} self-start sm:self-auto`,children:l.text})]}),e.jsxs("div",{className:"text-gray-500 text-xs mt-2",children:[s.vehicle_plate?`Vehicle: ${s.vehicle_plate}`:"",s.vehicle_plate&&s.driver_username?" • ":"",s.driver_username?`Driver: ${s.driver_username}`:""]}),n==="not_complete"&&s.supervisor_reason&&e.jsxs("div",{className:"text-red-600 text-xs mt-2",children:["Reason: ",s.supervisor_reason]}),n==="complete"&&(s.complained_client_ids||[]).includes(g||-1)&&e.jsx("div",{className:"text-amber-700 text-xs mt-2",children:"Complaint submitted. Awaiting review."}),n==="complete"&&E(s)&&e.jsx("button",{className:"text-xs text-amber-700 font-medium mt-2 hover:text-amber-800 transition-colors",onClick:()=>X(s.id),children:"My home not yet serviced"})]})},s.id)})})]})]}),e.jsx("div",{className:"space-y-6 sm:space-y-8",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6 sticky top-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-6",children:[e.jsx(h.Payment,{className:"w-5 h-5 text-amber-600"}),e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-charcoal",children:t("payment.makePayment")})]}),m.type!=="idle"&&e.jsx("div",{className:`mb-6 p-4 rounded-xl border transition-all duration-300 ${m.type==="pending"?"bg-amber-50 border-amber-200 text-amber-700":m.type==="success"?"bg-green-50 border-green-200 text-green-700":m.type==="error"?"bg-red-50 border-red-200 text-red-700":""}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[m.type==="pending"&&e.jsx(h.Loading,{}),m.type==="success"&&e.jsx(h.Check,{}),m.type==="error"&&e.jsx(h.Alert,{}),e.jsx("span",{className:"font-medium text-sm",children:m.message})]})}),e.jsxs("form",{onSubmit:I,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-charcoal mb-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h.Phone,{className:"w-4 h-4 text-amber-600"}),e.jsx("span",{children:t("payment.phoneNumber")})]})}),e.jsx("input",{type:"tel",value:$,onChange:s=>R(s.target.value),placeholder:"e.g. +2507XXXXXXXX",className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent transition-all duration-200 text-charcoal placeholder-gray-400",disabled:y}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Enter your mobile money phone number"})]}),e.jsx("button",{type:"submit",disabled:y,className:`w-full flex items-center justify-center space-x-2 py-4 rounded-xl font-semibold shadow-sm transition-all duration-200 ${y?"bg-amber-400 cursor-not-allowed":"bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 hover:shadow-md"}`,children:y?e.jsxs(e.Fragment,{children:[e.jsx(h.Loading,{}),e.jsx("span",{className:"text-white text-sm",children:t("payment.processing")})]}):e.jsx("span",{className:"text-white text-sm",children:t("payment.payNow")})})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-xl border border-gray-200",children:[e.jsx("h3",{className:"text-sm font-semibold text-charcoal mb-2",children:t("payment.infoTitle")}),e.jsxs("ul",{className:"text-xs text-gray-600 space-y-1",children:[e.jsx("li",{children:"• Payments are processed via mobile money"}),e.jsx("li",{children:"• You will receive an STK push notification"}),e.jsx("li",{children:"• Standard transaction fees apply"}),e.jsx("li",{children:"• Receipts are generated automatically"})]})]})]})})]})]}),e.jsx("style",{children:`
        .text-charcoal {
          color: #1E1E1E;
        }
        .bg-amber-50 {
          background-color: #FFFBEB;
        }
        .bg-amber-500 {
          background-color: #D97706;
        }
        .bg-amber-600 {
          background-color: #B45309;
        }
        .text-amber-600 {
          color: #D97706;
        }
        .text-amber-700 {
          color: #B45309;
        }
        .border-amber-200 {
          border-color: #FCD34D;
        }
        .bg-green-50 {
          background-color: #F0FDF4;
        }
        .text-green-600 {
          color: #15803D;
        }
        .border-green-200 {
          border-color: #BBF7D0;
        }
      `})]})};export{se as default};
