import{u as Se,j as s}from"./index-DnGg16Vn.js";import{r as i}from"./react-BeLGUnOF.js";import{L as w}from"./LoadingSpinner-uLM5j9Cp.js";const p="http://localhost:4000",Ee=()=>{const{t:r}=Se(),[L,me]=i.useState(null),[xe,J]=i.useState(!1),[H,b]=i.useState(null),[I,pe]=i.useState(""),[$,A]=i.useState([]),[D,Q]=i.useState([]),[F,V]=i.useState([]),[B,U]=i.useState([]),[T,j]=i.useState([]),[W,v]=i.useState({}),[M,S]=i.useState({}),[C,O]=i.useState({}),[N,_]=i.useState({}),[G,z]=i.useState({}),[he,R]=i.useState(!1),[ue,we]=i.useState(""),[m,h]=i.useState(null),[g,K]=i.useState(!1),[X,Y]=i.useState({}),[Z,ee]=i.useState({}),[se,te]=i.useState({}),[re,ae]=i.useState({}),[le,ne]=i.useState({}),[f,y]=i.useState(null);i.useEffect(()=>{const e=localStorage.getItem("token");e&&fetch(`${p}/api/me`,{headers:{Authorization:`Bearer ${e}`}}).then(async l=>{var a;const t=await l.json();me(((a=t==null?void 0:t.user)==null?void 0:a.role)??null)}).catch(()=>{})},[]),i.useEffect(()=>{const e=localStorage.getItem("token");!e||L!=="manager"||(J(!0),b(null),fetch(`${p}/api/manager/workers-summary`,{headers:{Authorization:`Bearer ${e}`}}).then(async l=>{const t=await l.json();if(!l.ok)throw new Error((t==null?void 0:t.error)||"Failed to load workers");A(Array.isArray(t.supervisors)?t.supervisors.map(a=>({id:a.id,username:a.username,first_name:a.first_name??null,last_name:a.last_name??null,salary:a.salary!=null?Number(a.salary):null,zones:Array.isArray(a.zones)?a.zones:[]})):[]),Q(Array.isArray(t.chiefs)?t.chiefs.map(a=>({id:a.id,username:a.username,first_name:a.first_name??null,last_name:a.last_name??null,zones:Array.isArray(a.zones)?a.zones:[]})):[]),V(Array.isArray(t.manpower)?t.manpower.map(a=>({id:a.id,username:a.username,first_name:a.first_name??null,last_name:a.last_name??null,salary:a.salary!=null?Number(a.salary):null})):[]),U(Array.isArray(t.drivers)?t.drivers.map(a=>({id:a.id,username:a.username,first_name:a.first_name??null,last_name:a.last_name??null,salary:a.salary!=null?Number(a.salary):null})):[]),j(Array.isArray(t.vehicles)?t.vehicles:[])}).catch(l=>b((l==null?void 0:l.message)||"Failed to load workers")).finally(()=>J(!1)))},[L]);const c=I.toLowerCase().trim(),E=(e,l)=>{const t=(e||"").toLowerCase().trim(),a=(l||"").toLowerCase().trim(),n=[t,a].filter(Boolean).join(" ").trim();return!!n&&n.includes(c)},ie=i.useMemo(()=>c?$.filter(e=>e.username.toLowerCase().includes(c)||E(e.first_name,e.last_name)):$,[c,$]),oe=i.useMemo(()=>c?D.filter(e=>e.username.toLowerCase().includes(c)||E(e.first_name,e.last_name)):D,[c,D]),ce=i.useMemo(()=>c?F.filter(e=>e.username.toLowerCase().includes(c)||E(e.first_name,e.last_name)):F,[c,F]),de=i.useMemo(()=>c?B.filter(e=>e.username.toLowerCase().includes(c)||E(e.first_name,e.last_name)):B,[c,B]),P=i.useMemo(()=>c?T.filter(e=>(e.plate||"").toLowerCase().includes(c)):T,[c,T]);async function q(e,l){const t=localStorage.getItem("token");if(!t)return;const a=Number(l);if(Number.isFinite(a)){K(!0);try{const n=await fetch(`${p}/api/manager/salaries`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({userId:e,amount:a})}),o=await n.json();if(!n.ok)throw new Error((o==null?void 0:o.error)||"Failed to save salary");const x=d=>d.map(u=>u.id===e?{...u,salary:a}:u);V(d=>x(d)),U(d=>x(d)),A(d=>d.map(u=>u.id===e?{...u,salary:a}:u)),h(null)}catch(n){b((n==null?void 0:n.message)||"Failed to save salary")}finally{K(!1)}}}async function ge(e){const l=localStorage.getItem("token");if(l){ee(t=>({...t,[e]:!0}));try{const t=await fetch(`${p}/api/manageworkers/supervisors/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${l}`}}),a=await t.json().catch(()=>({}));if(!t.ok)throw new Error((a==null?void 0:a.error)||"Failed to delete");A(n=>n.filter(o=>o.id!==e)),j(n=>n.map(o=>o.supervisor_id===e?{...o,supervisor_id:null}:o))}catch(t){b((t==null?void 0:t.message)||"Failed to delete supervisor")}finally{ee(t=>({...t,[e]:!1}))}}}async function fe(e){const l=localStorage.getItem("token");if(l){te(t=>({...t,[e]:!0}));try{const t=await fetch(`${p}/api/manageworkers/drivers/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${l}`}}),a=await t.json().catch(()=>({}));if(!t.ok)throw new Error((a==null?void 0:a.error)||"Failed to delete");U(n=>n.filter(o=>o.id!==e))}catch(t){b((t==null?void 0:t.message)||"Failed to delete driver")}finally{te(t=>({...t,[e]:!1}))}}}async function ye(e){const l=localStorage.getItem("token");if(l){ae(t=>({...t,[e]:!0}));try{const t=await fetch(`${p}/api/manageworkers/chiefs/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${l}`}}),a=await t.json().catch(()=>({}));if(!t.ok)throw new Error((a==null?void 0:a.error)||"Failed to delete");Q(n=>n.filter(o=>o.id!==e))}catch(t){b((t==null?void 0:t.message)||"Failed to delete chief")}finally{ae(t=>({...t,[e]:!1}))}}}async function be(e){const l=localStorage.getItem("token");if(l){ne(t=>({...t,[e]:!0}));try{const t=await fetch(`${p}/api/manageworkers/vehicles/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${l}`}}),a=await t.json().catch(()=>({}));if(!t.ok)throw new Error((a==null?void 0:a.error)||"Failed to delete");j(n=>n.filter(o=>o.id!==e)),v(n=>({...n,[e]:!1}))}catch(t){b((t==null?void 0:t.message)||"Failed to delete vehicle")}finally{ne(t=>({...t,[e]:!1}))}}}async function je(e){const l=localStorage.getItem("token");if(l){Y(t=>({...t,[e]:!0}));try{const t=await fetch(`${p}/api/manageworkers/manpower/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${l}`}}),a=await t.json().catch(()=>({}));if(!t.ok)throw new Error((a==null?void 0:a.error)||"Failed to delete");V(n=>n.filter(o=>o.id!==e))}catch(t){b((t==null?void 0:t.message)||"Failed to delete manpower")}finally{Y(t=>({...t,[e]:!1}))}}}function Ne(){if(!f)return;const{type:e,id:l}=f;switch(y(null),e){case"supervisor":ge(l);break;case"driver":fe(l);break;case"chief":ye(l);break;case"manpower":je(l);break;case"vehicle":be(l);break;case"veh_image":ve(l);break}}async function ke(e){const l=localStorage.getItem("token");if(l){z(t=>({...t,[e]:null})),_(t=>({...t,[e]:!0}));try{let t=C[e]||"";const a=M[e]||null;if(a){const x=await fetch(`${p}/api/manager/vehicles/upload-base64`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({dataUrl:a})}),d=await x.json();if(!x.ok)throw new Error((d==null?void 0:d.error)||"Failed to upload image");t=d.image_url||t}if(!t)throw new Error("Please choose a file or paste an image URL");const n=await fetch(`${p}/api/manager/vehicles/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({imageUrl:t})}),o=await n.json();if(!n.ok)throw new Error((o==null?void 0:o.error)||"Failed to update vehicle");j(x=>x.map(d=>{var u;return d.id===e?{...d,image_url:((u=o.vehicle)==null?void 0:u.image_url)??t}:d})),v(x=>({...x,[e]:!1})),S(x=>({...x,[e]:null})),O(x=>({...x,[e]:""}))}catch(t){z(a=>({...a,[e]:(t==null?void 0:t.message)||"Failed to save image"}))}finally{_(t=>({...t,[e]:!1}))}}}async function ve(e){const l=localStorage.getItem("token");if(l){z(t=>({...t,[e]:null})),_(t=>({...t,[e]:!0}));try{const t=await fetch(`${p}/api/manager/vehicles/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({imageUrl:null})}),a=await t.json();if(!t.ok)throw new Error((a==null?void 0:a.error)||"Failed to delete image");j(n=>n.map(o=>o.id===e?{...o,image_url:null}:o)),v(n=>({...n,[e]:!1})),S(n=>({...n,[e]:null})),O(n=>({...n,[e]:""}))}catch(t){z(a=>({...a,[e]:(t==null?void 0:t.message)||"Failed to delete image"}))}finally{_(t=>({...t,[e]:!1}))}}}const k=({label:e,target:l})=>s.jsx("a",{href:l,className:"px-2 py-1 sm:px-3 rounded bg-amber-100 text-amber-800 hover:bg-amber-200 text-xs sm:text-sm whitespace-nowrap",children:e});return L!=="manager"?s.jsxs("div",{className:"p-6",children:[s.jsx("h2",{className:"text-2xl font-bold mb-4",children:r("workers.title")}),s.jsx("div",{className:"text-red-600",children:r("workers.onlyManagers")})]}):s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h2",{className:"text-2xl font-bold",children:r("workers.title")}),s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.jsx(k,{label:r("workers.quick.supervisors"),target:"#supervisors"}),s.jsx(k,{label:r("workers.quick.chiefs"),target:"#chiefs"}),s.jsx(k,{label:r("workers.quick.manpower"),target:"#manpower"}),s.jsx(k,{label:r("workers.quick.drivers"),target:"#drivers"}),s.jsx(k,{label:r("workers.quick.vehicles"),target:"#vehicles"})]})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm text-gray-700",children:r("workers.search")}),s.jsx("input",{value:I,onChange:e=>pe(e.target.value),className:"mt-1 border rounded px-3 py-2 w-full max-w-md",placeholder:r("workers.search.placeholder")})]}),H&&s.jsx("div",{className:"text-red-600 mb-3",children:H}),xe?s.jsxs("div",{className:"py-12 flex items-center gap-3 text-amber-700",children:[s.jsx(w,{size:24}),s.jsx("span",{children:r("workers.loading")})]}):s.jsxs("div",{className:"space-y-8",children:[s.jsxs("section",{id:"supervisors",className:"bg-white rounded-lg shadow overflow-hidden",children:[s.jsx("div",{className:"px-4 py-3 font-semibold border-b",children:r("workers.section.supervisors")}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"min-w-[720px] sm:min-w-full text-sm",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-4 py-3 text-left",children:r("workers.col.name")}),s.jsx("th",{className:"px-4 py-3 text-left",children:r("workers.col.username")}),s.jsx("th",{className:"px-4 py-3 text-left",children:r("workers.col.zones")}),s.jsx("th",{className:"px-4 py-3 text-right",children:r("workers.col.salary")}),s.jsx("th",{className:"px-4 py-3 text-left",children:r("workers.col.action")})]})}),s.jsxs("tbody",{children:[ie.map(e=>{var l;return s.jsxs("tr",{className:"border-t",children:[s.jsx("td",{className:"px-4 py-3",children:[e.first_name,e.last_name].filter(Boolean).join(" ")||"-"}),s.jsx("td",{className:"px-4 py-3",children:e.username}),s.jsx("td",{className:"px-4 py-3",children:(l=e.zones)!=null&&l.length?e.zones.map(t=>t.name).join(", "):"-"}),s.jsx("td",{className:"px-4 py-3 text-right",children:e.salary!=null?Number(e.salary).toLocaleString():"-"}),s.jsx("td",{className:"px-4 py-3",children:(m==null?void 0:m.userId)===e.id?s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"number",className:"border rounded px-2 py-1 w-32",value:m.amount,onChange:t=>h({userId:e.id,amount:t.target.value})}),s.jsxs("button",{disabled:g,onClick:()=>q(e.id,m.amount),className:"px-2 sm:px-3 py-1 rounded bg-green-600 text-white text-xs sm:text-sm whitespace-nowrap flex items-center gap-2",children:[g&&s.jsx(w,{size:14,className:"border-white/40 border-t-white"}),s.jsx("span",{children:r("workers.btn.save")})]}),s.jsx("button",{disabled:g,onClick:()=>h(null),className:"px-2 sm:px-3 py-1 rounded bg-gray-200 text-xs sm:text-sm whitespace-nowrap",children:r("workers.btn.cancel")})]}):s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>h({userId:e.id,amount:e.salary!=null?String(e.salary):""}),className:"px-2 sm:px-3 py-1 rounded bg-amber-500 text-black text-xs sm:text-sm whitespace-nowrap",children:r("workers.btn.editSalary")}),s.jsxs("button",{disabled:!!Z[e.id],onClick:()=>y({type:"supervisor",id:e.id}),className:"px-2 sm:px-3 py-1 rounded bg-red-600 text-white text-xs sm:text-sm whitespace-nowrap flex items-center gap-2",children:[Z[e.id]&&s.jsx(w,{size:14,className:"border-white/40 border-t-white"}),s.jsx("span",{children:r("workers.btn.delete")})]})]})})]},e.id)}),!ie.length&&s.jsx("tr",{children:s.jsx("td",{className:"px-4 py-6 text-gray-500",colSpan:4,children:r("workers.empty.supervisors")})})]})]})})]}),he&&s.jsx("div",{className:"fixed inset-0 z-50 bg-black/70 flex items-center justify-center p-4",role:"dialog","aria-modal":"true",onClick:()=>R(!1),children:s.jsxs("div",{className:"relative max-w-4xl w-full",onClick:e=>e.stopPropagation(),children:[s.jsx("img",{src:ue,alt:r("workers.viewer.alt"),className:"w-full h-auto rounded-lg shadow-lg"}),s.jsx("button",{type:"button",onClick:()=>R(!1),className:"absolute top-2 right-2 inline-flex items-center justify-center rounded-full bg-black/60 text-white w-9 h-9 hover:bg-black/80 focus:outline-none focus:ring-2 focus:ring-amber-500","aria-label":r("workers.viewer.close"),children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-5 h-5",children:s.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})}),s.jsxs("section",{id:"chiefs",className:"bg-white rounded-lg shadow overflow-hidden",children:[s.jsx("div",{className:"px-4 py-3 font-semibold border-b",children:r("workers.section.chiefs")}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"min-w-[720px] sm:min-w-full text-sm",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-4 py-3 text-left",children:r("workers.col.name")}),s.jsx("th",{className:"px-4 py-3 text-left",children:r("workers.col.username")}),s.jsx("th",{className:"px-4 py-3 text-left",children:r("workers.col.zones")}),s.jsx("th",{className:"px-4 py-3 text-left",children:r("workers.col.action")})]})}),s.jsxs("tbody",{children:[oe.map(e=>{var l;return s.jsxs("tr",{className:"border-t",children:[s.jsx("td",{className:"px-4 py-3",children:[e.first_name,e.last_name].filter(Boolean).join(" ")||"-"}),s.jsx("td",{className:"px-4 py-3",children:e.username}),s.jsx("td",{className:"px-4 py-3",children:(l=e.zones)!=null&&l.length?e.zones.map(t=>t.name).join(", "):"-"}),s.jsx("td",{className:"px-4 py-3",children:s.jsxs("button",{disabled:!!re[e.id],onClick:()=>y({type:"chief",id:e.id}),className:"px-2 sm:px-3 py-1 rounded bg-red-600 text-white text-xs sm:text-sm whitespace-nowrap flex items-center gap-2",children:[re[e.id]&&s.jsx(w,{size:14,className:"border-white/40 border-t-white"}),s.jsx("span",{children:r("workers.btn.delete")})]})})]},e.id)}),!oe.length&&s.jsx("tr",{children:s.jsx("td",{className:"px-4 py-6 text-gray-500",colSpan:2,children:r("workers.empty.chiefs")})})]})]})})]}),s.jsxs("section",{id:"manpower",className:"bg-white rounded-lg shadow overflow-hidden",children:[s.jsx("div",{className:"px-4 py-3 font-semibold border-b",children:r("workers.section.manpower")}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"min-w-[720px] sm:min-w-full text-sm",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-4 py-3 text-left",children:r("workers.col.name")}),s.jsx("th",{className:"px-4 py-3 text-left",children:r("workers.col.username")}),s.jsx("th",{className:"px-4 py-3 text-right",children:r("workers.col.salary")}),s.jsx("th",{className:"px-4 py-3 text-left",children:r("workers.col.action")})]})}),s.jsxs("tbody",{children:[ce.map(e=>s.jsxs("tr",{className:"border-t",children:[s.jsx("td",{className:"px-4 py-3",children:[e.first_name,e.last_name].filter(Boolean).join(" ")||"-"}),s.jsx("td",{className:"px-4 py-3",children:e.username}),s.jsx("td",{className:"px-4 py-3 text-right",children:e.salary!=null?Number(e.salary).toLocaleString():"-"}),s.jsx("td",{className:"px-4 py-3",children:(m==null?void 0:m.userId)===e.id?s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"number",className:"border rounded px-2 py-1 w-32",value:m.amount,onChange:l=>h({userId:e.id,amount:l.target.value})}),s.jsxs("button",{disabled:g,onClick:()=>q(e.id,m.amount),className:"px-2 sm:px-3 py-1 rounded bg-green-600 text-white text-xs sm:text-sm whitespace-nowrap flex items-center gap-2",children:[g&&s.jsx(w,{size:14,className:"border-white/40 border-t-white"}),s.jsx("span",{children:r("workers.btn.save")})]}),s.jsx("button",{disabled:g,onClick:()=>h(null),className:"px-2 sm:px-3 py-1 rounded bg-gray-200 text-xs sm:text-sm whitespace-nowrap",children:r("workers.btn.cancel")})]}):s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>h({userId:e.id,amount:e.salary!=null?String(e.salary):""}),className:"px-2 sm:px-3 py-1 rounded bg-amber-500 text-black text-xs sm:text-sm whitespace-nowrap",children:r("workers.btn.editSalary")}),s.jsxs("button",{disabled:!!X[e.id],onClick:()=>y({type:"manpower",id:e.id}),className:"px-2 sm:px-3 py-1 rounded bg-red-600 text-white text-xs sm:text-sm whitespace-nowrap flex items-center gap-2",children:[X[e.id]&&s.jsx(w,{size:14,className:"border-white/40 border-t-white"}),s.jsx("span",{children:r("workers.btn.delete")})]})]})})]},e.id)),!ce.length&&s.jsx("tr",{children:s.jsx("td",{className:"px-4 py-6 text-gray-500",colSpan:3,children:r("workers.empty.manpower")})})]})]})})]}),s.jsxs("section",{id:"drivers",className:"bg-white rounded-lg shadow overflow-hidden",children:[s.jsx("div",{className:"px-4 py-3 font-semibold border-b",children:r("workers.section.drivers")}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"min-w-[720px] sm:min-w-full text-sm",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-4 py-3 text-left",children:r("workers.col.name")}),s.jsx("th",{className:"px-4 py-3 text-left",children:r("workers.col.username")}),s.jsx("th",{className:"px-4 py-3 text-right",children:r("workers.col.salary")}),s.jsx("th",{className:"px-4 py-3 text-left",children:r("workers.col.action")})]})}),s.jsxs("tbody",{children:[de.map(e=>s.jsxs("tr",{className:"border-t",children:[s.jsx("td",{className:"px-4 py-3",children:[e.first_name,e.last_name].filter(Boolean).join(" ")||"-"}),s.jsx("td",{className:"px-4 py-3",children:e.username}),s.jsx("td",{className:"px-4 py-3 text-right",children:e.salary!=null?Number(e.salary).toLocaleString():"-"}),s.jsx("td",{className:"px-4 py-3",children:(m==null?void 0:m.userId)===e.id?s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"number",className:"border rounded px-2 py-1 w-32",value:m.amount,onChange:l=>h({userId:e.id,amount:l.target.value})}),s.jsxs("button",{disabled:g,onClick:()=>q(e.id,m.amount),className:"px-2 sm:px-3 py-1 rounded bg-green-600 text-white text-xs sm:text-sm whitespace-nowrap flex items-center gap-2",children:[g&&s.jsx(w,{size:14,className:"border-white/40 border-t-white"}),s.jsx("span",{children:r("workers.btn.save")})]}),s.jsx("button",{disabled:g,onClick:()=>h(null),className:"px-2 sm:px-3 py-1 rounded bg-gray-200 text-xs sm:text-sm whitespace-nowrap",children:r("workers.btn.cancel")})]}):s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>h({userId:e.id,amount:e.salary!=null?String(e.salary):""}),className:"px-2 sm:px-3 py-1 rounded bg-amber-500 text-black text-xs sm:text-sm whitespace-nowrap",children:r("workers.btn.editSalary")}),s.jsxs("button",{disabled:!!se[e.id],onClick:()=>y({type:"driver",id:e.id}),className:"px-2 sm:px-3 py-1 rounded bg-red-600 text-white text-xs sm:text-sm whitespace-nowrap flex items-center gap-2",children:[se[e.id]&&s.jsx(w,{size:14,className:"border-white/40 border-t-white"}),s.jsx("span",{children:r("workers.btn.delete")})]})]})})]},e.id)),!de.length&&s.jsx("tr",{children:s.jsx("td",{className:"px-4 py-6 text-gray-500",colSpan:3,children:r("workers.empty.drivers")})})]})]})})]}),s.jsxs("section",{id:"vehicles",className:"bg-white rounded-lg shadow overflow-hidden",children:[s.jsx("div",{className:"px-4 py-3 font-semibold border-b",children:r("workers.section.vehicles")}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"min-w-[720px] sm:min-w-full text-sm",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-4 py-3 text-left",children:r("workers.col.image")}),s.jsx("th",{className:"px-4 py-3 text-left",children:r("workers.col.plate")}),s.jsx("th",{className:"px-4 py-3 text-left",children:r("workers.col.make")}),s.jsx("th",{className:"px-4 py-3 text-left",children:r("workers.col.model")}),s.jsx("th",{className:"px-4 py-3 text-left",children:r("workers.col.supervisorId")}),s.jsx("th",{className:"px-4 py-3 text-left",children:r("workers.col.actions")})]})}),s.jsxs("tbody",{children:[P.map(e=>s.jsxs("tr",{className:"border-t",children:[s.jsx("td",{className:"px-4 py-3",children:e.image_url?s.jsx("button",{type:"button",onClick:()=>{we(e.image_url),R(!0)},title:r("workers.viewer.title"),children:s.jsx("img",{src:e.image_url,alt:e.plate,className:"w-20 h-12 object-cover rounded border"})}):s.jsx("span",{className:"text-gray-400",children:r("workers.noImage")})}),s.jsx("td",{className:"px-4 py-3",children:e.plate}),s.jsx("td",{className:"px-4 py-3",children:e.make||""}),s.jsx("td",{className:"px-4 py-3",children:e.model||""}),s.jsx("td",{className:"px-4 py-3",children:e.supervisor_id??""}),s.jsxs("td",{className:"px-4 py-3 flex flex-wrap gap-2",children:[s.jsx("button",{className:"px-2 sm:px-3 py-1 rounded bg-amber-500 text-black text-xs sm:text-sm whitespace-nowrap",onClick:()=>v(l=>({...l,[e.id]:!l[e.id]})),children:W[e.id]?r("workers.btn.close"):r("workers.btn.editImage")}),e.image_url&&s.jsxs("button",{className:"px-2 sm:px-3 py-1 rounded bg-red-600 text-white hover:bg-red-700 text-xs sm:text-sm whitespace-nowrap flex items-center gap-2",disabled:!!N[e.id],onClick:()=>y({type:"veh_image",id:e.id}),children:[N[e.id]&&s.jsx(w,{size:14,className:"border-white/40 border-t-white"}),s.jsx("span",{children:r("workers.btn.deleteImage")})]}),s.jsxs("button",{className:"px-2 sm:px-3 py-1 rounded bg-red-700 text-white hover:bg-red-800 text-xs sm:text-sm whitespace-nowrap flex items-center gap-2",disabled:!!le[e.id],onClick:()=>y({type:"vehicle",id:e.id}),children:[le[e.id]&&s.jsx(w,{size:14,className:"border-white/40 border-t-white"}),s.jsx("span",{children:r("workers.btn.deleteVehicle")})]})]})]},e.id)),!P.length&&s.jsx("tr",{children:s.jsx("td",{className:"px-4 py-6 text-gray-500",colSpan:6,children:r("workers.empty.vehicles")})})]})]})}),s.jsx("div",{className:"divide-y",children:P.map(e=>W[e.id]?s.jsxs("div",{className:"p-4",children:[G[e.id]&&s.jsx("div",{className:"text-red-600 mb-2 text-sm",children:G[e.id]}),s.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3",children:[s.jsx("input",{type:"file",accept:"image/*",onChange:l=>{var n;const t=(n=l.target.files)==null?void 0:n[0];if(!t){S(o=>({...o,[e.id]:null}));return}const a=new FileReader;a.onload=()=>S(o=>({...o,[e.id]:String(a.result||"")})),a.readAsDataURL(t)}}),s.jsx("input",{type:"url",placeholder:"Or paste image URL",value:C[e.id]??"",onChange:l=>O(t=>({...t,[e.id]:l.target.value})),className:"w-full sm:w-80 border rounded px-3 py-2"}),s.jsx("button",{className:`px-2 sm:px-3 py-1 rounded text-white ${N[e.id]?"bg-amber-400":"bg-amber-600 hover:bg-amber-700"}`,disabled:!!N[e.id],onClick:()=>ke(e.id),children:N[e.id]?"Savingâ€¦":"Save Image"})]}),(M[e.id]||C[e.id])&&s.jsx("div",{className:"mt-3",children:s.jsx("img",{src:M[e.id]||C[e.id],alt:"Preview",className:"max-h-40 rounded border"})})]},`edit-${e.id}`):null)})]})]}),f&&s.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 flex items-center justify-center p-4",role:"dialog","aria-modal":"true",onClick:()=>y(null),children:s.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-md w-full p-5",onClick:e=>e.stopPropagation(),children:[s.jsx("h3",{className:"text-lg font-semibold mb-2",children:r("workers.modal.title")}),s.jsxs("p",{className:"text-sm text-gray-700 mb-4",children:[f.type==="supervisor"&&r("workers.modal.msg.supervisor"),f.type==="driver"&&r("workers.modal.msg.driver"),f.type==="chief"&&r("workers.modal.msg.chief"),f.type==="manpower"&&r("workers.modal.msg.manpower"),f.type==="vehicle"&&r("workers.modal.msg.vehicle"),f.type==="veh_image"&&r("workers.modal.msg.veh_image")]}),s.jsxs("div",{className:"flex items-center justify-end gap-2",children:[s.jsx("button",{type:"button",onClick:()=>y(null),className:"px-3 py-1.5 rounded bg-gray-200 text-sm",children:r("workers.btn.cancel")}),s.jsx("button",{type:"button",onClick:Ne,className:"px-3 py-1.5 rounded bg-red-600 text-white text-sm",children:r("workers.btn.delete")})]})]})})]})};export{Ee as default};
