import{j as e}from"./index-8yk-1D8L.js";import{g as I,f as W,r as m}from"./react-CzDbI3ao.js";const h="http://localhost:4000",s={primary:"#D97706",primaryHover:"#B45309",accent:"#15803D",accentHover:"#166534",background:"#F9FAFB",cardBg:"#FFFFFF",border:"#E5E7EB",text:"#1E1E1E",textLight:"#6B7280",error:"#DC2626"},i={Back:t=>{const{className:a,...o}=t;return e.jsx("svg",{...o,className:["w-4 h-4",a].filter(Boolean).join(" "),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})},Calendar:t=>{const{className:a,...o}=t;return e.jsx("svg",{...o,className:["w-5 h-5",a].filter(Boolean).join(" "),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})},Vehicle:t=>{const{className:a,...o}=t;return e.jsx("svg",{...o,className:["w-5 h-5",a].filter(Boolean).join(" "),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})})},Driver:t=>{const{className:a,...o}=t;return e.jsx("svg",{...o,className:["w-5 h-5",a].filter(Boolean).join(" "),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})},Manpower:t=>{const{className:a,...o}=t;return e.jsx("svg",{...o,className:["w-5 h-5",a].filter(Boolean).join(" "),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})},Save:t=>{const{className:a,...o}=t;return e.jsx("svg",{...o,className:["w-4 h-4",a].filter(Boolean).join(" "),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})},Add:t=>{const{className:a,...o}=t;return e.jsx("svg",{...o,className:["w-4 h-4",a].filter(Boolean).join(" "),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})},Remove:t=>{const{className:a,...o}=t;return e.jsx("svg",{...o,className:["w-4 h-4",a].filter(Boolean).join(" "),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})},Schedule:t=>{const{className:a,...o}=t;return e.jsx("svg",{...o,className:["w-4 h-4",a].filter(Boolean).join(" "),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}};function D(t){return new Date(2e3,0,t).toLocaleString(void 0,{weekday:"long"})}const v=({title:t,number:a})=>e.jsxs("div",{className:"flex items-center gap-3 mb-4 md:mb-6 pb-3 border-b",style:{borderColor:s.border},children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm",style:{backgroundColor:s.primary},children:a}),e.jsx("h2",{className:"text-2xl font-bold",style:{color:s.text},children:t})]}),x=({children:t,className:a=""})=>e.jsx("div",{className:`rounded-lg shadow-sm border p-4 sm:p-5 md:p-6 ${a}`,style:{backgroundColor:s.cardBg,borderColor:s.border},children:t}),N=({children:t,onClick:a,disabled:o=!1,loading:d=!1,className:p=""})=>e.jsx("button",{onClick:a,disabled:o||d,className:`px-4 py-2 rounded-lg font-medium text-white transition-colors flex items-center gap-2 ${p}`,style:{backgroundColor:o?s.textLight:s.primary,cursor:o?"not-allowed":"pointer"},onMouseOver:c=>{!o&&!d&&(c.currentTarget.style.backgroundColor=s.primaryHover)},onMouseOut:c=>{!o&&!d&&(c.currentTarget.style.backgroundColor=s.primary)},children:t}),k=({children:t,onClick:a,disabled:o=!1,loading:d=!1,className:p=""})=>e.jsx("button",{onClick:a,disabled:o||d,className:`px-4 py-2 rounded-lg font-medium text-white transition-colors flex items-center gap-2 ${p}`,style:{backgroundColor:o?s.textLight:s.accent,cursor:o?"not-allowed":"pointer"},onMouseOver:c=>{!o&&!d&&(c.currentTarget.style.backgroundColor=s.accentHover)},onMouseOut:c=>{!o&&!d&&(c.currentTarget.style.backgroundColor=s.accent)},children:t}),J=()=>{const{id:t}=I(),a=W(),[o,d]=m.useState(null),[p,c]=m.useState(!1),[w,C]=m.useState(null),[y,S]=m.useState([]),[f,B]=m.useState({}),[b,z]=m.useState({}),[,$]=m.useState({}),[M,L]=m.useState("");function u(){const r=localStorage.getItem("token");!r||!t||(c(!0),C(null),fetch(`${h}/api/supervisor/zones/${t}/supervision`,{headers:{Authorization:`Bearer ${r}`}}).then(async n=>{const l=await n.json();if(!n.ok)throw new Error((l==null?void 0:l.error)||"Failed to load");d(l),S(l.serviceDays||[]);const j={};for(const g of l.driverAssignments||[])j[g.weekday]=String(g.driver_user_id);B(j);const A={};for(const g of l.drivers||[])A[g.id]=new Set(g.assigned_manpowers||[]);$(A)}).catch(n=>C((n==null?void 0:n.message)||"Failed to load")).finally(()=>c(!1)))}m.useEffect(()=>{u()},[t]);function V(r){S(n=>n.includes(r)?n.filter(l=>l!==r):[...n,r])}async function E(){const r=localStorage.getItem("token");!r||!t||(await fetch(`${h}/api/supervisor/zones/${t}/service-days`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({days:y})}),u())}async function F(r){const n=localStorage.getItem("token");if(!n||!t)return;const l=Number(f[r]);l&&(await fetch(`${h}/api/supervisor/zones/${t}/driver`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({weekday:r,driverUserId:l})}),u())}async function H(r){const n=localStorage.getItem("token");if(!n||!t)return;const l=Number(b[r]);l&&(await fetch(`${h}/api/supervisor/zones/${t}/driver/vehicle`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({driverUserId:l,vehicleId:r})}),u())}async function _(){const r=localStorage.getItem("token");if(!r||!t)return;const n=Number(M);n&&(await fetch(`${h}/api/supervisor/zones/${t}/manpower`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({userId:n})}),L(""),u())}async function T(r){const n=localStorage.getItem("token");!n||!t||(await fetch(`${h}/api/supervisor/zones/${t}/manpower/${r}`,{method:"DELETE",headers:{Authorization:`Bearer ${n}`}}),u())}return p?e.jsx("div",{className:"min-h-screen p-0 sm:p-2 md:p-4",style:{backgroundColor:s.background},children:e.jsx("div",{className:"max-w-none md:max-w-6xl mx-auto space-y-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 rounded w-48 mb-6",style:{backgroundColor:s.border}}),e.jsx("div",{className:"grid gap-6",children:[...Array(5)].map((r,n)=>e.jsx("div",{className:"h-32 rounded-lg",style:{backgroundColor:s.border}},n))})]})})}):w?e.jsx("div",{className:"min-h-screen p-0 sm:p-2 md:p-4",style:{backgroundColor:s.background},children:e.jsx("div",{className:"max-w-none md:max-w-6xl mx-auto",children:e.jsx(x,{children:e.jsx("div",{className:"text-center p-6 rounded-lg",style:{backgroundColor:"#FEF2F2",borderColor:s.error},children:e.jsx("div",{style:{color:s.error},className:"font-medium",children:w})})})})}):o?e.jsx("div",{className:"min-h-screen p-0 sm:p-2 md:p-4",style:{backgroundColor:s.background},children:e.jsxs("div",{className:"max-w-none md:max-w-6xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("button",{onClick:()=>a(-1),className:"flex items-center space-x-2 transition-colors duration-200",style:{color:s.textLight},children:[e.jsx(i.Back,{}),e.jsx("span",{className:"font-medium",children:"Back to Zones"})]}),e.jsx("div",{className:"w-px h-6",style:{backgroundColor:s.border}}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",style:{color:s.text},children:"Zone Supervision"}),e.jsxs("p",{className:"mt-1",style:{color:s.textLight},children:["Manage ",o.zone.name," operations and assignments"]})]})]}),e.jsxs(k,{onClick:()=>a(`/supervisor/zones/${o.zone.id}/schedule`),className:"hidden md:flex px-6 py-3",children:[e.jsx(i.Schedule,{}),e.jsx("span",{children:"Plan Service Schedule"})]})]}),e.jsx("div",{className:"md:hidden",children:e.jsx(x,{children:e.jsxs(k,{onClick:()=>a(`/supervisor/zones/${o.zone.id}/schedule`),className:"w-full justify-center py-3",children:[e.jsx(i.Schedule,{}),e.jsx("span",{children:"Plan Service Schedule"})]})})}),e.jsxs("section",{children:[e.jsx(v,{title:"Supervisor Vehicles",number:1}),e.jsxs(x,{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(i.Vehicle,{style:{color:s.primary}}),e.jsx("h3",{className:"text-lg font-semibold",style:{color:s.text},children:"Your Assigned Vehicles"})]}),e.jsx("div",{children:o.supervisorVehicles&&o.supervisorVehicles.length?e.jsx("div",{className:"flex flex-wrap gap-3",children:o.supervisorVehicles.map(r=>e.jsx("span",{className:"px-4 py-2 rounded-lg font-medium border",style:{backgroundColor:"#FEF7ED",borderColor:s.primary,color:s.primary},children:r.plate},r.id))}):e.jsx("div",{style:{color:s.textLight},className:"italic",children:"No vehicles assigned to you yet"})})]})]}),e.jsxs("section",{children:[e.jsx(v,{title:"Service Days Configuration",number:2}),e.jsxs(x,{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-6",children:[e.jsx(i.Calendar,{style:{color:s.primary}}),e.jsx("h3",{className:"text-lg font-semibold",style:{color:s.text},children:"Active Service Days"})]}),e.jsx("div",{className:"flex flex-wrap gap-3 mb-6",children:Array.from({length:7}).map((r,n)=>{const l=n+1,j=y.includes(l);return e.jsx("button",{onClick:()=>V(l),className:`px-4 py-3 rounded-lg border font-medium transition-all duration-200 ${j?"text-white shadow-lg":"border hover:shadow-md"}`,style:j?{backgroundColor:s.primary,borderColor:s.primary}:{backgroundColor:s.cardBg,color:s.text,borderColor:s.border},children:D(l)},l)})}),e.jsxs(k,{onClick:E,className:"px-6 py-3",children:[e.jsx(i.Save,{}),e.jsx("span",{children:"Save Service Days"})]})]})]}),e.jsxs("section",{children:[e.jsx(v,{title:"Driver Assignments",number:3}),e.jsxs(x,{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-6",children:[e.jsx(i.Driver,{style:{color:s.primary}}),e.jsx("h3",{className:"text-lg font-semibold",style:{color:s.text},children:"Weekly Driver Schedule"})]}),y.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:y.sort((r,n)=>r-n).map(r=>e.jsxs("div",{className:"rounded-lg p-4 border",style:{backgroundColor:s.background,borderColor:s.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-lg",style:{color:s.text},children:D(r)}),e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:s.primary}})]}),e.jsxs("select",{className:"w-full rounded-lg px-4 py-3 mb-4 focus:outline-none focus:ring-2 border",style:{backgroundColor:s.cardBg,borderColor:s.border,color:s.text},value:f[r]||"",onChange:n=>B({...f,[r]:n.target.value}),children:[e.jsx("option",{value:"",children:"Select driver…"}),o.drivers.map(n=>e.jsxs("option",{value:n.id,children:[n.username," ",n.vehicle_plate?`(${n.vehicle_plate})`:""]},n.id))]}),e.jsxs(N,{onClick:()=>F(r),className:"w-full justify-center py-3",children:[e.jsx(i.Save,{}),e.jsx("span",{children:"Assign Driver"})]})]},r))}):e.jsxs("div",{className:"text-center py-8 rounded-lg border",style:{backgroundColor:s.background,borderColor:s.border},children:[e.jsx(i.Calendar,{className:"w-12 h-12 mx-auto mb-3",style:{color:s.textLight}}),e.jsx("div",{style:{color:s.textLight},children:"Select service days above to assign drivers"})]})]})]}),e.jsxs("section",{children:[e.jsx(v,{title:"Vehicle Management",number:4}),e.jsxs(x,{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-6",children:[e.jsx(i.Vehicle,{style:{color:s.primary}}),e.jsx("h3",{className:"text-lg font-semibold",style:{color:s.text},children:"Driver Vehicle Assignments"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:o.vehicles.map(r=>{const n=o.drivers.find(l=>l.vehicle_id===r.id)||null;return e.jsxs("div",{className:"rounded-lg p-4 border",style:{backgroundColor:s.background,borderColor:s.border},children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(i.Vehicle,{className:"w-4 h-4",style:{color:s.primary}}),e.jsxs("h4",{className:"font-semibold",style:{color:s.text},children:["Vehicle ",r.plate]})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",style:{color:s.text},children:"Current driver:"})," ",n?e.jsx("span",{style:{color:s.text},children:n.username}):e.jsx("span",{style:{color:s.error},children:"None assigned"})]}),Array.isArray(r.assigned_manpower_users)&&e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium mb-1",style:{color:s.text},children:"Assigned Manpower:"}),r.assigned_manpower_users.length?e.jsx("div",{className:"space-y-1",children:r.assigned_manpower_users.map(l=>e.jsxs("div",{className:"px-2 py-1 rounded",style:{backgroundColor:s.cardBg,color:s.text},children:[l.username," (#",l.id,")"]},l.id))}):e.jsx("div",{style:{color:s.textLight},className:"italic",children:"None assigned"})]})]}),e.jsxs("select",{className:"w-full rounded-lg px-4 py-3 mb-3 focus:outline-none focus:ring-2 border",style:{backgroundColor:s.cardBg,borderColor:s.border,color:s.text},value:b[r.id]||"",onChange:l=>z({...b,[r.id]:l.target.value}),children:[e.jsx("option",{value:"",children:"Select driver…"}),o.drivers.map(l=>e.jsx("option",{value:l.id,children:l.username},l.id))]}),e.jsxs(N,{onClick:()=>H(r.id),className:"w-full justify-center py-3",children:[e.jsx(i.Save,{}),e.jsx("span",{children:"Assign Driver"})]})]},r.id)})})]})]}),e.jsxs("section",{children:[e.jsx(v,{title:"Manpower Management",number:5}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(x,{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(i.Add,{style:{color:s.primary}}),e.jsx("h3",{className:"text-lg font-semibold",style:{color:s.text},children:"Add New Manpower"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("input",{className:"flex-1 w-full rounded-lg px-4 py-3 focus:outline-none focus:ring-2 border",style:{backgroundColor:s.cardBg,borderColor:s.border,color:s.text},placeholder:"Enter manpower user ID",value:M,onChange:r=>L(r.target.value),type:"number"}),e.jsxs(N,{onClick:_,className:"w-full sm:w-auto justify-center px-6 py-3",children:[e.jsx(i.Add,{}),e.jsx("span",{children:"Add Manpower"})]})]})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-6",children:[e.jsx(i.Manpower,{style:{color:s.primary}}),e.jsx("h3",{className:"text-lg font-semibold",style:{color:s.text},children:"Assigned Manpower"})]}),o.manpower.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:o.manpower.map(r=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg p-4 border",style:{backgroundColor:s.background,borderColor:s.border},children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",style:{color:s.text},children:r.username}),e.jsxs("div",{className:"text-sm",style:{color:s.textLight},children:["ID: #",r.id]})]}),e.jsxs("button",{onClick:()=>T(r.id),className:"flex items-center space-x-1 px-3 py-2 rounded-lg font-medium transition-colors duration-200",style:{backgroundColor:"#FEF2F2",color:s.error},children:[e.jsx(i.Remove,{}),e.jsx("span",{className:"text-sm",children:"Remove"})]})]},r.id))}):e.jsxs("div",{className:"text-center py-8 rounded-lg border",style:{backgroundColor:s.background,borderColor:s.border},children:[e.jsx(i.Manpower,{className:"w-12 h-12 mx-auto mb-3",style:{color:s.textLight}}),e.jsx("div",{style:{color:s.textLight},children:"No manpower assigned to this zone"})]})]})]})]})]})}):e.jsx("div",{className:"min-h-screen p-0 sm:p-2 md:p-4",style:{backgroundColor:s.background},children:e.jsx("div",{className:"max-w-none md:max-w-6xl mx-auto",children:e.jsx(x,{children:e.jsx("div",{className:"text-center",children:e.jsx("div",{style:{color:s.textLight},children:"Zone not found"})})})})})};export{J as default};
