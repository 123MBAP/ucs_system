import{j as s}from"./index-DaGMaRVu.js";import{r as l}from"./react-CzDbI3ao.js";import{L as ve}from"./LoadingSpinner-6XlBvmUP.js";const c="http://localhost:4000",Ge=()=>{const[y,be]=l.useState([]),[x,ye]=l.useState([]),[b,Ne]=l.useState([]),[j,je]=l.useState([]),[M,Ce]=l.useState([]),[we,Se]=l.useState([]),[ke,K]=l.useState(!1),[Q,N]=l.useState(null),[X,Y]=l.useState(null),[C,Z]=l.useState(""),[w,T]=l.useState(""),[E,V]=l.useState({}),[ee,$e]=l.useState({}),[F,Ae]=l.useState({}),[v,I]=l.useState({}),[L,se]=l.useState(""),[Te,re]=l.useState({}),[_,De]=l.useState({}),[S,te]=l.useState(""),[z,oe]=l.useState(""),[B,ie]=l.useState(""),[k,ne]=l.useState(""),[O,ae]=l.useState(""),[H,le]=l.useState(""),[P,de]=l.useState(""),[J,ce]=l.useState(""),[d,m]=l.useState({}),[me,Me]=l.useState({}),[U,Ze]=l.useState({}),[$,he]=l.useState(""),[W,ue]=l.useState(""),[R,pe]=l.useState(""),[A,xe]=l.useState(""),i={primary:"#D97706",primaryHover:"#B45309",background:"#F3F4F6",cardBg:"#FFFFFF",border:"#E5E7EB",text:"#1E1E1E",textLight:"#6B7280",error:"#DC2626"};function h(){const t=localStorage.getItem("token");t&&(K(!0),N(null),fetch(`${c}/api/manageworkers/init`,{headers:{Authorization:`Bearer ${t}`}}).then(async o=>{const e=await o.json();if(!o.ok)throw new Error((e==null?void 0:e.error)||"Failed to load");const r=(e.supervisors||[]).map(a=>({id:a.id,username:a.username,vehicles:Array.isArray(a.vehicles)?a.vehicles.map(p=>({id:Number(p.id),plate:String(p.plate)})):[],zones:Array.isArray(a.zones)?a.zones.map(p=>({id:Number(p.id),name:String(p.name)})):[]}));be(r);const n=new Map((e.drivers||[]).map(a=>[Number(a.id),String(a.username)]));ye((e.vehicles||[]).map(a=>({id:Number(a.id),plate:String(a.plate),manpower:Array.isArray(a.manpower)?a.manpower.map(p=>({manpower_id:Number(p.manpower_id),username:String(p.username)})):[],drivers:Array.isArray(a.drivers)?a.drivers.map(p=>({user_id:Number(p.user_id),username:n.get(Number(p.user_id))})):[]}))),Ne((e.zones||[]).map(a=>({id:Number(a.id),name:String(a.zone_name),assigned_chief:a.assigned_chief??null,supervisor_id:a.supervisor_id??null}))),je((e.chiefs||[]).map(a=>({id:Number(a.id),username:String(a.username)}))),Ce((e.drivers||[]).map(a=>({id:Number(a.id),username:String(a.username)}))),Se((e.manpower||[]).map(a=>({id:Number(a.id),username:String(a.username)})))}).catch(o=>N((o==null?void 0:o.message)||"Failed to load")).finally(()=>K(!1)))}async function Ee(t){const o=localStorage.getItem("token");o&&(await fetch(`${c}/api/manageworkers/manpower/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`}}),h())}l.useEffect(()=>{h()},[]);function Ve(t){Y(t.id),Z(""),T("")}function ge(){Y(null),Z(""),T(""),V({})}async function Fe(t){const o=localStorage.getItem("token");if(o&&C!=="")try{m(r=>({...r,[`saveVehicle-${t}`]:!0}));const e=await fetch(`${c}/api/manageworkers/supervisors/${t}/vehicle`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({vehicleId:Number(C)})});if(e.status===409)if(window.confirm("This vehicle is already assigned to another supervisor. Do you want to move it to this supervisor?"))await fetch(`${c}/api/manageworkers/supervisors/${t}/vehicle/move`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({vehicleId:Number(C)})});else return;else if(!e.ok){const r=await e.json().catch(()=>({}));throw new Error((r==null?void 0:r.error)||"Failed to assign vehicle")}}catch(e){N((e==null?void 0:e.message)||"Failed to assign/move vehicle")}finally{ge(),h(),m(e=>({...e,[`saveVehicle-${t}`]:!1}))}}async function Ie(t,o){const e=localStorage.getItem("token");e&&(await fetch(`${c}/api/manageworkers/supervisors/${t}/vehicle/${o}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`}}),h())}async function Le(t,o){const e=localStorage.getItem("token");if(e)try{m(n=>({...n,assignVehicleNoSup:!0}));const r=await fetch(`${c}/api/manageworkers/supervisors/${t}/vehicle`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({vehicleId:o})});if(r.status===409)if(window.confirm("This vehicle is already assigned to another supervisor. Do you want to move it to this supervisor?"))await fetch(`${c}/api/manageworkers/supervisors/${t}/vehicle/move`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({vehicleId:o})});else return;else if(!r.ok){const n=await r.json().catch(()=>({}));throw new Error((n==null?void 0:n.error)||"Failed to assign vehicle")}}catch(r){N((r==null?void 0:r.message)||"Failed to assign/move vehicle")}finally{ae(""),le(""),h(),m(r=>({...r,assignVehicleNoSup:!1}))}}async function _e(t){const o=localStorage.getItem("token");if(o&&w)try{m(r=>({...r,[`addZone-${t}`]:!0}));const e=await fetch(`${c}/api/manageworkers/supervisors/${t}/zones/add`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({zoneId:Number(w)})});if(e.status===409)if(await e.json().catch(()=>({})),window.confirm("This zone is already assigned to a supervisor. Do you want to move it to this supervisor?"))await fetch(`${c}/api/manageworkers/supervisors/${t}/zones/move`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({zoneId:Number(w)})});else return;else if(!e.ok){const r=await e.json().catch(()=>({}));throw new Error((r==null?void 0:r.error)||"Failed to add zone")}}catch(e){N((e==null?void 0:e.message)||"Failed to add/move zone")}finally{T(""),h(),m(e=>({...e,[`addZone-${t}`]:!1}))}}async function ze(t,o){const e=localStorage.getItem("token");if(e)try{m(n=>({...n,assignZoneNoSup:!0}));const r=await fetch(`${c}/api/manageworkers/supervisors/${t}/zones/add`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({zoneId:o})});if(r.status===409)if(await r.json().catch(()=>({})),window.confirm("This zone is already assigned to a supervisor. Do you want to move it to this supervisor?"))await fetch(`${c}/api/manageworkers/supervisors/${t}/zones/move`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({zoneId:o})});else return;else if(!r.ok){const n=await r.json().catch(()=>({}));throw new Error((n==null?void 0:n.error)||"Failed to add zone")}}catch(r){N((r==null?void 0:r.message)||"Failed to add/move zone")}finally{de(""),ce(""),h(),m(r=>({...r,assignZoneNoSup:!1}))}}async function Be(t,o){const e=localStorage.getItem("token");e&&(await fetch(`${c}/api/manageworkers/supervisors/${t}/zones/remove`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({zoneId:o})}),h())}async function Oe(t,o){const e=localStorage.getItem("token");if(!e)return;const r=Number(o);Number.isFinite(r)&&(m(n=>({...n,[`moveZone-${t}`]:!0})),await fetch(`${c}/api/manageworkers/supervisors/${r}/zones/move`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({zoneId:t})}),V(n=>({...n,[t]:""})),h(),m(n=>({...n,[`moveZone-${t}`]:!1})))}async function q(t,o){const e=localStorage.getItem("token");e&&(m(r=>({...r,[`setChief-${t}`]:!0})),await fetch(`${c}/api/manageworkers/zones/${t}/reassign-chief`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({chiefUserId:o})}),h(),m(r=>({...r,[`setChief-${t}`]:!1})))}async function He(t){const o=localStorage.getItem("token");o&&(m(e=>({...e,[`removeChief-${t}`]:!0})),await fetch(`${c}/api/manageworkers/zones/${t}/chief`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`}}),h(),m(e=>({...e,[`removeChief-${t}`]:!1})))}async function G(t,o){const e=localStorage.getItem("token");e&&(m(r=>({...r,[`assignDriver-${t}`]:!0})),await fetch(`${c}/api/manageworkers/drivers/${t}/vehicle`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({vehicleId:o})}),h(),m(r=>({...r,[`assignDriver-${t}`]:!1})))}async function Pe(t){const o=localStorage.getItem("token");o&&(await fetch(`${c}/api/manageworkers/drivers/${t}/vehicle`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`}}),h())}async function fe(t,o){const e=localStorage.getItem("token");e&&(m(r=>({...r,[`assignManpower-${t}`]:!0})),await fetch(`${c}/api/manageworkers/manpower/${t}/vehicle`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({vehicleId:o})}),h(),m(r=>({...r,[`assignManpower-${t}`]:!1})))}async function Je(t){const o=localStorage.getItem("token");o&&(await fetch(`${c}/api/manageworkers/manpower/${t}/vehicle`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`}}),h())}const D=({title:t,number:o})=>s.jsxs("div",{className:"flex items-center gap-3 mb-6 pb-3 border-b",style:{borderColor:i.border},children:[s.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm",style:{backgroundColor:i.primary},children:o}),s.jsx("h2",{className:"text-2xl font-bold",style:{color:i.text},children:t})]}),f=({title:t})=>s.jsx("h3",{className:"text-lg font-semibold mb-4 pb-2 border-b",style:{color:i.text,borderColor:i.border},children:t}),g=({children:t,className:o=""})=>s.jsx("div",{className:`rounded-lg shadow-sm border p-6 ${o}`,style:{backgroundColor:i.cardBg,borderColor:i.border},children:t}),u=({children:t,onClick:o,disabled:e=!1,loading:r=!1,className:n=""})=>s.jsxs("button",{onClick:o,disabled:e||r,className:`px-4 py-2 rounded-lg font-medium text-white transition-colors flex items-center gap-2 ${n}`,style:{backgroundColor:e?i.textLight:i.primary,cursor:e?"not-allowed":"pointer"},onMouseOver:a=>{!e&&!r&&(a.currentTarget.style.backgroundColor=i.primaryHover)},onMouseOut:a=>{!e&&!r&&(a.currentTarget.style.backgroundColor=i.primary)},children:[r&&s.jsx(ve,{size:16,className:"border-white/60 border-t-white"}),t]}),Ue=({children:t,onClick:o,disabled:e=!1,className:r=""})=>s.jsx("button",{onClick:o,disabled:e,className:`px-4 py-2 rounded-lg font-medium border transition-colors ${r}`,style:{color:i.text,borderColor:i.border,backgroundColor:"transparent",cursor:e?"not-allowed":"pointer"},onMouseOver:n=>{e||(n.currentTarget.style.backgroundColor=i.background)},onMouseOut:n=>{e||(n.currentTarget.style.backgroundColor="transparent")},children:t});return s.jsxs("div",{className:"p-6 space-y-8 min-h-screen",style:{backgroundColor:i.background},children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("h1",{className:"text-3xl font-bold mb-2",style:{color:i.text},children:"Manage Workers"}),s.jsx("p",{className:"text-lg",style:{color:i.textLight},children:"Manage supervisors, chiefs, manpower, and drivers across your organization"})]}),Q&&s.jsx("div",{className:"p-4 rounded-lg text-white font-medium text-center",style:{backgroundColor:i.error},children:Q}),ke?s.jsx("div",{className:"flex justify-center items-center py-12",children:s.jsx(ve,{size:32,className:"border-gray-400 border-t-gray-600"})}):s.jsxs("div",{className:"space-y-12 max-w-7xl mx-auto",children:[s.jsxs("section",{children:[s.jsx(D,{title:"Manage Supervisors",number:1}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[y.map(t=>s.jsxs(g,{className:"hover:shadow-md transition-shadow",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold",style:{color:i.text},children:t.username}),s.jsxs("span",{className:"text-sm",style:{color:i.textLight},children:["ID: #",t.id]})]}),X===t.id?s.jsx(Ue,{onClick:ge,className:"text-sm px-3 py-1",children:"Close"}):s.jsx("button",{onClick:()=>Ve(t),className:"text-sm font-medium underline px-3 py-1 rounded",style:{color:i.primary},children:"Manage"})]}),s.jsxs("div",{className:"space-y-3 mb-4",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-sm font-medium",style:{color:i.textLight},children:"Assigned Vehicles:"}),s.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:t.vehicles&&t.vehicles.length?t.vehicles.map(o=>s.jsx("span",{className:"px-2 py-1 text-xs rounded border",style:{borderColor:i.border},children:o.plate},o.id)):s.jsx("span",{className:"text-sm",style:{color:i.textLight},children:"None"})})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-sm font-medium",style:{color:i.textLight},children:"Zones:"}),s.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:t.zones&&t.zones.length?t.zones.map(o=>s.jsx("span",{className:"px-2 py-1 text-xs rounded border",style:{borderColor:i.border},children:o.name},o.id)):s.jsx("span",{className:"text-sm",style:{color:i.textLight},children:"None"})})]})]}),X===t.id&&s.jsxs("div",{className:"space-y-4 border-t pt-4",style:{borderColor:i.border},children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:i.text},children:"Assign Vehicle"}),s.jsxs("select",{value:C,onChange:o=>Z(o.target.value),className:"w-full border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:border-amber-600 focus:ring-amber-600",style:{borderColor:i.border},children:[s.jsx("option",{value:"",children:"Select a vehicle…"}),x.map(o=>s.jsx("option",{value:o.id,children:o.plate},o.id))]}),s.jsx("div",{className:"mt-2",children:s.jsx(u,{onClick:()=>Fe(t.id),disabled:!C||!!d[`saveVehicle-${t.id}`],loading:!!d[`saveVehicle-${t.id}`],className:"text-sm px-3 py-1",children:"Add Vehicle"})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:i.text},children:"Unassign Vehicles"}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.vehicles.map(o=>s.jsxs("button",{onClick:()=>Ie(t.id,o.id),className:"px-3 py-1 text-xs rounded-lg border flex items-center gap-1 transition-colors",style:{borderColor:i.border},onMouseOver:e=>e.currentTarget.style.backgroundColor=i.background,onMouseOut:e=>e.currentTarget.style.backgroundColor="transparent",children:[o.plate," ",s.jsx("span",{children:"✕"})]},o.id)),!t.vehicles.length&&s.jsx("div",{className:"text-sm",style:{color:i.textLight},children:"No vehicles to unassign"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:i.text},children:"Add Zone"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("select",{value:w,onChange:o=>T(o.target.value),className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},children:[s.jsx("option",{value:"",children:"Select a zone…"}),b.filter(o=>!t.zones.some(e=>e.id===o.id)).map(o=>s.jsx("option",{value:o.id,children:o.name},o.id))]}),s.jsx(u,{onClick:()=>_e(t.id),disabled:!w||!!d[`addZone-${t.id}`],loading:!!d[`addZone-${t.id}`],className:"text-sm px-3 py-1",children:"Add"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:i.text},children:"Remove Zones"}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.zones.map(o=>s.jsxs("button",{onClick:()=>Be(t.id,o.id),className:"px-3 py-1 text-xs rounded-lg border flex items-center gap-1 transition-colors",style:{borderColor:i.border},onMouseOver:e=>e.currentTarget.style.backgroundColor=i.background,onMouseOut:e=>e.currentTarget.style.backgroundColor="transparent",children:[o.name," ",s.jsx("span",{children:"✕"})]},o.id)),!t.zones.length&&s.jsx("div",{className:"text-sm",style:{color:i.textLight},children:"No zones to remove"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:i.text},children:"Move Zones to Another Supervisor"}),s.jsxs("div",{className:"space-y-3",children:[t.zones.map(o=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-sm flex-1",style:{color:i.text},children:o.name}),s.jsxs("select",{value:E[o.id]||"",onChange:e=>V(r=>({...r,[o.id]:e.target.value})),className:"border rounded-lg px-2 py-1 text-sm",style:{borderColor:i.border},children:[s.jsx("option",{value:"",children:"Select supervisor…"}),y.filter(e=>e.id!==t.id).map(e=>s.jsx("option",{value:e.id,children:e.username},e.id))]}),s.jsx(u,{onClick:()=>Oe(o.id,E[o.id]),disabled:!E[o.id]||!!d[`moveZone-${o.id}`],loading:!!d[`moveZone-${o.id}`],className:"text-sm px-2 py-1",children:"Move"})]},o.id)),!t.zones.length&&s.jsx("div",{className:"text-sm",style:{color:i.textLight},children:"No zones to move"})]})]})]})]},t.id)),!y.length&&s.jsx(g,{children:s.jsx("div",{className:"text-center py-8",style:{color:i.textLight},children:"No supervisors found"})})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs(g,{children:[s.jsx(f,{title:"Unassigned Vehicles"}),(()=>{const t=new Set;y.forEach(e=>(e.vehicles||[]).forEach(r=>t.add(r.id)));const o=x.filter(e=>!t.has(e.id));return s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:O,onChange:e=>ae(e.target.value),children:[s.jsx("option",{value:"",children:"Select vehicle…"}),o.map(e=>s.jsx("option",{value:e.id,children:e.plate},e.id))]}),s.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:H,onChange:e=>le(e.target.value),children:[s.jsx("option",{value:"",children:"Select supervisor…"}),y.map(e=>s.jsx("option",{value:e.id,children:e.username},e.id))]}),s.jsx(u,{disabled:!O||!H||!!d.assignVehicleNoSup,loading:!!d.assignVehicleNoSup,onClick:()=>{const e=Number(O),r=Number(H);Number.isFinite(e)&&Number.isFinite(r)&&Le(r,e)},className:"text-sm whitespace-nowrap",children:"Assign"})]}),o.length===0&&s.jsx("div",{className:"text-sm text-center py-4",style:{color:i.textLight},children:"All vehicles are assigned to supervisors"})]})})()]}),s.jsxs(g,{children:[s.jsx(f,{title:"Unassigned Zones"}),(()=>{const t=new Set;y.forEach(e=>(e.zones||[]).forEach(r=>t.add(r.id)));const o=b.filter(e=>!t.has(e.id));return s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:P,onChange:e=>de(e.target.value),children:[s.jsx("option",{value:"",children:"Select zone…"}),o.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),s.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:J,onChange:e=>ce(e.target.value),children:[s.jsx("option",{value:"",children:"Select supervisor…"}),y.map(e=>s.jsx("option",{value:e.id,children:e.username},e.id))]}),s.jsx(u,{disabled:!P||!J||!!d.assignZoneNoSup,loading:!!d.assignZoneNoSup,onClick:()=>{const e=Number(P),r=Number(J);Number.isFinite(e)&&Number.isFinite(r)&&ze(r,e)},className:"text-sm whitespace-nowrap",children:"Assign"})]}),o.length===0&&s.jsx("div",{className:"text-sm text-center py-4",style:{color:i.textLight},children:"All zones are assigned to supervisors"})]})})()]})]})]}),s.jsxs("section",{children:[s.jsx(D,{title:"Manage Chiefs",number:2}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs(g,{children:[s.jsx(f,{title:"Chiefs and Their Zones"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[j.map(t=>{const o=b.filter(e=>e.assigned_chief===t.id);return o.length===0?null:s.jsxs("div",{className:"border rounded-lg p-4",style:{borderColor:i.border},children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("div",{className:"font-semibold",style:{color:i.text},children:t.username}),s.jsx("button",{onClick:()=>Me(e=>({...e,[t.id]:!e[t.id]})),className:"text-sm font-medium px-3 py-1 rounded border",style:{color:i.primary,borderColor:i.primary},children:me[t.id]?"Done":"Manage"})]}),s.jsx("div",{className:"space-y-3",children:o.map(e=>s.jsxs("div",{className:"flex items-center justify-between text-sm p-2 rounded border",style:{borderColor:i.border},children:[s.jsx("span",{style:{color:i.text},children:e.name}),me[t.id]&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{className:"px-2 py-1 text-xs rounded border",style:{borderColor:i.border},disabled:!!d[`removeChief-${e.id}`],onClick:()=>He(e.id),children:"Unassign"}),s.jsxs("select",{className:"border rounded px-2 py-1 text-xs",style:{borderColor:i.border},value:U[e.id]||"",onChange:r=>Ze(n=>({...n,[e.id]:r.target.value})),children:[s.jsx("option",{value:"",children:"Move to…"}),j.filter(r=>r.id!==t.id).map(r=>s.jsx("option",{value:r.id,children:r.username},r.id))]}),s.jsx(u,{disabled:!U[e.id]||!!d[`setChief-${e.id}`],loading:!!d[`setChief-${e.id}`],onClick:()=>{const r=Number(U[e.id]);Number.isFinite(r)&&q(e.id,r)},className:"text-xs px-2 py-1",children:"Move"})]})]},e.id))})]},t.id)}),j.filter(t=>b.some(o=>o.assigned_chief===t.id)).length===0&&s.jsx("div",{className:"col-span-full text-center py-8",style:{color:i.textLight},children:"No chiefs with assigned zones"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs(g,{children:[s.jsx(f,{title:"Zones Needing Chiefs"}),(()=>{const t=b.filter(e=>!e.assigned_chief),o=j.filter(e=>b.every(r=>r.assigned_chief!==e.id));return s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:$,onChange:e=>he(e.target.value),children:[s.jsx("option",{value:"",children:"Select zone…"}),t.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),s.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:W,onChange:e=>ue(e.target.value),children:[s.jsx("option",{value:"",children:"Select chief…"}),o.map(e=>s.jsx("option",{value:e.id,children:e.username},e.id))]}),s.jsx(u,{disabled:!$||!W||!!d[`setChief-${Number($)}`],loading:!!d[`setChief-${Number($)}`],onClick:()=>{const e=Number($),r=Number(W);Number.isFinite(e)&&Number.isFinite(r)&&q(e,r),he(""),ue("")},className:"text-sm whitespace-nowrap",children:"Assign"})]}),t.length===0&&s.jsx("div",{className:"text-sm text-center py-4",style:{color:i.textLight},children:"All zones have chiefs assigned"})]})})()]}),s.jsxs(g,{children:[s.jsx(f,{title:"Chiefs Without Zones"}),(()=>{const t=j.filter(e=>b.every(r=>r.assigned_chief!==e.id)),o=b.filter(e=>!e.assigned_chief);return s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:R,onChange:e=>pe(e.target.value),children:[s.jsx("option",{value:"",children:"Select chief…"}),t.map(e=>s.jsx("option",{value:e.id,children:e.username},e.id))]}),s.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:A,onChange:e=>xe(e.target.value),children:[s.jsx("option",{value:"",children:"Select zone…"}),o.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),s.jsx(u,{disabled:!R||!A||!!d[`setChief-${Number(A)}`],loading:!!d[`setChief-${Number(A)}`],onClick:()=>{const e=Number(R),r=Number(A);Number.isFinite(r)&&Number.isFinite(e)&&q(r,e),pe(""),xe("")},className:"text-sm whitespace-nowrap",children:"Assign"})]}),t.length===0&&s.jsx("div",{className:"text-sm text-center py-4",style:{color:i.textLight},children:"All chiefs have zones assigned"})]})})()]})]})]})]}),s.jsxs("section",{children:[s.jsx(D,{title:"Manage Manpower",number:3}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs(g,{children:[s.jsx(f,{title:"Vehicles and Their Manpower"}),s.jsx("div",{className:"space-y-4",children:x.map(t=>s.jsxs("div",{className:"border rounded-lg p-4",style:{borderColor:i.border},children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("div",{className:"font-semibold",style:{color:i.text},children:t.plate}),s.jsx("button",{onClick:()=>$e(o=>({...o,[t.id]:!o[t.id]})),className:"text-sm font-medium px-3 py-1 rounded border",style:{color:i.primary,borderColor:i.primary},children:ee[t.id]?"Done":"Manage"})]}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[(t.manpower||[]).length===0&&s.jsx("div",{className:"text-sm",style:{color:i.textLight},children:"No manpower assigned"}),(t.manpower||[]).map(o=>s.jsxs("div",{className:"flex items-center gap-2 border rounded-lg px-3 py-2",style:{borderColor:i.border},children:[s.jsx("span",{className:"text-sm",style:{color:i.text},children:o.username}),ee[t.id]&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{className:"px-2 py-1 text-xs rounded border",style:{borderColor:i.border},onClick:()=>Je(o.manpower_id),children:"Remove"}),s.jsxs("select",{className:"border rounded px-2 py-1 text-xs",style:{borderColor:i.border},value:F[o.manpower_id]||"",onChange:e=>Ae(r=>({...r,[o.manpower_id]:e.target.value})),children:[s.jsx("option",{value:"",children:"Move to…"}),x.filter(e=>e.id!==t.id).map(e=>s.jsx("option",{value:e.id,children:e.plate},e.id))]}),s.jsx(u,{disabled:!F[o.manpower_id]||!!d[`assignManpower-${o.manpower_id}`],loading:!!d[`assignManpower-${o.manpower_id}`],onClick:()=>{const e=Number(F[o.manpower_id]);Number.isFinite(e)&&fe(o.manpower_id,e)},className:"text-xs px-2 py-1",children:"Move"})]})]},o.manpower_id))]})]},t.id))})]}),s.jsxs(g,{children:[s.jsx(f,{title:"Unassigned Manpower"}),(()=>{const t=new Set;x.forEach(e=>(e.manpower||[]).forEach(r=>t.add(r.manpower_id)));const o=we.filter(e=>!t.has(e.id));return s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:L,onChange:e=>se(e.target.value),children:[s.jsx("option",{value:"",children:"Select vehicle…"}),x.map(e=>s.jsx("option",{value:e.id,children:e.plate},e.id))]}),s.jsx(u,{disabled:!L||Object.keys(v).filter(e=>v[Number(e)]).length===0,onClick:async()=>{const e=Object.keys(v).map(Number).filter(n=>v[n]),r=Number(L);for(const n of e)await fe(n,r);I({}),se("")},className:"text-sm whitespace-nowrap",children:"Assign Selected"}),s.jsx("button",{className:"px-4 py-2 rounded-lg font-medium border text-sm whitespace-nowrap",style:{borderColor:i.error,color:i.error},disabled:Object.keys(v).filter(e=>v[Number(e)]).length===0,onClick:async()=>{const e=Object.keys(v).map(Number).filter(n=>v[n]);if(!(!e.length||!window.confirm(`Delete ${e.length} manpower user(s)? This cannot be undone.`))){for(const n of e)await Ee(n);I({})}},children:"Delete Selected"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:[o.map(e=>s.jsxs("label",{className:"flex items-center gap-3 border rounded-lg p-3 cursor-pointer transition-colors hover:bg-gray-50",children:[s.jsx("input",{type:"checkbox",checked:!!v[e.id],onChange:r=>I(n=>({...n,[e.id]:r.target.checked})),className:"rounded",style:{accentColor:i.primary}}),s.jsx("span",{className:"text-sm",style:{color:i.text},children:e.username})]},e.id)),o.length===0&&s.jsx("div",{className:"col-span-full text-center py-8",style:{color:i.textLight},children:"No unassigned manpower"})]})]})})()]})]})]}),s.jsxs("section",{children:[s.jsx(D,{title:"Manage Drivers",number:4}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs(g,{children:[s.jsx(f,{title:"Drivers and Their Vehicles"}),(()=>{const t=[],o=new Map(M.map(r=>[r.id,r]));x.forEach(r=>(r.drivers||[]).forEach(n=>{const a=n.user_id&&o.get(n.user_id);a&&t.push({driver:a,vehicle:r})}));const e=x.filter(r=>!r.drivers||r.drivers.length===0);return s.jsxs("div",{className:"space-y-3",children:[t.length===0&&s.jsx("div",{className:"text-center py-8",style:{color:i.textLight},children:"No drivers currently assigned to vehicles"}),t.map(({driver:r,vehicle:n})=>s.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",style:{borderColor:i.border},children:[s.jsxs("div",{className:"text-sm",children:[s.jsx("span",{className:"font-medium",style:{color:i.text},children:r.username}),s.jsxs("span",{className:"ml-2",style:{color:i.textLight},children:["→ ",n.plate]})]}),s.jsx("div",{className:"flex items-center gap-2",children:Te[r.id]?s.jsxs(s.Fragment,{children:[s.jsx("button",{className:"px-3 py-1 text-xs rounded border",style:{borderColor:i.border},disabled:!!d[`assignDriver-${r.id}`],onClick:()=>Pe(r.id),children:"Remove"}),s.jsxs("select",{className:"border rounded px-2 py-1 text-xs",style:{borderColor:i.border},value:_[r.id]||"",onChange:a=>De(p=>({...p,[r.id]:a.target.value})),children:[s.jsx("option",{value:"",children:"Move to…"}),e.filter(a=>a.id!==n.id).map(a=>s.jsx("option",{value:a.id,children:a.plate},a.id))]}),s.jsx(u,{disabled:!_[r.id]||!!d[`assignDriver-${r.id}`],loading:!!d[`assignDriver-${r.id}`],onClick:()=>{const a=Number(_[r.id]);Number.isFinite(a)&&G(r.id,a)},className:"text-xs px-2 py-1",children:"Move"}),s.jsx("button",{className:"px-3 py-1 text-xs rounded border",style:{borderColor:i.border},onClick:()=>re(a=>({...a,[r.id]:!1})),children:"Done"})]}):s.jsx("button",{onClick:()=>re(a=>({...a,[r.id]:!0})),className:"text-sm font-medium px-3 py-1 rounded border",style:{color:i.primary,borderColor:i.primary},children:"Manage"})})]},`${r.id}-${n.id}`))]})})()]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs(g,{children:[s.jsx(f,{title:"Drivers Without Vehicles"}),(()=>{const t=new Set;x.forEach(r=>(r.drivers||[]).forEach(n=>t.add(n.user_id)));const o=M.filter(r=>!t.has(r.id)),e=x.filter(r=>!r.drivers||r.drivers.length===0);return s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:S,onChange:r=>te(r.target.value),children:[s.jsx("option",{value:"",children:"Select driver…"}),o.map(r=>s.jsx("option",{value:r.id,children:r.username},r.id))]}),s.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:z,onChange:r=>oe(r.target.value),children:[s.jsx("option",{value:"",children:"Select vehicle…"}),e.map(r=>s.jsx("option",{value:r.id,children:r.plate},r.id))]}),s.jsx(u,{disabled:!S||!z||!!d[`assignDriver-${Number(S)}`],loading:!!d[`assignDriver-${Number(S)}`],onClick:()=>{const r=Number(S),n=Number(z);Number.isFinite(r)&&Number.isFinite(n)&&G(r,n),te(""),oe("")},className:"text-sm whitespace-nowrap",children:"Assign"})]}),o.length===0&&s.jsx("div",{className:"text-sm text-center py-4",style:{color:i.textLight},children:"All drivers have vehicles assigned"})]})})()]}),s.jsxs(g,{children:[s.jsx(f,{title:"Vehicles Without Drivers"}),(()=>{const t=new Set;x.forEach(r=>(r.drivers||[]).forEach(n=>t.add(n.user_id)));const o=M.filter(r=>!t.has(r.id)),e=x.filter(r=>!r.drivers||r.drivers.length===0);return s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:B,onChange:r=>ie(r.target.value),children:[s.jsx("option",{value:"",children:"Select vehicle…"}),e.map(r=>s.jsx("option",{value:r.id,children:r.plate},r.id))]}),s.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:k,onChange:r=>ne(r.target.value),children:[s.jsx("option",{value:"",children:"Select driver…"}),o.map(r=>s.jsx("option",{value:r.id,children:r.username},r.id))]}),s.jsx(u,{disabled:!B||!k||!!d[`assignDriver-${Number(k)}`],loading:!!d[`assignDriver-${Number(k)}`],onClick:()=>{const r=Number(B),n=Number(k);Number.isFinite(n)&&Number.isFinite(r)&&G(n,r),ie(""),ne("")},className:"text-sm whitespace-nowrap",children:"Assign"})]}),e.length===0&&s.jsx("div",{className:"text-sm text-center py-4",style:{color:i.textLight},children:"All vehicles have drivers assigned"})]})})()]})]})]})]})]})]})};export{Ge as default};
