import{j as e}from"./index-DnGg16Vn.js";import{r as a,f as V}from"./react-BeLGUnOF.js";const p="http://localhost:4000",r={primary:"#D97706",primaryHover:"#B45309",accent:"#15803D",accentHover:"#166534",background:"#1E1E1E",cardBg:"rgba(255, 255, 255, 0.05)",border:"rgba(255, 255, 255, 0.1)",text:"#FFFFFF",textLight:"#9CA3AF",error:"#DC2626",modalBg:"rgba(17, 24, 39, 0.95)",modalInputBg:"rgba(255, 255, 255, 0.12)"},Y=()=>{const[v,w]=a.useState(""),[N,C]=a.useState(""),[$,f]=a.useState(!1),[y,c]=a.useState("start"),[k,S]=a.useState(""),[E,n]=a.useState(null),[m,i]=a.useState(!1),[l,F]=a.useState(null),[O,L]=a.useState(null),[B,T]=a.useState(""),[g,M]=a.useState(!1),[R,P]=a.useState(null),I=V();async function q(s){s.preventDefault(),P(null),M(!0);try{const t=await fetch(`${p}/api/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:v,password:N})}),o=await t.json();if(!t.ok)throw new Error((o==null?void 0:o.error)||"Login failed");localStorage.setItem("token",o.token),localStorage.setItem("user",JSON.stringify(o.user)),window.dispatchEvent(new Event("auth-changed")),w(""),C(""),I("/")}catch(t){P(t.message||"Login failed")}finally{M(!1)}}async function U(){n(null),i(!0);try{const s=await fetch(`${p}/api/password/start`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({usernameOrEmail:k})}),t=await s.json();if(!s.ok)throw new Error((t==null?void 0:t.error)||"Failed");F(t),c("options")}catch(s){n((s==null?void 0:s.message)||"Failed")}finally{i(!1)}}async function J(){if(l){n(null),i(!0);try{const s=await fetch(`${p}/api/password/client/request`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l.username})}),t=await s.json();if(!s.ok)throw new Error((t==null?void 0:t.error)||"Failed");c("done")}catch(s){n((s==null?void 0:s.message)||"Failed")}finally{i(!1)}}}async function A(){if(l){n(null),i(!0);try{const s=await fetch(`${p}/api/password/email/send`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userType:l.userType,userId:l.userId})}),t=await s.json();if(!s.ok)throw new Error((t==null?void 0:t.error)||"Failed");L(t.requestId),c("email_code")}catch(s){n((s==null?void 0:s.message)||"Failed")}finally{i(!1)}}}async function D(){if(O){n(null),i(!0);try{const s=await fetch(`${p}/api/password/email/verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({requestId:O,code:B})}),t=await s.json();if(!s.ok)throw new Error((t==null?void 0:t.error)||"Failed");c("done")}catch(s){n((s==null?void 0:s.message)||"Failed")}finally{i(!1)}}}async function H(){if(l){n(null),i(!0);try{const s=await fetch(`${p}/api/password/user/request-supervisor`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l.username})}),t=await s.json();if(!s.ok)throw new Error((t==null?void 0:t.error)||"Failed");c("done")}catch(s){n((s==null?void 0:s.message)||"Failed")}finally{i(!1)}}}const z=({children:s,onClick:t,disabled:o=!1,loading:d=!1,type:u="button",className:h=""})=>e.jsxs("button",{type:u,onClick:t,disabled:o||d,className:`px-4 py-3 rounded-lg font-semibold text-white transition-all duration-200 flex items-center justify-center gap-2 ${h}`,style:{backgroundColor:o?"#6B7280":r.primary,cursor:o?"not-allowed":"pointer"},onMouseOver:j=>{!o&&!d&&(j.currentTarget.style.backgroundColor=r.primaryHover)},onMouseOut:j=>{!o&&!d&&(j.currentTarget.style.backgroundColor=r.primary)},children:[d&&e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),s]}),b=({children:s,onClick:t,disabled:o=!1,type:d="button",className:u=""})=>e.jsx("button",{type:d,onClick:t,disabled:o,className:`px-4 py-3 rounded-lg font-semibold text-white transition-all duration-200 ${u}`,style:{backgroundColor:o?"#6B7280":r.accent,cursor:o?"not-allowed":"pointer"},onMouseOver:h=>{o||(h.currentTarget.style.backgroundColor=r.accentHover)},onMouseOut:h=>{o||(h.currentTarget.style.backgroundColor=r.accent)},children:s}),x=({children:s,onClick:t,disabled:o=!1,className:d=""})=>e.jsx("button",{onClick:t,disabled:o,className:`px-4 py-3 rounded-lg font-semibold border transition-all duration-200 ${d}`,style:{color:r.text,borderColor:r.border,backgroundColor:"transparent",cursor:o?"not-allowed":"pointer"},onMouseOver:u=>{o||(u.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.05)")},onMouseOut:u=>{o||(u.currentTarget.style.backgroundColor="transparent")},children:s});return e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4",style:{backgroundColor:r.background},children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute -top-40 -right-40 w-80 h-80 rounded-full blur-3xl",style:{backgroundColor:`${r.primary}15`}}),e.jsx("div",{className:"absolute -bottom-40 -left-40 w-80 h-80 rounded-full blur-3xl",style:{backgroundColor:`${r.accent}15`}}),e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 rounded-full blur-3xl",style:{backgroundColor:`${r.primary}10`}})]}),e.jsxs("div",{className:"relative w-full max-w-md",children:[e.jsxs("div",{className:"rounded-2xl border p-8 shadow-2xl",style:{backgroundColor:r.cardBg,borderColor:r.border},children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-2xl shadow-lg mb-4",style:{backgroundColor:r.primary},children:e.jsx("span",{className:"text-white font-bold text-xl",children:"UCS"})}),e.jsx("h1",{className:"text-3xl font-bold mb-2",style:{color:r.text},children:"Welcome Back"}),e.jsx("p",{style:{color:r.textLight},children:"Sign in to your UCS account"})]}),e.jsxs("form",{onSubmit:q,className:"space-y-6",children:[R&&e.jsx("div",{className:"p-4 rounded-lg border",style:{backgroundColor:"#FEF2F2",borderColor:r.error},children:e.jsxs("div",{className:"flex items-center space-x-2",style:{color:r.error},children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm font-medium",children:R})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:r.text},children:"Username or Email"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"w-5 h-5",style:{color:r.textLight},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),e.jsx("input",{value:v,onChange:s=>w(s.target.value),className:"block w-full pl-10 pr-4 py-3 rounded-lg border focus:outline-none focus:ring-2 backdrop-blur-sm transition-all duration-200",style:{backgroundColor:"rgba(255, 255, 255, 0.05)",borderColor:r.border,color:r.text},placeholder:"Enter your username or email",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:r.text},children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"w-5 h-5",style:{color:r.textLight},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),e.jsx("input",{type:"password",value:N,onChange:s=>C(s.target.value),className:"block w-full pl-10 pr-4 py-3 rounded-lg border focus:outline-none focus:ring-2 backdrop-blur-sm transition-all duration-200",style:{backgroundColor:"rgba(255, 255, 255, 0.05)",borderColor:r.border,color:r.text},placeholder:"Enter your password",required:!0})]})]})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(z,{type:"submit",disabled:g,loading:g,className:"flex-1 py-3",children:g?"Signing in...":"Sign in"})}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"button",onClick:()=>{f(!0),c("start"),S(""),F(null),n(null),L(null),T("")},className:"text-sm font-medium transition-colors duration-200 hover:underline",style:{color:r.textLight},children:"Forgot your password?"})})]}),$&&e.jsx("div",{className:"absolute inset-0 rounded-2xl flex items-center justify-center p-6",style:{backgroundColor:"rgba(0, 0, 0, 0.8)"},children:e.jsxs("div",{className:"rounded-2xl p-6 w-full border shadow-2xl",style:{backgroundColor:r.modalBg,borderColor:r.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:r.text},children:"Reset Password"}),e.jsx("button",{onClick:()=>f(!1),className:"p-1 rounded-lg transition-colors duration-200 hover:bg-white/10",style:{color:r.text},children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-4",children:[E&&e.jsx("div",{className:"p-3 rounded border",style:{backgroundColor:"#FEF2F2",borderColor:r.error,color:r.error},children:E}),y==="start"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:r.text},children:"Username or Email"}),e.jsx("input",{value:k,onChange:s=>S(s.target.value),className:"block w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2",style:{backgroundColor:r.modalInputBg,borderColor:r.border,color:r.text},placeholder:"Enter your username or email"})]}),e.jsxs("div",{className:"flex items-center space-x-3 pt-2",children:[e.jsx(b,{onClick:U,className:"flex-1 py-3",disabled:m,children:m?"Please wait...":"Continue"}),e.jsx(x,{onClick:()=>f(!1),className:"flex-1 py-3",children:"Cancel"})]})]}),y==="options"&&l&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{style:{color:r.text},children:[e.jsxs("p",{className:"text-sm",children:["Account: ",e.jsx("span",{className:"font-semibold",children:l.username})]}),l.canEmailReset&&e.jsxs("p",{className:"text-sm",children:["Email hint: ",e.jsx("span",{className:"font-semibold",children:l.emailHint})]})]}),e.jsxs("div",{className:"space-y-2",children:[l.canEmailReset&&e.jsx(b,{onClick:A,className:"w-full py-3",disabled:m,children:m?"Sending...":"Reset via Email Code"}),l.isClient&&e.jsx(x,{onClick:J,className:"w-full py-3",children:"Ask Chief to Reset Password"}),!l.isClient&&(l.role==="chief"||l.role==="driver"||l.role==="manpower")&&e.jsx(x,{onClick:H,className:"w-full py-3",children:"Ask Supervisor to Reset Password"}),e.jsx(x,{onClick:()=>c("start"),className:"w-full py-3",children:"Back"})]})]}),y==="email_code"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:r.text},children:"Enter Verification Code (sent to your email)"}),e.jsx("input",{value:B,onChange:s=>T(s.target.value),className:"block w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2",style:{backgroundColor:r.modalInputBg,borderColor:r.border,color:r.text},placeholder:"6-digit code"})]}),e.jsxs("div",{className:"flex items-center space-x-3 pt-2",children:[e.jsx(b,{onClick:D,className:"flex-1 py-3",disabled:m,children:m?"Verifying...":"Verify & Reset"}),e.jsx(x,{onClick:()=>c("options"),className:"flex-1 py-3",children:"Back"})]})]}),y==="done"&&e.jsxs("div",{className:"space-y-4 text-center",style:{color:r.text},children:[e.jsxs("p",{children:["Your password has been reset to default: ",e.jsx("span",{className:"font-semibold",children:"123"})," if approved or verified."]}),e.jsx(b,{onClick:()=>{f(!1)},className:"w-full py-3",children:"Close"})]})]})]})})]}),e.jsx("div",{className:"text-center mt-6",children:e.jsx("p",{className:"text-sm",style:{color:r.textLight},children:"2024 UCS Company. Secure Management System"})})]})]})};export{Y as default};
