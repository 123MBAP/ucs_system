import{j as e}from"./index-DZTFkylD.js";import{r as x,L as O}from"./react-CzDbI3ao.js";const z="http://localhost:4000",h={Zone:()=>e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.447-.894L15 4m0 13V4m0 0L9 7"})}),Chief:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),Clients:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),Arrow:()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),TrendUp:()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})})},R=()=>{const[u,D]=x.useState([]),[p,S]=x.useState(!1),[C,L]=x.useState(null),[N,_]=x.useState("monthly"),[f,Z]=x.useState([]),[W,$]=x.useState(!1),[j,w]=x.useState({yearly:[],monthly:[],weekly:[],daily:[]});x.useEffect(()=>{const s=localStorage.getItem("token");s&&(S(!0),L(null),fetch(`${z}/api/supervisor/zones`,{headers:{Authorization:`Bearer ${s}`}}).then(async n=>{const r=await n.json();if(!n.ok)throw new Error((r==null?void 0:r.error)||"Failed to load zones");D(Array.isArray(r.zones)?r.zones:[])}).catch(n=>L((n==null?void 0:n.message)||"Failed to load zones")).finally(()=>S(!1)))},[]);function F(s=6){const n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],r=new Date,d=[];for(let c=s-1;c>=0;c--){const i=new Date(r.getFullYear(),r.getMonth()-c,1),a=`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}`;d.push({key:a,label:n[i.getMonth()]})}return d}function Y(s){const n=F(6),r=new Map(n.map(t=>[t.key,0])),d=new Date,c=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}`,i=[0,0,0,0],a=Array.from({length:5},(t,o)=>String(new Date().getFullYear()-(4-o))),l=new Map(a.map(t=>[t,0])),m=[],b=[];for(let t=6;t>=0;t--){const o=new Date(d);o.setDate(d.getDate()-t);const g=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`;b.push(g),m.push(`Day ${7-t}`)}const y=new Map(b.map(t=>[t,0])),T=Array.isArray(s)?s.filter(t=>{const o=String((t==null?void 0:t.status)||"").toLowerCase();return!(t!=null&&t.status)||o==="success"||o==="successful"}):[];for(const t of T){const o=Number(t.amount||0),g=new Date(t.completed_at||t.created_at||t.updated_at||t.inserted_at||Date.now()),v=`${g.getFullYear()}-${String(g.getMonth()+1).padStart(2,"0")}`;if(r.has(v)&&r.set(v,(r.get(v)||0)+o),v===c){const J=Math.min(4,Math.max(1,Math.ceil(g.getDate()/7)));i[J-1]+=o}const k=String(g.getFullYear());l.has(k)&&l.set(k,(l.get(k)||0)+o);const M=`${g.getFullYear()}-${String(g.getMonth()+1).padStart(2,"0")}-${String(g.getDate()).padStart(2,"0")}`;y.has(M)&&y.set(M,(y.get(M)||0)+o)}const K=a.map(t=>({year:t,amount:l.get(t)||0})),P=n.map(t=>({month:t.label,amount:r.get(t.key)||0})),V=[{week:"Week 1",amount:i[0]},{week:"Week 2",amount:i[1]},{week:"Week 3",amount:i[2]},{week:"Week 4",amount:i[3]}],I=b.map((t,o)=>({day:m[o],amount:y.get(t)||0}));return{yearly:K,monthly:P,weekly:V,daily:I}}x.useEffect(()=>{let s=!1;async function n(){try{$(!0);const r=localStorage.getItem("token");if(!r){w({yearly:[],monthly:[],weekly:[],daily:[]});return}const c=await(await fetch(`${z}/api/payments/completed`,{headers:{Authorization:`Bearer ${r}`}})).json(),i=Array.isArray(c==null?void 0:c.payments)?c.payments:[],a=Y(i);s||w(a)}catch{s||w({yearly:[],monthly:[],weekly:[],daily:[]})}finally{s||$(!1)}}return n(),()=>{s=!0}},[]),x.useEffect(()=>{const s={yearly:j.yearly,monthly:j.monthly,weekly:j.weekly,daily:j.daily};Z(s[N]||[])},[N,j]);const A=u.reduce((s,n)=>s+n.client_count,0),B=u.filter(s=>s.chief_username).length,E=u.length>0?Math.round(A/u.length):0;return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-stone-800 to-amber-600 bg-clip-text text-transparent",children:"Zone Supervision"}),e.jsx("p",{className:"text-stone-600 mt-2",children:"Manage your assigned zones and oversee operations"})]}),e.jsx("div",{className:"flex items-center space-x-4 mt-4 sm:mt-0",children:e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-stone-500",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"}),e.jsx("span",{children:"All Systems Operational"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"group bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-amber-100 p-6 hover:shadow-xl transition-all duration-300 hover:-translate-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-stone-600 mb-2",children:"Total Zones"}),e.jsx("p",{className:"text-3xl font-bold text-stone-900",children:p?"...":u.length}),e.jsx("p",{className:"text-sm text-stone-500 mt-1",children:"Assigned to you"})]}),e.jsx("div",{className:"p-4 rounded-xl bg-gradient-to-br from-amber-600 to-orange-500 shadow-lg",children:e.jsx(h.Zone,{})})]})}),e.jsx("div",{className:"group bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-amber-100 p-6 hover:shadow-xl transition-all duration-300 hover:-translate-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-stone-600 mb-2",children:"Active Chiefs"}),e.jsx("p",{className:"text-3xl font-bold text-stone-900",children:p?"...":B}),e.jsx("div",{className:"flex items-center mt-1",children:e.jsxs("div",{className:"inline-flex items-center px-2 py-1 rounded-full bg-emerald-100 text-emerald-700 text-xs font-medium",children:[e.jsx(h.TrendUp,{}),e.jsx("span",{className:"ml-1",children:"Active"})]})})]}),e.jsx("div",{className:"p-4 rounded-xl bg-gradient-to-br from-emerald-600 to-green-500 shadow-lg",children:e.jsx(h.Chief,{})})]})}),e.jsx("div",{className:"group bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-amber-100 p-6 hover:shadow-xl transition-all duration-300 hover:-translate-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-stone-600 mb-2",children:"Total Clients"}),e.jsx("p",{className:"text-3xl font-bold text-stone-900",children:p?"...":A.toLocaleString()}),e.jsx("p",{className:"text-sm text-stone-500 mt-1",children:"Across all zones"})]}),e.jsx("div",{className:"p-4 rounded-xl bg-gradient-to-br from-lime-600 to-green-500 shadow-lg",children:e.jsx(h.Clients,{})})]})}),e.jsx("div",{className:"group bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-amber-100 p-6 hover:shadow-xl transition-all duration-300 hover:-translate-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-stone-600 mb-2",children:"Avg per Zone"}),e.jsx("p",{className:"text-3xl font-bold text-stone-900",children:p?"...":E}),e.jsx("p",{className:"text-sm text-stone-500 mt-1",children:"Clients per zone"})]}),e.jsx("div",{className:"p-4 rounded-xl bg-gradient-to-br from-amber-500 to-yellow-500 shadow-lg",children:e.jsx(h.Clients,{})})]})})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-amber-100 p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-stone-800",children:"Payment Trends"}),e.jsx("p",{className:"text-xs text-stone-500 mt-1",children:"Completed payments overview"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-3 md:mt-0",children:["yearly","monthly","weekly","daily"].map(s=>e.jsx("button",{onClick:()=>_(s),className:`px-3 py-1.5 rounded-md text-xs font-semibold ${N===s?"bg-amber-600 text-white":"bg-stone-100 text-stone-600 hover:bg-stone-200"}`,children:s==="yearly"?"Year":s==="monthly"?"Monthly":s==="weekly"?"Weekly":"Daily"},s))})]}),e.jsx("div",{className:"h-64 relative",children:W?e.jsx("div",{className:"h-full flex items-center justify-center text-stone-500 text-sm",children:"Loading payments..."}):f.length===0?e.jsx("div",{className:"h-full flex items-center justify-center text-stone-500 text-sm",children:"No payments to display"}):(()=>{const s=f.map(a=>Number(a.amount)||0),n=Math.max(...s,1),r=Math.pow(10,Math.floor(Math.log10(n))),d=Math.ceil(n/r)*r,c=6,i=Array.from({length:c},(a,l)=>Math.round(d/(c-1)*l));return e.jsxs("div",{className:"h-full flex",children:[e.jsx("div",{className:"w-10 relative",children:i.map((a,l)=>{const m=100-a/d*100;return e.jsx("div",{className:"absolute left-0 w-full",style:{top:`${m}%`},children:e.jsx("div",{className:"-translate-y-1/2 flex items-center",children:e.jsx("span",{className:"text-[10px] text-stone-500 w-8 text-right pr-1",children:a.toLocaleString()})})},l)})}),e.jsxs("div",{className:"flex-1 relative",children:[i.map((a,l)=>{const m=100-a/d*100;return e.jsx("div",{className:"absolute left-0 right-0",style:{top:`${m}%`},children:e.jsx("div",{className:`h-px ${l===0?"bg-stone-300":"bg-stone-100"}`})},l)}),e.jsx("div",{className:"absolute inset-x-0 bottom-6 top-2 pointer-events-none",children:(()=>{const a=f.length||1;return Array.from({length:a},(l,m)=>{const b=(m+.5)/a*100;return e.jsx("div",{className:"absolute top-0 bottom-0",style:{left:`${b}%`},children:e.jsx("div",{className:"w-px h-full bg-stone-100 -translate-x-1/2"})},m)})})()}),e.jsx("div",{className:"absolute inset-x-0 bottom-6 top-2",children:e.jsx("div",{className:"flex items-end justify-between h-full space-x-2",children:f.map((a,l)=>{const m=Math.max(0,Math.min(100,Number(a.amount)/d*100));return e.jsxs("div",{className:"flex-1 flex flex-col items-center group",children:[e.jsx("div",{className:"text-center mb-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:e.jsxs("div",{className:"bg-stone-800 text-white text-xs px-2 py-1 rounded-md shadow",children:["$",Number(a.amount).toLocaleString()]})}),e.jsx("div",{className:"w-full bg-gradient-to-t from-amber-500 to-yellow-500 rounded-md transition-all duration-300 hover:opacity-90 cursor-pointer",style:{height:`${m}%`}})]},l)})})}),e.jsx("div",{className:"absolute left-0 right-0 bottom-0",children:e.jsx("div",{className:"flex justify-between items-center",children:f.map((a,l)=>e.jsx("div",{className:"flex-1 text-center",children:e.jsx("p",{className:"text-[11px] font-medium text-stone-600",children:"year"in a?a.year:"month"in a?a.month:"week"in a?a.week:a.day})},l))})})]})]})})()})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-amber-100 p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-stone-800",children:"Your Zones"}),e.jsx("p",{className:"text-stone-600 mt-1",children:"Manage and supervise your assigned zones"})]}),e.jsx("div",{className:"flex items-center space-x-2 mt-4 md:mt-0",children:e.jsxs("span",{className:"text-sm text-stone-500",children:[u.length," zone",u.length!==1?"s":""," assigned"]})})]}),C&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"flex items-center space-x-2 text-red-700",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"font-medium",children:C})]})}),p?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((s,n)=>e.jsxs("div",{className:"bg-stone-100 rounded-xl p-6 animate-pulse",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-stone-300 rounded w-20"}),e.jsx("div",{className:"h-6 bg-stone-300 rounded w-32"})]}),e.jsx("div",{className:"w-12 h-12 bg-stone-300 rounded-xl"})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"h-4 bg-stone-300 rounded w-16"}),e.jsx("div",{className:"h-4 bg-stone-300 rounded w-20"})]})}),e.jsx("div",{className:"h-10 bg-stone-300 rounded-lg mt-4"})]},n))}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[u.map(s=>e.jsxs("div",{className:"group bg-white rounded-xl border border-amber-100 p-6 hover:shadow-lg transition-all duration-300 hover:-translate-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-stone-500 uppercase tracking-wide",children:"Zone"}),e.jsx("h3",{className:"text-xl font-bold text-stone-800",children:s.zone_name})]}),e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-amber-600 to-amber-700 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx(h.Zone,{})})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-stone-600",children:[e.jsx(h.Chief,{}),e.jsx("span",{className:"font-medium",children:"Zone Chief"})]}),e.jsx("span",{className:`font-semibold ${s.chief_username?"text-stone-800":"text-amber-600"}`,children:s.chief_username||"Unassigned"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-stone-600",children:[e.jsx(h.Clients,{}),e.jsx("span",{className:"font-medium",children:"Active Clients"})]}),e.jsx("span",{className:"text-lg font-bold text-stone-800",children:s.client_count})]})]}),e.jsxs(O,{to:`/supervisor/zones/${s.id}/supervision`,className:"flex items-center justify-center space-x-2 w-full py-3 bg-stone-50 hover:bg-amber-50 text-stone-700 hover:text-amber-700 rounded-xl font-semibold transition-all duration-200 border border-stone-200 hover:border-amber-200 group-hover:shadow-md",children:[e.jsx("span",{children:"Manage Zone"}),e.jsx(h.Arrow,{})]})]},s.id)),!u.length&&!p&&e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx("div",{className:"w-20 h-20 bg-stone-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx(h.Zone,{})}),e.jsx("h3",{className:"text-xl font-semibold text-stone-700 mb-2",children:"No zones assigned"}),e.jsx("p",{className:"text-stone-500 max-w-md mx-auto",children:"You haven't been assigned to any zones yet. Please contact your administrator to get started with zone supervision."})]})]})]})]})};export{R as default};
