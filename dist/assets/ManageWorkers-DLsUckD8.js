import{j as e}from"./index-B9Qtw13a.js";import{r as l}from"./react-BeLGUnOF.js";import{L as ve}from"./LoadingSpinner-BctHBYsx.js";const c="http://localhost:4000",Ge=()=>{const[y,be]=l.useState([]),[p,ye]=l.useState([]),[b,je]=l.useState([]),[N,Ne]=l.useState([]),[M,we]=l.useState([]),[Ce,Se]=l.useState([]),[ke,K]=l.useState(!1),[Q,j]=l.useState(null),[X,Y]=l.useState(null),[w,Z]=l.useState(""),[C,T]=l.useState(""),[E,V]=l.useState({}),[ee,$e]=l.useState({}),[F,Ae]=l.useState({}),[v,I]=l.useState({}),[L,se]=l.useState(""),[Te,re]=l.useState({}),[_,De]=l.useState({}),[S,te]=l.useState(""),[z,oe]=l.useState(""),[B,ie]=l.useState(""),[k,ne]=l.useState(""),[O,ae]=l.useState(""),[H,le]=l.useState(""),[P,de]=l.useState(""),[J,ce]=l.useState(""),[d,m]=l.useState({}),[me,Me]=l.useState({}),[U,Ze]=l.useState({}),[$,he]=l.useState(""),[W,ue]=l.useState(""),[R,xe]=l.useState(""),[A,pe]=l.useState(""),i={primary:"#D97706",primaryHover:"#B45309",background:"#F3F4F6",cardBg:"#FFFFFF",border:"#E5E7EB",text:"#1E1E1E",textLight:"#6B7280",error:"#DC2626"};function h(){const t=localStorage.getItem("token");t&&(K(!0),j(null),fetch(`${c}/api/manageworkers/init`,{headers:{Authorization:`Bearer ${t}`}}).then(async o=>{const s=await o.json();if(!o.ok)throw new Error((s==null?void 0:s.error)||"Failed to load");const r=(s.supervisors||[]).map(a=>({id:a.id,username:a.username,vehicles:Array.isArray(a.vehicles)?a.vehicles.map(x=>({id:Number(x.id),plate:String(x.plate)})):[],zones:Array.isArray(a.zones)?a.zones.map(x=>({id:Number(x.id),name:String(x.name)})):[]}));be(r);const n=new Map((s.drivers||[]).map(a=>[Number(a.id),String(a.username)]));ye((s.vehicles||[]).map(a=>({id:Number(a.id),plate:String(a.plate),manpower:Array.isArray(a.manpower)?a.manpower.map(x=>({manpower_id:Number(x.manpower_id),username:String(x.username)})):[],drivers:Array.isArray(a.drivers)?a.drivers.map(x=>({user_id:Number(x.user_id),username:n.get(Number(x.user_id))})):[]}))),je((s.zones||[]).map(a=>({id:Number(a.id),name:String(a.zone_name),assigned_chief:a.assigned_chief??null,supervisor_id:a.supervisor_id??null}))),Ne((s.chiefs||[]).map(a=>({id:Number(a.id),username:String(a.username)}))),we((s.drivers||[]).map(a=>({id:Number(a.id),username:String(a.username)}))),Se((s.manpower||[]).map(a=>({id:Number(a.id),username:String(a.username)})))}).catch(o=>j((o==null?void 0:o.message)||"Failed to load")).finally(()=>K(!1)))}async function Ee(t){const o=localStorage.getItem("token");o&&(await fetch(`${c}/api/manageworkers/manpower/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`}}),h())}l.useEffect(()=>{h()},[]);function Ve(t){Y(t.id),Z(""),T("")}function ge(){Y(null),Z(""),T(""),V({})}async function Fe(t){const o=localStorage.getItem("token");if(o&&w!=="")try{m(r=>({...r,[`saveVehicle-${t}`]:!0}));const s=await fetch(`${c}/api/manageworkers/supervisors/${t}/vehicle`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({vehicleId:Number(w)})});if(s.status===409)if(window.confirm("This vehicle is already assigned to another supervisor. Do you want to move it to this supervisor?"))await fetch(`${c}/api/manageworkers/supervisors/${t}/vehicle/move`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({vehicleId:Number(w)})});else return;else if(!s.ok){const r=await s.json().catch(()=>({}));throw new Error((r==null?void 0:r.error)||"Failed to assign vehicle")}}catch(s){j((s==null?void 0:s.message)||"Failed to assign/move vehicle")}finally{ge(),h(),m(s=>({...s,[`saveVehicle-${t}`]:!1}))}}async function Ie(t,o){const s=localStorage.getItem("token");s&&(await fetch(`${c}/api/manageworkers/supervisors/${t}/vehicle/${o}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}}),h())}async function Le(t,o){const s=localStorage.getItem("token");if(s)try{m(n=>({...n,assignVehicleNoSup:!0}));const r=await fetch(`${c}/api/manageworkers/supervisors/${t}/vehicle`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({vehicleId:o})});if(r.status===409)if(window.confirm("This vehicle is already assigned to another supervisor. Do you want to move it to this supervisor?"))await fetch(`${c}/api/manageworkers/supervisors/${t}/vehicle/move`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({vehicleId:o})});else return;else if(!r.ok){const n=await r.json().catch(()=>({}));throw new Error((n==null?void 0:n.error)||"Failed to assign vehicle")}}catch(r){j((r==null?void 0:r.message)||"Failed to assign/move vehicle")}finally{ae(""),le(""),h(),m(r=>({...r,assignVehicleNoSup:!1}))}}async function _e(t){const o=localStorage.getItem("token");if(o&&C)try{m(r=>({...r,[`addZone-${t}`]:!0}));const s=await fetch(`${c}/api/manageworkers/supervisors/${t}/zones/add`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({zoneId:Number(C)})});if(s.status===409)if(await s.json().catch(()=>({})),window.confirm("This zone is already assigned to a supervisor. Do you want to move it to this supervisor?"))await fetch(`${c}/api/manageworkers/supervisors/${t}/zones/move`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({zoneId:Number(C)})});else return;else if(!s.ok){const r=await s.json().catch(()=>({}));throw new Error((r==null?void 0:r.error)||"Failed to add zone")}}catch(s){j((s==null?void 0:s.message)||"Failed to add/move zone")}finally{T(""),h(),m(s=>({...s,[`addZone-${t}`]:!1}))}}async function ze(t,o){const s=localStorage.getItem("token");if(s)try{m(n=>({...n,assignZoneNoSup:!0}));const r=await fetch(`${c}/api/manageworkers/supervisors/${t}/zones/add`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({zoneId:o})});if(r.status===409)if(await r.json().catch(()=>({})),window.confirm("This zone is already assigned to a supervisor. Do you want to move it to this supervisor?"))await fetch(`${c}/api/manageworkers/supervisors/${t}/zones/move`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({zoneId:o})});else return;else if(!r.ok){const n=await r.json().catch(()=>({}));throw new Error((n==null?void 0:n.error)||"Failed to add zone")}}catch(r){j((r==null?void 0:r.message)||"Failed to add/move zone")}finally{de(""),ce(""),h(),m(r=>({...r,assignZoneNoSup:!1}))}}async function Be(t,o){const s=localStorage.getItem("token");s&&(await fetch(`${c}/api/manageworkers/supervisors/${t}/zones/remove`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({zoneId:o})}),h())}async function Oe(t,o){const s=localStorage.getItem("token");if(!s)return;const r=Number(o);Number.isFinite(r)&&(m(n=>({...n,[`moveZone-${t}`]:!0})),await fetch(`${c}/api/manageworkers/supervisors/${r}/zones/move`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({zoneId:t})}),V(n=>({...n,[t]:""})),h(),m(n=>({...n,[`moveZone-${t}`]:!1})))}async function q(t,o){const s=localStorage.getItem("token");s&&(m(r=>({...r,[`setChief-${t}`]:!0})),await fetch(`${c}/api/manageworkers/zones/${t}/reassign-chief`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({chiefUserId:o})}),h(),m(r=>({...r,[`setChief-${t}`]:!1})))}async function He(t){const o=localStorage.getItem("token");o&&(m(s=>({...s,[`removeChief-${t}`]:!0})),await fetch(`${c}/api/manageworkers/zones/${t}/chief`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`}}),h(),m(s=>({...s,[`removeChief-${t}`]:!1})))}async function G(t,o){const s=localStorage.getItem("token");s&&(m(r=>({...r,[`assignDriver-${t}`]:!0})),await fetch(`${c}/api/manageworkers/drivers/${t}/vehicle`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({vehicleId:o})}),h(),m(r=>({...r,[`assignDriver-${t}`]:!1})))}async function Pe(t){const o=localStorage.getItem("token");o&&(await fetch(`${c}/api/manageworkers/drivers/${t}/vehicle`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`}}),h())}async function fe(t,o){const s=localStorage.getItem("token");s&&(m(r=>({...r,[`assignManpower-${t}`]:!0})),await fetch(`${c}/api/manageworkers/manpower/${t}/vehicle`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({vehicleId:o})}),h(),m(r=>({...r,[`assignManpower-${t}`]:!1})))}async function Je(t){const o=localStorage.getItem("token");o&&(await fetch(`${c}/api/manageworkers/manpower/${t}/vehicle`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`}}),h())}const D=({title:t,number:o})=>e.jsxs("div",{className:"flex items-center gap-3 mb-6 pb-3 border-b",style:{borderColor:i.border},children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm",style:{backgroundColor:i.primary},children:o}),e.jsx("h2",{className:"text-2xl font-bold",style:{color:i.text},children:t})]}),f=({title:t})=>e.jsx("h3",{className:"text-lg font-semibold mb-4 pb-2 border-b",style:{color:i.text,borderColor:i.border},children:t}),g=({children:t,className:o=""})=>e.jsx("div",{className:`rounded-lg shadow-sm border p-6 ${o}`,style:{backgroundColor:i.cardBg,borderColor:i.border},children:t}),u=({children:t,onClick:o,disabled:s=!1,loading:r=!1,className:n=""})=>e.jsxs("button",{onClick:o,disabled:s||r,className:`px-4 py-2 rounded-lg font-medium text-white transition-colors flex items-center gap-2 ${n}`,style:{backgroundColor:s?i.textLight:i.primary,cursor:s?"not-allowed":"pointer"},onMouseOver:a=>{!s&&!r&&(a.currentTarget.style.backgroundColor=i.primaryHover)},onMouseOut:a=>{!s&&!r&&(a.currentTarget.style.backgroundColor=i.primary)},children:[r&&e.jsx(ve,{size:16,className:"border-white/60 border-t-white"}),t]}),Ue=({children:t,onClick:o,disabled:s=!1,className:r=""})=>e.jsx("button",{onClick:o,disabled:s,className:`px-4 py-2 rounded-lg font-medium border transition-colors ${r}`,style:{color:i.text,borderColor:i.border,backgroundColor:"transparent",cursor:s?"not-allowed":"pointer"},onMouseOver:n=>{s||(n.currentTarget.style.backgroundColor=i.background)},onMouseOut:n=>{s||(n.currentTarget.style.backgroundColor="transparent")},children:t});return e.jsxs("div",{className:"p-6 space-y-8 min-h-screen",style:{backgroundColor:i.background},children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",style:{color:i.text},children:"Manage Workers"}),e.jsx("p",{className:"text-lg",style:{color:i.textLight},children:"Manage supervisors, chiefs, manpower, and drivers across your organization"})]}),Q&&e.jsx("div",{className:"p-4 rounded-lg text-white font-medium text-center",style:{backgroundColor:i.error},children:Q}),ke?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx(ve,{size:32,className:"border-gray-400 border-t-gray-600"})}):e.jsxs("div",{className:"space-y-12 max-w-7xl mx-auto",children:[e.jsxs("section",{children:[e.jsx(D,{title:"Manage Supervisors",number:1}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[y.map(t=>e.jsxs(g,{className:"hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:i.text},children:t.username}),e.jsxs("span",{className:"text-sm",style:{color:i.textLight},children:["ID: #",t.id]})]}),X===t.id?e.jsx(Ue,{onClick:ge,className:"text-sm px-3 py-1",children:"Close"}):e.jsx("button",{onClick:()=>Ve(t),className:"text-sm font-medium underline px-3 py-1 rounded",style:{color:i.primary},children:"Manage"})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",style:{color:i.textLight},children:"Assigned Vehicles:"}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:t.vehicles&&t.vehicles.length?t.vehicles.map(o=>e.jsx("span",{className:"px-2 py-1 text-xs rounded border",style:{borderColor:i.border},children:o.plate},o.id)):e.jsx("span",{className:"text-sm",style:{color:i.textLight},children:"None"})})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",style:{color:i.textLight},children:"Zones:"}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:t.zones&&t.zones.length?t.zones.map(o=>e.jsx("span",{className:"px-2 py-1 text-xs rounded border",style:{borderColor:i.border},children:o.name},o.id)):e.jsx("span",{className:"text-sm",style:{color:i.textLight},children:"None"})})]})]}),X===t.id&&e.jsxs("div",{className:"space-y-4 border-t pt-4",style:{borderColor:i.border},children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:i.text},children:"Assign Vehicle"}),e.jsxs("select",{value:w,onChange:o=>Z(o.target.value),className:"w-full border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:border-amber-600 focus:ring-amber-600",style:{borderColor:i.border},children:[e.jsx("option",{value:"",children:"Select a vehicle…"}),p.map(o=>e.jsx("option",{value:o.id,children:o.plate},o.id))]}),e.jsx("div",{className:"mt-2",children:e.jsx(u,{onClick:()=>Fe(t.id),disabled:!w||!!d[`saveVehicle-${t.id}`],loading:!!d[`saveVehicle-${t.id}`],className:"text-sm px-3 py-1",children:"Add Vehicle"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:i.text},children:"Unassign Vehicles"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.vehicles.map(o=>e.jsxs("button",{onClick:()=>Ie(t.id,o.id),className:"px-3 py-1 text-xs rounded-lg border flex items-center gap-1 transition-colors",style:{borderColor:i.border},onMouseOver:s=>s.currentTarget.style.backgroundColor=i.background,onMouseOut:s=>s.currentTarget.style.backgroundColor="transparent",children:[o.plate," ",e.jsx("span",{children:"✕"})]},o.id)),!t.vehicles.length&&e.jsx("div",{className:"text-sm",style:{color:i.textLight},children:"No vehicles to unassign"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:i.text},children:"Add Zone"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("select",{value:C,onChange:o=>T(o.target.value),className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},children:[e.jsx("option",{value:"",children:"Select a zone…"}),b.filter(o=>!t.zones.some(s=>s.id===o.id)).map(o=>e.jsx("option",{value:o.id,children:o.name},o.id))]}),e.jsx(u,{onClick:()=>_e(t.id),disabled:!C||!!d[`addZone-${t.id}`],loading:!!d[`addZone-${t.id}`],className:"text-sm px-3 py-1",children:"Add"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:i.text},children:"Remove Zones"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.zones.map(o=>e.jsxs("button",{onClick:()=>Be(t.id,o.id),className:"px-3 py-1 text-xs rounded-lg border flex items-center gap-1 transition-colors",style:{borderColor:i.border},onMouseOver:s=>s.currentTarget.style.backgroundColor=i.background,onMouseOut:s=>s.currentTarget.style.backgroundColor="transparent",children:[o.name," ",e.jsx("span",{children:"✕"})]},o.id)),!t.zones.length&&e.jsx("div",{className:"text-sm",style:{color:i.textLight},children:"No zones to remove"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:i.text},children:"Move Zones to Another Supervisor"}),e.jsxs("div",{className:"space-y-3",children:[t.zones.map(o=>e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2",children:[e.jsx("span",{className:"text-sm flex-1",style:{color:i.text},children:o.name}),e.jsxs("select",{value:E[o.id]||"",onChange:s=>V(r=>({...r,[o.id]:s.target.value})),className:"border rounded-lg px-2 py-1 text-sm",style:{borderColor:i.border},children:[e.jsx("option",{value:"",children:"Select supervisor…"}),y.filter(s=>s.id!==t.id).map(s=>e.jsx("option",{value:s.id,children:s.username},s.id))]}),e.jsx(u,{onClick:()=>Oe(o.id,E[o.id]),disabled:!E[o.id]||!!d[`moveZone-${o.id}`],loading:!!d[`moveZone-${o.id}`],className:"text-sm px-2 py-1",children:"Move"})]},o.id)),!t.zones.length&&e.jsx("div",{className:"text-sm",style:{color:i.textLight},children:"No zones to move"})]})]})]})]},t.id)),!y.length&&e.jsx(g,{children:e.jsx("div",{className:"text-center py-8",style:{color:i.textLight},children:"No supervisors found"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(g,{children:[e.jsx(f,{title:"Unassigned Vehicles"}),(()=>{const t=new Set;y.forEach(s=>(s.vehicles||[]).forEach(r=>t.add(r.id)));const o=p.filter(s=>!t.has(s.id));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:O,onChange:s=>ae(s.target.value),children:[e.jsx("option",{value:"",children:"Select vehicle…"}),o.map(s=>e.jsx("option",{value:s.id,children:s.plate},s.id))]}),e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:H,onChange:s=>le(s.target.value),children:[e.jsx("option",{value:"",children:"Select supervisor…"}),y.map(s=>e.jsx("option",{value:s.id,children:s.username},s.id))]}),e.jsx(u,{disabled:!O||!H||!!d.assignVehicleNoSup,loading:!!d.assignVehicleNoSup,onClick:()=>{const s=Number(O),r=Number(H);Number.isFinite(s)&&Number.isFinite(r)&&Le(r,s)},className:"text-sm whitespace-nowrap",children:"Assign"})]}),o.length===0&&e.jsx("div",{className:"text-sm text-center py-4",style:{color:i.textLight},children:"All vehicles are assigned to supervisors"})]})})()]}),e.jsxs(g,{children:[e.jsx(f,{title:"Unassigned Zones"}),(()=>{const t=new Set;y.forEach(s=>(s.zones||[]).forEach(r=>t.add(r.id)));const o=b.filter(s=>!t.has(s.id));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:P,onChange:s=>de(s.target.value),children:[e.jsx("option",{value:"",children:"Select zone…"}),o.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:J,onChange:s=>ce(s.target.value),children:[e.jsx("option",{value:"",children:"Select supervisor…"}),y.map(s=>e.jsx("option",{value:s.id,children:s.username},s.id))]}),e.jsx(u,{disabled:!P||!J||!!d.assignZoneNoSup,loading:!!d.assignZoneNoSup,onClick:()=>{const s=Number(P),r=Number(J);Number.isFinite(s)&&Number.isFinite(r)&&ze(r,s)},className:"text-sm whitespace-nowrap",children:"Assign"})]}),o.length===0&&e.jsx("div",{className:"text-sm text-center py-4",style:{color:i.textLight},children:"All zones are assigned to supervisors"})]})})()]})]})]}),e.jsxs("section",{children:[e.jsx(D,{title:"Manage Chiefs",number:2}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(g,{children:[e.jsx(f,{title:"Chiefs and Their Zones"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[N.map(t=>{const o=b.filter(s=>s.assigned_chief===t.id);return o.length===0?null:e.jsxs("div",{className:"border rounded-lg p-4",style:{borderColor:i.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-semibold",style:{color:i.text},children:t.username}),e.jsx("button",{onClick:()=>Me(s=>({...s,[t.id]:!s[t.id]})),className:"text-sm font-medium px-3 py-1 rounded border",style:{color:i.primary,borderColor:i.primary},children:me[t.id]?"Done":"Manage"})]}),e.jsx("div",{className:"space-y-3",children:o.map(s=>e.jsxs("div",{className:"flex items-center justify-between text-sm p-2 rounded border",style:{borderColor:i.border},children:[e.jsx("span",{style:{color:i.text},children:s.name}),me[t.id]&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-2 py-1 text-xs rounded border",style:{borderColor:i.border},disabled:!!d[`removeChief-${s.id}`],onClick:()=>He(s.id),children:"Unassign"}),e.jsxs("select",{className:"border rounded px-2 py-1 text-xs",style:{borderColor:i.border},value:U[s.id]||"",onChange:r=>Ze(n=>({...n,[s.id]:r.target.value})),children:[e.jsx("option",{value:"",children:"Move to…"}),N.filter(r=>r.id!==t.id).map(r=>e.jsx("option",{value:r.id,children:r.username},r.id))]}),e.jsx(u,{disabled:!U[s.id]||!!d[`setChief-${s.id}`],loading:!!d[`setChief-${s.id}`],onClick:()=>{const r=Number(U[s.id]);Number.isFinite(r)&&q(s.id,r)},className:"text-xs px-2 py-1",children:"Move"})]})]},s.id))})]},t.id)}),N.filter(t=>b.some(o=>o.assigned_chief===t.id)).length===0&&e.jsx("div",{className:"col-span-full text-center py-8",style:{color:i.textLight},children:"No chiefs with assigned zones"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(g,{children:[e.jsx(f,{title:"Zones Needing Chiefs"}),(()=>{const t=b.filter(s=>!s.assigned_chief),o=N.filter(s=>b.every(r=>r.assigned_chief!==s.id));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:$,onChange:s=>he(s.target.value),children:[e.jsx("option",{value:"",children:"Select zone…"}),t.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:W,onChange:s=>ue(s.target.value),children:[e.jsx("option",{value:"",children:"Select chief…"}),o.map(s=>e.jsx("option",{value:s.id,children:s.username},s.id))]}),e.jsx(u,{disabled:!$||!W||!!d[`setChief-${Number($)}`],loading:!!d[`setChief-${Number($)}`],onClick:()=>{const s=Number($),r=Number(W);Number.isFinite(s)&&Number.isFinite(r)&&q(s,r),he(""),ue("")},className:"text-sm whitespace-nowrap",children:"Assign"})]}),t.length===0&&e.jsx("div",{className:"text-sm text-center py-4",style:{color:i.textLight},children:"All zones have chiefs assigned"})]})})()]}),e.jsxs(g,{children:[e.jsx(f,{title:"Chiefs Without Zones"}),(()=>{const t=N.filter(s=>b.every(r=>r.assigned_chief!==s.id)),o=b.filter(s=>!s.assigned_chief);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:R,onChange:s=>xe(s.target.value),children:[e.jsx("option",{value:"",children:"Select chief…"}),t.map(s=>e.jsx("option",{value:s.id,children:s.username},s.id))]}),e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:A,onChange:s=>pe(s.target.value),children:[e.jsx("option",{value:"",children:"Select zone…"}),o.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx(u,{disabled:!R||!A||!!d[`setChief-${Number(A)}`],loading:!!d[`setChief-${Number(A)}`],onClick:()=>{const s=Number(R),r=Number(A);Number.isFinite(r)&&Number.isFinite(s)&&q(r,s),xe(""),pe("")},className:"text-sm whitespace-nowrap",children:"Assign"})]}),t.length===0&&e.jsx("div",{className:"text-sm text-center py-4",style:{color:i.textLight},children:"All chiefs have zones assigned"})]})})()]})]})]})]}),e.jsxs("section",{children:[e.jsx(D,{title:"Manage Manpower",number:3}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(g,{children:[e.jsx(f,{title:"Vehicles and Their Manpower"}),e.jsx("div",{className:"space-y-4",children:p.map(t=>e.jsxs("div",{className:"border rounded-lg p-4",style:{borderColor:i.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-semibold",style:{color:i.text},children:t.plate}),e.jsx("button",{onClick:()=>$e(o=>({...o,[t.id]:!o[t.id]})),className:"text-sm font-medium px-3 py-1 rounded border",style:{color:i.primary,borderColor:i.primary},children:ee[t.id]?"Done":"Manage"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(t.manpower||[]).length===0&&e.jsx("div",{className:"text-sm",style:{color:i.textLight},children:"No manpower assigned"}),(t.manpower||[]).map(o=>e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2 border rounded-lg px-3 py-2",style:{borderColor:i.border},children:[e.jsx("span",{className:"text-sm",style:{color:i.text},children:o.username}),ee[t.id]&&e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2",children:[e.jsx("button",{className:"px-2 py-1 text-xs rounded border",style:{borderColor:i.border},onClick:()=>Je(o.manpower_id),children:"Remove"}),e.jsxs("select",{className:"border rounded px-2 py-1 text-xs",style:{borderColor:i.border},value:F[o.manpower_id]||"",onChange:s=>Ae(r=>({...r,[o.manpower_id]:s.target.value})),children:[e.jsx("option",{value:"",children:"Move to…"}),p.filter(s=>s.id!==t.id).map(s=>e.jsx("option",{value:s.id,children:s.plate},s.id))]}),e.jsx(u,{disabled:!F[o.manpower_id]||!!d[`assignManpower-${o.manpower_id}`],loading:!!d[`assignManpower-${o.manpower_id}`],onClick:()=>{const s=Number(F[o.manpower_id]);Number.isFinite(s)&&fe(o.manpower_id,s)},className:"text-xs px-2 py-1",children:"Move"})]})]},o.manpower_id))]})]},t.id))})]}),e.jsxs(g,{children:[e.jsx(f,{title:"Unassigned Manpower"}),(()=>{const t=new Set;p.forEach(s=>(s.manpower||[]).forEach(r=>t.add(r.manpower_id)));const o=Ce.filter(s=>!t.has(s.id));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:L,onChange:s=>se(s.target.value),children:[e.jsx("option",{value:"",children:"Select vehicle…"}),p.map(s=>e.jsx("option",{value:s.id,children:s.plate},s.id))]}),e.jsx(u,{disabled:!L||Object.keys(v).filter(s=>v[Number(s)]).length===0,onClick:async()=>{const s=Object.keys(v).map(Number).filter(n=>v[n]),r=Number(L);for(const n of s)await fe(n,r);I({}),se("")},className:"text-sm whitespace-nowrap",children:"Assign Selected"}),e.jsx("button",{className:"px-4 py-2 rounded-lg font-medium border text-sm whitespace-nowrap",style:{borderColor:i.error,color:i.error},disabled:Object.keys(v).filter(s=>v[Number(s)]).length===0,onClick:async()=>{const s=Object.keys(v).map(Number).filter(n=>v[n]);if(!(!s.length||!window.confirm(`Delete ${s.length} manpower user(s)? This cannot be undone.`))){for(const n of s)await Ee(n);I({})}},children:"Delete Selected"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:[o.map(s=>e.jsxs("label",{className:"flex items-center gap-3 border rounded-lg p-3 cursor-pointer transition-colors hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",checked:!!v[s.id],onChange:r=>I(n=>({...n,[s.id]:r.target.checked})),className:"rounded",style:{accentColor:i.primary}}),e.jsx("span",{className:"text-sm",style:{color:i.text},children:s.username})]},s.id)),o.length===0&&e.jsx("div",{className:"col-span-full text-center py-8",style:{color:i.textLight},children:"No unassigned manpower"})]})]})})()]})]})]}),e.jsxs("section",{children:[e.jsx(D,{title:"Manage Drivers",number:4}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(g,{children:[e.jsx(f,{title:"Drivers and Their Vehicles"}),(()=>{const t=[],o=new Map(M.map(r=>[r.id,r]));p.forEach(r=>(r.drivers||[]).forEach(n=>{const a=n.user_id&&o.get(n.user_id);a&&t.push({driver:a,vehicle:r})}));const s=p.filter(r=>!r.drivers||r.drivers.length===0);return e.jsxs("div",{className:"space-y-3",children:[t.length===0&&e.jsx("div",{className:"text-center py-8",style:{color:i.textLight},children:"No drivers currently assigned to vehicles"}),t.map(({driver:r,vehicle:n})=>e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 p-3 border rounded-lg",style:{borderColor:i.border},children:[e.jsxs("div",{className:"text-sm min-w-0 flex-1 break-words",children:[e.jsx("span",{className:"font-medium",style:{color:i.text},children:r.username}),e.jsxs("span",{className:"ml-2",style:{color:i.textLight},children:["→ ",n.plate]})]}),e.jsx("div",{className:"flex items-center flex-wrap gap-2 sm:justify-end",children:Te[r.id]?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 w-full sm:w-auto",children:[e.jsx("button",{className:"px-3 py-1 text-xs rounded border",style:{borderColor:i.border},disabled:!!d[`assignDriver-${r.id}`],onClick:()=>Pe(r.id),children:"Remove"}),e.jsxs("select",{className:"border rounded px-2 py-1 text-xs min-w-[8rem]",style:{borderColor:i.border},value:_[r.id]||"",onChange:a=>De(x=>({...x,[r.id]:a.target.value})),children:[e.jsx("option",{value:"",children:"Move to…"}),s.filter(a=>a.id!==n.id).map(a=>e.jsx("option",{value:a.id,children:a.plate},a.id))]}),e.jsx(u,{disabled:!_[r.id]||!!d[`assignDriver-${r.id}`],loading:!!d[`assignDriver-${r.id}`],onClick:()=>{const a=Number(_[r.id]);Number.isFinite(a)&&G(r.id,a)},className:"text-xs px-2 py-1",children:"Move"}),e.jsx("button",{className:"px-3 py-1 text-xs rounded border",style:{borderColor:i.border},onClick:()=>re(a=>({...a,[r.id]:!1})),children:"Done"})]})}):e.jsx("button",{onClick:()=>re(a=>({...a,[r.id]:!0})),className:"text-sm font-medium px-3 py-1 rounded border",style:{color:i.primary,borderColor:i.primary},children:"Manage"})})]},`${r.id}-${n.id}`))]})})()]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(g,{children:[e.jsx(f,{title:"Drivers Without Vehicles"}),(()=>{const t=new Set;p.forEach(r=>(r.drivers||[]).forEach(n=>t.add(n.user_id)));const o=M.filter(r=>!t.has(r.id)),s=p.filter(r=>!r.drivers||r.drivers.length===0);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:S,onChange:r=>te(r.target.value),children:[e.jsx("option",{value:"",children:"Select driver…"}),o.map(r=>e.jsx("option",{value:r.id,children:r.username},r.id))]}),e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:z,onChange:r=>oe(r.target.value),children:[e.jsx("option",{value:"",children:"Select vehicle…"}),s.map(r=>e.jsx("option",{value:r.id,children:r.plate},r.id))]}),e.jsx(u,{disabled:!S||!z||!!d[`assignDriver-${Number(S)}`],loading:!!d[`assignDriver-${Number(S)}`],onClick:()=>{const r=Number(S),n=Number(z);Number.isFinite(r)&&Number.isFinite(n)&&G(r,n),te(""),oe("")},className:"text-sm whitespace-nowrap",children:"Assign"})]}),o.length===0&&e.jsx("div",{className:"text-sm text-center py-4",style:{color:i.textLight},children:"All drivers have vehicles assigned"})]})})()]}),e.jsxs(g,{children:[e.jsx(f,{title:"Vehicles Without Drivers"}),(()=>{const t=new Set;p.forEach(r=>(r.drivers||[]).forEach(n=>t.add(n.user_id)));const o=M.filter(r=>!t.has(r.id)),s=p.filter(r=>!r.drivers||r.drivers.length===0);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:B,onChange:r=>ie(r.target.value),children:[e.jsx("option",{value:"",children:"Select vehicle…"}),s.map(r=>e.jsx("option",{value:r.id,children:r.plate},r.id))]}),e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:i.border},value:k,onChange:r=>ne(r.target.value),children:[e.jsx("option",{value:"",children:"Select driver…"}),o.map(r=>e.jsx("option",{value:r.id,children:r.username},r.id))]}),e.jsx(u,{disabled:!B||!k||!!d[`assignDriver-${Number(k)}`],loading:!!d[`assignDriver-${Number(k)}`],onClick:()=>{const r=Number(B),n=Number(k);Number.isFinite(n)&&Number.isFinite(r)&&G(n,r),ie(""),ne("")},className:"text-sm whitespace-nowrap",children:"Assign"})]}),s.length===0&&e.jsx("div",{className:"text-sm text-center py-4",style:{color:i.textLight},children:"All vehicles have drivers assigned"})]})})()]})]})]})]})]})]})};export{Ge as default};
