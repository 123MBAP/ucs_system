import{u as U,j as e}from"./index-DnGg16Vn.js";import{r as i}from"./react-BeLGUnOF.js";import{c as V,R as Y,d as Z,M as G}from"./ui-DnAl6TrK.js";const u="http://localhost:4000",h={Client:s=>e.jsx("svg",{...s,className:`w-6 h-6 ${s.className||""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),Payment:s=>e.jsx("svg",{...s,className:`w-6 h-6 ${s.className||""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})}),Phone:s=>e.jsx("svg",{...s,className:`w-5 h-5 ${s.className||""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),Check:s=>e.jsx("svg",{...s,className:`w-5 h-5 ${s.className||""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),Loading:s=>e.jsx("svg",{...s,className:`w-5 h-5 animate-spin ${s.className||""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 2v4m0 12v4m8-10h-4M6 12H2"})}),Alert:s=>e.jsx("svg",{...s,className:`w-5 h-5 ${s.className||""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},se=()=>{const{t:s}=U(),L="John Client",[y,B]=i.useState(null),[w,z]=i.useState([]),[D,k]=i.useState([]),[K,_]=i.useState({}),$=i.useMemo(()=>[s("weekday.mon"),s("weekday.tue"),s("weekday.wed"),s("weekday.thu"),s("weekday.fri"),s("weekday.sat"),s("weekday.sun")],[s]),S=i.useMemo(()=>w.map(t=>$[(Number(t)||1)-1]).filter(Boolean),[w]),[c,T]=i.useState(null),[p,F]=i.useState(0),[N,I]=i.useState(""),[j,C]=i.useState(!1),[m,g]=i.useState({type:"idle"});i.useEffect(()=>{const t=localStorage.getItem("token");!t||!u||(async()=>{var r,n;try{const l=await fetch(`${u}/api/clients/me`,{headers:{Authorization:`Bearer ${t}`}}),a=await l.json();if(l.ok&&((r=a==null?void 0:a.client)!=null&&r.zone_id)){B(a.client.id),((n=a==null?void 0:a.client)==null?void 0:n.monthly_amount)!=null&&T(Number(a.client.monthly_amount));const d=await fetch(`${u}/api/zones/${a.client.zone_id}/service-days`,{headers:{Authorization:`Bearer ${t}`}}),x=await d.json();d.ok&&Array.isArray(x==null?void 0:x.serviceDays)&&z(x.serviceDays.map(b=>Number(b)).filter(b=>b>=1&&b<=7));const P=await fetch(`${u}/api/zones/${a.client.zone_id}/schedule`,{headers:{Authorization:`Bearer ${t}`}}),f=await P.json();P.ok&&Array.isArray(f==null?void 0:f.schedule)&&k(f.schedule);const A=await fetch(`${u}/api/payments/statements`,{headers:{Authorization:`Bearer ${t}`}}),v=await A.json();if(A.ok&&Array.isArray(v==null?void 0:v.payments)){const b=new Date,W=b.getFullYear(),O=b.getMonth(),H=v.payments.filter(o=>(o==null?void 0:o.client_id)===a.client.id&&(o==null?void 0:o.completed_at)).map(o=>({amt:Number(o.amount)||0,dt:new Date(o.completed_at)})).filter(({dt:o})=>o.getFullYear()===W&&o.getMonth()===O).reduce((o,{amt:J})=>o+J,0);F(H)}}}catch{}})()},[]);const E=t=>{if(!t||t.supervisor_status!=="complete"||!t.supervisor_decided_at)return!1;const r=new Date(t.supervisor_decided_at),n=new Date(r.getTime()+1440*60*1e3),l=new Date<=n,a=(t.complained_client_ids||[]).includes(y||-1);return l&&!a},M=i.useMemo(()=>{const t=new Date;return D.filter(r=>{if(r.supervisor_status!=="complete"||!r.supervisor_decided_at)return!0;const n=new Date(r.supervisor_decided_at),l=new Date(n.getTime()+1440*60*1e3);return(r.complained_client_ids||[]).includes(y||-1)||t<=l})},[D,y]),q=async t=>{var n;const r=localStorage.getItem("token");if(r)try{_(d=>({...d,[t]:!0}));const l=await fetch(`${u}/api/clients/complaints`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({scheduleId:t})}),a=await l.json();l.ok&&((n=a==null?void 0:a.schedule)!=null&&n.complained_client_ids)&&k(d=>d.map(x=>x.id===t?{...x,complained_client_ids:a.schedule.complained_client_ids}:x))}finally{_(l=>({...l,[t]:!1}))}},R=async t=>{if(t.preventDefault(),!/^\+?\d{9,15}$/.test(N)){g({type:"error",message:s("clientDashboard.pay.phoneInvalid")});return}C(!0),g({type:"pending",message:s("clientDashboard.pay.initiated")});try{const r=localStorage.getItem("token");if(!r||c==null){g({type:"error",message:s("clientDashboard.pay.missing")});return}const n=Number(c),l=await fetch(`${u}/api/payments/transactions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({amount:n,phoneNumber:N})}),a=await l.json().catch(()=>({}));if(!l.ok)throw new Error((a==null?void 0:a.error)||"Failed to initiate payment");g({type:"pending",message:s("clientDashboard.pay.requestSent")})}catch(r){g({type:"error",message:(r==null?void 0:r.message)||s("clientDashboard.pay.failed")})}finally{C(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gray-50 p-4 sm:p-6 lg:p-8",children:[e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6 sm:space-y-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold ucs-gradient-text",children:s("clientDashboard.title")}),e.jsx("p",{className:"text-gray-600 mt-2 text-sm sm:text-base",children:s("clientDashboard.subtitle")})]}),e.jsx("div",{className:"flex items-center space-x-4 mt-4 sm:mt-0",children:e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[e.jsx("div",{className:"w-2 h-2 bg-green-600 rounded-full animate-pulse"}),e.jsx("span",{children:s("clientDashboard.accountActive")})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 sm:gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6 sm:space-y-8",children:[e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6 transition-all duration-300 hover:shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-600",children:s("client.profile")}),e.jsx("span",{className:"text-xs text-green-600 bg-green-50 px-2 py-1 rounded-full font-medium border border-green-200",children:s("common.verified")})]}),e.jsx("p",{className:"text-xl sm:text-2xl font-bold text-charcoal",children:L}),e.jsx("p",{className:"text-gray-600 mt-1 text-sm sm:text-base",children:s("clientDashboard.activeClient")})]}),e.jsx("div",{className:"w-14 h-14 sm:w-16 sm:h-16 bg-gradient-to-br from-amber-500 to-amber-600 rounded-2xl flex items-center justify-center shadow-lg",children:e.jsx(h.Client,{})})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-5 transition-all duration-300 hover:shadow-md",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-3",children:e.jsx("span",{className:"text-sm font-semibold text-gray-600",children:s("clientDashboard.serviceDay")})}),e.jsx("p",{className:"text-gray-600 text-sm mb-2",children:s("clientDashboard.serviceDayDesc")}),e.jsx("p",{className:"text-lg sm:text-xl font-bold text-charcoal",children:S.length?S.join(", "):s("clientDashboard.notSet")})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-5 transition-all duration-300 hover:shadow-md",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-3",children:e.jsx("span",{className:"text-sm font-semibold text-gray-600",children:s("clientDashboard.amountToPay")})}),e.jsx("p",{className:"text-lg sm:text-xl font-bold text-charcoal",children:c!=null?`$${c.toLocaleString()}`:s("clientDashboard.amountToPayUnknown")}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:s("clientDashboard.monthlyAmountLabel")}),c!=null&&e.jsxs("p",{className:"text-gray-500 text-xs mt-2",children:[s("clientDashboard.remainingThisMonth")," $",Math.max(0,c-p).toLocaleString()]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-5 transition-all duration-300 hover:shadow-md",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(h.Payment,{className:"w-4 h-4 text-amber-600"}),e.jsx("span",{className:"text-sm font-semibold text-gray-600",children:s("clientDashboard.paidThisMonth")})]}),e.jsxs("p",{className:"text-lg sm:text-xl font-bold text-charcoal",children:["$",p.toLocaleString()]}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:s("clientDashboard.totalPaidThisMonth")}),c!=null&&e.jsxs("div",{className:"flex items-center space-x-2 mt-3",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${p>=c?"bg-green-600":"bg-amber-500"}`}),e.jsx("span",{className:`text-xs font-medium ${p>=c?"text-green-600":"text-amber-600"}`,children:p>=c?s("clientDashboard.paymentUpToDate"):s("clientDashboard.paymentPending")})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-5",children:[e.jsx("h3",{className:"text-sm font-semibold text-charcoal mb-4",children:s("clientDashboard.quickActions")}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{label:s("clientDashboard.qa.paymentHistory"),Icon:V,color:"text-amber-600 bg-amber-50"},{label:s("clientDashboard.qa.receipts"),Icon:Y,color:"text-green-600 bg-green-50"},{label:s("clientDashboard.qa.profile"),Icon:Z,color:"text-charcoal bg-gray-100"},{label:s("clientDashboard.qa.support"),Icon:G,color:"text-gray-600 bg-gray-50"}].map(({label:t,Icon:r,color:n},l)=>e.jsxs("button",{className:"flex flex-col items-center justify-center p-3 bg-gray-50 rounded-lg hover:bg-amber-50 border border-gray-200 hover:border-amber-200 transition-all duration-200 group",children:[e.jsx("span",{className:`mb-2 p-2 rounded-lg ${n}`,children:e.jsx(r,{className:"h-4 w-4"})}),e.jsx("span",{className:"text-xs font-medium text-charcoal text-center group-hover:text-amber-700",children:t})]},l))})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-4",children:e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-charcoal",children:s("clientDashboard.serviceSchedule")})}),M.length===0?e.jsx("div",{className:"text-gray-600 text-center py-8",children:s("clientDashboard.noSchedule")}):e.jsx("div",{className:"space-y-3",children:M.map(t=>{var a,d;const r=$[(Number(t.service_day)||1)-1]||"",n=t.supervisor_status,l=n==null?{text:s("clientDashboard.badge.pending"),cls:"bg-amber-50 text-amber-700 border-amber-200"}:n==="complete"?{text:s("clientDashboard.badge.completed"),cls:"bg-green-50 text-green-700 border-green-200"}:{text:s("clientDashboard.badge.notCompleted"),cls:"bg-red-50 text-red-700 border-red-200"};return e.jsx("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-charcoal font-semibold text-sm sm:text-base",children:r}),e.jsxs("div",{className:"text-gray-600 text-xs sm:text-sm",children:[(a=t.service_start)==null?void 0:a.slice(0,5)," - ",(d=t.service_end)==null?void 0:d.slice(0,5)]})]}),e.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded-lg border ${l.cls} self-start sm:self-auto`,children:l.text})]}),e.jsxs("div",{className:"text-gray-500 text-xs mt-2",children:[t.vehicle_plate?`${s("clientDashboard.vehiclePrefix")} ${t.vehicle_plate}`:"",t.vehicle_plate&&t.driver_username?" • ":"",t.driver_username?`${s("clientDashboard.driverPrefix")} ${t.driver_username}`:""]}),n==="not_complete"&&t.supervisor_reason&&e.jsxs("div",{className:"text-red-600 text-xs mt-2",children:[s("clientDashboard.reasonPrefix")," ",t.supervisor_reason]}),n==="complete"&&(t.complained_client_ids||[]).includes(y||-1)&&e.jsx("div",{className:"text-amber-700 text-xs mt-2",children:s("clientDashboard.complaintSubmitted")}),n==="complete"&&E(t)&&e.jsx("button",{className:"text-xs text-amber-700 font-medium mt-2 hover:text-amber-800 transition-colors",onClick:()=>q(t.id),children:s("clientDashboard.complainCta")})]})},t.id)})})]})]}),e.jsx("div",{className:"space-y-6 sm:space-y-8",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6 sticky top-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-6",children:[e.jsx(h.Payment,{className:"w-5 h-5 text-amber-600"}),e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-charcoal",children:s("payment.makePayment")})]}),m.type!=="idle"&&e.jsx("div",{className:`mb-6 p-4 rounded-xl border transition-all duration-300 ${m.type==="pending"?"bg-amber-50 border-amber-200 text-amber-700":m.type==="success"?"bg-green-50 border-green-200 text-green-700":m.type==="error"?"bg-red-50 border-red-200 text-red-700":""}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[m.type==="pending"&&e.jsx(h.Loading,{}),m.type==="success"&&e.jsx(h.Check,{}),m.type==="error"&&e.jsx(h.Alert,{}),e.jsx("span",{className:"font-medium text-sm",children:m.message})]})}),e.jsxs("form",{onSubmit:R,className:"space-y-6",children:[c!=null&&e.jsxs("div",{className:"p-3 bg-amber-50 rounded-xl border border-amber-200",children:[e.jsx("div",{className:"text-xs text-amber-700",children:s("clientDashboard.amountToPay")}),e.jsx("div",{className:"text-lg font-bold text-charcoal",children:`$${Number(c).toLocaleString()}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-charcoal mb-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h.Phone,{className:"w-4 h-4 text-amber-600"}),e.jsx("span",{children:s("payment.phoneNumber")})]})}),e.jsx("input",{type:"tel",value:N,onChange:t=>I(t.target.value),placeholder:s("clientDashboard.pay.phonePlaceholder"),className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent transition-all duration-200 text-charcoal placeholder-gray-400",disabled:j}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:s("clientDashboard.pay.phoneHelp")})]}),e.jsx("button",{type:"submit",disabled:j,className:`w-full flex items-center justify-center space-x-2 py-4 rounded-xl font-semibold shadow-sm transition-all duration-200 ${j?"bg-amber-400 cursor-not-allowed":"bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 hover:shadow-md"}`,children:j?e.jsxs(e.Fragment,{children:[e.jsx(h.Loading,{}),e.jsx("span",{className:"text-white text-sm",children:s("payment.processing")})]}):e.jsx("span",{className:"text-white text-sm",children:s("payment.payNow")})})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-xl border border-gray-200",children:[e.jsx("h3",{className:"text-sm font-semibold text-charcoal mb-2",children:s("payment.infoTitle")}),e.jsxs("ul",{className:"text-xs text-gray-600 space-y-1",children:[e.jsxs("li",{children:["• ",s("clientDashboard.info.paymentsProcessed")]}),e.jsxs("li",{children:["• ",s("clientDashboard.info.stkPush")]}),e.jsxs("li",{children:["• ",s("clientDashboard.info.fees")]}),e.jsxs("li",{children:["• ",s("clientDashboard.info.receipts")]})]})]})]})})]})]}),e.jsx("style",{children:`
        .text-charcoal {
          color: #1E1E1E;
        }
        .bg-amber-50 {
          background-color: #FFFBEB;
        }
        .bg-amber-500 {
          background-color: #D97706;
        }
        .bg-amber-600 {
          background-color: #B45309;
        }
        .text-amber-600 {
          color: #D97706;
        }
        .text-amber-700 {
          color: #B45309;
        }
        .border-amber-200 {
          border-color: #FCD34D;
        }
        .bg-green-50 {
          background-color: #F0FDF4;
        }
        .text-green-600 {
          color: #15803D;
        }
        .border-green-200 {
          border-color: #BBF7D0;
        }
      `})]})};export{se as default};
