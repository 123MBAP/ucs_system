import{j as e}from"./index-8yk-1D8L.js";import{r as a,u as H,L as K}from"./react-CzDbI3ao.js";const f="http://localhost:4000",X=()=>{const[A,E]=a.useState(""),[L,F]=a.useState(""),[h,j]=a.useState(""),[p,b]=a.useState(!1),[g,x]=a.useState("existing"),[m,I]=a.useState("existing"),[N,w]=a.useState(null),[D,V]=a.useState([]),[J,Y]=a.useState([]),[v,_]=a.useState(""),[y,r]=a.useState(!1),[q,k]=a.useState(null),[S,B]=a.useState(""),[C,M]=a.useState(""),[z,P]=a.useState(""),[Z,R]=a.useState(""),[O,o]=a.useState(null),T=H(),U=new URLSearchParams(T.search),d=U.get("reassign")==="1",u=U.get("zoneId");a.useEffect(()=>{const s=localStorage.getItem("token");s&&(fetch(`${f}/api/zones`,{headers:{Authorization:`Bearer ${s}`}}).then(async i=>{const l=await i.json();if(!i.ok)throw new Error((l==null?void 0:l.error)||"Failed to load zones");const c=(l.zones||[]).map(n=>({id:String(n.id),name:n.zone_name}));V(c);const t=u;t&&c.some(n=>n.id===String(t))&&(b(!0),x("existing"),w(String(t)))}).catch(i=>{console.error("Load zones error:",i)}),fetch(`${f}/api/manager/users?role=chief`,{headers:{Authorization:`Bearer ${s}`}}).then(async i=>{const l=await i.json();if(!i.ok)throw new Error((l==null?void 0:l.error)||"Failed to load chiefs");const c=(l.users||[]).map(t=>({id:String(t.id),username:t.username}));Y(c)}).catch(i=>console.error("Load chiefs error:",i)))},[T.search]);function G(s){if(s.preventDefault(),o(null),k(null),r(!0),d&&m==="existing"){const t=localStorage.getItem("token");if(!t){o("You must be logged in as manager to reassign a chief."),r(!1);return}if(!u){o("Missing zoneId to reassign."),r(!1);return}if(!v){o("Select a chief to assign."),r(!1);return}fetch(`${f}/api/manager/zones/${u}/reassign-chief`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({chiefUserId:Number(v)})}).then(async n=>{const $=await n.json();if(!n.ok)throw new Error(($==null?void 0:$.error)||"Failed to reassign chief");k("Chief reassigned successfully.")}).catch(n=>o(n.message||"Failed to reassign chief")).finally(()=>r(!1));return}if(!A.trim()||!L.trim()||!h.trim()){o("First name, last name, and username/email are required."),r(!1);return}let i=null;if(p)if(g==="existing"){if(!N){o("Please select an existing zone to assign."),r(!1);return}i={type:"existing",zoneId:N}}else{if(!S.trim()||!C.trim()||!z.trim()||!Z.trim()){o("All new zone fields are required when creating a new zone."),r(!1);return}i={type:"new",zone:{name:S,cell:C,village:z,description:Z}}}const l={username:h,assigned:i},c=localStorage.getItem("token");if(!c){o("You must be logged in as manager to create a chief."),r(!1);return}fetch(`${f}/api/manager/chiefs`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify(l)}).then(async t=>{const n=await t.json();if(!t.ok)throw new Error((n==null?void 0:n.error)||"Failed to create chief");k(`Chief created. Temporary password: ${n.tempPassword}`),E(""),F(""),j(""),b(!1),x("existing"),w(null),B(""),M(""),P(""),R("")}).catch(t=>o(t.message||"Failed to create chief")).finally(()=>r(!1))}return e.jsxs("div",{className:"p-6 max-w-2xl",children:[d&&u&&e.jsx("div",{className:"mb-2",children:e.jsx(K,{to:`/zones/${u}`,className:"text-blue-600 underline text-sm",children:"← Back to Zone"})}),e.jsx("h2",{className:"text-2xl font-bold mb-4",children:d?"Reassign Chief of the Zone":"Register Chief of Zone"}),e.jsxs("form",{onSubmit:G,className:"space-y-4",children:[O&&e.jsx("div",{className:"text-red-600",children:O}),q&&e.jsx("div",{className:"text-green-600",children:q}),!(d&&m==="existing")&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"First Name"}),e.jsx("input",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",value:A,onChange:s=>E(s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Last Name"}),e.jsx("input",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",value:L,onChange:s=>F(s.target.value),required:!0})]})]}),!d&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Username or Email"}),e.jsx("input",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",value:h,onChange:s=>j(s.target.value),required:!0})]}),d&&e.jsxs("div",{className:"p-4 border rounded-md",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",name:"mode",value:"existing",checked:m==="existing",onChange:()=>I("existing"),className:"mr-2"}),e.jsx("span",{children:"Assign to an existing chief"})]}),e.jsxs("label",{className:"inline-flex items-center ml-6",children:[e.jsx("input",{type:"radio",name:"mode",value:"new",checked:m==="new",onChange:()=>I("new"),className:"mr-2"}),e.jsx("span",{children:"Create a new chief"})]})]}),m==="existing"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Select Chief"}),e.jsxs("select",{value:v,onChange:s=>_(s.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",children:[e.jsx("option",{value:"",children:"-- Select chief --"}),J.map(s=>e.jsx("option",{value:s.id,children:s.username},s.id))]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Username or Email"}),e.jsx("input",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",value:h,onChange:s=>j(s.target.value)})]})]}),e.jsx("div",{className:"pt-2",children:e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:s=>b(s.target.checked),className:"mr-2"}),e.jsx("span",{children:"Assign Zone (optional)"})]})}),p&&e.jsxs("div",{className:"p-4 border rounded-md",children:[e.jsxs("div",{className:"space-x-4 mb-3",children:[e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",name:"assignMode",value:"existing",checked:g==="existing",onChange:()=>x("existing"),className:"mr-2"}),e.jsx("span",{children:"Assign to existing zone"})]}),e.jsxs("label",{className:"inline-flex items-center ml-4",children:[e.jsx("input",{type:"radio",name:"assignMode",value:"new",checked:g==="new",onChange:()=>x("new"),className:"mr-2"}),e.jsx("span",{children:"Assign to new zone"})]})]}),g==="existing"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Select Zone"}),e.jsxs("select",{value:N??"",onChange:s=>w(s.target.value||null),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",children:[e.jsx("option",{value:"",children:"-- Select zone --"}),D.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Zone Name"}),e.jsx("input",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",value:S,onChange:s=>B(s.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Cell"}),e.jsx("input",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",value:C,onChange:s=>M(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Village"}),e.jsx("input",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",value:z,onChange:s=>P(s.target.value)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Location Description"}),e.jsx("textarea",{rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",value:Z,onChange:s=>R(s.target.value)})]})]})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:y,className:`px-4 py-2 text-white rounded-md ${y?"bg-blue-400":"bg-blue-600 hover:bg-blue-700"}`,children:y?"Creating…":"Create Chief"})})]})]})};export{X as default};
