import{u as A,j as e}from"./index-DnGg16Vn.js";import{r as d}from"./react-BeLGUnOF.js";import{d as E,i as g,T as B,W as $}from"./ui-DnAl6TrK.js";const y="http://localhost:4000",C=()=>{var b,v,j,w,f;const{t:r}=A(),[c,z]=d.useState(null),[l,k]=d.useState({name:"",salary:null,vehicle:null,driver:null,supervisor:null}),[o,p]=d.useState(!1),[h,_]=d.useState([]);return d.useEffect(()=>{const t=localStorage.getItem("token");t&&(p(!0),fetch(`${y}/api/manpower/dashboard`,{headers:{Authorization:`Bearer ${t}`}}).then(async n=>{var i,m,x;const s=await n.json();if(!n.ok)throw new Error((s==null?void 0:s.error)||"Failed to load dashboard");z(s.user);const a=[(i=s==null?void 0:s.user)==null?void 0:i.first_name,(m=s==null?void 0:s.user)==null?void 0:m.last_name].filter(Boolean).join(" ")||((x=s==null?void 0:s.user)==null?void 0:x.username)||"";k({name:a,salary:(s==null?void 0:s.salary)??null,vehicle:(s==null?void 0:s.vehicle)??null,driver:(s==null?void 0:s.driver)??null,supervisor:(s==null?void 0:s.supervisor)??null})}).catch(n=>console.error("Load manpower profile error:",n)).finally(()=>p(!1)),fetch(`${y}/api/manpower/schedule`,{headers:{Authorization:`Bearer ${t}`}}).then(async n=>{const s=await n.json();if(!n.ok)throw new Error((s==null?void 0:s.error)||"Failed to load schedule");_(Array.isArray(s.schedule)?s.schedule:[])}).catch(n=>console.error("Load manpower schedule error:",n)))},[]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-zinc-800 to-amber-600 bg-clip-text text-transparent",children:r("manpower.title")}),e.jsx("p",{className:"text-zinc-600 mt-2",children:r("manpower.subtitle")})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-4 sm:mt-0 text-sm text-zinc-500",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{children:r("manpower.profileActive")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-600",children:r("manpower.name")}),e.jsx("div",{className:"text-2xl font-bold text-zinc-900 mt-1",children:o?"…":l.name||"-"})]}),e.jsx("div",{className:"shrink-0 p-2 rounded-lg bg-amber-50 text-amber-600",children:e.jsx(E,{className:"h-8 w-8"})})]})}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-600",children:r("manpower.assignedVehicle")}),e.jsx("div",{className:"text-2xl font-bold text-zinc-900 mt-1",children:o?"…":((b=l.vehicle)==null?void 0:b.plate)||r("manpower.notAssigned")}),e.jsxs("div",{className:"text-sm text-zinc-600 mt-2 flex items-center gap-1",children:[e.jsx(g,{className:"w-4 h-4"})," ",r("manpower.driver"),": ",o?"…":((v=l.driver)==null?void 0:v.full_name)||((j=l.driver)==null?void 0:j.username)||"-"]}),e.jsxs("div",{className:"text-sm text-zinc-600 mt-1 flex items-center gap-1",children:[e.jsx(g,{className:"w-4 h-4"})," ",r("manpower.supervisor"),": ",o?"…":((w=l.supervisor)==null?void 0:w.full_name)||((f=l.supervisor)==null?void 0:f.username)||"-"]})]}),e.jsx("div",{className:"shrink-0 p-2 rounded-lg bg-amber-50 text-amber-600",children:e.jsx(B,{className:"h-8 w-8"})})]})}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-600",children:r("manpower.salary")}),e.jsx("div",{className:"text-2xl font-bold text-zinc-900 mt-1",children:o?"…":l.salary!=null?l.salary.toLocaleString():"Not set"})]}),e.jsx("div",{className:"shrink-0 p-2 rounded-lg bg-emerald-50 text-emerald-600",children:e.jsx($,{className:"h-8 w-8"})})]})})]}),(()=>{const t=d.useMemo(()=>{const n=new Set;for(const s of h){const a=s.assigned_manpower_usernames||[];for(const i of a)n.add(i)}return c!=null&&c.username&&n.delete(c.username),Array.from(n)},[h,c]);return t.length>0?e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("h3",{className:"text-sm font-semibold text-zinc-700",children:r("manpower.team")})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.map(n=>e.jsx("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-amber-50 text-amber-700 border border-amber-200",children:n},n))})]}):null})(),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-4",children:e.jsx("h2",{className:"text-xl font-bold text-zinc-800",children:r("manpower.schedule.title")})}),h.length===0?e.jsx("div",{className:"text-zinc-600",children:r("manpower.schedule.none")}):e.jsx("div",{className:"space-y-4",children:h.map(t=>{var x,N;const s=[r("weekday.mon"),r("weekday.tue"),r("weekday.wed"),r("weekday.thu"),r("weekday.fri"),r("weekday.sat"),r("weekday.sun")][(Number(t.service_day)||1)-1]||"",a=t.supervisor_status,i=a==null?{text:r("status.pending"),cls:"bg-amber-50 text-amber-700 border-amber-200"}:a==="complete"?{text:r("status.completed"),cls:"bg-emerald-50 text-emerald-700 border-emerald-200"}:{text:r("status.notCompleted"),cls:"bg-red-50 text-red-700 border-red-200"},m=(()=>{const u=t.assigned_manpower_names,S=t.assigned_manpower_usernames??[];return(u&&u.length?u:S)||[]})();return e.jsxs("div",{className:"rounded-xl border border-zinc-100 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-zinc-900 font-semibold",children:s}),e.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded-lg border ${i.cls}`,children:i.text})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"rounded-lg bg-zinc-50 p-3",children:[e.jsx("div",{className:"text-xs text-zinc-500",children:r("manpower.vehicle")}),e.jsx("div",{className:"text-sm font-semibold text-zinc-800",children:t.vehicle_plate||"-"})]}),e.jsxs("div",{className:"rounded-lg bg-zinc-50 p-3",children:[e.jsx("div",{className:"text-xs text-zinc-500",children:r("manpower.driver")}),e.jsx("div",{className:"text-sm font-semibold text-zinc-800",children:t.driver_username||"-"})]}),e.jsxs("div",{className:"rounded-lg bg-zinc-50 p-3",children:[e.jsx("div",{className:"text-xs text-zinc-500",children:r("common.serviceStart")}),e.jsx("div",{className:"text-sm font-semibold text-zinc-800",children:((x=t.service_start)==null?void 0:x.slice(0,5))||"-"})]}),e.jsxs("div",{className:"rounded-lg bg-zinc-50 p-3",children:[e.jsx("div",{className:"text-xs text-zinc-500",children:r("common.serviceEnd")}),e.jsx("div",{className:"text-sm font-semibold text-zinc-800",children:((N=t.service_end)==null?void 0:N.slice(0,5))||"-"})]})]}),e.jsxs("div",{className:"mt-3 text-xs text-zinc-600 space-y-1",children:[!!t.zone_name&&e.jsxs("div",{children:[r("manpower.zone"),": ",t.zone_name]}),m.length>0&&e.jsxs("div",{children:[r("manpower.team"),": ",m.join(", ")]}),a==="not_complete"&&t.supervisor_reason&&e.jsxs("div",{className:"text-red-600",children:[r("manpower.reason"),": ",t.supervisor_reason]})]})]},t.id)})})]})]})};export{C as default};
