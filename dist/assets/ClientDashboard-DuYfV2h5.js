import{j as e}from"./index-DZTFkylD.js";import{r as i}from"./react-CzDbI3ao.js";import{c as H,R as J,d as O,M as U}from"./ui-fx2JTPqr.js";const u="http://localhost:4000",o={Client:()=>e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),Payment:()=>e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})}),Phone:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),Check:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),Loading:()=>e.jsx("svg",{className:"w-5 h-5 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 2v4m0 12v4m8-10h-4M6 12H2"})}),Alert:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},Q=()=>{const D="John Client",[b,L]=i.useState(null),[y,z]=i.useState([]),[N,w]=i.useState([]),[Z,k]=i.useState({}),_=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],S=i.useMemo(()=>y.map(t=>_[(Number(t)||1)-1]).filter(Boolean),[y]),[d,T]=i.useState(null),[p,B]=i.useState(0),[P,R]=i.useState(""),[j,C]=i.useState(!1),[m,g]=i.useState({type:"idle"});i.useEffect(()=>{const t=localStorage.getItem("token");!t||!u||(async()=>{var a,n;try{const r=await fetch(`${u}/api/clients/me`,{headers:{Authorization:`Bearer ${t}`}}),s=await r.json();if(r.ok&&((a=s==null?void 0:s.client)!=null&&a.zone_id)){L(s.client.id),((n=s==null?void 0:s.client)==null?void 0:n.monthly_amount)!=null&&T(Number(s.client.monthly_amount));const c=await fetch(`${u}/api/zones/${s.client.zone_id}/service-days`,{headers:{Authorization:`Bearer ${t}`}}),x=await c.json();c.ok&&Array.isArray(x==null?void 0:x.serviceDays)&&z(x.serviceDays.map(h=>Number(h)).filter(h=>h>=1&&h<=7));const $=await fetch(`${u}/api/zones/${s.client.zone_id}/schedule`,{headers:{Authorization:`Bearer ${t}`}}),f=await $.json();$.ok&&Array.isArray(f==null?void 0:f.schedule)&&w(f.schedule);const A=await fetch(`${u}/api/payments/statements`,{headers:{Authorization:`Bearer ${t}`}}),v=await A.json();if(A.ok&&Array.isArray(v==null?void 0:v.payments)){const h=new Date,V=h.getFullYear(),E=h.getMonth(),F=v.payments.filter(l=>(l==null?void 0:l.client_id)===s.client.id&&(l==null?void 0:l.completed_at)).map(l=>({amt:Number(l.amount)||0,dt:new Date(l.completed_at)})).filter(({dt:l})=>l.getFullYear()===V&&l.getMonth()===E).reduce((l,{amt:Y})=>l+Y,0);B(F)}}}catch{}})()},[]);const W=t=>{if(!t||t.supervisor_status!=="complete"||!t.supervisor_decided_at)return!1;const a=new Date(t.supervisor_decided_at),n=new Date(a.getTime()+1440*60*1e3),r=new Date<=n,s=(t.complained_client_ids||[]).includes(b||-1);return r&&!s},M=i.useMemo(()=>{const t=new Date;return N.filter(a=>{if(a.supervisor_status!=="complete"||!a.supervisor_decided_at)return!0;const n=new Date(a.supervisor_decided_at),r=new Date(n.getTime()+1440*60*1e3);return(a.complained_client_ids||[]).includes(b||-1)||t<=r})},[N,b]),X=async t=>{var n;const a=localStorage.getItem("token");if(a)try{k(c=>({...c,[t]:!0}));const r=await fetch(`${u}/api/clients/complaints`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({scheduleId:t})}),s=await r.json();r.ok&&((n=s==null?void 0:s.schedule)!=null&&n.complained_client_ids)&&w(c=>c.map(x=>x.id===t?{...x,complained_client_ids:s.schedule.complained_client_ids}:x))}finally{k(r=>({...r,[t]:!1}))}},I=async t=>{if(t.preventDefault(),!/^\+?\d{9,15}$/.test(P)){g({type:"error",message:"Enter a valid phone number (9-15 digits, optionally starting with +)."});return}C(!0),g({type:"pending",message:"Payment initiated. Please confirm on your phone…"});try{await new Promise(a=>setTimeout(a,1500)),await new Promise(a=>setTimeout(a,3e3)),g({type:"success",message:"Payment confirmed on your phone. Thank you!"})}catch{g({type:"error",message:"Payment failed. Please try again."})}finally{C(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 p-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-slate-800 to-blue-600 bg-clip-text text-transparent",children:"Client Dashboard"}),e.jsx("p",{className:"text-slate-600 mt-2",children:"Welcome back! Manage your payments and account"})]}),e.jsx("div",{className:"flex items-center space-x-4 mt-4 sm:mt-0",children:e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-slate-500",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{children:"Account Active"})]})})]}),e.jsx("div",{className:"group bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6 hover:shadow-xl transition-all duration-300 hover:-translate-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("span",{className:"text-sm font-semibold text-slate-600",children:"Client Profile"}),e.jsx("span",{className:"text-xs text-green-600 bg-green-100 px-2 py-1 rounded-full font-medium",children:"Verified"})]}),e.jsx("p",{className:"text-2xl font-bold text-slate-900",children:D}),e.jsx("p",{className:"text-slate-600 mt-1",children:"Active client since 2024"})]}),e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg",children:e.jsx(o.Client,{})})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsx("div",{className:"group bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6 hover:shadow-xl transition-all duration-300 hover:-translate-y-1",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center space-x-2 mb-2",children:e.jsx("span",{className:"text-sm font-semibold text-slate-600",children:"Service Day"})}),e.jsx("p",{className:"text-slate-600",children:"The day of service in your zone is:"}),e.jsx("p",{className:"mt-2 text-2xl font-bold text-slate-900",children:S.length?S.join(", "):"Not set"})]})})}),e.jsx("div",{className:"group bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6 hover:shadow-xl transition-all duration-300 hover:-translate-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center space-x-2 mb-2",children:e.jsx("span",{className:"text-sm font-semibold text-slate-600",children:"Amount To Pay"})}),e.jsx("p",{className:"text-3xl font-bold text-slate-900",children:d!=null?`$${d.toLocaleString()}`:"—"}),e.jsx("p",{className:"text-slate-600 mt-2",children:"Your monthly amount"}),d!=null&&e.jsxs("p",{className:"text-slate-500 text-sm mt-1",children:["Remaining this month: $",Math.max(0,d-p).toLocaleString()]})]}),e.jsx("div",{className:"text-4xl opacity-20",children:e.jsx(o.Payment,{})})]})}),e.jsx("div",{className:"group bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6 hover:shadow-xl transition-all duration-300 hover:-translate-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(o.Payment,{}),e.jsx("span",{className:"text-sm font-semibold text-slate-600",children:"Amount Paid This Month"})]}),e.jsxs("p",{className:"text-3xl font-bold text-slate-900",children:["$",p.toLocaleString()]}),e.jsx("p",{className:"text-slate-600 mt-2",children:"Total paid this month"}),d!=null&&e.jsxs("div",{className:"flex items-center space-x-2 mt-3",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${p>=d?"bg-green-500":"bg-amber-500"}`}),e.jsx("span",{className:`text-sm font-medium ${p>=d?"text-green-600":"text-amber-600"}`,children:p>=d?"Payment up to date":"Payment pending"})]})]}),e.jsx("div",{className:"text-4xl opacity-20",children:e.jsx(o.Payment,{})})]})}),e.jsxs("div",{className:"group bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6 hover:shadow-xl transition-all duration-300 hover:-translate-y-1",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-4",children:e.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"Service Schedule"})}),M.length===0?e.jsx("div",{className:"text-slate-600",children:"No scheduled services yet."}):e.jsx("div",{className:"divide-y divide-slate-200",children:M.map(t=>{var s,c;const a=_[(Number(t.service_day)||1)-1]||"",n=t.supervisor_status,r=n==null?{text:"Pending",cls:"bg-amber-50 text-amber-700 border-amber-200"}:n==="complete"?{text:"Completed",cls:"bg-emerald-50 text-emerald-700 border-emerald-200"}:{text:"Not Completed",cls:"bg-red-50 text-red-700 border-red-200"};return e.jsxs("div",{className:"py-4 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-900 font-semibold",children:a}),e.jsxs("div",{className:"text-slate-600 text-sm",children:[(s=t.service_start)==null?void 0:s.slice(0,5)," - ",(c=t.service_end)==null?void 0:c.slice(0,5)]}),e.jsxs("div",{className:"text-slate-500 text-xs mt-1",children:[t.vehicle_plate?`Vehicle: ${t.vehicle_plate}`:"",t.vehicle_plate&&t.driver_username?" • ":"",t.driver_username?`Driver: ${t.driver_username}`:""]}),n==="not_complete"&&t.supervisor_reason&&e.jsxs("div",{className:"text-red-600 text-xs mt-1",children:["Reason: ",t.supervisor_reason]}),n==="complete"&&(t.complained_client_ids||[]).includes(b||-1)&&e.jsx("div",{className:"text-amber-700 text-xs mt-1",children:"Complaint submitted. Awaiting review."}),n==="complete"&&W(t)&&e.jsx("button",{className:"text-xs text-red-600 font-medium mt-2",onClick:()=>X(t.id),children:"My home not yet"})]}),e.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded-lg border ${r.cls}`,children:r.text})]},t.id)})})]}),e.jsxs("div",{className:"group bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6 hover:shadow-xl transition-all duration-300 hover:-translate-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-6",children:[e.jsx(o.Payment,{}),e.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"Make a Payment"})]}),m.type!=="idle"&&e.jsx("div",{className:`mb-6 p-4 rounded-xl border backdrop-blur-sm transition-all duration-300 ${m.type==="pending"?"bg-blue-50/80 border-blue-200 text-blue-700":m.type==="success"?"bg-green-50/80 border-green-200 text-green-700":m.type==="error"?"bg-red-50/80 border-red-200 text-red-700":""}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[m.type==="pending"&&e.jsx(o.Loading,{}),m.type==="success"&&e.jsx(o.Check,{}),m.type==="error"&&e.jsx(o.Alert,{}),e.jsx("span",{className:"font-medium",children:m.message})]})}),e.jsxs("form",{onSubmit:I,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o.Phone,{}),e.jsx("span",{children:"Phone Number"})]})}),e.jsx("input",{type:"tel",value:P,onChange:t=>R(t.target.value),placeholder:"e.g. +2507XXXXXXXX",className:"w-full px-4 py-3 bg-white border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",disabled:j}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"Enter your mobile money phone number"})]}),e.jsx("button",{type:"submit",disabled:j,className:`w-full flex items-center justify-center space-x-2 py-4 rounded-xl font-semibold shadow-lg transition-all duration-200 ${j?"bg-blue-400 cursor-not-allowed":"bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 hover:shadow-xl"}`,children:j?e.jsxs(e.Fragment,{children:[e.jsx(o.Loading,{}),e.jsx("span",{className:"text-white",children:"Processing Payment..."})]}):e.jsx("span",{className:"text-white",children:"Pay Now"})})]}),e.jsxs("div",{className:"mt-6 p-4 bg-slate-50 rounded-xl border border-slate-200",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700 mb-2",children:"Payment Information"}),e.jsxs("ul",{className:"text-xs text-slate-600 space-y-1",children:[e.jsx("li",{children:"• Payments are processed via mobile money"}),e.jsx("li",{children:"• You will receive an STK push notification"}),e.jsx("li",{children:"• Standard transaction fees apply"}),e.jsx("li",{children:"• Receipts are generated automatically"})]})]})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-4",children:"Quick Actions"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[{label:"View Payment History",Icon:H,onClick:()=>{},color:"text-indigo-600 bg-indigo-50"},{label:"Download Receipts",Icon:J,onClick:()=>{},color:"text-emerald-600 bg-emerald-50"},{label:"Update Profile",Icon:O,onClick:()=>{},color:"text-blue-600 bg-blue-50"},{label:"Get Support",Icon:U,onClick:()=>{},color:"text-orange-600 bg-orange-50"}].map(({label:t,Icon:a,onClick:n,color:r},s)=>e.jsxs("button",{onClick:n,className:"flex flex-col items-center justify-center p-4 bg-slate-50 rounded-xl hover:bg-white border border-slate-200 hover:border-blue-200 transition-all duration-200 group hover:shadow-md",children:[e.jsx("span",{className:`mb-2 p-2 rounded-lg ${r}`,children:e.jsx(a,{className:"h-6 w-6"})}),e.jsx("span",{className:"text-sm font-medium text-slate-700 text-center group-hover:text-blue-600",children:t})]},s))})]})]})})};export{Q as default};
