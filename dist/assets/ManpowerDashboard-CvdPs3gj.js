import{j as e}from"./index-DZTFkylD.js";import{r as o}from"./react-CzDbI3ao.js";import{d as g,h as p,T as w,W as y}from"./ui-fx2JTPqr.js";const b="http://localhost:4000",S=()=>{var h,u,v;const[,j]=o.useState(null),[l,N]=o.useState({name:"",salary:null,vehicle:null,driver:null,supervisor:null}),[i,m]=o.useState(!1),[x,f]=o.useState([]);return o.useEffect(()=>{const r=localStorage.getItem("token");r&&(m(!0),fetch(`${b}/api/manpower/dashboard`,{headers:{Authorization:`Bearer ${r}`}}).then(async t=>{var d,n,c;const s=await t.json();if(!t.ok)throw new Error((s==null?void 0:s.error)||"Failed to load dashboard");j(s.user);const a=[(d=s==null?void 0:s.user)==null?void 0:d.first_name,(n=s==null?void 0:s.user)==null?void 0:n.last_name].filter(Boolean).join(" ")||((c=s==null?void 0:s.user)==null?void 0:c.username)||"";N({name:a,salary:(s==null?void 0:s.salary)??null,vehicle:(s==null?void 0:s.vehicle)??null,driver:(s==null?void 0:s.driver)??null,supervisor:(s==null?void 0:s.supervisor)??null})}).catch(t=>console.error("Load manpower profile error:",t)).finally(()=>m(!1)),fetch(`${b}/api/manpower/schedule`,{headers:{Authorization:`Bearer ${r}`}}).then(async t=>{const s=await t.json();if(!t.ok)throw new Error((s==null?void 0:s.error)||"Failed to load schedule");f(Array.isArray(s.schedule)?s.schedule:[])}).catch(t=>console.error("Load manpower schedule error:",t)))},[]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-zinc-800 to-indigo-600 bg-clip-text text-transparent",children:"Manpower Dashboard"}),e.jsx("p",{className:"text-zinc-600 mt-2",children:"Your assignment and payroll overview"})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-4 sm:mt-0 text-sm text-zinc-500",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{children:"Profile Active"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-600",children:"Name"}),e.jsx("div",{className:"text-2xl font-bold text-zinc-900 mt-1",children:i?"…":l.name||"-"})]}),e.jsx("div",{className:"shrink-0 p-2 rounded-lg bg-indigo-50 text-indigo-600",children:e.jsx(g,{className:"h-8 w-8"})})]})}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-600",children:"Assigned Vehicle"}),e.jsx("div",{className:"text-2xl font-bold text-zinc-900 mt-1",children:i?"…":((h=l.vehicle)==null?void 0:h.plate)||"Not assigned"}),e.jsxs("div",{className:"text-sm text-zinc-600 mt-2 flex items-center gap-1",children:[e.jsx(p,{className:"w-4 h-4"})," Driver: ",i?"…":((u=l.driver)==null?void 0:u.username)||"-"]}),e.jsxs("div",{className:"text-sm text-zinc-600 mt-1 flex items-center gap-1",children:[e.jsx(p,{className:"w-4 h-4"})," Supervisor: ",i?"…":((v=l.supervisor)==null?void 0:v.username)||"-"]})]}),e.jsx("div",{className:"shrink-0 p-2 rounded-lg bg-amber-50 text-amber-600",children:e.jsx(w,{className:"h-8 w-8"})})]})}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-600",children:"Salary"}),e.jsx("div",{className:"text-2xl font-bold text-zinc-900 mt-1",children:i?"…":l.salary!=null?l.salary.toLocaleString():"Not set"})]}),e.jsx("div",{className:"shrink-0 p-2 rounded-lg bg-emerald-50 text-emerald-600",children:e.jsx(y,{className:"h-8 w-8"})})]})})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-4",children:e.jsx("h2",{className:"text-xl font-bold text-zinc-800",children:"Service Schedule"})}),x.length===0?e.jsx("div",{className:"text-zinc-600",children:"No scheduled services yet."}):e.jsx("div",{className:"divide-y divide-zinc-200",children:x.map(r=>{var n,c;const s=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"][(Number(r.service_day)||1)-1]||"",a=r.supervisor_status,d=a==null?{text:"Pending",cls:"bg-amber-50 text-amber-700 border-amber-200"}:a==="complete"?{text:"Completed",cls:"bg-emerald-50 text-emerald-700 border-emerald-200"}:{text:"Not Completed",cls:"bg-red-50 text-red-700 border-red-200"};return e.jsxs("div",{className:"py-4 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-zinc-900 font-semibold",children:s}),e.jsxs("div",{className:"text-zinc-600 text-sm",children:[(n=r.service_start)==null?void 0:n.slice(0,5)," - ",(c=r.service_end)==null?void 0:c.slice(0,5)]}),e.jsxs("div",{className:"text-zinc-500 text-xs mt-1",children:[r.vehicle_plate?`Vehicle: ${r.vehicle_plate}`:"",r.vehicle_plate&&r.driver_username?" • ":"",r.driver_username?`Driver: ${r.driver_username}`:""]}),a==="not_complete"&&r.supervisor_reason&&e.jsxs("div",{className:"text-red-600 text-xs mt-1",children:["Reason: ",r.supervisor_reason]})]}),e.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded-lg border ${d.cls}`,children:d.text})]},r.id)})})]})]})};export{S as default};
