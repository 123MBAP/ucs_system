import{u as xe,j as e}from"./index-8yk-1D8L.js";import{f as he,r as l,L as ue}from"./react-CzDbI3ao.js";import{L as fe}from"./LoadingSpinner-pHrC3iMT.js";const R="http://localhost:4000",f={Zone:()=>e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.447-.894L15 4m0 13V4m0 0L9 7"})}),Chief:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),Clients:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),Arrow:()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),TrendUp:()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})})},je=()=>{const{t,lang:z}=xe(),T=he(),[u,O]=l.useState([]),[v,F]=l.useState(!1),[W,E]=l.useState(null),[C,H]=l.useState("monthly"),[j,J]=l.useState([]),[U,Y]=l.useState(!1),[B,I]=l.useState(null),[P,D]=l.useState([]),[q,G]=l.useState(0),[b,L]=l.useState({yearly:[],monthly:[],weekly:[],daily:[]}),[w,Q]=l.useState(""),[N,X]=l.useState(""),[k,ee]=l.useState(""),[$,se]=l.useState(!1),_=l.useRef(null);l.useEffect(()=>{const s=localStorage.getItem("token");if(!s){T("/login",{replace:!0});return}F(!0),E(null),fetch(`${R}/api/supervisor/zones`,{headers:{Authorization:`Bearer ${s}`}}).then(async o=>{const a=await o.json();if(!o.ok)throw new Error((a==null?void 0:a.error)||"Failed to load zones");O(Array.isArray(a.zones)?a.zones:[])}).catch(o=>E((o==null?void 0:o.message)||"Failed to load zones")).finally(()=>F(!1))},[]);const g=l.useMemo(()=>new Intl.NumberFormat(void 0,{maximumFractionDigits:0}),[z]);function te(s=6){const o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],a=new Date,c=[];for(let x=s-1;x>=0;x--){const m=new Date(a.getFullYear(),a.getMonth()-x,1),n=`${m.getFullYear()}-${String(m.getMonth()+1).padStart(2,"0")}`;c.push({key:n,label:o[m.getMonth()]})}return c}function re(s){const o=te(6),a=new Map(o.map(r=>[r.key,0])),c=new Date,x=`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}`,m=[0,0,0,0],n=Array.from({length:5},(r,d)=>String(new Date().getFullYear()-(4-d))),i=new Map(n.map(r=>[r,0])),h=[],y=[];for(let r=6;r>=0;r--){const d=new Date(c);d.setDate(c.getDate()-r);const p=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;y.push(p),h.push(`Day ${7-r}`)}const M=new Map(y.map(r=>[r,0])),oe=Array.isArray(s)?s.filter(r=>{const d=String((r==null?void 0:r.status)||"").toLowerCase();return!(r!=null&&r.status)||d==="success"||d==="successful"}):[];for(const r of oe){const d=Number(r.amount||0),p=new Date(r.completed_at||r.created_at||r.updated_at||r.inserted_at||Date.now()),S=`${p.getFullYear()}-${String(p.getMonth()+1).padStart(2,"0")}`;if(a.has(S)&&a.set(S,(a.get(S)||0)+d),S===x){const me=Math.min(4,Math.max(1,Math.ceil(p.getDate()/7)));m[me-1]+=d}const A=String(p.getFullYear());i.has(A)&&i.set(A,(i.get(A)||0)+d);const Z=`${p.getFullYear()}-${String(p.getMonth()+1).padStart(2,"0")}-${String(p.getDate()).padStart(2,"0")}`;M.has(Z)&&M.set(Z,(M.get(Z)||0)+d)}const le=n.map(r=>({year:r,amount:i.get(r)||0})),ie=o.map(r=>({month:r.label,amount:a.get(r.key)||0})),de=[{week:"Week 1",amount:m[0]},{week:"Week 2",amount:m[1]},{week:"Week 3",amount:m[2]},{week:"Week 4",amount:m[3]}],ce=y.map((r,d)=>({day:h[d],amount:M.get(r)||0}));return{yearly:le,monthly:ie,weekly:de,daily:ce}}l.useEffect(()=>{let s=!1;async function o(){try{Y(!0);const a=localStorage.getItem("token");if(!a){s||(L({yearly:[],monthly:[],weekly:[],daily:[]}),D([]));return}I(null);const x=await(await fetch(`${R}/api/payments/completed`,{headers:{Authorization:`Bearer ${a}`}})).json(),m=Array.isArray(x==null?void 0:x.payments)?x.payments:[];s||D(m)}catch(a){s||(I((a==null?void 0:a.message)||t("supervisor.error.generic")),D([]),L({yearly:[],monthly:[],weekly:[],daily:[]}))}finally{s||Y(!1)}}return o(),()=>{s=!0}},[q]);const K=l.useMemo(()=>P.filter(s=>{if(w&&String((s==null?void 0:s.zone_id)??"")!==String(w))return!1;const o=(s==null?void 0:s.completed_at)||(s==null?void 0:s.created_at)||(s==null?void 0:s.updated_at)||(s==null?void 0:s.inserted_at);if(N){const a=new Date(N);if(new Date(o||0)<a)return!1}if(k){const a=new Date(k);if(a.setHours(23,59,59,999),new Date(o||0)>a)return!1}return!0}),[P,w,N,k]);l.useEffect(()=>{const s=re(K);L(s)},[K]),l.useEffect(()=>{const s={yearly:b.yearly,monthly:b.monthly,weekly:b.weekly,daily:b.daily};J(s[C]||[])},[C,b]);const V=u.reduce((s,o)=>s+o.client_count,0),ae=u.filter(s=>s.chief_username).length,ne=u.length>0?Math.round(V/u.length):0;return e.jsxs("div",{className:"space-y-8 overflow-x-hidden",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between min-w-0",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-stone-800 to-amber-600 bg-clip-text text-transparent truncate",children:t("supervisor.title")}),e.jsx("p",{className:"text-stone-600 mt-2 truncate",children:t("supervisor.subtitle")})]}),e.jsx("div",{className:"flex items-center space-x-4 mt-4 sm:mt-0 min-w-0",children:e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-stone-500",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"}),e.jsx("span",{className:"truncate",children:t("supervisor.systemsOk")})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{onClick:()=>{var s;return(s=_.current)==null?void 0:s.scrollIntoView({behavior:"smooth"})},className:"group bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-amber-100 p-6 hover:shadow-xl transition-all duration-300 hover:-translate-y-1 cursor-pointer",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-stone-600 mb-2",children:t("supervisor.stats.totalZones")}),e.jsx("p",{className:"text-3xl font-bold text-stone-900",children:v?"...":g.format(u.length)}),e.jsx("p",{className:"text-sm text-stone-500 mt-1",children:t("supervisor.stats.assignedToYou")})]}),e.jsx("div",{className:"p-4 rounded-xl bg-gradient-to-br from-amber-600 to-orange-500 shadow-lg",children:e.jsx(f.Zone,{})})]})}),e.jsx("div",{className:"group bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-amber-100 p-6 hover:shadow-xl transition-all duration-300 hover:-translate-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-stone-600 mb-2",children:t("supervisor.stats.activeChiefs")}),e.jsx("p",{className:"text-3xl font-bold text-stone-900",children:v?"...":g.format(ae)}),e.jsx("div",{className:"flex items-center mt-1",children:e.jsxs("div",{className:"inline-flex items-center px-2 py-1 rounded-full bg-emerald-100 text-emerald-700 text-xs font-medium",children:[e.jsx(f.TrendUp,{}),e.jsx("span",{className:"ml-1",children:t("supervisor.stats.active")})]})})]}),e.jsx("div",{className:"p-4 rounded-xl bg-gradient-to-br from-emerald-600 to-green-500 shadow-lg",children:e.jsx(f.Chief,{})})]})}),e.jsx("div",{className:"group bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-amber-100 p-6 hover:shadow-xl transition-all duration-300 hover:-translate-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-stone-600 mb-2",children:t("supervisor.stats.totalClients")}),e.jsx("p",{className:"text-3xl font-bold text-stone-900",children:v?"...":g.format(V)}),e.jsx("p",{className:"text-sm text-stone-500 mt-1",children:t("supervisor.stats.acrossZones")})]}),e.jsx("div",{className:"p-4 rounded-xl bg-gradient-to-br from-lime-600 to-green-500 shadow-lg",children:e.jsx(f.Clients,{})})]})}),e.jsx("div",{className:"group bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-amber-100 p-6 hover:shadow-xl transition-all duration-300 hover:-translate-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-stone-600 mb-2",children:t("supervisor.stats.avgPerZone")}),e.jsx("p",{className:"text-3xl font-bold text-stone-900",children:v?"...":g.format(ne)}),e.jsx("p",{className:"text-sm text-stone-500 mt-1",children:t("supervisor.stats.clientsPerZone")})]}),e.jsx("div",{className:"p-4 rounded-xl bg-gradient-to-br from-amber-500 to-yellow-500 shadow-lg",children:e.jsx(f.Clients,{})})]})})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-amber-100 p-6 overflow-x-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-6 min-w-0",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h2",{className:"text-lg font-semibold text-stone-800",children:t("supervisor.trends.title")}),e.jsx("p",{className:"text-xs text-stone-500 mt-1",children:t("supervisor.trends.subtitle")})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-3 md:mt-0",children:[e.jsxs("select",{className:"px-2 py-1.5 rounded-md text-xs bg-stone-100 text-stone-700",value:w,onChange:s=>Q(s.target.value),children:[e.jsx("option",{value:"",children:t("supervisor.filters.allZones")}),u.map(s=>e.jsx("option",{value:s.id,children:s.zone_name},s.id))]}),e.jsx("input",{type:"date",className:"px-2 py-1.5 rounded-md text-xs bg-stone-100 text-stone-700",value:N,onChange:s=>X(s.target.value),"aria-label":t("supervisor.filters.startDate")}),e.jsx("input",{type:"date",className:"px-2 py-1.5 rounded-md text-xs bg-stone-100 text-stone-700",value:k,onChange:s=>ee(s.target.value),"aria-label":t("supervisor.filters.endDate")}),["yearly","monthly","weekly","daily"].map(s=>e.jsx("button",{onClick:()=>H(s),className:`px-3 py-1.5 rounded-md text-xs font-semibold ${C===s?"bg-amber-600 text-white":"bg-stone-100 text-stone-600 hover:bg-stone-200"}`,children:t(s==="yearly"?"supervisor.trends.year":s==="monthly"?"supervisor.trends.monthly":s==="weekly"?"supervisor.trends.weekly":"supervisor.trends.daily")},s))]})]}),e.jsx("div",{className:"h-64 relative min-w-[480px] md:min-w-0",children:U?e.jsx("div",{className:"h-full flex items-center justify-center text-stone-500 text-sm",children:e.jsx(fe,{})}):B?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-stone-600 text-sm gap-2",children:[e.jsx("div",{children:B}),e.jsx("button",{onClick:()=>G(s=>s+1),className:"px-3 py-1.5 rounded-md bg-amber-600 text-white",children:t("supervisor.retry")})]}):j.length===0?e.jsx("div",{className:"h-full flex items-center justify-center text-stone-500 text-sm",children:t("supervisor.trends.empty")}):(()=>{const s=j.map(n=>Number(n.amount)||0),o=Math.max(...s,1),a=Math.pow(10,Math.floor(Math.log10(o))),c=Math.ceil(o/a)*a,x=6,m=Array.from({length:x},(n,i)=>Math.round(c/(x-1)*i));return e.jsxs("div",{className:"h-full flex",children:[e.jsx("div",{className:"w-10 relative",children:m.map((n,i)=>{const h=100-n/c*100;return e.jsx("div",{className:"absolute left-0 w-full",style:{top:`${h}%`},children:e.jsx("div",{className:"-translate-y-1/2 flex items-center",children:e.jsx("span",{className:"text-[10px] text-stone-500 w-8 text-right pr-1",children:g.format(n)})})},i)})}),e.jsxs("div",{className:"flex-1 relative min-w-0",children:[m.map((n,i)=>{const h=100-n/c*100;return e.jsx("div",{className:"absolute left-0 right-0",style:{top:`${h}%`},children:e.jsx("div",{className:`h-px ${i===0?"bg-stone-300":"bg-stone-100"}`})},i)}),e.jsx("div",{className:"absolute inset-x-0 bottom-6 top-2 pointer-events-none",children:(()=>{const n=j.length||1;return Array.from({length:n},(i,h)=>{const y=(h+.5)/n*100;return e.jsx("div",{className:"absolute top-0 bottom-0",style:{left:`${y}%`},children:e.jsx("div",{className:"w-px h-full bg-stone-100 -translate-x-1/2"})},h)})})()}),e.jsx("div",{className:"absolute inset-x-0 bottom-6 top-2",children:e.jsx("div",{className:"flex items-end justify-between h-full space-x-2",children:j.map((n,i)=>{const h=Math.max(0,Math.min(100,Number(n.amount)/c*100));return e.jsxs("div",{className:"flex-1 flex flex-col items-center group",children:[e.jsx("div",{className:"text-center mb-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:e.jsx("div",{className:"bg-stone-800 text-white text-xs px-2 py-1 rounded-md shadow",children:g.format(Number(n.amount))})}),e.jsx("div",{className:"w-full bg-gradient-to-t from-amber-500 to-yellow-500 rounded-md transition-all duration-300 hover:opacity-90 cursor-pointer",style:{height:`${h}%`}})]},i)})})}),e.jsx("div",{className:"absolute left-0 right-0 bottom-0",children:e.jsx("div",{className:"flex justify-between items-center",children:j.map((n,i)=>e.jsx("div",{className:"flex-1 text-center truncate",children:e.jsx("p",{className:"text-[11px] font-medium text-stone-600 break-words",children:"year"in n?n.year:"month"in n?n.month:"week"in n?n.week:n.day})},i))})})]})]})})()})]}),e.jsxs("div",{ref:_,className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-amber-100 p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-6 min-w-0",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h2",{className:"text-xl font-bold text-stone-800",children:"Your Zones"}),e.jsx("p",{className:"text-stone-600 mt-1 truncate",children:"Manage and supervise your assigned zones"})]}),e.jsxs("div",{className:"flex items-center space-x-3 mt-4 md:mt-0",children:[e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-stone-600",children:[e.jsx("input",{type:"checkbox",className:"rounded",checked:$,onChange:s=>se(s.target.checked)}),t("supervisor.filters.onlyWithChief")]}),e.jsxs("span",{className:"text-sm text-stone-500",children:[g.format(u.length)," zone",u.length!==1?"s":""," assigned"]}),e.jsx("button",{onClick:()=>{var s;return(s=_.current)==null?void 0:s.scrollIntoView({behavior:"smooth"})},className:"px-3 py-1.5 rounded-md bg-stone-100 text-stone-700 hover:bg-stone-200 text-sm",children:t("supervisor.quick.viewZones")})]})]}),W&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"flex items-center space-x-2 text-red-700",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"font-medium",children:W})]})}),v?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((s,o)=>e.jsxs("div",{className:"bg-stone-100 rounded-xl p-6 animate-pulse",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-stone-300 rounded w-20"}),e.jsx("div",{className:"h-6 bg-stone-300 rounded w-32"})]}),e.jsx("div",{className:"w-12 h-12 bg-stone-300 rounded-xl"})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"h-4 bg-stone-300 rounded w-16"}),e.jsx("div",{className:"h-4 bg-stone-300 rounded w-20"})]})}),e.jsx("div",{className:"h-10 bg-stone-300 rounded-lg mt-4"})]},o))}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[u.filter(s=>!$||!!s.chief_username).map(s=>e.jsxs("div",{className:"group bg-white rounded-xl border border-amber-100 p-6 hover:shadow-lg transition-all duration-300 hover:-translate-y-1 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 min-w-0",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"text-xs font-medium text-stone-500 uppercase tracking-wide",children:t("supervisor.zone")}),e.jsx("h3",{className:"text-xl font-bold text-stone-800 break-words truncate",children:s.zone_name})]}),e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-amber-600 to-amber-700 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx(f.Zone,{})})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-stone-600",children:[e.jsx(f.Chief,{}),e.jsx("span",{className:"font-medium",children:t("supervisor.zoneChief")})]}),e.jsx("span",{className:`font-semibold ${s.chief_username?"text-stone-800":"text-amber-600"} truncate`,children:s.chief_username||t("supervisor.unassigned")})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-stone-600",children:[e.jsx(f.Clients,{}),e.jsx("span",{className:"font-medium",children:t("supervisor.activeClients")})]}),e.jsx("span",{className:"text-lg font-bold text-stone-800",children:g.format(s.client_count)})]})]}),e.jsxs(ue,{to:`/supervisor/zones/${s.id}/supervision`,className:"flex items-center justify-center space-x-2 w-full py-3 bg-stone-50 hover:bg-amber-50 text-stone-700 hover:text-amber-700 rounded-xl font-semibold transition-all duration-200 border border-stone-200 hover:border-amber-200 group-hover:shadow-md",children:[e.jsx("span",{children:t("supervisor.manageZone")}),e.jsx(f.Arrow,{})]})]},s.id)),!u.filter(s=>!$||!!s.chief_username).length&&!v&&e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx("div",{className:"w-20 h-20 bg-stone-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx(f.Zone,{})}),e.jsx("h3",{className:"text-xl font-semibold text-stone-700 mb-2",children:t("supervisor.noZones.title")}),e.jsx("p",{className:"text-stone-500 max-w-md mx-auto",children:t("supervisor.noZones.desc")})]})]})]})]})};export{je as default};
