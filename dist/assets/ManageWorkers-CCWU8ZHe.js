import{j as e,u as Oe}from"./index-B34CxXhK.js";import{r as x}from"./react-BeLGUnOF.js";import{L as He}from"./LoadingSpinner-DT6bjMH5.js";function Pe(X){const{t:o,colors:a,supervisors:b,vehicles:B,zones:D,editingId:I,editVehicleId:L,moveSelection:N,assignVehicleNoSup:k,assignVehicleToSupervisorId:$,assignZoneNoSup:_,assignZoneToSupervisorId:M,actionLoading:A,startEdit:P,cancelEdit:R,setEditVehicleId:z,setMoveSelection:q,setAssignVehicleNoSup:W,setAssignVehicleToSupervisorId:E,setAssignZoneNoSup:F,setAssignZoneToSupervisorId:T,saveVehicle:V,unassignVehicle:g,removeZone:j,moveZone:i,assignVehicleToSupervisor:p,assignZoneToSupervisor:J}=X,G=({title:c,number:d})=>e.jsxs("div",{className:"flex items-center gap-3 mb-6 pb-3 border-b",style:{borderColor:a.border},children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm",style:{backgroundColor:a.primary},children:d}),e.jsx("h2",{className:"text-2xl font-bold",style:{color:a.text},children:c})]}),O=({title:c})=>e.jsx("h3",{className:"text-lg font-semibold mb-4 pb-2 border-b",style:{color:a.text,borderColor:a.border},children:c}),K=({children:c,className:d=""})=>e.jsx("div",{className:`rounded-lg shadow-sm border p-6 ${d}`,style:{backgroundColor:a.cardBg,borderColor:a.border},children:c}),H=({children:c,onClick:d,disabled:s=!1,loading:r=!1,className:n=""})=>e.jsx("button",{onClick:d,disabled:s||r,className:`px-4 py-2 rounded-lg font-medium text-white transition-colors flex items-center gap-2 ${n}`,style:{backgroundColor:s?a.textLight:a.primary,cursor:s?"not-allowed":"pointer"},onMouseOver:t=>{!s&&!r&&(t.currentTarget.style.backgroundColor=a.primaryHover)},onMouseOut:t=>{!s&&!r&&(t.currentTarget.style.backgroundColor=a.primary)},children:c}),Q=({children:c,onClick:d,disabled:s=!1,className:r=""})=>e.jsx("button",{onClick:d,disabled:s,className:`px-4 py-2 rounded-lg font-medium border transition-colors ${r}`,style:{color:a.text,borderColor:a.border,backgroundColor:"transparent",cursor:s?"not-allowed":"pointer"},onMouseOver:n=>{s||(n.currentTarget.style.backgroundColor=a.background)},onMouseOut:n=>{s||(n.currentTarget.style.backgroundColor="transparent")},children:c});return e.jsxs("section",{children:[e.jsx(G,{title:o("manageWorkers.section.supervisors"),number:1}),e.jsxs("div",{className:"space-y-6 mb-8",children:[e.jsxs(K,{children:[e.jsx(O,{title:"Supervisors and Their Zones"}),e.jsxs("div",{className:"space-y-4",children:[b.filter(c=>(c.zones||[]).length>0).map(c=>e.jsxs("div",{className:"border rounded-lg p-4",style:{borderColor:a.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-semibold",style:{color:a.text},children:c.username}),I===c.id?e.jsx(Q,{onClick:R,className:"text-sm px-3 py-1",children:o("manageWorkers.close")}):e.jsx("button",{onClick:()=>P(c),className:"text-sm font-medium px-3 py-1 rounded border",style:{color:a.primary,borderColor:a.primary},children:o("manageWorkers.manage")})]}),e.jsx("div",{className:"space-y-3",children:(c.zones||[]).map(d=>e.jsxs("div",{className:"flex items-center justify-between text-sm p-2 rounded border",style:{borderColor:a.border},children:[e.jsx("span",{style:{color:a.text},children:d.name}),I===c.id&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-2 py-1 text-xs rounded border",style:{borderColor:a.border},onClick:()=>j(c.id,d.id),children:"Unassign"}),e.jsxs("select",{className:"border rounded px-2 py-1 text-xs",style:{borderColor:a.border},value:N[d.id]||"",onChange:s=>q(r=>({...r,[d.id]:s.target.value})),children:[e.jsx("option",{value:"",children:"Move to…"}),b.filter(s=>s.id!==c.id).map(s=>e.jsx("option",{value:s.id,children:s.username},s.id))]}),e.jsx(H,{disabled:!N[d.id]||!!A[`moveZone-${d.id}`],onClick:()=>i(d.id,N[d.id]),className:"text-xs px-2 py-1",children:"Move"})]})]},d.id))})]},c.id)),b.filter(c=>(c.zones||[]).length>0).length===0&&e.jsx("div",{className:"text-center py-8",style:{color:a.textLight},children:"No supervisors with zones"})]})]}),e.jsxs(K,{children:[e.jsx(O,{title:"Supervisors and Their Vehicles"}),e.jsxs("div",{className:"space-y-4",children:[b.filter(c=>(c.vehicles||[]).length>0).map(c=>e.jsxs("div",{className:"border rounded-lg p-4",style:{borderColor:a.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-semibold",style:{color:a.text},children:c.username}),I===c.id?e.jsx(Q,{onClick:R,className:"text-sm px-3 py-1",children:o("manageWorkers.close")}):e.jsx("button",{onClick:()=>P(c),className:"text-sm font-medium px-3 py-1 rounded border",style:{color:a.primary,borderColor:a.primary},children:o("manageWorkers.manage")})]}),e.jsxs("div",{className:"space-y-3",children:[(c.vehicles||[]).map(d=>e.jsxs("div",{className:"flex items-center justify-between text-sm p-2 rounded border",style:{borderColor:a.border},children:[e.jsx("span",{style:{color:a.text},children:d.plate}),I===c.id&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-2 py-1 text-xs rounded border",style:{borderColor:a.border},onClick:()=>g(c.id,d.id),children:"Unassign"}),e.jsxs("select",{className:"border rounded px-2 py-1 text-xs",style:{borderColor:a.border},value:N[d.id]||"",onChange:s=>q(r=>({...r,[d.id]:s.target.value})),children:[e.jsx("option",{value:"",children:"Move to…"}),b.filter(s=>s.id!==c.id).map(s=>e.jsx("option",{value:s.id,children:s.username},s.id))]}),e.jsx(H,{disabled:!N[d.id]||!!A[`saveVehicle-${c.id}`],onClick:()=>{const s=Number(N[d.id]);Number.isFinite(s)&&p(s,d.id)},className:"text-xs px-2 py-1",children:"Move"})]})]},d.id)),I===c.id&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("select",{value:L,onChange:d=>z(d.target.value),className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:a.border},children:[e.jsx("option",{value:"",children:o("manageWorkers.selectVehicle")}),B.filter(d=>!(c.vehicles||[]).some(s=>s.id===d.id)).map(d=>e.jsx("option",{value:d.id,children:d.plate},d.id))]}),e.jsx(H,{onClick:()=>V(c.id),disabled:!L||!!A[`saveVehicle-${c.id}`],className:"text-sm px-3 py-1",children:o("manageWorkers.addVehicle")})]})]})]},c.id)),b.filter(c=>(c.vehicles||[]).length>0).length===0&&e.jsx("div",{className:"text-center py-8",style:{color:a.textLight},children:"No supervisors with vehicles"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(K,{children:[e.jsx(O,{title:"Supervisors Without Zones"}),(()=>{const c=b.filter(r=>!r.zones||r.zones.length===0),d=new Set;b.forEach(r=>(r.zones||[]).forEach(n=>d.add(n.id)));const s=D.filter(r=>!d.has(r.id));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:a.border},value:M,onChange:r=>T(r.target.value),children:[e.jsx("option",{value:"",children:"Select supervisor…"}),c.map(r=>e.jsx("option",{value:r.id,children:r.username},r.id))]}),e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:a.border},value:_,onChange:r=>F(r.target.value),children:[e.jsx("option",{value:"",children:"Select zone…"}),s.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]}),e.jsx(H,{disabled:!_||!M||!!A.assignZoneNoSup,onClick:()=>{const r=Number(_),n=Number(M);Number.isFinite(r)&&Number.isFinite(n)&&J(n,r)},className:"text-sm whitespace-nowrap",children:"Assign"})]}),c.length===0&&e.jsx("div",{className:"text-sm text-center py-4",style:{color:a.textLight},children:"All supervisors have zones"})]})})()]}),e.jsxs(K,{children:[e.jsx(O,{title:o("manageWorkers.unassignedVehicles")}),(()=>{const c=new Set;b.forEach(s=>(s.vehicles||[]).forEach(r=>c.add(r.id)));const d=B.filter(s=>!c.has(s.id));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:a.border},value:k,onChange:s=>W(s.target.value),children:[e.jsx("option",{value:"",children:"Select vehicle…"}),d.map(s=>e.jsx("option",{value:s.id,children:s.plate},s.id))]}),e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:a.border},value:$,onChange:s=>E(s.target.value),children:[e.jsx("option",{value:"",children:"Select supervisor…"}),b.map(s=>e.jsx("option",{value:s.id,children:s.username},s.id))]}),e.jsx(H,{disabled:!k||!$||!!A.assignVehicleNoSup,onClick:()=>{const s=Number(k),r=Number($);Number.isFinite(s)&&Number.isFinite(r)&&p(r,s)},className:"text-sm whitespace-nowrap",children:"Assign"})]}),d.length===0&&e.jsx("div",{className:"text-sm text-center py-4",style:{color:a.textLight},children:"All vehicles are assigned to supervisors"})]})})()]}),e.jsxs(K,{children:[e.jsx(O,{title:"Supervisors Without Vehicles"}),(()=>{const c=b.filter(r=>!r.vehicles||r.vehicles.length===0),d=new Set;b.forEach(r=>(r.vehicles||[]).forEach(n=>d.add(n.id)));const s=B.filter(r=>!d.has(r.id));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:a.border},value:$,onChange:r=>E(r.target.value),children:[e.jsx("option",{value:"",children:"Select supervisor…"}),c.map(r=>e.jsx("option",{value:r.id,children:r.username},r.id))]}),e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:a.border},value:k,onChange:r=>W(r.target.value),children:[e.jsx("option",{value:"",children:"Select vehicle…"}),s.map(r=>e.jsx("option",{value:r.id,children:r.plate},r.id))]}),e.jsx(H,{disabled:!k||!$||!!A.assignVehicleNoSup,onClick:()=>{const r=Number(k),n=Number($);Number.isFinite(r)&&Number.isFinite(n)&&p(n,r)},className:"text-sm whitespace-nowrap",children:"Assign"})]}),c.length===0&&e.jsx("div",{className:"text-sm text-center py-4",style:{color:a.textLight},children:"All supervisors have vehicles"})]})})()]}),e.jsxs(K,{children:[e.jsx(O,{title:"Unassigned Zones"}),(()=>{const c=new Set;b.forEach(s=>(s.zones||[]).forEach(r=>c.add(r.id)));const d=D.filter(s=>!c.has(s.id));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:a.border},value:_,onChange:s=>F(s.target.value),children:[e.jsx("option",{value:"",children:"Select zone…"}),d.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:a.border},value:M,onChange:s=>T(s.target.value),children:[e.jsx("option",{value:"",children:"Select supervisor…"}),b.map(s=>e.jsx("option",{value:s.id,children:s.username},s.id))]}),e.jsx(H,{disabled:!_||!M||!!A.assignZoneNoSup,onClick:()=>{const s=Number(_),r=Number(M);Number.isFinite(s)&&Number.isFinite(r)&&J(r,s)},className:"text-sm whitespace-nowrap",children:"Assign"})]}),d.length===0&&e.jsx("div",{className:"text-sm text-center py-4",style:{color:a.textLight},children:"All zones are assigned to supervisors"})]})})()]})]})]})}function We(X){const{colors:o,chiefs:a,zones:b,actionLoading:B,manageChief:D,moveZoneChiefTarget:I,noChiefSelectedZone:L,noChiefAssignChiefId:N,noZoneSelectedChief:k,noZoneAssignZoneId:$,setManageChief:_,setMoveZoneChiefTarget:M,setNoChiefSelectedZone:A,setNoChiefAssignChiefId:P,setNoZoneSelectedChief:R,setNoZoneAssignZoneId:z,setZoneChief:q,removeZoneChief:W}=X,E=({title:g,number:j})=>e.jsxs("div",{className:"flex items-center gap-3 mb-6 pb-3 border-b",style:{borderColor:o.border},children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm",style:{backgroundColor:o.primary},children:j}),e.jsx("h2",{className:"text-2xl font-bold",style:{color:o.text},children:g})]}),F=({title:g})=>e.jsx("h3",{className:"text-lg font-semibold mb-4 pb-2 border-b",style:{color:o.text,borderColor:o.border},children:g}),T=({children:g,className:j=""})=>e.jsx("div",{className:`rounded-lg shadow-sm border p-6 ${j}`,style:{backgroundColor:o.cardBg,borderColor:o.border},children:g}),V=({children:g,onClick:j,disabled:i=!1,loading:p=!1,className:J=""})=>e.jsx("button",{onClick:j,disabled:i||p,className:`px-4 py-2 rounded-lg font-medium text-white transition-colors flex items-center gap-2 ${J}`,style:{backgroundColor:i?o.textLight:o.primary,cursor:i?"not-allowed":"pointer"},onMouseOver:G=>{!i&&!p&&(G.currentTarget.style.backgroundColor=o.primaryHover)},onMouseOut:G=>{!i&&!p&&(G.currentTarget.style.backgroundColor=o.primary)},children:g});return e.jsxs("section",{children:[e.jsx(E,{title:"Manage Chiefs",number:2}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(T,{children:[e.jsx(F,{title:"Chiefs and Their Zones"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[a.map(g=>{const j=b.filter(i=>i.assigned_chief===g.id);return j.length===0?null:e.jsxs("div",{className:"border rounded-lg p-4",style:{borderColor:o.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-semibold",style:{color:o.text},children:g.username}),e.jsx("button",{onClick:()=>_(i=>({...i,[g.id]:!i[g.id]})),className:"text-sm font-medium px-3 py-1 rounded border",style:{color:o.primary,borderColor:o.primary},children:D[g.id]?"Done":"Manage"})]}),e.jsx("div",{className:"space-y-3",children:j.map(i=>e.jsxs("div",{className:"flex items-center justify-between text-sm p-2 rounded border",style:{borderColor:o.border},children:[e.jsx("span",{style:{color:o.text},children:i.name}),D[g.id]&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-2 py-1 text-xs rounded border",style:{borderColor:o.border},disabled:!!B[`removeChief-${i.id}`],onClick:()=>W(i.id),children:"Unassign"}),e.jsxs("select",{className:"border rounded px-2 py-1 text-xs",style:{borderColor:o.border},value:I[i.id]||"",onChange:p=>M(J=>({...J,[i.id]:p.target.value})),children:[e.jsx("option",{value:"",children:"Move to…"}),a.filter(p=>p.id!==g.id).map(p=>e.jsx("option",{value:p.id,children:p.username},p.id))]}),e.jsx(V,{disabled:!I[i.id]||!!B[`setChief-${i.id}`],onClick:()=>{const p=Number(I[i.id]);Number.isFinite(p)&&q(i.id,p)},className:"text-xs px-2 py-1",children:"Move"})]})]},i.id))})]},g.id)}),a.filter(g=>b.some(j=>j.assigned_chief===g.id)).length===0&&e.jsx("div",{className:"col-span-full text-center py-8",style:{color:o.textLight},children:"No chiefs with assigned zones"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(T,{children:[e.jsx(F,{title:"Zones Needing Chiefs"}),(()=>{const g=b.filter(i=>!i.assigned_chief),j=a.filter(i=>b.every(p=>p.assigned_chief!==i.id));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:o.border},value:L,onChange:i=>A(i.target.value),children:[e.jsx("option",{value:"",children:"Select zone…"}),g.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]}),e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:o.border},value:N,onChange:i=>P(i.target.value),children:[e.jsx("option",{value:"",children:"Select chief…"}),j.map(i=>e.jsx("option",{value:i.id,children:i.username},i.id))]}),e.jsx(V,{disabled:!L||!N||!!B[`setChief-${Number(L)}`],onClick:()=>{const i=Number(L),p=Number(N);Number.isFinite(i)&&Number.isFinite(p)&&q(i,p),A(""),P("")},className:"text-sm whitespace-nowrap",children:"Assign"})]}),g.length===0&&e.jsx("div",{className:"text-sm text-center py-4",style:{color:o.textLight},children:"All zones have chiefs assigned"})]})})()]}),e.jsxs(T,{children:[e.jsx(F,{title:"Chiefs Without Zones"}),(()=>{const g=a.filter(i=>b.every(p=>p.assigned_chief!==i.id)),j=b.filter(i=>!i.assigned_chief);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:o.border},value:k,onChange:i=>R(i.target.value),children:[e.jsx("option",{value:"",children:"Select chief…"}),g.map(i=>e.jsx("option",{value:i.id,children:i.username},i.id))]}),e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:o.border},value:$,onChange:i=>z(i.target.value),children:[e.jsx("option",{value:"",children:"Select zone…"}),j.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]}),e.jsx(V,{disabled:!k||!$||!!B[`setChief-${Number($)}`],onClick:()=>{const i=Number(k),p=Number($);Number.isFinite(p)&&Number.isFinite(i)&&q(p,i),R(""),z("")},className:"text-sm whitespace-nowrap",children:"Assign"})]}),g.length===0&&e.jsx("div",{className:"text-sm text-center py-4",style:{color:o.textLight},children:"All chiefs have zones assigned"})]})})()]})]})]})]})}function Je(X){const{colors:o,vehicles:a,drivers:b,manpower:B,actionLoading:D,manageVehicle:I,moveManpowerTarget:L,unassignedSelected:N,assignVehicleForSelection:k,setManageVehicle:$,setMoveManpowerTarget:_,setUnassignedSelected:M,setAssignVehicleForSelection:A,assignManpowerVehicle:P,unassignManpowerVehicle:R,deleteManpower:z,manageDriver:q,moveDriverTargetVehicle:W,unassignedDriverId:E,vehicleForUnassignedDriver:F,vehicleNoDriverId:T,driverNoVehicleId:V,setManageDriver:g,setMoveDriverTargetVehicle:j,setUnassignedDriverId:i,setVehicleForUnassignedDriver:p,setVehicleNoDriverId:J,setDriverNoVehicleId:G,assignDriverVehicle:O,unassignDriverVehicle:K}=X,H=({title:s,number:r})=>e.jsxs("div",{className:"flex items-center gap-3 mb-6 pb-3 border-b",style:{borderColor:o.border},children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm",style:{backgroundColor:o.primary},children:r}),e.jsx("h2",{className:"text-2xl font-bold",style:{color:o.text},children:s})]}),Q=({title:s})=>e.jsx("h3",{className:"text-lg font-semibold mb-4 pb-2 border-b",style:{color:o.text,borderColor:o.border},children:s}),c=({children:s,className:r=""})=>e.jsx("div",{className:`rounded-lg shadow-sm border p-6 ${r}`,style:{backgroundColor:o.cardBg,borderColor:o.border},children:s}),d=({children:s,onClick:r,disabled:n=!1,loading:t=!1,className:f=""})=>e.jsx("button",{onClick:r,disabled:n||t,className:`px-4 py-2 rounded-lg font-medium text-white transition-colors flex items-center gap-2 ${f}`,style:{backgroundColor:n?o.textLight:o.primary,cursor:n?"not-allowed":"pointer"},onMouseOver:y=>{!n&&!t&&(y.currentTarget.style.backgroundColor=o.primaryHover)},onMouseOut:y=>{!n&&!t&&(y.currentTarget.style.backgroundColor=o.primary)},children:s});return e.jsxs(e.Fragment,{children:[e.jsxs("section",{children:[e.jsx(H,{title:"Manage Manpower",number:3}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(c,{children:[e.jsx(Q,{title:"Vehicles and Their Manpower"}),e.jsx("div",{className:"space-y-4",children:a.map(s=>e.jsxs("div",{className:"border rounded-lg p-4",style:{borderColor:o.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-semibold",style:{color:o.text},children:s.plate}),e.jsx("button",{onClick:()=>$(r=>({...r,[s.id]:!r[s.id]})),className:"text-sm font-medium px-3 py-1 rounded border",style:{color:o.primary,borderColor:o.primary},children:I[s.id]?"Done":"Manage"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(s.manpower||[]).length===0&&e.jsx("div",{className:"text-sm",style:{color:o.textLight},children:"No manpower assigned"}),(s.manpower||[]).map(r=>e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2 border rounded-lg px-3 py-2",style:{borderColor:o.border},children:[e.jsx("span",{className:"text-sm",style:{color:o.text},children:r.username}),I[s.id]&&e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2",children:[e.jsx("button",{className:"px-2 py-1 text-xs rounded border",style:{borderColor:o.border},onClick:()=>R(r.manpower_id),children:"Remove"}),e.jsxs("select",{className:"border rounded px-2 py-1 text-xs",style:{borderColor:o.border},value:L[r.manpower_id]||"",onChange:n=>_(t=>({...t,[r.manpower_id]:n.target.value})),children:[e.jsx("option",{value:"",children:"Move to…"}),a.filter(n=>n.id!==s.id).map(n=>e.jsx("option",{value:n.id,children:n.plate},n.id))]}),e.jsx(d,{disabled:!L[r.manpower_id]||!!D[`assignManpower-${r.manpower_id}`],onClick:()=>{const n=Number(L[r.manpower_id]);Number.isFinite(n)&&P(r.manpower_id,n)},className:"text-xs px-2 py-1",children:"Move"})]})]},r.manpower_id))]})]},s.id))})]}),e.jsxs(c,{children:[e.jsx(Q,{title:"Unassigned Manpower"}),(()=>{const s=new Set;a.forEach(n=>(n.manpower||[]).forEach(t=>s.add(t.manpower_id)));const r=B.filter(n=>!s.has(n.id));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:o.border},value:k,onChange:n=>A(n.target.value),children:[e.jsx("option",{value:"",children:"Select vehicle…"}),a.map(n=>e.jsx("option",{value:n.id,children:n.plate},n.id))]}),e.jsx(d,{disabled:!k||Object.keys(N).filter(n=>N[Number(n)]).length===0,onClick:async()=>{const n=Object.keys(N).map(Number).filter(f=>N[f]),t=Number(k);for(const f of n)await P(f,t);M(()=>({})),A("")},className:"text-sm whitespace-nowrap",children:"Assign Selected"}),e.jsx("button",{className:"px-4 py-2 rounded-lg font-medium border text-sm whitespace-nowrap",style:{borderColor:o.error,color:o.error},disabled:Object.keys(N).filter(n=>N[Number(n)]).length===0,onClick:async()=>{const n=Object.keys(N).map(Number).filter(f=>N[f]);if(!(!n.length||!window.confirm(`Delete ${n.length} manpower user(s)? This cannot be undone.`))){for(const f of n)await z(f);M(()=>({}))}},children:"Delete Selected"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:[r.map(n=>e.jsxs("label",{className:"flex items-center gap-3 border rounded-lg p-3 cursor-pointer transition-colors hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",checked:!!N[n.id],onChange:t=>M(f=>({...f,[n.id]:t.target.checked})),className:"rounded",style:{accentColor:o.primary}}),e.jsx("span",{className:"text-sm",style:{color:o.text},children:n.username})]},n.id)),r.length===0&&e.jsx("div",{className:"col-span-full text-center py-8",style:{color:o.textLight},children:"No unassigned manpower"})]})]})})()]})]})]}),e.jsxs("section",{children:[e.jsx(H,{title:"Manage Drivers",number:4}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(c,{children:[e.jsx(Q,{title:"Drivers and Their Vehicles"}),(()=>{const s=[],r=new Map(b.map(t=>[t.id,t]));a.forEach(t=>(t.drivers||[]).forEach(f=>{const y=f.user_id&&r.get(f.user_id);y&&s.push({driver:y,vehicle:t})}));const n=a.filter(t=>!t.drivers||t.drivers.length===0);return e.jsxs("div",{className:"space-y-3",children:[s.length===0&&e.jsx("div",{className:"text-center py-8",style:{color:o.textLight},children:"No drivers currently assigned to vehicles"}),s.map(({driver:t,vehicle:f})=>e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 p-3 border rounded-lg",style:{borderColor:o.border},children:[e.jsxs("div",{className:"text-sm min-w-0 flex-1 break-words",children:[e.jsx("span",{className:"font-medium",style:{color:o.text},children:t.username}),e.jsxs("span",{className:"ml-2",style:{color:o.textLight},children:["→ ",f.plate]})]}),e.jsx("div",{className:"flex items-center flex-wrap gap-2 sm:justify-end",children:q[t.id]?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 w-full sm:w-auto",children:[e.jsx("button",{className:"px-3 py-1 text-xs rounded border",style:{borderColor:o.border},disabled:!!D[`assignDriver-${t.id}`],onClick:()=>K(t.id),children:"Remove"}),e.jsxs("select",{className:"border rounded px-2 py-1 text-xs min-w-[8rem]",style:{borderColor:o.border},value:W[t.id]||"",onChange:y=>j(ee=>({...ee,[t.id]:y.target.value})),children:[e.jsx("option",{value:"",children:"Move to…"}),n.filter(y=>y.id!==f.id).map(y=>e.jsx("option",{value:y.id,children:y.plate},y.id))]}),e.jsx(d,{disabled:!W[t.id]||!!D[`assignDriver-${t.id}`],onClick:()=>{const y=Number(W[t.id]);Number.isFinite(y)&&O(t.id,y)},className:"text-xs px-2 py-1",children:"Move"}),e.jsx("button",{className:"px-3 py-1 text-xs rounded border",style:{borderColor:o.border},onClick:()=>g(y=>({...y,[t.id]:!1})),children:"Done"})]})}):e.jsx("button",{onClick:()=>g(y=>({...y,[t.id]:!0})),className:"text-sm font-medium px-3 py-1 rounded border",style:{color:o.primary,borderColor:o.primary},children:"Manage"})})]},`${t.id}-${f.id}`))]})})()]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(c,{children:[e.jsx(Q,{title:"Drivers Without Vehicles"}),(()=>{const s=new Set;a.forEach(t=>(t.drivers||[]).forEach(f=>s.add(f.user_id)));const r=b.filter(t=>!s.has(t.id)),n=a.filter(t=>!t.drivers||t.drivers.length===0);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:o.border},value:E,onChange:t=>i(t.target.value),children:[e.jsx("option",{value:"",children:"Select driver…"}),r.map(t=>e.jsx("option",{value:t.id,children:t.username},t.id))]}),e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:o.border},value:F,onChange:t=>p(t.target.value),children:[e.jsx("option",{value:"",children:"Select vehicle…"}),n.map(t=>e.jsx("option",{value:t.id,children:t.plate},t.id))]}),e.jsx(d,{disabled:!E||!F||!!D[`assignDriver-${Number(E)}`],onClick:()=>{const t=Number(E),f=Number(F);Number.isFinite(t)&&Number.isFinite(f)&&O(t,f),i(""),p("")},className:"text-sm whitespace-nowrap",children:"Assign"})]}),r.length===0&&e.jsx("div",{className:"text-sm text-center py-4",style:{color:o.textLight},children:"All drivers have vehicles assigned"})]})})()]}),e.jsxs(c,{children:[e.jsx(Q,{title:"Vehicles Without Drivers"}),(()=>{const s=new Set;a.forEach(t=>(t.drivers||[]).forEach(f=>s.add(f.user_id)));const r=b.filter(t=>!s.has(t.id)),n=a.filter(t=>!t.drivers||t.drivers.length===0);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:o.border},value:T,onChange:t=>J(t.target.value),children:[e.jsx("option",{value:"",children:"Select vehicle…"}),n.map(t=>e.jsx("option",{value:t.id,children:t.plate},t.id))]}),e.jsxs("select",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",style:{borderColor:o.border},value:V,onChange:t=>G(t.target.value),children:[e.jsx("option",{value:"",children:"Select driver…"}),r.map(t=>e.jsx("option",{value:t.id,children:t.username},t.id))]}),e.jsx(d,{disabled:!T||!V||!!D[`assignDriver-${Number(V)}`],onClick:()=>{const t=Number(T),f=Number(V);Number.isFinite(f)&&Number.isFinite(t)&&O(f,t),J(""),G("")},className:"text-sm whitespace-nowrap",children:"Assign"})]}),n.length===0&&e.jsx("div",{className:"text-sm text-center py-4",style:{color:o.textLight},children:"All vehicles have drivers assigned"})]})})()]})]})]})]})]})}const w="http://localhost:4000",Ge=()=>{const{t:X}=Oe(),[o,a]=x.useState([]),[b,B]=x.useState([]),[D,I]=x.useState([]),[L,N]=x.useState([]),[k,$]=x.useState([]),[_,M]=x.useState([]),[A,P]=x.useState(!1),[R,z]=x.useState(null),[q,W]=x.useState(null),[E,F]=x.useState(""),[T,V]=x.useState(""),[g,j]=x.useState({}),[i,p]=x.useState({}),[J,G]=x.useState({}),[O,K]=x.useState({}),[H,Q]=x.useState(""),[c,d]=x.useState({}),[s,r]=x.useState({}),[n,t]=x.useState(""),[f,y]=x.useState(""),[ee,ae]=x.useState(""),[le,ce]=x.useState(""),[de,re]=x.useState(""),[me,te]=x.useState(""),[he,oe]=x.useState(""),[ue,ie]=x.useState(""),[se,S]=x.useState({}),[xe,pe]=x.useState({}),[ge,fe]=x.useState({}),[ve,be]=x.useState(""),[ye,Ne]=x.useState(""),[je,Ce]=x.useState(""),[we,Se]=x.useState(""),Y={primary:"#D97706",primaryHover:"#B45309",accent:"#15803D",accentHover:"#166534",background:"#F3F4F6",cardBg:"#FFFFFF",border:"#E5E7EB",text:"#1E1E1E",textLight:"#6B7280",error:"#DC2626"};function Z(){const m=localStorage.getItem("token");m&&(P(!0),z(null),fetch(`${w}/api/manageworkers/init`,{headers:{Authorization:`Bearer ${m}`}}).then(async u=>{const l=await u.json();if(!u.ok)throw new Error((l==null?void 0:l.error)||"Failed to load");const h=(l.supervisors||[]).map(v=>({id:v.id,username:v.username,vehicles:Array.isArray(v.vehicles)?v.vehicles.map(U=>({id:Number(U.id),plate:String(U.plate)})):[],zones:Array.isArray(v.zones)?v.zones.map(U=>({id:Number(U.id),name:String(U.name)})):[]}));a(h);const C=new Map((l.drivers||[]).map(v=>[Number(v.id),String(v.username)]));B((l.vehicles||[]).map(v=>({id:Number(v.id),plate:String(v.plate),manpower:Array.isArray(v.manpower)?v.manpower.map(U=>({manpower_id:Number(U.manpower_id),username:String(U.username)})):[],drivers:Array.isArray(v.drivers)?v.drivers.map(U=>({user_id:Number(U.user_id),username:C.get(Number(U.user_id))})):[]}))),I((l.zones||[]).map(v=>({id:Number(v.id),name:String(v.zone_name),assigned_chief:v.assigned_chief??null,supervisor_id:v.supervisor_id??null}))),N((l.chiefs||[]).map(v=>({id:Number(v.id),username:String(v.username)}))),$((l.drivers||[]).map(v=>({id:Number(v.id),username:String(v.username)}))),M((l.manpower||[]).map(v=>({id:Number(v.id),username:String(v.username)})))}).catch(u=>z((u==null?void 0:u.message)||"Failed to load")).finally(()=>P(!1)))}async function ke(m){const u=localStorage.getItem("token");u&&(await fetch(`${w}/api/manageworkers/manpower/${m}`,{method:"DELETE",headers:{Authorization:`Bearer ${u}`}}),Z())}x.useEffect(()=>{Z()},[]);function $e(m){W(m.id),F(""),V("")}function ne(){W(null),F(""),V(""),j({})}async function Ae(m){const u=localStorage.getItem("token");if(u&&E!=="")try{S(h=>({...h,[`saveVehicle-${m}`]:!0}));const l=await fetch(`${w}/api/manageworkers/supervisors/${m}/vehicle`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`},body:JSON.stringify({vehicleId:Number(E)})});if(l.status===409)if(window.confirm("This vehicle is already assigned to another supervisor. Do you want to move it to this supervisor?"))await fetch(`${w}/api/manageworkers/supervisors/${m}/vehicle/move`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`},body:JSON.stringify({vehicleId:Number(E)})});else return;else if(!l.ok){const h=await l.json().catch(()=>({}));throw new Error((h==null?void 0:h.error)||"Failed to assign vehicle")}}catch(l){z((l==null?void 0:l.message)||"Failed to assign/move vehicle")}finally{ne(),Z(),S(l=>({...l,[`saveVehicle-${m}`]:!1}))}}async function Te(m,u){const l=localStorage.getItem("token");l&&(await fetch(`${w}/api/manageworkers/supervisors/${m}/vehicle/${u}`,{method:"DELETE",headers:{Authorization:`Bearer ${l}`}}),Z())}async function Ve(m,u){const l=localStorage.getItem("token");if(l)try{S(C=>({...C,assignVehicleNoSup:!0}));const h=await fetch(`${w}/api/manageworkers/supervisors/${m}/vehicle`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({vehicleId:u})});if(h.status===409)if(window.confirm("This vehicle is already assigned to another supervisor. Do you want to move it to this supervisor?"))await fetch(`${w}/api/manageworkers/supervisors/${m}/vehicle/move`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({vehicleId:u})});else return;else if(!h.ok){const C=await h.json().catch(()=>({}));throw new Error((C==null?void 0:C.error)||"Failed to assign vehicle")}}catch(h){z((h==null?void 0:h.message)||"Failed to assign/move vehicle")}finally{re(""),te(""),Z(),S(h=>({...h,assignVehicleNoSup:!1}))}}async function Ze(m){const u=localStorage.getItem("token");if(u&&T)try{S(h=>({...h,[`addZone-${m}`]:!0}));const l=await fetch(`${w}/api/manageworkers/supervisors/${m}/zones/add`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`},body:JSON.stringify({zoneId:Number(T)})});if(l.status===409)if(await l.json().catch(()=>({})),window.confirm("This zone is already assigned to a supervisor. Do you want to move it to this supervisor?"))await fetch(`${w}/api/manageworkers/supervisors/${m}/zones/move`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`},body:JSON.stringify({zoneId:Number(T)})});else return;else if(!l.ok){const h=await l.json().catch(()=>({}));throw new Error((h==null?void 0:h.error)||"Failed to add zone")}}catch(l){z((l==null?void 0:l.message)||"Failed to add/move zone")}finally{V(""),Z(),S(l=>({...l,[`addZone-${m}`]:!1}))}}async function De(m,u){const l=localStorage.getItem("token");if(l)try{S(C=>({...C,assignZoneNoSup:!0}));const h=await fetch(`${w}/api/manageworkers/supervisors/${m}/zones/add`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({zoneId:u})});if(h.status===409)if(await h.json().catch(()=>({})),window.confirm("This zone is already assigned to a supervisor. Do you want to move it to this supervisor?"))await fetch(`${w}/api/manageworkers/supervisors/${m}/zones/move`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({zoneId:u})});else return;else if(!h.ok){const C=await h.json().catch(()=>({}));throw new Error((C==null?void 0:C.error)||"Failed to add zone")}}catch(h){z((h==null?void 0:h.message)||"Failed to add/move zone")}finally{oe(""),ie(""),Z(),S(h=>({...h,assignZoneNoSup:!1}))}}async function Ie(m,u){const l=localStorage.getItem("token");l&&(await fetch(`${w}/api/manageworkers/supervisors/${m}/zones/remove`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({zoneId:u})}),Z())}async function Me(m,u){const l=localStorage.getItem("token");if(!l)return;const h=Number(u);Number.isFinite(h)&&(S(C=>({...C,[`moveZone-${m}`]:!0})),await fetch(`${w}/api/manageworkers/supervisors/${h}/zones/move`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({zoneId:m})}),j(C=>({...C,[m]:""})),Z(),S(C=>({...C,[`moveZone-${m}`]:!1})))}async function Ee(m,u){const l=localStorage.getItem("token");l&&(S(h=>({...h,[`setChief-${m}`]:!0})),await fetch(`${w}/api/manageworkers/zones/${m}/reassign-chief`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({chiefUserId:u})}),Z(),S(h=>({...h,[`setChief-${m}`]:!1})))}async function Fe(m){const u=localStorage.getItem("token");u&&(S(l=>({...l,[`removeChief-${m}`]:!0})),await fetch(`${w}/api/manageworkers/zones/${m}/chief`,{method:"DELETE",headers:{Authorization:`Bearer ${u}`}}),Z(),S(l=>({...l,[`removeChief-${m}`]:!1})))}async function Le(m,u){const l=localStorage.getItem("token");l&&(S(h=>({...h,[`assignDriver-${m}`]:!0})),await fetch(`${w}/api/manageworkers/drivers/${m}/vehicle`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({vehicleId:u})}),Z(),S(h=>({...h,[`assignDriver-${m}`]:!1})))}async function ze(m){const u=localStorage.getItem("token");u&&(await fetch(`${w}/api/manageworkers/drivers/${m}/vehicle`,{method:"DELETE",headers:{Authorization:`Bearer ${u}`}}),Z())}async function Be(m,u){const l=localStorage.getItem("token");l&&(S(h=>({...h,[`assignManpower-${m}`]:!0})),await fetch(`${w}/api/manageworkers/manpower/${m}/vehicle`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({vehicleId:u})}),Z(),S(h=>({...h,[`assignManpower-${m}`]:!1})))}async function _e(m){const u=localStorage.getItem("token");u&&(await fetch(`${w}/api/manageworkers/manpower/${m}/vehicle`,{method:"DELETE",headers:{Authorization:`Bearer ${u}`}}),Z())}return e.jsxs("div",{className:"p-6 space-y-8 min-h-screen",style:{backgroundColor:Y.background},children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 ucs-gradient-text",children:X("manageWorkers.title")}),e.jsx("p",{className:"text-lg",style:{color:Y.textLight},children:X("manageWorkers.subtitle")})]}),R&&e.jsx("div",{className:"p-4 rounded-lg text-white font-medium text-center",style:{backgroundColor:Y.error},children:R}),A?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx(He,{size:32,className:"border-gray-400 border-t-gray-600"})}):e.jsxs("div",{className:"space-y-12 max-w-7xl mx-auto",children:[e.jsx(Pe,{t:X,colors:Y,supervisors:o,vehicles:b,zones:D,editingId:q,editVehicleId:E,addZoneId:T,moveSelection:g,assignVehicleNoSup:de,assignVehicleToSupervisorId:me,assignZoneNoSup:he,assignZoneToSupervisorId:ue,actionLoading:se,startEdit:$e,cancelEdit:ne,setEditVehicleId:F,setAddZoneId:V,setMoveSelection:j,setAssignVehicleNoSup:re,setAssignVehicleToSupervisorId:te,setAssignZoneNoSup:oe,setAssignZoneToSupervisorId:ie,saveVehicle:Ae,unassignVehicle:Te,addZone:Ze,removeZone:Ie,moveZone:Me,assignVehicleToSupervisor:Ve,assignZoneToSupervisor:De}),e.jsx(We,{colors:Y,chiefs:L,zones:D,actionLoading:se,manageChief:xe,moveZoneChiefTarget:ge,noChiefSelectedZone:ve,noChiefAssignChiefId:ye,noZoneSelectedChief:je,noZoneAssignZoneId:we,setManageChief:pe,setMoveZoneChiefTarget:fe,setNoChiefSelectedZone:be,setNoChiefAssignChiefId:Ne,setNoZoneSelectedChief:Ce,setNoZoneAssignZoneId:Se,setZoneChief:Ee,removeZoneChief:Fe}),e.jsx(Je,{colors:Y,vehicles:b,drivers:k,manpower:_,actionLoading:se,manageVehicle:i,moveManpowerTarget:J,unassignedSelected:O,assignVehicleForSelection:H,setManageVehicle:p,setMoveManpowerTarget:G,setUnassignedSelected:K,setAssignVehicleForSelection:Q,assignManpowerVehicle:Be,unassignManpowerVehicle:_e,deleteManpower:ke,manageDriver:c,moveDriverTargetVehicle:s,unassignedDriverId:n,vehicleForUnassignedDriver:f,vehicleNoDriverId:ee,driverNoVehicleId:le,setManageDriver:d,setMoveDriverTargetVehicle:r,setUnassignedDriverId:t,setVehicleForUnassignedDriver:y,setVehicleNoDriverId:ae,setDriverNoVehicleId:ce,assignDriverVehicle:Le,unassignDriverVehicle:ze})]})]})};export{Ge as default};
