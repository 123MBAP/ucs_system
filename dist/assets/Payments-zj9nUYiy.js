import{j as e}from"./index-DZTFkylD.js";import{u as L,r as n}from"./react-CzDbI3ao.js";const p="http://localhost:4000",_=()=>{const c=L(),[f,M]=n.useState([]),[g,A]=n.useState([]),[F,j]=n.useState(!1),[y,o]=n.useState(null),[h,N]=n.useState(""),[u,w]=n.useState(""),[v,k]=n.useState(""),[S,I]=n.useState(!1),C=n.useMemo(()=>new URLSearchParams(c.search),[c.search]),P=C.get("clientId"),d=C.get("clientName");function b(){const t=localStorage.getItem("token");if(!t)return;j(!0),o(null);const l=new URLSearchParams(c.search),a=l.get("scope"),s=l.get("filter"),r=[];a&&r.push(`scope=${encodeURIComponent(a)}`),s&&r.push(`filter=${encodeURIComponent(s)}`),a||r.push("mine=true");const $=r.length?`?${r.join("&")}`:"";Promise.all([fetch(`${p}/api/payments/transactions${$}`,{headers:{Authorization:`Bearer ${t}`}}),fetch(`${p}/api/payments/completed${$}`,{headers:{Authorization:`Bearer ${t}`}})]).then(async([i,E])=>{const m=await i.json(),x=await E.json();if(!i.ok)throw new Error((m==null?void 0:m.error)||"Failed to load pending");if(!E.ok)throw new Error((x==null?void 0:x.error)||"Failed to load completed");M(m.transactions||[]),A(x.payments||[])}).catch(i=>o((i==null?void 0:i.message)||"Failed to load payments")).finally(()=>j(!1))}n.useEffect(()=>{const a=`Pay for ${new Date().toLocaleString(void 0,{month:"long"})}`,s=d?`${a} — ${d}`:a;k(s),b()},[c.search]);function T(t){t.preventDefault(),o(null);const l=localStorage.getItem("token");if(l){if(!h||!u){o("Amount and Phone are required");return}fetch(`${p}/api/payments/transactions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({amount:Number(h),phoneNumber:u,purpose:v||void 0,clientId:P?Number(P):void 0})}).then(async a=>{const s=await a.json();if(!a.ok)throw new Error((s==null?void 0:s.error)||"Failed to initiate payment");N(""),w(""),b();try{window.dispatchEvent(new Event("payments-updated"))}catch{}}).catch(a=>o((a==null?void 0:a.message)||"Failed to initiate payment"))}}function B(t){const l=localStorage.getItem("token");!l||!window.confirm(`Mark transaction #${t} as completed (success)?`)||fetch(`${p}/api/payments/transactions/${t}/complete`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({status:"success"})}).then(async s=>{const r=await s.json();if(!s.ok)throw new Error((r==null?void 0:r.error)||"Failed to complete transaction");b();try{window.dispatchEvent(new Event("payments-updated"))}catch{}}).catch(s=>o((s==null?void 0:s.message)||"Failed to complete transaction"))}return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-slate-800 to-blue-600 bg-clip-text text-transparent",children:"Payments"}),e.jsx("p",{className:"text-slate-600 mt-2",children:"Initiate mobile money payments and track transactions"})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-4 sm:mt-0 text-sm text-slate-500",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{children:"Service Available"})]})]}),d&&e.jsxs("div",{className:"rounded-xl border border-amber-200 bg-amber-50 p-4 text-amber-900",children:["Paying for client: ",e.jsx("span",{className:"font-semibold",children:d})]}),y&&e.jsx("div",{className:"rounded-xl border border-red-200 bg-red-50 p-4 text-red-700",children:y}),F&&e.jsx("div",{className:"rounded-xl border border-slate-200 bg-white p-4 text-slate-600",children:"Loading…"}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6",children:[e.jsxs("div",{className:"mb-4 flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"Initiate Payment"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"px-3 py-1 rounded-xl text-black font-semibold",style:{backgroundColor:"#FFCB05"},children:"MTN MoMo"}),e.jsx("span",{className:"text-sm text-slate-600",children:"You will pay using MTN Mobile Money"})]})]}),e.jsxs("form",{onSubmit:T,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-1",children:"Amount"}),e.jsx("input",{type:"number",min:"0",step:"0.01",className:"w-full px-3 py-2 bg-white border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",value:h,onChange:t=>N(t.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-1",children:"Phone"}),e.jsx("input",{className:"w-full px-3 py-2 bg-white border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",value:u,onChange:t=>w(t.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700",children:"Purpose"}),e.jsx("button",{type:"button",onClick:()=>I(t=>!t),className:"text-sm text-blue-600 underline",children:S?"Done":"Edit"})]}),e.jsx("input",{className:"mt-1 w-full px-3 py-2 bg-white border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",value:v,onChange:t=>k(t.target.value),readOnly:!S})]}),e.jsx("div",{className:"md:col-span-1 flex items-end",children:e.jsx("button",{type:"submit",className:"w-full px-4 py-2 rounded-xl font-semibold text-black hover:brightness-95 transition-all duration-200 shadow-sm",style:{backgroundColor:"#FFCB05"},children:"Initiate MTN MoMo Payment"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-4",children:"Pending Transactions"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-200",children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"#"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Client"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Phone"}),e.jsx("th",{className:"px-3 py-2"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-slate-200",children:[f.map(t=>e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"px-3 py-2",children:t.id}),e.jsx("td",{className:"px-3 py-2",children:t.client_username||t.client_id}),e.jsxs("td",{className:"px-3 py-2",children:[t.amount," ",t.currency]}),e.jsx("td",{className:"px-3 py-2",children:t.phone_number}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsx("button",{onClick:()=>B(t.id),className:"px-2 py-1 text-sm bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg transition-colors",children:"Mark Completed"})})]},t.id)),!f.length&&e.jsx("tr",{children:e.jsx("td",{className:"px-3 py-3 text-slate-500",colSpan:5,children:"No pending transactions."})})]})]})})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-4",children:"Completed Payments"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-200",children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"#"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Client"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Status"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-slate-200",children:[g.map(t=>e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"px-3 py-2",children:t.id}),e.jsx("td",{className:"px-3 py-2",children:t.client_username||t.client_id}),e.jsxs("td",{className:"px-3 py-2",children:[t.amount," ",t.currency]}),e.jsx("td",{className:"px-3 py-2",children:t.status})]},t.id)),!g.length&&e.jsx("tr",{children:e.jsx("td",{className:"px-3 py-3 text-slate-500",colSpan:4,children:"No completed payments."})})]})]})})]})]})]})};export{_ as default};
