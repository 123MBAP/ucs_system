import{u as J,j as e}from"./index-CdjKjvMW.js";import{r as i}from"./react-CzDbI3ao.js";import{c as q,R as H,d as U,M as Z}from"./ui-C_j-RX_5.js";const p="http://localhost:4000",h={Client:s=>e.jsx("svg",{...s,className:`w-6 h-6 ${s.className||""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),Payment:s=>e.jsx("svg",{...s,className:`w-6 h-6 ${s.className||""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})}),Phone:s=>e.jsx("svg",{...s,className:`w-5 h-5 ${s.className||""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),Check:s=>e.jsx("svg",{...s,className:`w-5 h-5 ${s.className||""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),Loading:s=>e.jsx("svg",{...s,className:`w-5 h-5 animate-spin ${s.className||""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 2v4m0 12v4m8-10h-4M6 12H2"})}),Alert:s=>e.jsx("svg",{...s,className:`w-5 h-5 ${s.className||""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},te=()=>{const{t:s}=J(),B="John Client",[y,L]=i.useState(null),[w,z]=i.useState([]),[k,_]=i.useState([]),[K,S]=i.useState({}),$=i.useMemo(()=>[s("weekday.mon"),s("weekday.tue"),s("weekday.wed"),s("weekday.thu"),s("weekday.fri"),s("weekday.sat"),s("weekday.sun")],[s]),D=i.useMemo(()=>w.map(t=>$[(Number(t)||1)-1]).filter(Boolean),[w]),[c,T]=i.useState(null),[b,F]=i.useState(0),[N,R]=i.useState(""),[j,C]=i.useState(!1),[m,g]=i.useState({type:"idle"});i.useEffect(()=>{const t=localStorage.getItem("token");!t||!p||(async()=>{var r,n;try{const o=await fetch(`${p}/api/clients/me`,{headers:{Authorization:`Bearer ${t}`}}),a=await o.json();if(o.ok&&((r=a==null?void 0:a.client)!=null&&r.zone_id)){L(a.client.id),((n=a==null?void 0:a.client)==null?void 0:n.monthly_amount)!=null&&T(Number(a.client.monthly_amount));const d=await fetch(`${p}/api/zones/${a.client.zone_id}/service-days`,{headers:{Authorization:`Bearer ${t}`}}),x=await d.json();d.ok&&Array.isArray(x==null?void 0:x.serviceDays)&&z(x.serviceDays.map(u=>Number(u)).filter(u=>u>=1&&u<=7));const M=await fetch(`${p}/api/zones/${a.client.zone_id}/schedule`,{headers:{Authorization:`Bearer ${t}`}}),f=await M.json();M.ok&&Array.isArray(f==null?void 0:f.schedule)&&_(f.schedule);const P=await fetch(`${p}/api/payments/statements`,{headers:{Authorization:`Bearer ${t}`}}),v=await P.json();if(P.ok&&Array.isArray(v==null?void 0:v.payments)){const u=new Date,W=u.getFullYear(),O=u.getMonth(),V=v.payments.filter(l=>(l==null?void 0:l.client_id)===a.client.id&&(l==null?void 0:l.completed_at)).map(l=>({amt:Number(l.amount)||0,dt:new Date(l.completed_at)})).filter(({dt:l})=>l.getFullYear()===W&&l.getMonth()===O).reduce((l,{amt:Y})=>l+Y,0);F(V)}}}catch{}})()},[]);const E=t=>{if(!t||t.supervisor_status!=="complete"||!t.supervisor_decided_at)return!1;const r=new Date(t.supervisor_decided_at),n=new Date(r.getTime()+1440*60*1e3),o=new Date<=n,a=(t.complained_client_ids||[]).includes(y||-1);return o&&!a},A=i.useMemo(()=>{const t=new Date;return k.filter(r=>{if(r.supervisor_status!=="complete"||!r.supervisor_decided_at)return!0;const n=new Date(r.supervisor_decided_at),o=new Date(n.getTime()+1440*60*1e3);return(r.complained_client_ids||[]).includes(y||-1)||t<=o})},[k,y]),I=async t=>{var n;const r=localStorage.getItem("token");if(r)try{S(d=>({...d,[t]:!0}));const o=await fetch(`${p}/api/clients/complaints`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({scheduleId:t})}),a=await o.json();o.ok&&((n=a==null?void 0:a.schedule)!=null&&n.complained_client_ids)&&_(d=>d.map(x=>x.id===t?{...x,complained_client_ids:a.schedule.complained_client_ids}:x))}finally{S(o=>({...o,[t]:!1}))}},X=async t=>{if(t.preventDefault(),!/^\+?\d{9,15}$/.test(N)){g({type:"error",message:"Enter a valid phone number (9-15 digits, optionally starting with +)."});return}C(!0),g({type:"pending",message:"Payment initiated. Please confirm on your phone…"});try{const r=localStorage.getItem("token");if(!r||c==null){g({type:"error",message:"Missing session or amount. Please reload and try again."});return}const n=Number(c),o=await fetch(`${p}/api/payments/transactions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({amount:n,phoneNumber:N})}),a=await o.json().catch(()=>({}));if(!o.ok)throw new Error((a==null?void 0:a.error)||"Failed to initiate payment");g({type:"pending",message:"Request sent. Approve the prompt on your phone to complete payment."})}catch(r){g({type:"error",message:(r==null?void 0:r.message)||"Payment failed. Please try again."})}finally{C(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gray-50 p-4 sm:p-6 lg:p-8",children:[e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6 sm:space-y-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold text-charcoal",children:s("clientDashboard.title")}),e.jsx("p",{className:"text-gray-600 mt-2 text-sm sm:text-base",children:s("clientDashboard.subtitle")})]}),e.jsx("div",{className:"flex items-center space-x-4 mt-4 sm:mt-0",children:e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[e.jsx("div",{className:"w-2 h-2 bg-green-600 rounded-full animate-pulse"}),e.jsx("span",{children:"Account Active"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 sm:gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6 sm:space-y-8",children:[e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6 transition-all duration-300 hover:shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-600",children:s("client.profile")}),e.jsx("span",{className:"text-xs text-green-600 bg-green-50 px-2 py-1 rounded-full font-medium border border-green-200",children:s("common.verified")})]}),e.jsx("p",{className:"text-xl sm:text-2xl font-bold text-charcoal",children:B}),e.jsx("p",{className:"text-gray-600 mt-1 text-sm sm:text-base",children:"Active client since 2024"})]}),e.jsx("div",{className:"w-14 h-14 sm:w-16 sm:h-16 bg-gradient-to-br from-amber-500 to-amber-600 rounded-2xl flex items-center justify-center shadow-lg",children:e.jsx(h.Client,{})})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-5 transition-all duration-300 hover:shadow-md",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-3",children:e.jsx("span",{className:"text-sm font-semibold text-gray-600",children:s("clientDashboard.serviceDay")})}),e.jsx("p",{className:"text-gray-600 text-sm mb-2",children:"The day of service in your zone is:"}),e.jsx("p",{className:"text-lg sm:text-xl font-bold text-charcoal",children:D.length?D.join(", "):"Not set"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-5 transition-all duration-300 hover:shadow-md",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-3",children:e.jsx("span",{className:"text-sm font-semibold text-gray-600",children:s("clientDashboard.amountToPay")})}),e.jsx("p",{className:"text-lg sm:text-xl font-bold text-charcoal",children:c!=null?`$${c.toLocaleString()}`:"—"}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"Your monthly amount"}),c!=null&&e.jsxs("p",{className:"text-gray-500 text-xs mt-2",children:["Remaining this month: $",Math.max(0,c-b).toLocaleString()]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-5 transition-all duration-300 hover:shadow-md",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(h.Payment,{className:"w-4 h-4 text-amber-600"}),e.jsx("span",{className:"text-sm font-semibold text-gray-600",children:s("clientDashboard.paidThisMonth")})]}),e.jsxs("p",{className:"text-lg sm:text-xl font-bold text-charcoal",children:["$",b.toLocaleString()]}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"Total paid this month"}),c!=null&&e.jsxs("div",{className:"flex items-center space-x-2 mt-3",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${b>=c?"bg-green-600":"bg-amber-500"}`}),e.jsx("span",{className:`text-xs font-medium ${b>=c?"text-green-600":"text-amber-600"}`,children:b>=c?s("clientDashboard.paymentUpToDate"):s("clientDashboard.paymentPending")})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-5",children:[e.jsx("h3",{className:"text-sm font-semibold text-charcoal mb-4",children:"Quick Actions"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{label:"Payment History",Icon:q,color:"text-amber-600 bg-amber-50"},{label:"Receipts",Icon:H,color:"text-green-600 bg-green-50"},{label:"Profile",Icon:U,color:"text-charcoal bg-gray-100"},{label:"Support",Icon:Z,color:"text-gray-600 bg-gray-50"}].map(({label:t,Icon:r,color:n},o)=>e.jsxs("button",{className:"flex flex-col items-center justify-center p-3 bg-gray-50 rounded-lg hover:bg-amber-50 border border-gray-200 hover:border-amber-200 transition-all duration-200 group",children:[e.jsx("span",{className:`mb-2 p-2 rounded-lg ${n}`,children:e.jsx(r,{className:"h-4 w-4"})}),e.jsx("span",{className:"text-xs font-medium text-charcoal text-center group-hover:text-amber-700",children:t})]},o))})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-4",children:e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-charcoal",children:s("clientDashboard.serviceSchedule")})}),A.length===0?e.jsx("div",{className:"text-gray-600 text-center py-8",children:s("clientDashboard.noSchedule")}):e.jsx("div",{className:"space-y-3",children:A.map(t=>{var a,d;const r=$[(Number(t.service_day)||1)-1]||"",n=t.supervisor_status,o=n==null?{text:"Pending",cls:"bg-amber-50 text-amber-700 border-amber-200"}:n==="complete"?{text:"Completed",cls:"bg-green-50 text-green-700 border-green-200"}:{text:"Not Completed",cls:"bg-red-50 text-red-700 border-red-200"};return e.jsx("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-charcoal font-semibold text-sm sm:text-base",children:r}),e.jsxs("div",{className:"text-gray-600 text-xs sm:text-sm",children:[(a=t.service_start)==null?void 0:a.slice(0,5)," - ",(d=t.service_end)==null?void 0:d.slice(0,5)]})]}),e.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded-lg border ${o.cls} self-start sm:self-auto`,children:o.text})]}),e.jsxs("div",{className:"text-gray-500 text-xs mt-2",children:[t.vehicle_plate?`Vehicle: ${t.vehicle_plate}`:"",t.vehicle_plate&&t.driver_username?" • ":"",t.driver_username?`Driver: ${t.driver_username}`:""]}),n==="not_complete"&&t.supervisor_reason&&e.jsxs("div",{className:"text-red-600 text-xs mt-2",children:["Reason: ",t.supervisor_reason]}),n==="complete"&&(t.complained_client_ids||[]).includes(y||-1)&&e.jsx("div",{className:"text-amber-700 text-xs mt-2",children:"Complaint submitted. Awaiting review."}),n==="complete"&&E(t)&&e.jsx("button",{className:"text-xs text-amber-700 font-medium mt-2 hover:text-amber-800 transition-colors",onClick:()=>I(t.id),children:"My home not yet serviced"})]})},t.id)})})]})]}),e.jsx("div",{className:"space-y-6 sm:space-y-8",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6 sticky top-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-6",children:[e.jsx(h.Payment,{className:"w-5 h-5 text-amber-600"}),e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-charcoal",children:s("payment.makePayment")})]}),m.type!=="idle"&&e.jsx("div",{className:`mb-6 p-4 rounded-xl border transition-all duration-300 ${m.type==="pending"?"bg-amber-50 border-amber-200 text-amber-700":m.type==="success"?"bg-green-50 border-green-200 text-green-700":m.type==="error"?"bg-red-50 border-red-200 text-red-700":""}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[m.type==="pending"&&e.jsx(h.Loading,{}),m.type==="success"&&e.jsx(h.Check,{}),m.type==="error"&&e.jsx(h.Alert,{}),e.jsx("span",{className:"font-medium text-sm",children:m.message})]})}),e.jsxs("form",{onSubmit:X,className:"space-y-6",children:[c!=null&&e.jsxs("div",{className:"p-3 bg-amber-50 rounded-xl border border-amber-200",children:[e.jsx("div",{className:"text-xs text-amber-700",children:"Amount to pay (current month)"}),e.jsx("div",{className:"text-lg font-bold text-charcoal",children:`$${Number(c).toLocaleString()}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-charcoal mb-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h.Phone,{className:"w-4 h-4 text-amber-600"}),e.jsx("span",{children:s("payment.phoneNumber")})]})}),e.jsx("input",{type:"tel",value:N,onChange:t=>R(t.target.value),placeholder:"e.g. +2507XXXXXXXX",className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent transition-all duration-200 text-charcoal placeholder-gray-400",disabled:j}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Enter your mobile money phone number"})]}),e.jsx("button",{type:"submit",disabled:j,className:`w-full flex items-center justify-center space-x-2 py-4 rounded-xl font-semibold shadow-sm transition-all duration-200 ${j?"bg-amber-400 cursor-not-allowed":"bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 hover:shadow-md"}`,children:j?e.jsxs(e.Fragment,{children:[e.jsx(h.Loading,{}),e.jsx("span",{className:"text-white text-sm",children:s("payment.processing")})]}):e.jsx("span",{className:"text-white text-sm",children:s("payment.payNow")})})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-xl border border-gray-200",children:[e.jsx("h3",{className:"text-sm font-semibold text-charcoal mb-2",children:s("payment.infoTitle")}),e.jsxs("ul",{className:"text-xs text-gray-600 space-y-1",children:[e.jsx("li",{children:"• Payments are processed via mobile money"}),e.jsx("li",{children:"• You will receive an STK push notification"}),e.jsx("li",{children:"• Standard transaction fees apply"}),e.jsx("li",{children:"• Receipts are generated automatically"})]})]})]})})]})]}),e.jsx("style",{children:`
        .text-charcoal {
          color: #1E1E1E;
        }
        .bg-amber-50 {
          background-color: #FFFBEB;
        }
        .bg-amber-500 {
          background-color: #D97706;
        }
        .bg-amber-600 {
          background-color: #B45309;
        }
        .text-amber-600 {
          color: #D97706;
        }
        .text-amber-700 {
          color: #B45309;
        }
        .border-amber-200 {
          border-color: #FCD34D;
        }
        .bg-green-50 {
          background-color: #F0FDF4;
        }
        .text-green-600 {
          color: #15803D;
        }
        .border-green-200 {
          border-color: #BBF7D0;
        }
      `})]})};export{te as default};
