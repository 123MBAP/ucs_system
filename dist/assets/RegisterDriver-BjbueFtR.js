import{j as e}from"./index-BdDvBGrt.js";import{r as t}from"./react-BeLGUnOF.js";const c="http://localhost:4000",R=()=>{const[u,S]=t.useState(""),[g,k]=t.useState(""),[x,C]=t.useState(""),[p,E]=t.useState(""),[v,$]=t.useState(!1),[d,f]=t.useState("existing"),[I,q]=t.useState([]),[b,V]=t.useState(null),[w,A]=t.useState(""),[j,m]=t.useState(!1),[P,F]=t.useState(null),[T,h]=t.useState(null);t.useEffect(()=>{const s=localStorage.getItem("token");s&&fetch(`${c}/api/manager/vehicles`,{headers:{Authorization:`Bearer ${s}`}}).then(async l=>{const a=await l.json();if(!l.ok)throw new Error((a==null?void 0:a.error)||"Failed to load vehicles");const n=(a.vehicles||[]).map(r=>({id:String(r.id),plate:r.plate}));q(n)}).catch(l=>console.error("Load vehicles error:",l))},[]);function J(s){if(s.preventDefault(),h(null),F(null),m(!0),!u.trim()||!g.trim()||!x.trim()){h("First name, last name and username/email are required."),m(!1);return}const l={firstName:u,lastName:g,username:x,salary:p?Number(p):void 0},a=localStorage.getItem("token");if(!a){h("You must be logged in as manager to create a driver."),m(!1);return}fetch(`${c}/api/manager/drivers`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(l)}).then(async n=>{var B,D;const r=await n.json();if(!n.ok)throw new Error((r==null?void 0:r.error)||"Failed to create driver");const N=(B=r==null?void 0:r.driver)==null?void 0:B.id;if(!N)throw new Error("Driver created but id missing");if(v)if(d==="existing"){if(!b)throw new Error("Please select a vehicle to assign.");const o=await fetch(`${c}/api/manager/drivers/${N}/vehicle`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({vehicleId:Number(b)})}),i=await o.json();if(!o.ok)throw new Error((i==null?void 0:i.error)||"Failed to assign vehicle")}else{if(!w.trim())throw new Error("Please provide the new vehicle plate");const o=await fetch(`${c}/api/manager/vehicles`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({plate:w.trim()})}),i=await o.json();if(!o.ok)throw new Error((i==null?void 0:i.error)||"Failed to create vehicle");const O=(D=i==null?void 0:i.vehicle)==null?void 0:D.id;if(!O)throw new Error("Vehicle created but id missing");const z=await fetch(`${c}/api/manager/drivers/${N}/vehicle`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({vehicleId:O})}),y=await z.json();if(!z.ok)throw new Error((y==null?void 0:y.error)||"Failed to assign new vehicle")}F(`Driver created. Temporary password: ${r.tempPassword}`),S(""),k(""),C(""),E(""),$(!1),f("existing"),V(null),A("")}).catch(n=>h(n.message||"Failed to create driver")).finally(()=>m(!1))}return e.jsxs("div",{className:"p-6 max-w-2xl",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Register Driver"}),e.jsxs("form",{onSubmit:J,className:"space-y-4",children:[T&&e.jsx("div",{className:"text-red-600",children:T}),P&&e.jsx("div",{className:"text-green-600",children:P}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"First Name"}),e.jsx("input",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",value:u,onChange:s=>S(s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Last Name"}),e.jsx("input",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",value:g,onChange:s=>k(s.target.value),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Username or Email"}),e.jsx("input",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",value:x,onChange:s=>C(s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Salary (optional)"}),e.jsx("input",{type:"number",min:"0",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",value:p,onChange:s=>E(s.target.value),placeholder:"Enter salary amount"})]}),e.jsx("div",{className:"pt-2",children:e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",checked:v,onChange:s=>$(s.target.checked),className:"mr-2"}),e.jsx("span",{children:"Assign Vehicle (optional)"})]})}),v&&e.jsxs("div",{className:"p-4 border rounded-md",children:[e.jsxs("div",{className:"space-x-4 mb-3",children:[e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",name:"vehicleMode",value:"existing",checked:d==="existing",onChange:()=>f("existing"),className:"mr-2"}),e.jsx("span",{children:"Assign existing vehicle"})]}),e.jsxs("label",{className:"inline-flex items-center ml-4",children:[e.jsx("input",{type:"radio",name:"vehicleMode",value:"new",checked:d==="new",onChange:()=>f("new"),className:"mr-2"}),e.jsx("span",{children:"Assign new vehicle"})]})]}),d==="existing"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Select Vehicle"}),e.jsxs("select",{value:b??"",onChange:s=>V(s.target.value||null),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",children:[e.jsx("option",{value:"",children:"-- Select vehicle --"}),I.map(s=>e.jsx("option",{value:s.id,children:s.plate},s.id))]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"New Vehicle Plate"}),e.jsx("input",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",value:w,onChange:s=>A(s.target.value)})]})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:j,className:`px-4 py-2 text-white rounded-md ${j?"bg-blue-400":"bg-blue-600 hover:bg-blue-700"}`,children:j?"Creatingâ€¦":"Create Driver"})})]})]})};export{R as default};
