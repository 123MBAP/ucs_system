import{u as K,j as e}from"./index-DMsqYpTw.js";import{r as t,u as Q,L as W}from"./react-BeLGUnOF.js";const b="http://localhost:4000",se=()=>{const{t:a}=K(),[Z,I]=t.useState(""),[A,F]=t.useState(""),[g,p]=t.useState(""),[j,N]=t.useState(!1),[x,f]=t.useState("existing"),[u,L]=t.useState("existing"),[v,w]=t.useState(null),[J,V]=t.useState([]),[Y,_]=t.useState([]),[k,G]=t.useState(""),[S,o]=t.useState(!1),[O,y]=t.useState(null),[C,q]=t.useState(""),[E,M]=t.useState(""),[z,P]=t.useState(""),[B,T]=t.useState(""),[D,c]=t.useState(null),R=Q(),U=new URLSearchParams(R.search),m=U.get("reassign")==="1",h=U.get("zoneId");t.useEffect(()=>{const s=localStorage.getItem("token");s&&(fetch(`${b}/api/zones`,{headers:{Authorization:`Bearer ${s}`}}).then(async i=>{const l=await i.json();if(!i.ok)throw new Error((l==null?void 0:l.error)||"Failed to load zones");const d=(l.zones||[]).map(r=>({id:String(r.id),name:r.zone_name}));V(d);const n=h;n&&d.some(r=>r.id===String(n))&&(N(!0),f("existing"),w(String(n)))}).catch(i=>{console.error("Load zones error:",i)}),fetch(`${b}/api/manager/users?role=chief`,{headers:{Authorization:`Bearer ${s}`}}).then(async i=>{const l=await i.json();if(!i.ok)throw new Error((l==null?void 0:l.error)||"Failed to load chiefs");const d=(l.users||[]).map(n=>({id:String(n.id),username:n.username}));_(d)}).catch(i=>console.error("Load chiefs error:",i)))},[R.search]);function H(s){if(s.preventDefault(),c(null),y(null),o(!0),m&&u==="existing"){const n=localStorage.getItem("token");if(!n){c("You must be logged in as manager to reassign a chief."),o(!1);return}if(!h){c("Missing zoneId to reassign."),o(!1);return}if(!k){c("Select a chief to assign."),o(!1);return}fetch(`${b}/api/manager/zones/${h}/reassign-chief`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({chiefUserId:Number(k)})}).then(async r=>{const $=await r.json();if(!r.ok)throw new Error(($==null?void 0:$.error)||"Failed to reassign chief");y("Chief reassigned successfully.")}).catch(r=>c(r.message||"Failed to reassign chief")).finally(()=>o(!1));return}if(!Z.trim()||!A.trim()||!g.trim()){c("First name, last name, and username/email are required."),o(!1);return}let i=null;if(j)if(x==="existing"){if(!v){c("Please select an existing zone to assign."),o(!1);return}i={type:"existing",zoneId:v}}else{if(!C.trim()||!E.trim()||!z.trim()||!B.trim()){c("All new zone fields are required when creating a new zone."),o(!1);return}i={type:"new",zone:{name:C,cell:E,village:z,description:B}}}const l={username:g,assigned:i},d=localStorage.getItem("token");if(!d){c("You must be logged in as manager to create a chief."),o(!1);return}fetch(`${b}/api/manager/chiefs`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify(l)}).then(async n=>{const r=await n.json();if(!n.ok)throw new Error((r==null?void 0:r.error)||"Failed to create chief");y(`Chief created. Temporary password: ${r.tempPassword}`),I(""),F(""),p(""),N(!1),f("existing"),w(null),q(""),M(""),P(""),T("")}).catch(n=>c(n.message||"Failed to create chief")).finally(()=>o(!1))}return e.jsxs("div",{className:"p-6 max-w-2xl",children:[m&&h&&e.jsx("div",{className:"mb-2",children:e.jsxs(W,{to:`/zones/${h}`,className:"text-amber-600 underline text-sm",children:["← ",a("register.common.back")]})}),e.jsx("h2",{className:"text-2xl font-bold mb-4",children:a(m?"register.chief.reassignTitle":"register.chief.title")}),e.jsxs("form",{onSubmit:H,className:"space-y-4",children:[D&&e.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3 text-red-700",children:D}),O&&e.jsx("div",{className:"rounded-lg border border-emerald-200 bg-emerald-50 p-3 text-emerald-700",children:O}),!(m&&u==="existing")&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-800",children:a("register.common.firstName")}),e.jsx("input",{className:"mt-1 block w-full rounded-md border",style:{borderColor:"#E5E7EB"},value:Z,onChange:s=>I(s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-800",children:a("register.common.lastName")}),e.jsx("input",{className:"mt-1 block w-full rounded-md border",style:{borderColor:"#E5E7EB"},value:A,onChange:s=>F(s.target.value),required:!0})]})]}),!m&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-800",children:a("register.common.usernameOrEmail")}),e.jsx("input",{className:"mt-1 block w-full rounded-md border",style:{borderColor:"#E5E7EB"},value:g,onChange:s=>p(s.target.value),required:!0})]}),m&&e.jsxs("div",{className:"p-4 border rounded-md",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",name:"mode",value:"existing",checked:u==="existing",onChange:()=>L("existing"),className:"mr-2"}),e.jsx("span",{children:"Assign to an existing chief"})]}),e.jsxs("label",{className:"inline-flex items-center ml-6",children:[e.jsx("input",{type:"radio",name:"mode",value:"new",checked:u==="new",onChange:()=>L("new"),className:"mr-2"}),e.jsx("span",{children:"Create a new chief"})]})]}),u==="existing"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-800",children:a("register.chief.selectChief")}),e.jsxs("select",{value:k,onChange:s=>G(s.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",children:[e.jsx("option",{value:"",children:"-- Select chief --"}),Y.map(s=>e.jsx("option",{value:s.id,children:s.username},s.id))]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-800",children:a("register.common.usernameOrEmail")}),e.jsx("input",{className:"mt-1 block w-full rounded-md border",style:{borderColor:"#E5E7EB"},value:g,onChange:s=>p(s.target.value)})]})]}),e.jsx("div",{className:"pt-2",children:e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",checked:j,onChange:s=>N(s.target.checked),className:"mr-2"}),e.jsx("span",{children:a("register.chief.assignZoneOptional")})]})}),j&&e.jsxs("div",{className:"p-4 border rounded-md",children:[e.jsxs("div",{className:"space-x-4 mb-3",children:[e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",name:"assignMode",value:"existing",checked:x==="existing",onChange:()=>f("existing"),className:"mr-2"}),e.jsx("span",{children:a("register.chief.assignExisting")})]}),e.jsxs("label",{className:"inline-flex items-center ml-4",children:[e.jsx("input",{type:"radio",name:"assignMode",value:"new",checked:x==="new",onChange:()=>f("new"),className:"mr-2"}),e.jsx("span",{children:a("register.chief.assignNew")})]})]}),x==="existing"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-800",children:a("register.common.selectZone")}),e.jsxs("select",{value:v??"",onChange:s=>w(s.target.value||null),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",children:[e.jsx("option",{value:"",children:"-- Select zone --"}),J.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-800",children:a("register.chief.zoneName")}),e.jsx("input",{className:"mt-1 block w-full rounded-md border",style:{borderColor:"#E5E7EB"},value:C,onChange:s=>q(s.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-800",children:a("register.chief.cell")}),e.jsx("input",{className:"mt-1 block w-full rounded-md border",style:{borderColor:"#E5E7EB"},value:E,onChange:s=>M(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-800",children:a("register.chief.village")}),e.jsx("input",{className:"mt-1 block w-full rounded-md border",style:{borderColor:"#E5E7EB"},value:z,onChange:s=>P(s.target.value)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-800",children:a("register.chief.locationDescription")}),e.jsx("textarea",{rows:3,className:"mt-1 block w-full rounded-md border",style:{borderColor:"#E5E7EB"},value:B,onChange:s=>T(s.target.value)})]})]})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:S,className:`px-4 py-2 text-white rounded-md ${S?"bg-amber-400":"bg-amber-600 hover:bg-amber-700"}`,children:S?"…":a("register.chief.button")})})]})]})};export{se as default};
