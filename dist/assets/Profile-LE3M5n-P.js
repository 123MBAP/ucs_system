import{j as e}from"./index-DZTFkylD.js";import{r as a}from"./react-CzDbI3ao.js";const S="http://localhost:4000",H=()=>{const[C,E]=a.useState(""),[U,F]=a.useState(""),[p,P]=a.useState(""),[$,I]=a.useState(""),[i,g]=a.useState(""),[O,r]=a.useState(null),[L,b]=a.useState(null),[_,R]=a.useState(!1),[c,j]=a.useState(!1),[d,y]=a.useState(!1),[u,N]=a.useState(!1),[m,v]=a.useState(!1),[w,f]=a.useState(!1),A=a.useRef(null),[x,k]=a.useState(null);a.useEffect(()=>{const t=localStorage.getItem("token");t&&fetch(`${S}/api/profile`,{headers:{Authorization:`Bearer ${t}`}}).then(async n=>{const s=await n.json();if(!n.ok)throw new Error((s==null?void 0:s.error)||"Failed to load profile");const l=s.profile||{};P(l.username||""),E(l.first_name||""),F(l.last_name||""),I(l.phone_number||""),g(l.profile_image_url||"")}).catch(n=>r(n.message||"Failed to load profile"))},[]);function D(t){g(t.target.value)}function T(){var t;(t=A.current)==null||t.click()}function z(t){var l;const n=(l=t.target.files)==null?void 0:l[0];if(!n)return;const s=new FileReader;s.onload=()=>{const o=String(s.result||"");k(o),f(!0)},s.readAsDataURL(n)}async function J(t){if(t.preventDefault(),r(null),b(null),!p.trim()){r("Username is required.");return}const n=localStorage.getItem("token");if(!n){r("Not authenticated");return}R(!0);try{let s=i;if(x){const B=await fetch(`${S}/api/profile/upload-base64`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({dataUrl:x})}),h=await B.json();if(!B.ok)throw new Error((h==null?void 0:h.error)||"Failed to upload image");s=h.profile_image_url||s,g(s)}const l=await fetch(`${S}/api/profile`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({firstName:C,lastName:U,username:p,phone:$,profileImageUrl:s})}),o=await l.json();if(!l.ok)throw new Error((o==null?void 0:o.error)||"Failed to save profile");b("Profile saved."),j(!1),y(!1),N(!1),v(!1),f(!1),k(null)}catch(s){r((s==null?void 0:s.message)||"Failed to save profile")}finally{R(!1)}}const q=c||d||u||m||w;return e.jsxs("div",{className:"p-6 max-w-3xl",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"My Profile"}),e.jsxs("form",{onSubmit:J,className:"space-y-6",children:[O&&e.jsx("div",{className:"text-red-600",children:O}),L&&e.jsx("div",{className:"text-green-600",children:L}),e.jsxs("div",{className:"flex items-start space-x-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-gray-200 overflow-hidden flex items-center justify-center",children:x||i?e.jsx("img",{src:x||i,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-gray-500",children:"No image"})}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"text-sm px-3 py-1 rounded bg-gray-100",onClick:()=>f(!0),children:"Edit"}),w&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"text-sm px-3 py-1 rounded bg-blue-600 text-white",onClick:T,children:"Choose File"}),e.jsx("input",{ref:A,type:"file",accept:"image/*",onChange:z,className:"hidden"})]})]}),w&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Or Image URL"}),e.jsx("input",{type:"url",value:i,onChange:D,placeholder:"https://.../image.jpg",className:"mt-1 block w-64 rounded-md border-gray-300 shadow-sm"})]})]}),e.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"First Name"}),e.jsx("button",{type:"button",className:"text-xs text-blue-600",onClick:()=>j(t=>!t),children:c?"Cancel":"Edit"})]}),e.jsx("input",{className:`mt-1 block w-full rounded-md ${c?"border-gray-300 shadow-sm":"border-transparent bg-transparent p-0 outline-none focus:outline-none focus:ring-0 focus:border-transparent"}`,value:C,onChange:t=>E(t.target.value),readOnly:!c})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Last Name"}),e.jsx("button",{type:"button",className:"text-xs text-blue-600",onClick:()=>y(t=>!t),children:d?"Cancel":"Edit"})]}),e.jsx("input",{className:`mt-1 block w-full rounded-md ${d?"border-gray-300 shadow-sm":"border-transparent bg-transparent p-0 outline-none focus:outline-none focus:ring-0 focus:border-transparent"}`,value:U,onChange:t=>F(t.target.value),readOnly:!d})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Username"}),e.jsx("button",{type:"button",className:"text-xs text-blue-600",onClick:()=>N(t=>!t),children:u?"Cancel":"Edit"})]}),e.jsx("input",{className:`mt-1 block w-full rounded-md ${u?"border-gray-300 shadow-sm":"border-transparent bg-transparent p-0 outline-none focus:outline-none focus:ring-0 focus:border-transparent"}`,value:p,onChange:t=>P(t.target.value),readOnly:!u})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Phone Number"}),e.jsx("button",{type:"button",className:"text-xs text-blue-600",onClick:()=>v(t=>!t),children:m?"Cancel":"Edit"})]}),e.jsx("input",{className:`mt-1 block w-full rounded-md ${m?"border-gray-300 shadow-sm":"border-transparent bg-transparent p-0 outline-none focus:outline-none focus:ring-0 focus:border-transparent"}`,value:$,onChange:t=>I(t.target.value),readOnly:!m})]})]})]}),q&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"submit",disabled:_,className:`px-4 py-2 rounded-md text-white ${_?"bg-blue-400":"bg-blue-600 hover:bg-blue-700"}`,children:"Save"}),e.jsx("button",{type:"button",className:"px-4 py-2 rounded-md bg-gray-100",onClick:()=>{j(!1),y(!1),N(!1),v(!1),f(!1),k(null),b(null),r(null)},children:"Cancel"})]})]})]})};export{H as default};
