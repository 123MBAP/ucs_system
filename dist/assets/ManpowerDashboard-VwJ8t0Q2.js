import{u as S,j as e}from"./index-CdjKjvMW.js";import{r as m}from"./react-CzDbI3ao.js";import{d as A,i as N,T as E,W as B}from"./ui-C_j-RX_5.js";const f="http://localhost:4000",C=()=>{var p,v,j,b,w;const{t:r}=S(),[,z]=m.useState(null),[n,y]=m.useState({name:"",salary:null,vehicle:null,driver:null,supervisor:null}),[a,h]=m.useState(!1),[u,k]=m.useState([]);return m.useEffect(()=>{const t=localStorage.getItem("token");t&&(h(!0),fetch(`${f}/api/manpower/dashboard`,{headers:{Authorization:`Bearer ${t}`}}).then(async l=>{var d,c,o;const s=await l.json();if(!l.ok)throw new Error((s==null?void 0:s.error)||"Failed to load dashboard");z(s.user);const i=[(d=s==null?void 0:s.user)==null?void 0:d.first_name,(c=s==null?void 0:s.user)==null?void 0:c.last_name].filter(Boolean).join(" ")||((o=s==null?void 0:s.user)==null?void 0:o.username)||"";y({name:i,salary:(s==null?void 0:s.salary)??null,vehicle:(s==null?void 0:s.vehicle)??null,driver:(s==null?void 0:s.driver)??null,supervisor:(s==null?void 0:s.supervisor)??null})}).catch(l=>console.error("Load manpower profile error:",l)).finally(()=>h(!1)),fetch(`${f}/api/manpower/schedule`,{headers:{Authorization:`Bearer ${t}`}}).then(async l=>{const s=await l.json();if(!l.ok)throw new Error((s==null?void 0:s.error)||"Failed to load schedule");k(Array.isArray(s.schedule)?s.schedule:[])}).catch(l=>console.error("Load manpower schedule error:",l)))},[]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-zinc-800 to-indigo-600 bg-clip-text text-transparent",children:r("manpower.title")}),e.jsx("p",{className:"text-zinc-600 mt-2",children:r("manpower.subtitle")})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-4 sm:mt-0 text-sm text-zinc-500",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{children:r("manpower.profileActive")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-600",children:r("manpower.name")}),e.jsx("div",{className:"text-2xl font-bold text-zinc-900 mt-1",children:a?"…":n.name||"-"})]}),e.jsx("div",{className:"shrink-0 p-2 rounded-lg bg-indigo-50 text-indigo-600",children:e.jsx(A,{className:"h-8 w-8"})})]})}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-600",children:r("manpower.assignedVehicle")}),e.jsx("div",{className:"text-2xl font-bold text-zinc-900 mt-1",children:a?"…":((p=n.vehicle)==null?void 0:p.plate)||r("manpower.notAssigned")}),e.jsxs("div",{className:"text-sm text-zinc-600 mt-2 flex items-center gap-1",children:[e.jsx(N,{className:"w-4 h-4"})," ",r("manpower.driver"),": ",a?"…":((v=n.driver)==null?void 0:v.full_name)||((j=n.driver)==null?void 0:j.username)||"-"]}),e.jsxs("div",{className:"text-sm text-zinc-600 mt-1 flex items-center gap-1",children:[e.jsx(N,{className:"w-4 h-4"})," ",r("manpower.supervisor"),": ",a?"…":((b=n.supervisor)==null?void 0:b.full_name)||((w=n.supervisor)==null?void 0:w.username)||"-"]})]}),e.jsx("div",{className:"shrink-0 p-2 rounded-lg bg-amber-50 text-amber-600",children:e.jsx(E,{className:"h-8 w-8"})})]})}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-600",children:r("manpower.salary")}),e.jsx("div",{className:"text-2xl font-bold text-zinc-900 mt-1",children:a?"…":n.salary!=null?n.salary.toLocaleString():"Not set"})]}),e.jsx("div",{className:"shrink-0 p-2 rounded-lg bg-emerald-50 text-emerald-600",children:e.jsx(B,{className:"h-8 w-8"})})]})})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-4",children:e.jsx("h2",{className:"text-xl font-bold text-zinc-800",children:r("manpower.schedule.title")})}),u.length===0?e.jsx("div",{className:"text-zinc-600",children:r("manpower.schedule.none")}):e.jsx("div",{className:"space-y-4",children:u.map(t=>{var o,g;const s=[r("weekday.mon"),r("weekday.tue"),r("weekday.wed"),r("weekday.thu"),r("weekday.fri"),r("weekday.sat"),r("weekday.sun")][(Number(t.service_day)||1)-1]||"",i=t.supervisor_status,d=i==null?{text:r("status.pending"),cls:"bg-amber-50 text-amber-700 border-amber-200"}:i==="complete"?{text:r("status.completed"),cls:"bg-emerald-50 text-emerald-700 border-emerald-200"}:{text:r("status.notCompleted"),cls:"bg-red-50 text-red-700 border-red-200"},c=(()=>{const x=t.assigned_manpower_names,_=t.assigned_manpower_usernames??[];return(x&&x.length?x:_)||[]})();return e.jsxs("div",{className:"rounded-xl border border-zinc-100 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-zinc-900 font-semibold",children:s}),e.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded-lg border ${d.cls}`,children:d.text})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"rounded-lg bg-zinc-50 p-3",children:[e.jsx("div",{className:"text-xs text-zinc-500",children:r("manpower.vehicle")}),e.jsx("div",{className:"text-sm font-semibold text-zinc-800",children:t.vehicle_plate||"-"})]}),e.jsxs("div",{className:"rounded-lg bg-zinc-50 p-3",children:[e.jsx("div",{className:"text-xs text-zinc-500",children:r("manpower.driver")}),e.jsx("div",{className:"text-sm font-semibold text-zinc-800",children:t.driver_username||"-"})]}),e.jsxs("div",{className:"rounded-lg bg-zinc-50 p-3",children:[e.jsx("div",{className:"text-xs text-zinc-500",children:r("common.serviceStart")}),e.jsx("div",{className:"text-sm font-semibold text-zinc-800",children:((o=t.service_start)==null?void 0:o.slice(0,5))||"-"})]}),e.jsxs("div",{className:"rounded-lg bg-zinc-50 p-3",children:[e.jsx("div",{className:"text-xs text-zinc-500",children:r("common.serviceEnd")}),e.jsx("div",{className:"text-sm font-semibold text-zinc-800",children:((g=t.service_end)==null?void 0:g.slice(0,5))||"-"})]})]}),e.jsxs("div",{className:"mt-3 text-xs text-zinc-600 space-y-1",children:[!!t.zone_name&&e.jsxs("div",{children:[r("manpower.zone"),": ",t.zone_name]}),c.length>0&&e.jsxs("div",{children:[r("manpower.team"),": ",c.join(", ")]}),i==="not_complete"&&t.supervisor_reason&&e.jsxs("div",{className:"text-red-600",children:[r("manpower.reason"),": ",t.supervisor_reason]})]})]},t.id)})})]})]})};export{C as default};
